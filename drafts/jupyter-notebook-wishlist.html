<!DOCTYPE html>
<html lang="en">
<head>
        <title>A Jupyter Notebook Wishlist</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
          <link rel="stylesheet" href="https://www.ianbicking.org/theme/css/style.min.css">
        <!--<link rel="stylesheet" href="https://www.ianbicking.org/theme/css/main.css" type="text/css" />-->
        <link href="https://www.ianbicking.org/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="Ian Bicking: a blog Atom Feed" />
        <link rel="icon" href="https://www.ianbicking.org/favicon.ico">

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://www.ianbicking.org/css/ie.css"/>
                <script src="https://www.ianbicking.org/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://www.ianbicking.org/css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">
  <div id="main-wrapper1">
  <div id="main-wrapper2">
  <div id="main-container">
        <header id="banner" class="body">
                <h1><a href="https://www.ianbicking.org">Ian Bicking: a blog </a></h1>
        </header><!-- /#banner -->
<section id="content" class="body">
    <article>
        <header>
            <abbr class="published" title="2018-03-28T00:00:00-05:00">
                Wednesday, March 28th, 2018
            </abbr>
            <h1 class="entry-title">
                <a
                    href="https://www.ianbicking.org/drafts/jupyter-notebook-wishlist.html"
                    rel="bookmark"
                    title="Permalink to A Jupyter Notebook Wishlist"
                    >A Jupyter Notebook&nbsp;Wishlist</a
                >
            </h1>
        </header>

        <div class="entry-content"><p>I&#8217;ve been using Jupyter Notebook recently, and generally I like it, especially for exploratory programming: exploring data, algorithms, learning&nbsp;models.</p>
<p>But I can&#8217;t like something without also deeply desiring changes in that very same thing. I even <a href="https://github.com/ianb/sheets">started playing with some ideas</a>, but after hitting some speedbumps I had to admit to myself that I couldn&#8217;t put forward extended attention on the&nbsp;topic.</p>
<h1>What I&nbsp;like</h1>
<p>I wouldn&#8217;t make a wishlist if I wasn&#8217;t starting with something I appreciate. Here&#8217;s what I&nbsp;like:</p>
<ul>
<li>You can share many different kinds of work as a notebook. It can be instructional, with just the framework of a solution. It can be a complete piece of code or an idea you are showing off. Or rough code where you bring you own data. And putting in expository Markdown can really take it to the next level of&nbsp;polish.</li>
<li>Opening a notebook and seeing someone&#8217;s previous output is great. Often that &#8220;someone&#8221; is your past self, but it&#8217;s just as useful then too. It&#8217;s not a guarantee that if you re-run the notebook you&#8217;ll get the same result, but it&#8217;s something. Normal code never has&nbsp;this.</li>
<li>You get the interactiveness of a <span class="caps">REPL</span>, but in a more declarative and persistent container of the&nbsp;notebook.</li>
<li>Unlike a <span class="caps">REPL</span>, it&#8217;s reasonable to write extended pieces of code in a notebook. It&#8217;s not great, but there&#8217;s no ceiling you hit where it falls apart. This is good for exploration because you don&#8217;t always know which snippet of code is the one you&#8217;ll keep adding&nbsp;to.</li>
<li>It&#8217;s much easier to look back on what you did than in a <span class="caps">REPL</span>.</li>
<li>A web interface is so, so, so much more information-rich than text interfaces, and that opens up a lot of&nbsp;potential.</li>
</ul>
<p>Some parts of <a href="https://blog.jupyter.org/jupyterlab-is-ready-for-users-5a6f039b8906">JupyterLab</a> look interesting, but it doesn&#8217;t feel like it builds on Notebook&#8217;s strengths, and instead aches to be an <span class="caps">IDE</span>.</p>
<h1>What could be&nbsp;better</h1>
<h2>Batteries aren&#8217;t&nbsp;included</h2>
<p>There are a lot of extension for Jupyter. I guess, because sometimes I see other people using interesting extensions. Finding them isn&#8217;t easy, I can&#8217;t even find a list of the extensions shipped by default. I&#8217;m sure other people have gotten used to copy and pasting a common set of <code>%load_ext</code> to the top of their&nbsp;notebooks.</p>
<p>You get a warning when you re-run <code>%load_ext</code>! Reentrant code in Jupyter is a much larger topic, but at least the built-in features of Jupyter should all be reentrant and the system shouldn&#8217;t complain about&nbsp;it.</p>
<p>Jupyter is constantly being used by people who haven&#8217;t used Jupyter before. Having to discover, explore, and install features through extensions leaves most people without access to those&nbsp;features.</p>
<h2>Interface&nbsp;improvements</h2>
<p>So much basic stuff! Keyboard shortcuts aren&#8217;t documented in the interface. I don&#8217;t know about other people, but I <em>still</em> try to use the context menu to do basic operations. It&#8217;s super easy to add context menus to a web page! Everything seems jammed into this one simple model that I imagine is based on the IPython <span class="caps">REPL</span>. And perhaps a certain ambivalence about <span class="caps">HTML</span> (<a href="https://nbconvert.readthedocs.io/en/latest/">nbconvert</a>?)</p>
<h3>Information&nbsp;density</h3>
<p>You can include so much information in <span class="caps">HTML</span>! For instance, I sometimes care about how long a cell takes to execute. Adding the execution time (when it&#8217;s non-trivial) would be so easy! You could make it small, you could tuck it away, you could have an inspector. If a cell takes surprisingly long to run I <em>definitely</em> don&#8217;t want to edit the cell, add <code>%timeit</code> and&nbsp;rerun!</p>
<h3>Print&nbsp;overflow</h3>
<p>It&#8217;s easy to write a loop with a <code>print()</code> statement and practically DoS your notebook. If there&#8217;s too much data then please, just throw it away, or even abort the entire thing. If it&#8217;s really important to some people to be able to print excessive data, then maybe tuck it away in the Python process for lazy&nbsp;retrieval.</p>
<h2>Inspect the&nbsp;source</h2>
<p>While <a href="https://github.com/ianb/sheets">my experimentation</a> didn&#8217;t even get to the idea I started with, one thing that worked super well was <a href="https://github.com/ianb/sheets/blob/0d7520d442100d58c122ea27c8b70997a45b8d6c/sheets/env.py#L141-L287">source code rewriting</a>.</p>
<p>I used this technique to translate code like&nbsp;this:</p>
<div class="highlight"><pre><span></span><code><span class="n">do_some_routine</span><span class="p">()</span> <span class="c1"># or any top-level expression</span>
</code></pre></div>

<p>to:</p>
<div class="highlight"><pre><span></span><code><span class="n">print_expr</span><span class="p">(</span><span class="s2">&quot;do_some_routing()&quot;</span><span class="p">,</span> <span class="n">do_some_routine</span><span class="p">())</span>
</code></pre></div>

<p>And then when you execute the cell you&#8217;ll see the expression alongside the result. The result is great, and replaced most uses of <code>print()</code> for me. Most of the time my extra arguments to <code>print()</code> were just ways of labeling the value, and the expression does that pretty well on its&nbsp;own.</p>
<p>I also added a way to explicitly watch an expression with <code>watch()</code>, with the same affordances, and bailing out if there&#8217;s too much&nbsp;output.</p>
<h2>Understand how cells depend on each&nbsp;other</h2>
<p>I have often found myself creating non-repeatable notebooks because I executed things out of order in invalid&nbsp;ways.</p>
<p>So long as you allow out-of-order execution, then it&#8217;s basically impossible to avoid this entirely. But I think it can be warned. Again using source inspection you can determine where variables are declared, reassigned, and used. This could at least be used to warn about cases when you are executing a cell with stale data (e.g., you&#8217;ve edited but not executed a previous cell, and now execute a cell that depends on that previous&nbsp;cell).</p>
<p>Or simpler solutions just could involve highlighting out of order&nbsp;executions.</p>
<h2>We need a pattern for reentrant but expensive data&nbsp;generation</h2>
<p>In many Jupyter use cases there is code that works really hard to do something, and then the result can be saved. In the simplest case this is just downloading some data, but obviously there are many other&nbsp;cases.</p>
<p>It&#8217;s possible this could all be done in code without explicit Jupyter support, but it&#8217;s something Jupyter specifically needs (and some support would be&nbsp;great).</p>
<p>The basic pattern is: this code generates a file. If the file exists, and the file was generated by this code, then executing the cell should not execute the&nbsp;code.</p>
<p>You could do this in Python with a pattern that maybe looks&nbsp;like:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@generates_files</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">my_generator</span><span class="p">():</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;data.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">urllib</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s2">&quot;http://some-location&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data.csv&quot;</span><span class="p">)</span>
</code></pre></div>

<p><code>@generates_file</code> would keep its own metadata on disk somewhere, would call <code>my_generator()</code> if it thought the data needed to be generated, and would probably do a before-and-after filesystem scan to see what files were generated. I use a function (<code>my_generator()</code>) because the source is easier to introspect, and you can conditionally execute it. <span class="caps">OTOH</span> it reads&nbsp;horribly.</p>
<p>This lets you lazily create files, and makes it easy to re-execute cells. However, the data being tracked is only on disk, it doesn&#8217;t handle loading the file, and it doesn&#8217;t understand prerequisite data. So there&#8217;s more to be done here, but it seems possible to work out. It should be possible to safely compose data pipelines in Jupyter, and re-run the notebook without having to do all the work over each&nbsp;time.</p>
<p>Some Jupyter notebooks implement this in ad hoc ways. But doing so is often hard to read. Most notebooks do nothing. As a result it&#8217;s painful to rerun all the cells from the top, even though that&#8217;s good&nbsp;practice.</p>
<h2>Wait&#8230; something changed,&nbsp;right?</h2>
<p>Have you ever re-executed a cell, and thought&#8230; I&#8217;m pretty sure the output changed. But how? I wasn&#8217;t expecting anything to&nbsp;change&#8230;</p>
<p>A little history please! This doesn&#8217;t have to be some fancy versioning system, and view-only would be&nbsp;fine.</p>
<h2>Aborting</h2>
<p>It&#8217;s hard to abort execution of something. The only reliable thing I&#8217;ve found is restarting the&nbsp;kernel.</p>
<p>Python doesn&#8217;t make it easy to manage processes and execution. I struggled with this myself back in the&nbsp;day.</p>
<h2>Handling external code&nbsp;edits</h2>
<p>Ugh <code>%autoreload</code>. It kind of works. Littering it through my notebooks is not good expository&nbsp;practice.</p>
<p>I know this is a hard problem. But not all of it is hard. It&#8217;s not hard to <em>warn</em> the user that they are using out of date code. It&#8217;s a little harder, but still feasible, to warn the user that they have out of date instances (one of the more common obstacles to safe&nbsp;reloading).</p>
<p>Putting control over reloading somewhere other than in the code cell itself would be sensible, e.g., a &#8220;reload and run&#8221;&nbsp;command.</p>
<h2>Interaction between Markdown and&nbsp;code</h2>
<p>This might not be practical, but I like what Bret Victor was getting at with <a href="http://worrydream.com/Tangle/">Tangle</a>, which lets you interact with parameters and see the&nbsp;effect.</p>
<p>In many cases there are more-or-less arbitrary and simple parameters that inform the code. These typically get stuffed into code, but it would be nice to treat them&nbsp;separately.</p>
<p>This would greatly benefit from an understanding of dependencies, since it specifically invites playing with variables that would invalidate cell&nbsp;output.</p>
<h2>Interactive&nbsp;widgets</h2>
<h2>Tracebacks</h2>
<p>It&#8217;s a pet topic of mine (since I wrote the first version of it in <a href="http://www.ianbicking.org/ajaxy-exception-catching.html">2005</a>, damn time marches on&#8230;) the one debugging tool I liked more than printing (which is still my go-to debugging approach in any language) is an interactive&nbsp;traceback.</p>
<p>The traceback in Jupyter doesn&#8217;t do anything fancy, but does manage to be longer than average without adding much useful&nbsp;information.</p>
<h2>I can&#8217;t open a notebook&nbsp;directly</h2>
<p>Instead I always get the folder, then forced into a new window for the notebook. Boo! <code>target=_blank</code> would make sense <em>inside</em> the notebook, where there&#8217;s a lot of state and the user might not want to open a link in the current window. But the folder view has no state, and there&#8217;s no reason to override normal&nbsp;navigation.</p>
<h2>Language&nbsp;agnosticism</h2>
<p>This isn&#8217;t a complaint, but acknowledging a constraint: each of these improvements tends to bind Jupyter Notebook more closely to a backend runtime that is configured for Jupyter. I&#8217;ve proposed things that are mostly feasible in Python, but may not be in other&nbsp;languages.</p>
<p>In my own experiment I went for tight binding between frontend and the backend: the backend produced <span class="caps">JSON</span>, and all the actual rendering was up to the frontend. Of course some of the <span class="caps">JSON</span> was &#8220;here is some text printed to stdout&#8221;, but I tried to improve on that when I could. I don&#8217;t think that would be a good approach for Jupyter. Handling a combination of dependencies that span the frontend and backend is a largely unsolved problem, and it requires highly invested developers who understand the entirety of the system (doable for fulltime employees and a small number of kernels, not feasible for open source contributors or people maintaining kernels on the&nbsp;side).</p>
<h2>Partitioning code into cells can seem&nbsp;arbitrary</h2>
<p>I don&#8217;t know how I feel about cells. It&#8217;s what makes the notebook interactive, and different from a module. But I frequently find myself splitting up cells, or treating them as a unit (i.e., always executing them in&nbsp;series).</p>
<h2>Every cell wants to become a&nbsp;function</h2>
<p>Everytime I experiment with an idea, I start by executing it at the top level, getting it working, and then I want to generalize: how can I compare one approach to another? How can I ensure a series of things work&nbsp;together?</p>
<p>Functions are the normal Python unit of repeatable and parameterized computation. And so cells always want to become a function (or sets of cells, since the actual cells are created&nbsp;organically).</p>
<p>Maybe in a sense this is how cell dependency should be understood. Each cell is <em>always</em> a kind of function, taking in the globals, and outputing new globals, and these are the parameters and return values of the cells. Taken to its illogicly circular conclusion, a cell with a function definition returns the function, and depends on whatever the function&nbsp;calls.</p></div>
        <!-- /.entry-content -->
    </article>
</section>
        <section id="extras" class="body">
                <div class="links">
                  <h2><a href="https://www.ianbicking.org">here</a></h2>
                  <ul>
                    <li><a href="/blog/">blog</a></li>
                    <li><a href="/projects.html">projects</a></li>
                    <li><a href="https://www.ianbicking.org/archives.html">archives</a> &amp; <a href="https://www.ianbicking.org/categories.html">categories</a></li>
                    <li><a href="https://www.ianbicking.org/category/javascript.html">category: javascript</a></li>
                    <li><a href="https://www.ianbicking.org/category/misc.html">category: misc</a></li>
                    <li><a href="https://www.ianbicking.org/category/mozilla.html">category: mozilla</a></li>
                    </ul>
                </div>
                <div class="social">
                        <h2>elsewhere</h2>
                        <ul>
                            <li><a href="https://www.ianbicking.org/feeds/atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="https://twitter.com/ianbicking">@ianbicking</a></li>
                            <li><a href="https://hachyderm.io/@ianbicking">@ianbicking@hachyderm.io</a></li>
                            <li><a href="https://github.com/ianb">Github</a></li>
                        </ul>
                </div><!-- /.social -->
                <div class="archives">
                  <h2><a href="https://www.ianbicking.org/blog/">recent posts</a></h2>
                  <ul>
                    <li><a href="https://www.ianbicking.org/blog/2020/11/firefox-was-always-enough.html">Firefox Was Always&nbsp;Enough</a></li>
                    <li><a href="https://www.ianbicking.org/blog/2020/09/project-ideas-2020.html">Project ideas for (what&#8217;s left of)&nbsp;2020</a></li>
                    <li><a href="https://www.ianbicking.org/blog/2020/09/a-history-of-projects.html">A History Of&nbsp;Projects</a></li>
                    <li><a href="https://www.ianbicking.org/blog/2020/08/thoughts-on-voice-interfaces.html">Thoughts on Voice&nbsp;Interfaces</a></li>
                    <li><a href="https://www.ianbicking.org/blog/2019/07/kling-axes-of-politics-technocrats.html">Kling&#8217;s Axes of Politics, and the&nbsp;Technocrats</a></li>
                    <li><a href="https://www.ianbicking.org/blog/2019/04/users-want-control-is-a-shrug.html"><span class="dquo">&#8220;</span>Users want control&#8221; is a shoulder&nbsp;shrug</a></li>
                    <li><a href="https://www.ianbicking.org/blog/2019/03/open-source-doesnt-make-money-by-design.html">Open Source Doesn&#8217;t Make Money Because It Isn&#8217;t Designed To Make&nbsp;Money</a></li>
                    <li><a href="https://www.ianbicking.org/blog/2019/03/firefox-experiments-i-would-have-liked.html">The Firefox Experiments I Would Have Liked To&nbsp;Try</a></li>
                    <li><a href="https://www.ianbicking.org/blog/2019/01/overengaged-knowledge-worker.html">The Over-engaged Knowledge&nbsp;Worker</a></li>
                    <li><a href="https://www.ianbicking.org/blog/2019/01/we-need-open-hosting-platforms.html">We Need Open Hosting&nbsp;Platforms</a></li>
                  </ul>
                </div><!-- /.archives -->

                <div class="widgets">
                  <h2><a href="https://twitter.com/ianbicking">tweets</a></h2>
                  <a class="twitter-timeline" width="230" height="500" href="https://twitter.com/ianbicking" data-widget-id="319849964417187842" data-link-color="#aaae94">Tweets by @ianbicking</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

                </div><!-- /.widgets -->

        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
          This is the personal site of <a href="/">Ian Bicking</a>.  The opinions expressed here are my own.
        </footer><!-- /#contentinfo -->

<script src="/theme/instantclick.min.js"></script>
    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-2442258-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>
        </div><!-- /#main-container -->
        </div><!-- /#main-wrapper2 -->
        </div><!-- /#main-wrapper1 -->
</body>
</html>