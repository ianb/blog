<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <!-- MOBIFY - DO NOT ALTER - PASTE IMMEDIATELY AFTER OPENING HEAD TAG -->
        <script type="text/javascript">
            /*<![CDATA[*/ (function (a) {
                function b(a, b) {
                    if (+a) return ~a || (d.cookie = h + "=; path=/");
                    (j = d.createElement(e)),
                        (k = d.getElementsByTagName(e)[0]),
                        (j.src = a),
                        b && (j.onload = j.onerror = b),
                        k.parentNode.insertBefore(j, k);
                }
                function c() {
                    n.api || b(l.shift() || -1, c);
                }
                if (this.Mobify) return;
                var d = document,
                    e = "script",
                    f = "mobify",
                    g = "." + f + ".com/",
                    h = f + "-path",
                    i = g + "un" + f + ".js",
                    j,
                    k,
                    l = [!1, 1],
                    m,
                    n = (this.Mobify = {
                        points: [+new Date()],
                        tagVersion: [6, 0],
                    }),
                    o = /(; |#|&|^)mobify-path=([^&;]*)/g.exec(
                        location.hash + "; " + d.cookie
                    );
                o
                    ? (m = o[2]) &&
                      !+(m = sessionStorage[h] || m) &&
                      (l = [!0, "//preview" + g + escape(m)])
                    : ((l = a() || l),
                      l[0] && l.push("//cdn" + i, "//files01" + i)),
                    l.shift()
                        ? (d.write('<plaintext style="display:none;">'),
                          setTimeout(c))
                        : b(l[0]);
            })(function () {
                if (
                    /ip(hone|od)|android.*(mobile)|blackberry.*applewebkit/i.test(
                        navigator.userAgent
                    )
                ) {
                    return [
                        1,
                        "//cdn.mobify.com/sites/ians-blog/production/mobify.js",
                    ];
                }
            }); /*]]>*/
        </script>
        <!-- END MOBIFY -->
        <title>Ian Bicking: a blog :: HTML</title>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
        <meta name="generator" content="WordPress 3.4.2" />
        <!-- LEAVE FOR STATS -->
        <meta name="description" content="" />
        <link
            rel="stylesheet"
            title="plaintxtSimpler"
            href="../../wp-content/themes/Barthelme-ianb/style.css"
            type="text/css"
            media="all"
        />
        <link rel="start" href="../../index.html" title="Ian Bicking: a blog" />
        <link
            rel="alternate"
            type="application/atom+xml"
            title="Ian Bicking: a blog Atom Feed"
            href="../../feed/atom/index.html"
        />
        <link
            rel="alternate"
            type="application/rss+xml"
            title="Ian Bicking: a blog RSS 2.0 Feed"
            href="../../feed/rss/index.html"
        />
        <link
            rel="alternate"
            type="application/rss+xml"
            title="Ian Bicking: a blog Comments RSS 2.0 Feed"
            href="../../comments/feed/index.html"
        />
        <link
            rel="alternate"
            type="application/rdf+xml"
            title="Ian Bicking: a blog RSS 1.0"
            href="../../feed/rdf/index.html"
        />
        <link
            rel="alternate"
            type="text/xml"
            title="Ian Bicking: a blog RSS 0.92 Feed"
            href="../../feed/rss/index.html"
        />

        <link
            rel="archives"
            title="October 2012"
            href="../../2012/10/index.html"
        />
        <link
            rel="archives"
            title="February 2012"
            href="../../2012/02/index.html"
        />
        <link
            rel="archives"
            title="April 2011"
            href="../../2011/04/index.html"
        />
        <link
            rel="archives"
            title="March 2011"
            href="../../2011/03/index.html"
        />
        <link
            rel="archives"
            title="September 2010"
            href="../../2010/09/index.html"
        />
        <link
            rel="archives"
            title="August 2010"
            href="../../2010/08/index.html"
        />
        <link rel="archives" title="May 2010" href="../../2010/05/index.html" />
        <link
            rel="archives"
            title="April 2010"
            href="../../2010/04/index.html"
        />
        <link
            rel="archives"
            title="March 2010"
            href="../../2010/03/index.html"
        />
        <link
            rel="archives"
            title="February 2010"
            href="../../2010/02/index.html"
        />
        <link
            rel="archives"
            title="January 2010"
            href="../../2010/01/index.html"
        />
        <link
            rel="archives"
            title="September 2009"
            href="../../2009/09/index.html"
        />
        <link rel="archives" title="May 2009" href="../../2009/05/index.html" />
        <link
            rel="archives"
            title="April 2009"
            href="../../2009/04/index.html"
        />
        <link
            rel="archives"
            title="January 2009"
            href="../../2009/01/index.html"
        />
        <link
            rel="archives"
            title="December 2008"
            href="../../2008/12/index.html"
        />
        <link
            rel="archives"
            title="November 2008"
            href="../../2008/11/index.html"
        />
        <link
            rel="archives"
            title="October 2008"
            href="../../2008/10/index.html"
        />
        <link
            rel="archives"
            title="September 2008"
            href="../../2008/09/index.html"
        />
        <link
            rel="archives"
            title="August 2008"
            href="../../2008/08/index.html"
        />
        <link
            rel="archives"
            title="July 2008"
            href="../../2008/07/index.html"
        />
        <link
            rel="archives"
            title="June 2008"
            href="../../2008/06/index.html"
        />
        <link rel="archives" title="May 2008" href="../../2008/05/index.html" />
        <link
            rel="archives"
            title="April 2008"
            href="../../2008/04/index.html"
        />
        <link
            rel="archives"
            title="March 2008"
            href="../../2008/03/index.html"
        />
        <link
            rel="archives"
            title="February 2008"
            href="../../2008/02/index.html"
        />
        <link
            rel="archives"
            title="January 2008"
            href="../../2008/01/index.html"
        />
        <link
            rel="archives"
            title="November 2007"
            href="../../2007/11/index.html"
        />
        <link
            rel="archives"
            title="October 2007"
            href="../../2007/10/index.html"
        />
        <link
            rel="archives"
            title="September 2007"
            href="../../2007/09/index.html"
        />
        <link
            rel="archives"
            title="August 2007"
            href="../../2007/08/index.html"
        />
        <link
            rel="archives"
            title="July 2007"
            href="../../2007/07/index.html"
        />
        <link
            rel="alternate"
            type="application/rss+xml"
            title="Ian Bicking: a blog &raquo; HTML Category Feed"
            href="feed/index.html"
        />
        <link
            rel="EditURI"
            type="application/rsd+xml"
            title="RSD"
            href="../../xmlrpc.php?rsd"
        />
        <link
            rel="wlwmanifest"
            type="application/wlwmanifest+xml"
            href="../../wp-includes/wlwmanifest.xml"
        />
        <meta name="generator" content="WordPress 3.4.2" />
        <link
            rel="stylesheet"
            href="../../wp-content/plugins/source-code-syntax-highlighting-plugin-for-wordpress/geshi.css"
            type="text/css"
        />
        <style type="text/css">
            .recentcomments a {
                display: inline !important;
                padding: 0 !important;
                margin: 0 !important;
            }
        </style>
        <style type="text/css" media="all">
            /*<![CDATA[*/
            body {
                font-size: 100%;
            }
            body {
                font-family: tahoma, geneva, sans-serif;
            }
            div.post-header,
            h2.post-title,
            p.post-date-single,
            h2.post-title-single,
            div.post-entry h1,
            div.post-entry h2,
            div.post-entry h3,
            div.post-entry h4,
            div.post-entry h5,
            div.post-entry h6,
            div.post-entry blockquote,
            div.post-footer,
            h3#comment-count,
            h4#comment-header,
            div#comments ol li p.comment-metadata,
            h4#respond {
                font-family: verdana, geneva, sans-serif;
            }
            div.post-entry p {
                text-align: left;
            }
            div#wrapper {
                width: 100%;
            }

            /*]]>*/
        </style>
    </head>
    <body>
        <div id="wrapper">
            <div
                id="header"
                onclick="location.href='https://ianbicking.org/';"
                style="cursor: pointer"
            >
                <h1 id="title">
                    <a href="../../index.html" title="Ian Bicking: a blog"
                        >Ian Bicking: a blog</a
                    >
                </h1>
                <p id="description"></p>
            </div>
            <!-- WP Theme Credits -->
            <div style="display: none">
                We can answer on question
                <a href="http://www.olnevhost.net/vps-hosting.html"
                    >what is VPS</a
                >? and what is
                <a href="http://www.olnevhost.net/dedicated-servers.html"
                    ><strong>cheap dedicated servers</strong></a
                >?
            </div>
            <!-- END HEADER -->
            <div id="container">
                <div id="content" class="narrowcolumn">
                    <p class="post-date-single">{ Category Archives }</p>
                    <h2 class="post-title-single">HTML</h2>

                    <div id="post-164" class="post">
                        <div class="post-container">
                            <div class="post-content">
                                <h2 class="post-title">
                                    <a
                                        href="../../2010/03/01/throw-out-your-frameworks-forms-included/index.html"
                                        title="Permalink to Throw out your frameworks! (forms included)"
                                        rel="bookmark"
                                        >Throw out your frameworks! (forms
                                        included)</a
                                    >
                                </h2>
                                <div class="post-entry">
                                    <div class="document">
                                        <p>
                                            No, I should say
                                            <em>forms particularly</em>.
                                        </p>
                                        <p>
                                            I have lots of things to blog about,
                                            but nothing makes me want to blog
                                            like <em>code</em>. Ideas are hard,
                                            code is easy. So when I saw
                                            <a
                                                class="reference external"
                                                href="http://jacobian.org/writing/dynamic-form-generation/"
                                                >Jacob&#8217;s writeup about
                                                dynamic Django form
                                                generation</a
                                            >
                                            I felt a desire to respond. I
                                            didn&#8217;t see the form panel at
                                            PyCon (I intended to but I hardly
                                            saw <em>any</em> talks at PyCon, and
                                            yet still didn&#8217;t even see a
                                            good number of the people I wanted
                                            to see), but as the author of an
                                            <a
                                                class="reference external"
                                                href="http://formencode.org/htmlfill.html"
                                                >ungenerator</a
                                            >
                                            and as a general
                                            <a
                                                class="reference external"
                                                href="../../on-form-libraries.html"
                                                >form library skeptic</a
                                            >
                                            I have a somewhat different
                                            perspective on the topic.
                                        </p>
                                        <p>
                                            The example created for the panel
                                            might display that perspective. You
                                            should go read
                                            <a
                                                class="reference external"
                                                href="http://jacobian.org/writing/dynamic-form-generation/"
                                                >Jacob&#8217;s description</a
                                            >; but basically it&#8217;s a simple
                                            registration form with a dynamic set
                                            of questions to ask.
                                        </p>
                                        <p>
                                            I have created a
                                            <a
                                                class="reference external"
                                                href="http://svn.colorstudy.com/home/ianb/formencode_answer.py"
                                                >complete example</a
                                            >, because I wanted to be sure I
                                            wasn&#8217;t skipping anything, but
                                            I&#8217;ll present a trimmed-down
                                            version.
                                        </p>
                                        <p>First, the basic control logic:</p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            <span class="kw1">from</span>
                                            webob.<span class="me1">dec</span>
                                            <span class="kw1">import</span>
                                            wsgify<br />
                                            <span class="kw1">from</span> webob
                                            <span class="kw1">import</span>
                                            exc<br />
                                            <span class="kw1">from</span>
                                            formencode
                                            <span class="kw1">import</span>
                                            htmlfill<br />
                                            <br />
                                            @<span class="co1">wsgify</span
                                            ><br />
                                            <span class="kw1">def</span>
                                            questioner<span class="br0"
                                                >&#40;</span
                                            >req<span class="br0">&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp; questions =
                                            get_questions<span class="br0"
                                                >&#40;</span
                                            >req<span class="br0">&#41;</span>
                                            <span class="co1"
                                                ># This is provided as part of
                                                the example</span
                                            ><br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">if</span>
                                            req.<span class="me1">method</span>
                                            ==
                                            <span class="st0">'POST'</span
                                            >:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; errors =
                                            validate<span class="br0"
                                                >&#40;</span
                                            >req, questions<span class="br0"
                                                >&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="kw1">if</span>
                                            <span class="kw1">not</span>
                                            errors:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                            &nbsp; ...
                                            <span class="me1">save</span>
                                            response ...<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                            &nbsp;
                                            <span class="kw1">return</span>
                                            exc.<span class="me1"
                                                >HTTPFound</span
                                            ><span class="br0">&#40;</span
                                            >location=<span class="st0"
                                                >'/thanks'</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">else</span>:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; errors =
                                            <span class="br0">&#123;</span
                                            ><span class="br0">&#125;</span
                                            ><br />
                                            &nbsp; &nbsp;
                                            <span class="co1"
                                                >## Here's the &quot;form
                                                generation&quot;:</span
                                            ><br />
                                            &nbsp; &nbsp; page =
                                            page_template.<span class="me1"
                                                >substitute</span
                                            ><span class="br0">&#40;</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            action=req.<span class="me1"
                                                >url</span
                                            >,<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            questions=questions<span class="br0"
                                                >&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; page = htmlfill.<span
                                                class="me1"
                                                >render</span
                                            ><span class="br0">&#40;</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; page,<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            defaults=req.<span class="me1"
                                                >POST</span
                                            >,<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            errors=errors<span class="br0"
                                                >&#41;</span
                                            ><br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">return</span>
                                            Response<span class="br0"
                                                >&#40;</span
                                            >page<span class="br0">&#41;</span
                                            ><br />
                                            <br />
                                            <span class="kw1">def</span>
                                            validate<span class="br0"
                                                >&#40;</span
                                            >req, questions<span class="br0"
                                                >&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp;
                                            <span class="co1"
                                                ># All manual, but do it however
                                                you want:</span
                                            ><br />
                                            &nbsp; &nbsp; errors =
                                            <span class="br0">&#123;</span
                                            ><span class="br0">&#125;</span
                                            ><br />
                                            &nbsp; &nbsp; form = req.<span
                                                class="me1"
                                                >POST</span
                                            ><br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">if</span>
                                            <span class="br0">&#40;</span
                                            >form.<span class="me1">get</span
                                            ><span class="br0">&#40;</span
                                            ><span class="st0">'password'</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="kw1">and</span>
                                            form<span class="br0">&#91;</span
                                            ><span class="st0">'password'</span
                                            ><span class="br0">&#93;</span> !=
                                            form.<span class="me1">get</span
                                            ><span class="br0">&#40;</span
                                            ><span class="st0"
                                                >'password_confirm'</span
                                            ><span class="br0">&#41;</span
                                            ><span class="br0">&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            errors<span class="br0">&#91;</span
                                            ><span class="st0"
                                                >'password_confirm'</span
                                            ><span class="br0">&#93;</span> =
                                            <span class="st0"
                                                >'Passwords do not match'</span
                                            ><br />
                                            &nbsp; &nbsp; fields = questions +
                                            <span class="br0">&#91;</span
                                            ><span class="st0">'username'</span
                                            >,
                                            <span class="st0">'password'</span
                                            ><span class="br0">&#93;</span
                                            ><br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">for</span> field
                                            <span class="kw1">in</span>
                                            fields:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="kw1">if</span>
                                            <span class="kw1">not</span>
                                            form.<span class="me1">get</span
                                            ><span class="br0">&#40;</span
                                            >field<span class="br0">&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                            &nbsp; errors<span class="br0"
                                                >&#91;</span
                                            >field<span class="br0">&#93;</span>
                                            =
                                            <span class="st0"
                                                >'Please enter a value'</span
                                            ><br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">return</span>
                                            errors<br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            I&#8217;ve just manually handled
                                            validation here. I don&#8217;t feel
                                            like doing it with FormEncode.
                                            Manual validation isn&#8217;t that
                                            big a deal; FormEncode would just
                                            produce the same
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >errors</span
                                                ></tt
                                            >
                                            dictionary anyway. In this case (as
                                            in many form validation cases) you
                                            can&#8217;t do better than
                                            hand-written validation code:
                                            it&#8217;s shorter, more
                                            self-contained, and easier to tweak.
                                        </p>
                                        <p>
                                            After validation the template is
                                            rendered:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            page = page_template.<span
                                                class="me1"
                                                >substitute</span
                                            ><span class="br0">&#40;</span
                                            ><br />
                                            &nbsp; &nbsp; action=req.<span
                                                class="me1"
                                                >url</span
                                            >,<br />
                                            &nbsp; &nbsp;
                                            questions=questions<span class="br0"
                                                >&#41;</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            I&#8217;m using
                                            <a
                                                class="reference external"
                                                href="http://pythonpaste.org/tempita/"
                                                >Tempita</a
                                            >, but it really doesn&#8217;t
                                            matter. The template looks like
                                            this:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            &lt;form action=<span class="st0"
                                                >&quot;{{action}}&quot;</span
                                            >
                                            method=<span class="st0"
                                                >&quot;POST&quot;</span
                                            >&gt;<br />
                                            New Username: &lt;input
                                            <span class="kw2">type</span>=<span
                                                class="st0"
                                                >&quot;text&quot;</span
                                            >
                                            name=<span class="st0"
                                                >&quot;username&quot;</span
                                            >&gt;&lt;br /&gt;<br />
                                            Password: &lt;input
                                            <span class="kw2">type</span>=<span
                                                class="st0"
                                                >&quot;password&quot;</span
                                            >
                                            name=<span class="st0"
                                                >&quot;password&quot;</span
                                            >&gt;&lt;br /&gt;<br />
                                            Repeat Password:<br />
                                            &nbsp; &lt;input
                                            <span class="kw2">type</span>=<span
                                                class="st0"
                                                >&quot;password&quot;</span
                                            >
                                            name=<span class="st0"
                                                >&quot;password_confirm&quot;</span
                                            >&gt;&lt;br /&gt;<br />
                                            <span class="br0">&#123;</span
                                            ><span class="br0">&#123;</span
                                            ><span class="kw1">for</span>
                                            question
                                            <span class="kw1">in</span>
                                            questions<span class="br0"
                                                >&#125;</span
                                            ><span class="br0">&#125;</span
                                            ><br />
                                            &nbsp;
                                            <span class="br0">&#123;</span
                                            ><span class="br0">&#123;</span
                                            >question<span class="br0"
                                                >&#125;</span
                                            ><span class="br0">&#125;</span>:
                                            &lt;input
                                            <span class="kw2">type</span>=<span
                                                class="st0"
                                                >&quot;text&quot;</span
                                            >
                                            name=<span class="st0"
                                                >&quot;{{question}}&quot;</span
                                            >&gt;&lt;br /&gt;<br />
                                            <span class="br0">&#123;</span
                                            ><span class="br0">&#123;</span
                                            >endfor<span class="br0"
                                                >&#125;</span
                                            ><span class="br0">&#125;</span
                                            ><br />
                                            &lt;input
                                            <span class="kw2">type</span>=<span
                                                class="st0"
                                                >&quot;submit&quot;</span
                                            >&gt;<br />
                                            &lt;/form&gt;<br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            Note that the only &quot;logic&quot;
                                            here is to render the form to
                                            include fields for all the
                                            questions. Obviously this produces
                                            an ugly form, but it&#8217;s
                                            <em>very obvious</em> how you make
                                            this form pretty, and how to tweak
                                            it in any way you might want. Also
                                            if you have deeper dynamicism (e.g.,
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >get_questions</span
                                                ></tt
                                            >
                                            start returning the type of response
                                            required, or weird validation, or
                                            whatever) it&#8217;s
                                            <em>very obvious</em> where that
                                            change would go: display logic goes
                                            in the form, validation logic goes
                                            in that validate function.
                                        </p>
                                        <p>
                                            This just gives you the raw form.
                                            You wouldn&#8217;t need a template
                                            at all if it wasn&#8217;t for the
                                            dynamicism. Everything else is added
                                            when the form is &quot;filled&quot;:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            page = htmlfill.<span class="me1"
                                                >render</span
                                            ><span class="br0">&#40;</span
                                            ><br />
                                            &nbsp; &nbsp; page,<br />
                                            &nbsp; &nbsp; defaults=req.<span
                                                class="me1"
                                                >POST</span
                                            >,<br />
                                            &nbsp; &nbsp; errors=errors<span
                                                class="br0"
                                                >&#41;</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            How exactly you want to calculate
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >defaults</span
                                                ></tt
                                            >
                                            is up to the application; you might
                                            want query string variables to be
                                            able to pre-fill the form (use
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >req.params</span
                                                ></tt
                                            >), you might want the form bare to
                                            start (like here with
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >req.POST</span
                                                ></tt
                                            >), you can easily implement wizards
                                            by stuffing
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >req.POST</span
                                                ></tt
                                            >
                                            into the session to repeat a form,
                                            you might read the defaults out of a
                                            user object to make this an edit
                                            form. And errors are just handled
                                            automatically, inserted into the
                                            HTML with appropriate CSS classes.
                                        </p>
                                        <p>
                                            A great aspect of this
                                            <em>pattern</em> if you use it
                                            (I&#8217;m not even sure it deserves
                                            the moniker <em>library</em>): when
                                            <a
                                                class="reference external"
                                                href="http://www.whatwg.org/specs/web-apps/current-work/multipage/forms.html#forms"
                                                >HTML 5 Forms</a
                                            >
                                            finally come around and we can all
                                            stop doing this stupid server-side
                                            overthought nonsense,
                                            <strong>you</strong> won&#8217;t
                                            have overthought your forms. Your
                                            mind will be free and ready to
                                            accept that the world has actually
                                            become simpler, not more
                                            complicated, and that there is
                                            knowledge worth forgetting (forms
                                            are so freakin&#8217; stupid!) If at
                                            all possible, dodging complexity is
                                            far better than cleverly responding
                                            to complexity.
                                        </p>
                                    </div>
                                    <!-- <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="https://ianbicking.org/2010/03/01/throw-out-your-frameworks-forms-included/"
    dc:identifier="https://ianbicking.org/2010/03/01/throw-out-your-frameworks-forms-included/"
    dc:title="Throw out your frameworks! (forms included)"
    trackback:ping="https://ianbicking.org/2010/03/01/throw-out-your-frameworks-forms-included/trackback/" />
</rdf:RDF> -->
                                </div>
                                <!-- END POST-ENTRY -->
                            </div>
                            <!-- END POST-CONTENT  -->
                        </div>
                        <!-- END-CONTAINER -->
                        <div class="post-header">
                            <h3 class="post-date">2010 03 01</h3>
                            <p class="post-categories">
                                <a
                                    href="index.html"
                                    title="View all posts in HTML"
                                    rel="category tag"
                                    >HTML</a
                                ><br /><a
                                    href="../programming/index.html"
                                    title="View all posts in Programming"
                                    rel="category tag"
                                    >Programming</a
                                ><br /><a
                                    href="../python/index.html"
                                    title="View all posts in Python"
                                    rel="category tag"
                                    >Python</a
                                ><br /><a
                                    href="../web/index.html"
                                    title="View all posts in Web"
                                    rel="category tag"
                                    >Web</a
                                >
                            </p>
                            <p class="post-comments">
                                <a
                                    href="../../2010/03/01/throw-out-your-frameworks-forms-included/index.html#comments"
                                    title="Comment on Throw out your frameworks! (forms included)"
                                    >Comments (27)</a
                                >
                            </p>
                            <p class="post-permalink">
                                <a
                                    href="../../2010/03/01/throw-out-your-frameworks-forms-included/index.html"
                                    title="Permalink to Throw out your frameworks! (forms included)"
                                    rel="permalink"
                                    >Permalink</a
                                >
                            </p>
                        </div>
                        <!-- END POST-FOOTER -->
                    </div>
                    <!-- END POST -->

                    <div id="post-149" class="post">
                        <div class="post-container">
                            <div class="post-content">
                                <h2 class="post-title">
                                    <a
                                        href="../../2010/02/06/weave-client-side-data/index.html"
                                        title="Permalink to Weave: valuable client-side data"
                                        rel="bookmark"
                                        >Weave: valuable client-side data</a
                                    >
                                </h2>
                                <div class="post-entry">
                                    <div class="document">
                                        <p>
                                            I&#8217;ve been looking at
                                            <a
                                                class="reference external"
                                                href="https://mozillalabs.com/weave/"
                                                >Weave</a
                                            >
                                            some lately. The large-print summary
                                            on the page is
                                            <em
                                                >Synchronize Your Firefox
                                                Experience Across Desktop and
                                                Mobile</em
                                            >. Straight forward enough.
                                        </p>
                                        <p>
                                            Years and years ago I stopped really
                                            using bookmarks. You lose them
                                            moving from machine to machine
                                            (which Weave could help), but mostly
                                            I stopped using them because it was
                                            too hard to (a) identify interesting
                                            content and place it into a taxonomy
                                            and (b) predict what I would later
                                            be interested in. If I wanted to
                                            refer to something I&#8217;d seen
                                            before there&#8217;s a good chance I
                                            wouldn&#8217;t have saved it, while
                                            my bookmarks would be flooded with
                                            things that time would show were of
                                            transient interest.
                                        </p>
                                        <p>
                                            So&#8230; synchronizing bookmarks,
                                            eh. Saved form data and logins?
                                            Sure, that&#8217;s handy. It would
                                            make browsing on multiple machines
                                            <em>nicer</em>. But it feels more
                                            like a handy tweak.
                                        </p>
                                        <p>
                                            All my <em>really</em> useful data
                                            is kept on servers, categorized and
                                            protected by a user account. Why is
                                            that? Well, of course, where else
                                            would you keep it? In cookies? Ha!
                                        </p>
                                        <p>
                                            Why not in cookies? So many
                                            reasons&#8230; because cookies are
                                            opaque and can&#8217;t hold much
                                            data, can&#8217;t be exchanged, and
                                            probably worst of all they just
                                            disappear randomly.
                                        </p>
                                        <p>
                                            What if cookies weren&#8217;t so
                                            impossibly lame for holding
                                            important data? Suddenly sync seems
                                            much more interesting. Instead of
                                            storing documents and data on a
                                            website, the website could put all
                                            that data right into your browser.
                                            And conveniently
                                            <a
                                                class="reference external"
                                                href="http://en.wikipedia.org/wiki/DOM_storage"
                                                >HTML 5 has an API for that</a
                                            >. Everyone thinks about that API as
                                            a way of handling off-line caching,
                                            because while it handles many
                                            problems with cookies it
                                            doesn&#8217;t handle the problem of
                                            data disappearing as you move
                                            between computers and browser.
                                            That&#8217;s where Weave
                                            synchronization could change things.
                                            I don&#8217;t think this technique
                                            is something appropriate for every
                                            app (maybe not most apps), but it
                                            could allow a new class of
                                            applications.
                                        </p>
                                        <p>
                                            Advantages: web development and
                                            scaling becomes easy. If you store
                                            data in the browser scaling is
                                            almost free; serving static pages is
                                            a Solved Problem. Development is
                                            easier because development and
                                            deployment of HTML and Javascript is
                                            pretty easy. Forking is easy &#8212;
                                            just copy all the resources. So long
                                            as you don&#8217;t hardcode absolute
                                            links into your Javascript, you can
                                            even just save from the browser and
                                            get a working local copy of the
                                            application.
                                        </p>
                                        <p>
                                            Disadvantages: another silo. You
                                            might complain about Facebook
                                            keeping everyone&#8217;s data, but
                                            the data in Facebook is
                                            <em>still</em> more transparent than
                                            data held in files or locally with a
                                            browser. Let&#8217;s say you create
                                            a word processor that uses local
                                            storage for all its documents. If
                                            you stored that document online
                                            sharing and collaboration would be
                                            really easy; but with it stored
                                            locally the act of sharing is not as
                                            automatic, and collaboration is
                                            <em>very hard</em>. Sure, the
                                            &quot;user&quot; is in
                                            &quot;control&quot; of their data,
                                            but that would be more true on paper
                                            than in practice. Building
                                            collaboration on top of local
                                            storage is hard, and without
                                            that&#8230; maybe it&#8217;s not
                                            that interesting?
                                        </p>
                                        <p>
                                            Anyway, there is an interesting (but
                                            maybe Much Too Hard) problem in
                                            there. (DVCS in the browser?)
                                        </p>
                                        <p>
                                            <strong>Update</strong>: in
                                            <a
                                                class="reference external"
                                                href="http://www.azarask.in/blog/post/you-centric-a-sketch-of-the-future-of-browsers/"
                                                >this video</a
                                            >
                                            Aza talks about just what I talk
                                            about here. A few months ago. The
                                            Weave APIs also allude to things
                                            like this, including collaboration.
                                            So&#8230; they are on it!
                                        </p>
                                    </div>
                                    <!-- <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="https://ianbicking.org/2010/02/06/weave-client-side-data/"
    dc:identifier="https://ianbicking.org/2010/02/06/weave-client-side-data/"
    dc:title="Weave: valuable client-side data"
    trackback:ping="https://ianbicking.org/2010/02/06/weave-client-side-data/trackback/" />
</rdf:RDF> -->
                                </div>
                                <!-- END POST-ENTRY -->
                            </div>
                            <!-- END POST-CONTENT  -->
                        </div>
                        <!-- END-CONTAINER -->
                        <div class="post-header">
                            <h3 class="post-date">2010 02 06</h3>
                            <p class="post-categories">
                                <a
                                    href="index.html"
                                    title="View all posts in HTML"
                                    rel="category tag"
                                    >HTML</a
                                ><br /><a
                                    href="../web/index.html"
                                    title="View all posts in Web"
                                    rel="category tag"
                                    >Web</a
                                >
                            </p>
                            <p class="post-comments">
                                <a
                                    href="../../2010/02/06/weave-client-side-data/index.html#comments"
                                    title="Comment on Weave: valuable client-side data"
                                    >Comments (2)</a
                                >
                            </p>
                            <p class="post-permalink">
                                <a
                                    href="../../2010/02/06/weave-client-side-data/index.html"
                                    title="Permalink to Weave: valuable client-side data"
                                    rel="permalink"
                                    >Permalink</a
                                >
                            </p>
                        </div>
                        <!-- END POST-FOOTER -->
                    </div>
                    <!-- END POST -->

                    <div id="post-96" class="post">
                        <div class="post-container">
                            <div class="post-content">
                                <h2 class="post-title">
                                    <a
                                        href="../../2009/01/14/modern-web-design-i-renounce-thee/index.html"
                                        title="Permalink to Modern Web Design, I Renounce Thee!"
                                        rel="bookmark"
                                        >Modern Web Design, I Renounce Thee!</a
                                    >
                                </h2>
                                <div class="post-entry">
                                    <div class="document">
                                        <p>
                                            I&#8217;m not a designer, but I
                                            spend as much time looking at web
                                            pages as the next guy. So I took
                                            interest when I came upon
                                            <a
                                                class="reference external"
                                                href="http://www.wilsonminer.com/posts/2008/oct/20/relative-readability/"
                                                >this post on font size</a
                                            >
                                            by Wilson Miner, which in turn is
                                            inspired by the
                                            <a
                                                class="reference external"
                                                href="http://informationarchitects.jp/100e2r/"
                                                >100e2r (100% easy to read)
                                                standard</a
                                            >
                                            by Oliver Reichenstein.
                                        </p>
                                        <p>
                                            The basic idea is simple: we should
                                            have fonts at the
                                            &quot;default&quot; size, about
                                            16px, no smaller. This is about the
                                            size of text in print, read at a
                                            reasonable distance (typically
                                            closer up than a screen):
                                        </p>
                                        <div
                                            align="center"
                                            class="align-center"
                                        >
                                            <img
                                                alt="https://ianbicking.org/wp-content/uploads/images/typesize_comparison2.jpg"
                                                class="align-center"
                                                src="../../wp-content/uploads/images/typesize_comparison2.jpg"
                                            />
                                        </div>
                                        <p>
                                            Also it calls out low-contrast color
                                            schemes, which I think are mostly
                                            passe, and I will not insult you, my
                                            reader, by suggesting you
                                            don&#8217;t entirely agree. Because
                                            if you <em>don&#8217;t</em> agree,
                                            well, I&#8217;m afraid I&#8217;d
                                            have to use some strong words.
                                        </p>
                                        <p>
                                            I think small fonts, low contrast,
                                            huge amounts of whitespace, are a
                                            side effect of the audience
                                            designers create for.
                                        </p>
                                        <p>
                                            This makes me think of
                                            <a
                                                class="reference external"
                                                href="http://en.wikipedia.org/wiki/Modern_architecture"
                                                >Modern Architecture</a
                                            >:
                                        </p>
                                        <div
                                            align="center"
                                            class="align-center"
                                        >
                                            <img
                                                alt="https://ianbicking.org/wp-content/uploads/images/300px-seagram.jpg"
                                                class="align-center"
                                                src="../../wp-content/uploads/images/300px-seagram.jpg"
                                            />
                                        </div>
                                        <p>
                                            This is a form of architecture
                                            popular for skyscapers and other
                                            dramatic structures, with their
                                            soaring heights and other such
                                            dramatic adjectives. These are
                                            buildings designed for someone
                                            looking at the building from five
                                            hundred feet away. They are not
                                            designed for occupants. But
                                            that&#8217;s okay, because the
                                            design isn&#8217;t sold to
                                            occupants, it is sold to people who
                                            look at the sketches and want to
                                            feel very dramatic.
                                        </p>
                                        <p>
                                            Similarly, I think the design
                                            pattern of small fonts is something
                                            meant to appeal to shallow
                                            observation. By deemphasizing the
                                            text itself, the design is
                                            accentuated. Low-contrast text is
                                            even more obviously the domination
                                            of design over content. And it may
                                            very well look more professional and
                                            visually pleasing. But web design
                                            isn&#8217;t for making sites
                                            visually pleasing, it is for making
                                            the experience of the content more
                                            pleasing. Sites exist for their
                                            content, not their design.
                                        </p>
                                        <p>
                                            In 100e2r he also says
                                            <em>let your text breathe</em>. You
                                            need whitespace. If you
                                            <a
                                                class="reference external"
                                                href="../../2009/01/14/modern-web-design-i-renounce-thee/index.html"
                                                >view my site directly</a
                                            >, you&#8217;ll notice I don&#8217;t
                                            have big white margins around my
                                            text. When you come to my site,
                                            it&#8217;s to see my words, and
                                            that&#8217;s what I&#8217;m going to
                                            give you! When I want to let my text
                                            <em>breathe</em> with lots of
                                            <em>whitespace</em> this is what I
                                            do:
                                        </p>
                                        <div
                                            align="center"
                                            class="align-center"
                                        >
                                            <img
                                                alt="https://ianbicking.org/wp-content/uploads/images/500px-my-white-desktop.jpg"
                                                class="align-center"
                                                src="../../wp-content/uploads/images/500px-my-white-desktop.jpg"
                                            />
                                        </div>
                                        <p>
                                            Is a huge block of text hard to
                                            read? It is. And yeah, I&#8217;ve
                                            written articles like that. But the
                                            solution?
                                        </p>
                                        <div style="text-align: center">
                                            <b>WRITE BETTER</b>
                                        </div>
                                        <p>
                                            Similarly, it&#8217;s hard to read
                                            text if you don&#8217;t use
                                            paragraphs, but the solution
                                            isn&#8217;t to increase your line
                                            height until every line is like a
                                            paragraph of its own.
                                        </p>
                                        <p>
                                            The solution to the drudgery of
                                            large swathes of text is:
                                        </p>
                                        <ol class="arabic simple">
                                            <li>
                                                Make your blocks of text
                                                smaller.
                                            </li>
                                            <li>
                                                Use something other than
                                                paragraphs of text.
                                            </li>
                                        </ol>
                                        <p>
                                            Throw in a list. Do some
                                            indentation. Toss in even a stupid
                                            picture. Personally I try to throw
                                            in code examples, because
                                            that&#8217;s how we roll on this
                                            blog.
                                        </p>
                                        <p>
                                            That&#8217;s good writing,
                                            that&#8217;s content that is easy to
                                            read. It&#8217;s not easy to write,
                                            and I&#8217;m sure I miss the mark
                                            more often than not. But you
                                            can&#8217;t design your way to good
                                            content. If you want to write like
                                            this, if you want to let the flow of
                                            your text reflect the flow of your
                                            ideas, you need
                                            <strong>room</strong>. Huge margins
                                            don&#8217;t give you room. They are
                                            a crutch for poor writing, and not
                                            even a good crutch.
                                        </p>
                                        <p>
                                            So in conclusion: modern design be
                                            damned!
                                        </p>
                                    </div>
                                    <!-- <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="https://ianbicking.org/2009/01/14/modern-web-design-i-renounce-thee/"
    dc:identifier="https://ianbicking.org/2009/01/14/modern-web-design-i-renounce-thee/"
    dc:title="Modern Web Design, I Renounce Thee!"
    trackback:ping="https://ianbicking.org/2009/01/14/modern-web-design-i-renounce-thee/trackback/" />
</rdf:RDF> -->
                                </div>
                                <!-- END POST-ENTRY -->
                            </div>
                            <!-- END POST-CONTENT  -->
                        </div>
                        <!-- END-CONTAINER -->
                        <div class="post-header">
                            <h3 class="post-date">2009 01 14</h3>
                            <p class="post-categories">
                                <a
                                    href="index.html"
                                    title="View all posts in HTML"
                                    rel="category tag"
                                    >HTML</a
                                ><br /><a
                                    href="../notech/index.html"
                                    title="View all posts in Non-technical"
                                    rel="category tag"
                                    >Non-technical</a
                                ><br /><a
                                    href="../web/index.html"
                                    title="View all posts in Web"
                                    rel="category tag"
                                    >Web</a
                                >
                            </p>
                            <p class="post-comments">
                                <a
                                    href="../../2009/01/14/modern-web-design-i-renounce-thee/index.html#comments"
                                    title="Comment on Modern Web Design, I Renounce Thee!"
                                    >Comments (21)</a
                                >
                            </p>
                            <p class="post-permalink">
                                <a
                                    href="../../2009/01/14/modern-web-design-i-renounce-thee/index.html"
                                    title="Permalink to Modern Web Design, I Renounce Thee!"
                                    rel="permalink"
                                    >Permalink</a
                                >
                            </p>
                        </div>
                        <!-- END POST-FOOTER -->
                    </div>
                    <!-- END POST -->

                    <div id="post-91" class="post">
                        <div class="post-container">
                            <div class="post-content">
                                <h2 class="post-title">
                                    <a
                                        href="../../2009/01/11/atompub-instead-o-webdav/index.html"
                                        title="Permalink to Atompub as an alternative to WebDAV"
                                        rel="bookmark"
                                        >Atompub as an alternative to WebDAV</a
                                    >
                                </h2>
                                <div class="post-entry">
                                    <div class="document">
                                        <p>
                                            I&#8217;ve been thinking about an
                                            import/export API for
                                            <a
                                                class="reference external"
                                                href="http://pickywiki.org"
                                                >PickyWiki</a
                                            >; I want something that&#8217;s
                                            sensible, and works well enough that
                                            it can be the basic for things like
                                            creating restorable snapshots,
                                            integration with version control
                                            systems, and being good at
                                            self-hosting documentation.
                                        </p>
                                        <p>
                                            So far I&#8217;ve made a simple
                                            import/export system based on Atom.
                                            You can export the entire site as an
                                            Atom feed, and you can import Atom
                                            feeds. But whole-site import/export
                                            isn&#8217;t enough for the tools
                                            I&#8217;d like to write on top of
                                            the API.
                                        </p>
                                        <p>
                                            <a
                                                class="reference external"
                                                href="http://en.wikipedia.org/wiki/WebDAV"
                                                >WebDAV</a
                                            >
                                            would seem like a logical choice, as
                                            it lets you get and put resources.
                                            But it&#8217;s not a great choice
                                            for a few reasons:
                                        </p>
                                        <ul class="simple">
                                            <li>
                                                It&#8217;s really hard to
                                                implement on the server.
                                            </li>
                                            <li>
                                                Even clients are hard to
                                                implement.
                                            </li>
                                            <li>
                                                It uses GET to get resources.
                                                This is probably its most fatal
                                                flaw. There is no CMS that I
                                                know of (except
                                                <a
                                                    class="reference external"
                                                    href="http://www.tiddlywiki.com/"
                                                    >maybe one</a
                                                >) where the thing you view the
                                                browser is the thing that
                                                you&#8217;d actually edit. To
                                                work around this CMSes use
                                                User-Agent sniffing or an
                                                alternate URL space.
                                            </li>
                                            <li>
                                                WebDAV is worried about
                                                &quot;collections&quot; (i.e.,
                                                directories). The web basically
                                                doesn&#8217;t know what
                                                &quot;collections&quot; are, it
                                                only knows paths, and paths are
                                                strings.
                                            </li>
                                            <li>
                                                (In summary) WebDAV uses HTTP,
                                                but it is not
                                                <em>of the web</em>.
                                            </li>
                                        </ul>
                                        <p>
                                            I don&#8217;t want to invent
                                            something new though. So I started
                                            thinking of Atom some more, and
                                            <a
                                                class="reference external"
                                                href="http://en.wikipedia.org/wiki/Atom_(standard)"
                                                >Atompub</a
                                            >.
                                        </p>
                                        <p>
                                            The first thought is how to fix the
                                            GET problem in WebDAV. A web page
                                            isn&#8217;t an editable
                                            representation, but it&#8217;s
                                            pretty reasonable to put an editable
                                            representation into an Atom entry.
                                            Clients won&#8217;t necessarily
                                            understand extensions and properties
                                            you might add to those entries, but
                                            I don&#8217;t see any way around
                                            that. An entry might look like:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            &lt;entry&gt;<br />
                                            &nbsp; &lt;content
                                            <span class="kw2">type</span>=<span
                                                class="st0"
                                                >&quot;html&quot;</span
                                            >&gt;QUOTED HTML&lt;/content&gt;<br />
                                            &nbsp; ...
                                            <span class="me1">other</span>
                                            normal metadata
                                            <span class="br0">&#40;</span>title
                                            etc<span class="br0">&#41;</span>
                                            ...<br />
                                            &nbsp; &lt;privateprop:myproperty
                                            xmlns:privateprop=<span class="st0"
                                                >&quot;URL&quot;</span
                                            >
                                            name=<span class="st0"
                                                >&quot;foo&quot;</span
                                            >
                                            value=<span class="st0"
                                                >&quot;bar&quot;</span
                                            >
                                            /&gt;<br />
                                            &lt;/entry&gt;<br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            While there is special support for
                                            HTML, XHTML, and plain text in Atom,
                                            you can put any type of content in
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >&lt;content&gt;</span
                                                ></tt
                                            >, encoded in base64.
                                        </p>
                                        <p>
                                            To find the editable representation,
                                            the browser page can point to it. I
                                            imagine something like this:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            &lt;link rel=<span class="st0"
                                                >&quot;alternate&quot;</span
                                            >
                                            <span class="kw2">type</span>=<span
                                                class="st0"
                                                >&quot;application/atom+xml;
                                                type=entry&quot;</span
                                            ><br />
                                            &nbsp;href=<span class="st0"
                                                >&quot;this-url?format=atom&quot;</span
                                            >&gt;<br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            The actual URL (in this example
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >this-url?format=atom</span
                                                ></tt
                                            >) can be pretty much anything. My
                                            one worry is that this could be
                                            confused with feed detection, which
                                            looks like:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            &lt;link rel=<span class="st0"
                                                >&quot;alternate&quot;</span
                                            >
                                            <span class="kw2">type</span>=<span
                                                class="st0"
                                                >&quot;application/atom+xml&quot;</span
                                            ><br />
                                            &nbsp;href=<span class="st0"
                                                >&quot;/atom.xml&quot;</span
                                            >&gt;<br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            The only difference is &quot;;
                                            type=entry&quot;, which I&#8217;m
                                            betting a lot of clients don&#8217;t
                                            pay attention to.
                                        </p>
                                        <p>
                                            The Atom entries then can have an
                                            element:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            &lt;link rel=<span class="st0"
                                                >&quot;edit&quot;</span
                                            >
                                            href=<span class="st0"
                                                >&quot;this-url&quot;</span
                                            >
                                            /&gt;<br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            This is a location where you can PUT
                                            a new entry to update the resource.
                                            You could allow the client to PUT
                                            directly over the old page, or use
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >this-url?format=atom</span
                                                ></tt
                                            >
                                            or whatever is convenient on the
                                            server-side. Additionally, DELETE to
                                            the same URL would delete.
                                        </p>
                                        <p>
                                            This handles updates and deletes,
                                            and single-page reads. The next
                                            issue is creating pages.
                                        </p>
                                        <p>
                                            Atompub makes creation fairly
                                            simple. First you have to get the
                                            <a
                                                class="reference external"
                                                href="http://bitworking.org/projects/atom/rfc5023.html#appdocs"
                                                >Atompub service document</a
                                            >. This is a document with the type
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >application/atomsvc+xml</span
                                                ></tt
                                            >
                                            and it gives the collection URL.
                                            <a
                                                class="reference external"
                                                href="http://wiki.whatwg.org/wiki/ServiceRelExtension"
                                                >It&#8217;s suggested</a
                                            >
                                            you make this document discoverable
                                            like:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            &lt;link rel=<span class="st0"
                                                >&quot;service&quot;</span
                                            >
                                            <span class="kw2">type</span>=<span
                                                class="st0"
                                                >&quot;application/atomsvc+xml&quot;</span
                                            ><br />
                                            &nbsp;href=<span class="st0"
                                                >&quot;/atomsvc.xml&quot;</span
                                            >&gt;<br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            This document then points to the
                                            &quot;collection&quot; URL, which
                                            for our purposes is where you create
                                            documents. The service document
                                            would look like:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            &lt;service xmlns=<span class="st0"
                                                >&quot;http://www.w3.org/2007/app&quot;</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            &nbsp;xmlns:atom=<span class="st0"
                                                >&quot;http://www.w3.org/2005/Atom&quot;</span
                                            >&gt;<br />
                                            &nbsp; &lt;workspace&gt;<br />
                                            &nbsp; &nbsp; &lt;atom:title&gt;SITE
                                            TITLE&lt;/atom:title&gt;<br />
                                            &nbsp; &nbsp; &lt;collection
                                            href=<span class="st0"
                                                >&quot;/atomapi&quot;</span
                                            >&gt;<br />
                                            &nbsp; &nbsp; &nbsp;
                                            &lt;atom:title&gt;SITE
                                            TITLE&lt;/atom:title&gt;<br />
                                            &nbsp; &nbsp; &nbsp;
                                            &lt;accept&gt;*/*&lt;/accept&gt;<br />
                                            &nbsp; &nbsp; &nbsp;
                                            &lt;accept&gt;application/atom+<span
                                                class="kw3"
                                                >xml</span
                                            >;type=entry&lt;/accept&gt;<br />
                                            &nbsp; &nbsp; &lt;/collection&gt;<br />
                                            &nbsp; &lt;/workspace&gt;<br />
                                            &lt;/service&gt;<br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            Basically this indicates that you
                                            can POST any media to
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >/atomapi</span
                                                ></tt
                                            >
                                            (both Atom entries, and things like
                                            images).
                                        </p>
                                        <p>
                                            To create a page, a client then does
                                            a POST like:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            POST /atomapi<br />
                                            Content-Type: application/atom+<span
                                                class="kw3"
                                                >xml</span
                                            >;
                                            <span class="kw2">type</span
                                            >=entry<br />
                                            Slug: /page/path<br />
                                            <br />
                                            &lt;entry xmlns=<span class="st0"
                                                >&quot;...&quot;</span
                                            >&gt;...&lt;/entry&gt;<br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            There&#8217;s an awkwardness here,
                                            that you can suggest (via the Slug
                                            header) what the URL for the new
                                            page is. The client can find the
                                            actual URL of the new page from the
                                            Location header in the response. But
                                            the client can&#8217;t demand that
                                            the slug be respected (getting an
                                            error back if it is not), and
                                            there&#8217;s lots of use cases
                                            where the client doesn&#8217;t just
                                            want to <em>suggest</em> a path (for
                                            instance, other documents that are
                                            being created might rely on that
                                            path for links).
                                        </p>
                                        <p>
                                            Also, &quot;slug&quot;
                                            implies&#8230; well, a slug. That
                                            is, some path segment probably
                                            derived from the title.
                                            There&#8217;s nothing stopping the
                                            client from putting a complete path
                                            in there, but it&#8217;s very likely
                                            to be misinterpreted (e.g.
                                            translating
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >/page/path</span
                                                ></tt
                                            >
                                            to
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >/2009/01/pagepath</span
                                                ></tt
                                            >).
                                        </p>
                                        <p>
                                            Bug I digress. Anyway, you can post
                                            every resource as an entry,
                                            base64-encoding the resource body,
                                            but Atompub also allows POSTing
                                            media directly. When you do that,
                                            the server puts the media somewhere
                                            and creates a simple Atom entry for
                                            the media. If you wanted to add
                                            properties to that entry,
                                            you&#8217;d edit the entry after
                                            creating it.
                                        </p>
                                        <p>
                                            The last missing piece is how to get
                                            a list of all the pages on a site.
                                            Atompub <em>does</em> have an answer
                                            for this: just
                                            <tt class="docutils literal"
                                                ><span class="pre">GET</span>
                                                <span class="pre"
                                                    >/atomapi</span
                                                ></tt
                                            >
                                            will give you an Atom feed, and for
                                            our purposes we can demand that the
                                            feed is complete (using paging so
                                            that any one page of the feed
                                            doesn&#8217;t get too big). But this
                                            doesn&#8217;t seem like a good
                                            solution to me.
                                            <a
                                                class="reference external"
                                                href="http://code.google.com/apis/gdata/overview.html"
                                                >GData</a
                                            >
                                            specifies a useful set of queries to
                                            for feeds, but I&#8217;m not sure
                                            that this is very useful here; the
                                            kind of queries a client needs to do
                                            for this use case aren&#8217;t
                                            things GData was designed for.
                                        </p>
                                        <p>
                                            The queries that seem most important
                                            to me are queries by page path
                                            (which allows some sense of
                                            &quot;collections&quot; without
                                            being formal) and by content type.
                                            Also to allow incremental updates on
                                            the client side, filtering these
                                            queries by last-modified time (i.e.,
                                            all pages created since I last
                                            looked). Reporting queries (date of
                                            creation, update, author, last
                                            editor, and custom properties) of
                                            course <em>could</em> be useful, but
                                            don&#8217;t seem as directly
                                            applicable.
                                        </p>
                                        <p>
                                            Also, often the client won&#8217;t
                                            want the complete Atom entry for the
                                            pages, but only a list of pages
                                            (maybe with minimal metadata).
                                            I&#8217;m unsure about the validity
                                            of abbreviated Atom entries, but it
                                            seems like one solution. Any Atom
                                            entry can have something like:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            &lt;link rel=<span class="st0"
                                                >&quot;self&quot;</span
                                            >
                                            <span class="kw2">type</span>=<span
                                                class="st0"
                                                >&quot;application/atom+xml;
                                                type=entry&quot;</span
                                            ><br />
                                            &nbsp;href=<span class="st0"
                                                >&quot;url?format=atom&quot;</span
                                            >
                                            /&gt;<br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            This indicates where the entry
                                            exists, though it doesn&#8217;t
                                            suggest very forcefully that the
                                            actual entry is abbreviated. Anyway,
                                            I could then imagine a feed like:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            &lt;feed&gt;<br />
                                            &nbsp; &lt;entry&gt;<br />
                                            <br />
                                            &nbsp; &nbsp; &lt;content
                                            <span class="kw2">type</span>=<span
                                                class="st0"
                                                >&quot;some/content-type&quot;</span
                                            >
                                            /&gt;<br />
                                            &nbsp; &nbsp; &lt;link rel=<span
                                                class="st0"
                                                >&quot;self&quot;</span
                                            >
                                            href=<span class="st0"
                                                >&quot;...&quot;</span
                                            >
                                            /&gt;<br />
                                            &nbsp; &nbsp;
                                            &lt;updated&gt;YYYYMMDDTHH:MM:SSZ&lt;/updated&gt;<br />
                                            &nbsp; &lt;entry&gt;<br />
                                            &nbsp; ...<br />
                                            &lt;/feed&gt;<br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            This isn&#8217;t entirely valid,
                                            however &#8212; you can&#8217;t just
                                            have an empty
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >&lt;content&gt;</span
                                                ></tt
                                            >
                                            tag. You can use a
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >src</span
                                                ></tt
                                            >
                                            attribute to use indirection for the
                                            content, and then add Yet Another
                                            URL for each page that points to its
                                            raw content. But that&#8217;s just
                                            jumping through hoops. This also
                                            seems like an opportunity to suggest
                                            that the entry is incomplete.
                                        </p>
                                        <p>
                                            To actually construct these feeds,
                                            you need some way of getting the
                                            feed. I suggest that another entry
                                            be added to the Atompub service
                                            document, something like:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            &lt;cmsapi:feed href=<span
                                                class="st0"
                                                >&quot;URI-TEMPLATE&quot;</span
                                            >
                                            /&gt;<br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            That would be a
                                            <a
                                                class="reference external"
                                                href="http://bitworking.org/projects/URI-Templates/"
                                                >URI Template</a
                                            >
                                            that accepted several known
                                            variables (though frustratingly, URI
                                            Templates aren&#8217;t properly
                                            standardized yet). Things like:
                                        </p>
                                        <ul class="simple">
                                            <li>
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >content-type</span
                                                    ></tt
                                                >: the content type of the
                                                resource (allowing wildcards
                                                like
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >image/*</span
                                                    ></tt
                                                >)
                                            </li>
                                            <li>
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >container</span
                                                    ></tt
                                                >: a path to a container, i.e.,
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >/2007</span
                                                    ></tt
                                                >
                                                would match all pages in
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >/2007/...</span
                                                    ></tt
                                                >
                                            </li>
                                            <li>
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >path-regex</span
                                                    ></tt
                                                >: some regular expression to
                                                match the paths
                                            </li>
                                            <li>
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >last-modified</span
                                                    ></tt
                                                >: return all pages modified at
                                                the given date or later
                                            </li>
                                        </ul>
                                        <p>
                                            All parameters would be ANDed
                                            together.
                                        </p>
                                        <p>So, open issues:</p>
                                        <ul class="simple">
                                            <li>
                                                How to strongly suggest a path
                                                when creating a resource (better
                                                than Slug)
                                            </li>
                                            <li>
                                                How to rename (move) or copy a
                                                page (it&#8217;s easy enough to
                                                punt on copy, but I&#8217;d
                                                rather move by a
                                                <em>little</em> more formal than
                                                just recreating a resource in a
                                                new location and deleting the
                                                original)
                                            </li>
                                            <li>
                                                How to represent abbreviated
                                                Atom entries
                                            </li>
                                        </ul>
                                        <p>
                                            With these resolved I think
                                            it&#8217;d be possible to create a
                                            much simpler API than WebDAV, and
                                            one that can be applied to existing
                                            applications much more easily. (If
                                            you think there&#8217;s more
                                            missing, please comment.)
                                        </p>
                                    </div>
                                    <!-- <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="https://ianbicking.org/2009/01/11/atompub-instead-o-webdav/"
    dc:identifier="https://ianbicking.org/2009/01/11/atompub-instead-o-webdav/"
    dc:title="Atompub as an alternative to WebDAV"
    trackback:ping="https://ianbicking.org/2009/01/11/atompub-instead-o-webdav/trackback/" />
</rdf:RDF> -->
                                </div>
                                <!-- END POST-ENTRY -->
                            </div>
                            <!-- END POST-CONTENT  -->
                        </div>
                        <!-- END-CONTAINER -->
                        <div class="post-header">
                            <h3 class="post-date">2009 01 11</h3>
                            <p class="post-categories">
                                <a
                                    href="index.html"
                                    title="View all posts in HTML"
                                    rel="category tag"
                                    >HTML</a
                                ><br /><a
                                    href="../programming/index.html"
                                    title="View all posts in Programming"
                                    rel="category tag"
                                    >Programming</a
                                ><br /><a
                                    href="../web/index.html"
                                    title="View all posts in Web"
                                    rel="category tag"
                                    >Web</a
                                >
                            </p>
                            <p class="post-comments">
                                <a
                                    href="../../2009/01/11/atompub-instead-o-webdav/index.html#comments"
                                    title="Comment on Atompub as an alternative to WebDAV"
                                    >Comments (26)</a
                                >
                            </p>
                            <p class="post-permalink">
                                <a
                                    href="../../2009/01/11/atompub-instead-o-webdav/index.html"
                                    title="Permalink to Atompub as an alternative to WebDAV"
                                    rel="permalink"
                                    >Permalink</a
                                >
                            </p>
                        </div>
                        <!-- END POST-FOOTER -->
                    </div>
                    <!-- END POST -->

                    <div id="post-90" class="post">
                        <div class="post-container">
                            <div class="post-content">
                                <h2 class="post-title">
                                    <a
                                        href="../../2008/12/27/avoiding-silos-link-as-a-first-class-object/index.html"
                                        title="Permalink to Avoiding Silos: &#8220;link&#8221; as a first-class object"
                                        rel="bookmark"
                                        >Avoiding Silos: &#8220;link&#8221; as a
                                        first-class object</a
                                    >
                                </h2>
                                <div class="post-entry">
                                    <div class="document">
                                        <p>
                                            One of the constant annoyances to me
                                            in web applications is the
                                            self-proclaimed need for those
                                            applications to know about
                                            everything and do everything, and
                                            only spotty ad hoc techniques for
                                            including things from other
                                            applications.
                                        </p>
                                        <p>
                                            An example might be blog navigation
                                            or search, where you can only
                                            include data from the application
                                            itself. Or &quot;Recent Posts&quot;
                                            which can only show locally-produce
                                            posts. What if I post something
                                            elsewhere? I have to create some
                                            shoddy placeholder post to refer to
                                            it. Bah! Underlying this the data is
                                            usually structured in a specific
                                            way, with the HTML being a sort of
                                            artifact of the database, the markup
                                            transient and a slave to the
                                            database&#8217;s structure.
                                        </p>
                                        <p>
                                            An example of this might be a recent
                                            post listing like:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            &lt;ul&gt;<br />
                                            &nbsp;
                                            <span class="kw1">for</span> post
                                            <span class="kw1">in</span>
                                            recent_posts:<br />
                                            &nbsp; &nbsp; &lt;li&gt;<br />
                                            &nbsp; &nbsp; &nbsp; &lt;a
                                            href=<span class="st0"
                                                >&quot;/post/{{post.year}}/{{post.month}}/{{post.slug}}&quot;</span
                                            >&gt;<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="br0">&#123;</span
                                            ><span class="br0">&#123;</span
                                            >post.<span class="me1">title</span
                                            ><span class="br0">&#125;</span
                                            ><span class="br0">&#125;</span
                                            >&lt;/a&gt;<br />
                                            &nbsp; &nbsp; &lt;/li&gt;<br />
                                            &lt;/ul&gt;<br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            There&#8217;s clearly no room for
                                            exceptions in this code. I am thus
                                            proposing that any system like this
                                            should have the notion of a
                                            &quot;link&quot; as a first-class
                                            object. The code should look like
                                            this:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            &lt;ul&gt;<br />
                                            &nbsp;
                                            <span class="kw1">for</span> post
                                            <span class="kw1">in</span>
                                            recent_posts:<br />
                                            &nbsp; &nbsp; &lt;li&gt;<br />
                                            &nbsp; &nbsp; &nbsp;
                                            <span class="br0">&#123;</span
                                            ><span class="br0">&#123;</span
                                            >post.<span class="me1">link</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            ><span class="br0">&#125;</span
                                            ><span class="br0">&#125;</span
                                            ><br />
                                            &nbsp; &nbsp; &lt;/li&gt;<br />
                                            &lt;/ul&gt;<br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            Just like with
                                            <a
                                                class="reference external"
                                                href="../../2008/10/24/hypertext-driven-urls/index.html"
                                                >changing IDs to links</a
                                            >
                                            in service documents, the template
                                            doesn&#8217;t actually look any more
                                            complicated than it did before
                                            (simpler, even). But now we can use
                                            simple object-oriented techniques to
                                            create first-class links. The code
                                            might look like:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            <span class="kw1">class</span>
                                            Post<span class="br0">&#40;</span
                                            >SomeORM<span class="br0"
                                                >&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">def</span>
                                            url<span class="br0">&#40;</span
                                            ><span class="kw2">self</span
                                            ><span class="br0">&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="kw1">if</span>
                                            <span class="kw2">self</span>.<span
                                                class="kw2"
                                                >type</span
                                            >
                                            ==
                                            <span class="st0">'link'</span
                                            >:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                            &nbsp;
                                            <span class="kw1">return</span>
                                            <span class="kw2">self</span>.<span
                                                class="me1"
                                                >body</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="kw1">else</span>:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                            &nbsp; base = get_request<span
                                                class="br0"
                                                >&#40;</span
                                            ><span class="br0">&#41;</span
                                            >.<span class="me1"
                                                >application_url</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                            &nbsp;
                                            <span class="kw1">return</span>
                                            <span class="st0"
                                                >'%s/%s/%s/%s'</span
                                            >
                                            % <span class="br0">&#40;</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                            &nbsp; &nbsp; &nbsp; base,
                                            <span class="kw2">self</span>.<span
                                                class="me1"
                                                >year</span
                                            >,
                                            <span class="kw2">self</span>.<span
                                                class="me1"
                                                >month</span
                                            >,
                                            <span class="kw2">self</span>.<span
                                                class="me1"
                                                >slug</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            <br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">def</span>
                                            link<span class="br0">&#40;</span
                                            ><span class="kw2">self</span
                                            ><span class="br0">&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="kw1">return</span>
                                            html<span class="br0">&#40;</span
                                            ><span class="st0"
                                                >'&lt;a
                                                href=&quot;%s&quot;&gt;%s&lt;/a&gt;'</span
                                            ><span class="br0">&#41;</span> %
                                            <span class="br0">&#40;</span><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                            &nbsp;
                                            <span class="kw2">self</span>.<span
                                                class="me1"
                                                >url</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span>,
                                            <span class="kw2">self</span>.<span
                                                class="me1"
                                                >title</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            The addition of the
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >.url()</span
                                                ></tt
                                            >
                                            method has the obvious effect of
                                            making these offsite links work.
                                            Using a
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >.link()</span
                                                ></tt
                                            >
                                            method has the added advantage of
                                            allowing things like HTML snippets
                                            to be inserted into the system (even
                                            though that is not implemented
                                            here). By allowing arbitrary HTML in
                                            certain places you make it possible
                                            for people to extend the site in
                                            little ways &#8212; possibly adding
                                            markup to a title, or allowing an
                                            item in the list that actually
                                            contains two URLs (e.g.,
                                            <tt class="docutils literal"
                                                ><span class="pre">&lt;a</span>
                                                <span class="pre"
                                                    >href=&quot;url1&quot;&gt;Some</span
                                                >
                                                <span class="pre"
                                                    >Item&lt;/a&gt;</span
                                                >
                                                <span class="pre">(&lt;a</span>
                                                <span class="pre"
                                                    >href=&quot;url2&quot;&gt;via&lt;/a&gt;)</span
                                                ></tt
                                            >).
                                        </p>
                                        <p>
                                            In the context of Python I recommend
                                            making these into methods, not
                                            properties, because it allows you to
                                            later add keyword arguments to
                                            specialize the markup (like
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >post.link(abbreviated=True)</span
                                                ></tt
                                            >).
                                        </p>
                                        <p>
                                            One negative aspect of this is that
                                            you cannot affect all the markup
                                            through the template alone, you may
                                            have to go into the Python code to
                                            change things. Anyone have ideas for
                                            handling this problem?
                                        </p>
                                    </div>
                                    <!-- <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="https://ianbicking.org/2008/12/27/avoiding-silos-link-as-a-first-class-object/"
    dc:identifier="https://ianbicking.org/2008/12/27/avoiding-silos-link-as-a-first-class-object/"
    dc:title="Avoiding Silos: &#8220;link&#8221; as a first-class object"
    trackback:ping="https://ianbicking.org/2008/12/27/avoiding-silos-link-as-a-first-class-object/trackback/" />
</rdf:RDF> -->
                                </div>
                                <!-- END POST-ENTRY -->
                            </div>
                            <!-- END POST-CONTENT  -->
                        </div>
                        <!-- END-CONTAINER -->
                        <div class="post-header">
                            <h3 class="post-date">2008 12 27</h3>
                            <p class="post-categories">
                                <a
                                    href="index.html"
                                    title="View all posts in HTML"
                                    rel="category tag"
                                    >HTML</a
                                ><br /><a
                                    href="../programming/index.html"
                                    title="View all posts in Programming"
                                    rel="category tag"
                                    >Programming</a
                                ><br /><a
                                    href="../python/index.html"
                                    title="View all posts in Python"
                                    rel="category tag"
                                    >Python</a
                                ><br /><a
                                    href="../web/index.html"
                                    title="View all posts in Web"
                                    rel="category tag"
                                    >Web</a
                                >
                            </p>
                            <p class="post-comments">
                                <a
                                    href="../../2008/12/27/avoiding-silos-link-as-a-first-class-object/index.html#comments"
                                    title="Comment on Avoiding Silos: &#8220;link&#8221; as a first-class object"
                                    >Comments (13)</a
                                >
                            </p>
                            <p class="post-permalink">
                                <a
                                    href="../../2008/12/27/avoiding-silos-link-as-a-first-class-object/index.html"
                                    title="Permalink to Avoiding Silos: &#8220;link&#8221; as a first-class object"
                                    rel="permalink"
                                    >Permalink</a
                                >
                            </p>
                        </div>
                        <!-- END POST-FOOTER -->
                    </div>
                    <!-- END POST -->

                    <div id="post-85" class="post">
                        <div class="post-container">
                            <div class="post-content">
                                <h2 class="post-title">
                                    <a
                                        href="../../2008/12/10/lxml-an-underappreciated-web-scraping-library/index.html"
                                        title="Permalink to lxml: an underappreciated web scraping library"
                                        rel="bookmark"
                                        >lxml: an underappreciated web scraping
                                        library</a
                                    >
                                </h2>
                                <div class="post-entry">
                                    <div class="document">
                                        <p>
                                            When people think about web scraping
                                            in Python, they usually think
                                            <a
                                                class="reference external"
                                                href="http://www.crummy.com/software/BeautifulSoup/"
                                                >BeautifulSoup</a
                                            >. That&#8217;s okay, but I would
                                            encourage you to also consider
                                            <a
                                                class="reference external"
                                                href="http://codespeak.net/lxml/"
                                                >lxml</a
                                            >.
                                        </p>
                                        <p>
                                            First, people think BeautifulSoup is
                                            better at parsing broken HTML.
                                            <strong
                                                >This is not correct.</strong
                                            >
                                            lxml parses broken HTML quite
                                            nicely. I haven&#8217;t done any
                                            thorough testing, but at least
                                            <a
                                                class="reference external"
                                                href="http://www.crummy.com/software/BeautifulSoup/documentation.html#Parsing%20HTML"
                                                >the BeautifulSoup broken HTML
                                                example</a
                                            >
                                            is parsed better by lxml (which
                                            knows that
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >&lt;td&gt;</span
                                                ></tt
                                            >
                                            elements should go inside
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >&lt;table&gt;</span
                                                ></tt
                                            >
                                            elements).
                                        </p>
                                        <p>
                                            Second, people feel lxml is harder
                                            to install. This is correct.
                                            <strong>BUT</strong>, lxml 2.2alpha1
                                            includes an option to compile static
                                            versions of the underlying C
                                            libraries, which should improve the
                                            installation experience, especially
                                            on Macs. To install this new way,
                                            try:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            $ STATIC_DEPS=true easy_install
                                            <span class="st0"
                                                >'lxml&gt;=2.2alpha1'</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            One you have lxml installed, you
                                            have a great parser (which happens
                                            to be
                                            <a
                                                class="reference external"
                                                href="../../2008/03/30/python-html-parser-performance/index.html"
                                                >super-fast</a
                                            >
                                            and that is
                                            <strong>not a tradeoff</strong>).
                                            You get a fairly familiar API based
                                            on
                                            <a
                                                class="reference external"
                                                href="http://docs.python.org/library/xml.etree.elementtree.html#module-xml.etree.ElementTree"
                                                >ElementTree</a
                                            >, which though a little strange
                                            feeling at first, offers a compact
                                            and canonical representation of a
                                            document tree, compared to more
                                            traditional representations. But
                                            there&#8217;s more&#8230;
                                        </p>
                                        <p>
                                            One of the features that should be
                                            appealing to many people doing
                                            screen scraping is that you get CSS
                                            selectors. You can use XPath as
                                            well, but usually that&#8217;s more
                                            complicated (<a
                                                class="reference external"
                                                href="http://css2xpath.appspot.com/?css=div.pad%20a&amp;amp;format=html"
                                                >for example</a
                                            >). Here&#8217;s
                                            <a
                                                class="reference external"
                                                href="http://crowtheries.net/?p=60"
                                                >an example I found</a
                                            >
                                            getting links from a menu in a page
                                            in BeautifulSoup:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            <span class="kw1">from</span>
                                            BeautifulSoup
                                            <span class="kw1">import</span>
                                            BeautifulSoup<br />
                                            <span class="kw1">import</span>
                                            <span class="kw3">urllib2</span
                                            ><br />
                                            soup = BeautifulSoup<span
                                                class="br0"
                                                >&#40;</span
                                            ><span class="kw3">urllib2</span
                                            >.<span class="me1">urlopen</span
                                            ><span class="br0">&#40;</span
                                            ><span class="st0"
                                                >'http://java.sun.com'</span
                                            ><span class="br0">&#41;</span
                                            >.<span class="me1">read</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            menu = soup.<span class="me1"
                                                >findAll</span
                                            ><span class="br0">&#40;</span
                                            ><span class="st0">'div'</span
                                            >,attrs=<span class="br0"
                                                >&#123;</span
                                            ><span class="st0">'class'</span
                                            >:<span class="st0">'pad'</span
                                            ><span class="br0">&#125;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            <span class="kw1">for</span> subMenu
                                            <span class="kw1">in</span>
                                            menu:<br />
                                            &nbsp; &nbsp; links = subMenu.<span
                                                class="me1"
                                                >findAll</span
                                            ><span class="br0">&#40;</span
                                            ><span class="st0">'a'</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">for</span> link
                                            <span class="kw1">in</span>
                                            links:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="kw1">print</span>
                                            <span class="st0"
                                                >&quot;%s : %s&quot;</span
                                            >
                                            %
                                            <span class="br0">&#40;</span
                                            >link.<span class="kw3">string</span
                                            >, link<span class="br0">&#91;</span
                                            ><span class="st0">'href'</span
                                            ><span class="br0">&#93;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            Here&#8217;s the same example in
                                            lxml:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            <span class="kw1">from</span>
                                            lxml.<span class="me1">html</span>
                                            <span class="kw1">import</span>
                                            parse<br />
                                            doc = parse<span class="br0"
                                                >&#40;</span
                                            ><span class="st0"
                                                >'http://java.sun.com'</span
                                            ><span class="br0">&#41;</span
                                            >.<span class="me1">getroot</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            <span class="kw1">for</span> link
                                            <span class="kw1">in</span>
                                            doc.<span class="me1"
                                                >cssselect</span
                                            ><span class="br0">&#40;</span
                                            ><span class="st0">'div.pad a'</span
                                            ><span class="br0">&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">print</span>
                                            <span class="st0">'%s: %s'</span> %
                                            <span class="br0">&#40;</span
                                            >link.<span class="me1"
                                                >text_content</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span>,
                                            link.<span class="me1">get</span
                                            ><span class="br0">&#40;</span
                                            ><span class="st0">'href'</span
                                            ><span class="br0">&#41;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            lxml generally knows more about HTML
                                            than BeautifulSoup. Also I think it
                                            does well with the small details;
                                            for instance, the lxml example will
                                            match elements in
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >&lt;div</span
                                                >
                                                <span class="pre"
                                                    >class=&quot;pad</span
                                                >
                                                <span class="pre"
                                                    >menu&quot;&gt;</span
                                                ></tt
                                            >
                                            (space-separated classes), which the
                                            BeautifulSoup example does not do
                                            (obviously there are other ways to
                                            search, but
                                            <a
                                                class="reference external"
                                                href="http://www.crummy.com/software/BeautifulSoup/documentation.html#Searching%20by%20CSS%20class"
                                                >the obvious and documented
                                                technique</a
                                            >
                                            doesn&#8217;t pay attention to HTML
                                            semantics).
                                        </p>
                                        <p>
                                            One feature that I think is really
                                            useful is
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >.make_links_absolute()</span
                                                ></tt
                                            >. This takes the base URL of the
                                            page (<tt class="docutils literal"
                                                ><span class="pre"
                                                    >doc.base</span
                                                ></tt
                                            >) and uses it to make all the links
                                            absolute. This makes it possible to
                                            relocate snippets of HTML or whole
                                            sets of documents (as with
                                            <a
                                                class="reference external"
                                                href="http://svn.colorstudy.com/home/ianb/PageCollector/trunk"
                                                >this program</a
                                            >). This isn&#8217;t just
                                            <tt class="docutils literal"
                                                ><span class="pre">&lt;a</span>
                                                <span class="pre"
                                                    >href&gt;</span
                                                ></tt
                                            >
                                            links, but stylesheets, inline CSS
                                            with
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >&#64;import</span
                                                ></tt
                                            >
                                            statements,
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >background</span
                                                ></tt
                                            >
                                            attributes, etc. It doesn&#8217;t
                                            see quite <em>all</em> links (for
                                            instance, links in Javascript) but
                                            it sees most of them, and works well
                                            for most sites. So if you want to
                                            make a local copy of a site:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            <span class="kw1">from</span>
                                            lxml.<span class="me1">html</span>
                                            <span class="kw1">import</span>
                                            parse, open_in_browser<br />
                                            doc = parse<span class="br0"
                                                >&#40;</span
                                            ><span class="st0"
                                                >'http://wiki.python.org/moin/'</span
                                            ><span class="br0">&#41;</span
                                            >.<span class="me1">getroot</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            doc.<span class="me1"
                                                >make_links_absolute</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            open_in_browser<span class="br0"
                                                >&#40;</span
                                            >doc<span class="br0">&#41;</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >open_in_browser</span
                                                ></tt
                                            >
                                            serializes the document to a
                                            temporary file and then opens a web
                                            browser (using
                                            <a
                                                class="reference external"
                                                href="http://docs.python.org/library/webbrowser.html"
                                                >webbrowser</a
                                            >).
                                        </p>
                                        <p>
                                            Here&#8217;s
                                            <a
                                                class="reference external"
                                                href="http://svn.colorstudy.com/home/ianb/recipes/lxmldiff.py"
                                                >an example</a
                                            >
                                            that compares two pages using
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >lxml.html.diff</span
                                                ></tt
                                            >:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            <span class="kw1">from</span>
                                            lxml.<span class="me1">html</span
                                            >.<span class="me1">diff</span>
                                            <span class="kw1">import</span>
                                            htmldiff<br />
                                            <span class="kw1">from</span>
                                            lxml.<span class="me1">html</span>
                                            <span class="kw1">import</span>
                                            parse, tostring, open_in_browser,
                                            fromstring<br />
                                            <br />
                                            <span class="kw1">def</span>
                                            get_page<span class="br0"
                                                >&#40;</span
                                            >url<span class="br0">&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp; doc = parse<span
                                                class="br0"
                                                >&#40;</span
                                            >url<span class="br0">&#41;</span
                                            >.<span class="me1">getroot</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; doc.<span class="me1"
                                                >make_links_absolute</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">return</span>
                                            tostring<span class="br0"
                                                >&#40;</span
                                            >doc<span class="br0">&#41;</span
                                            ><br />
                                            <br />
                                            <span class="kw1">def</span>
                                            compare_pages<span class="br0"
                                                >&#40;</span
                                            >url1, url2, selector=<span
                                                class="st0"
                                                >'body div'</span
                                            ><span class="br0">&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp; basis = parse<span
                                                class="br0"
                                                >&#40;</span
                                            >url1<span class="br0">&#41;</span
                                            >.<span class="me1">getroot</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; basis.<span
                                                class="me1"
                                                >make_links_absolute</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; other = parse<span
                                                class="br0"
                                                >&#40;</span
                                            >url2<span class="br0">&#41;</span
                                            >.<span class="me1">getroot</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; other.<span
                                                class="me1"
                                                >make_links_absolute</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; el1 = basis.<span
                                                class="me1"
                                                >cssselect</span
                                            ><span class="br0">&#40;</span
                                            >selector<span class="br0"
                                                >&#41;</span
                                            ><span class="br0">&#91;</span
                                            ><span class="nu0">0</span
                                            ><span class="br0">&#93;</span
                                            ><br />
                                            &nbsp; &nbsp; el2 = other.<span
                                                class="me1"
                                                >cssselect</span
                                            ><span class="br0">&#40;</span
                                            >selector<span class="br0"
                                                >&#41;</span
                                            ><span class="br0">&#91;</span
                                            ><span class="nu0">0</span
                                            ><span class="br0">&#93;</span
                                            ><br />
                                            &nbsp; &nbsp; diff_content =
                                            htmldiff<span class="br0"
                                                >&#40;</span
                                            >tostring<span class="br0"
                                                >&#40;</span
                                            >el1<span class="br0">&#41;</span>,
                                            tostring<span class="br0"
                                                >&#40;</span
                                            >el2<span class="br0">&#41;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; diff_el =
                                            fromstring<span class="br0"
                                                >&#40;</span
                                            >diff_content<span class="br0"
                                                >&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; el1.<span class="me1"
                                                >getparent</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            >.<span class="me1">insert</span
                                            ><span class="br0">&#40;</span
                                            >el1.<span class="me1"
                                                >getparent</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            >.<span class="me1">index</span
                                            ><span class="br0">&#40;</span
                                            >el1<span class="br0">&#41;</span>,
                                            diff_el<span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; el1.<span class="me1"
                                                >getparent</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            >.<span class="me1">remove</span
                                            ><span class="br0">&#40;</span
                                            >el1<span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">return</span>
                                            basis<br />
                                            <br />
                                            <span class="kw1">if</span> __name__
                                            ==
                                            <span class="st0">'__main__'</span
                                            >:<br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">import</span>
                                            <span class="kw3">sys</span><br />
                                            &nbsp; &nbsp; doc =
                                            compare_pages<span class="br0"
                                                >&#40;</span
                                            ><span class="kw3">sys</span>.<span
                                                class="me1"
                                                >argv</span
                                            ><span class="br0">&#91;</span
                                            ><span class="nu0">1</span
                                            ><span class="br0">&#93;</span>,
                                            <span class="kw3">sys</span>.<span
                                                class="me1"
                                                >argv</span
                                            ><span class="br0">&#91;</span
                                            ><span class="nu0">2</span
                                            ><span class="br0">&#93;</span>,
                                            <span class="kw3">sys</span>.<span
                                                class="me1"
                                                >argv</span
                                            ><span class="br0">&#91;</span
                                            ><span class="nu0">3</span
                                            ><span class="br0">&#93;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; open_in_browser<span
                                                class="br0"
                                                >&#40;</span
                                            >doc<span class="br0">&#41;</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>You can use it like:</p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            $ python lxmldiff.<span class="me1"
                                                >py</span
                                            >
                                            \<br />
                                            <span class="st0"
                                                >'http://wiki.python.org/moin/BeginnersGuide?action=recall&amp;amp;#038;rev=70'</span
                                            >
                                            \<br />
                                            <span class="st0"
                                                >'http://wiki.python.org/moin/BeginnersGuide?action=recall&amp;amp;#038;rev=81'</span
                                            >
                                            \<br />
                                            <span class="st0"
                                                >'div#content'</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            Another feature lxml has is form
                                            handling. All the cool sexy new
                                            sites use minimal forms, but
                                            searching for &quot;registration
                                            forms&quot; I get
                                            <a
                                                class="reference external"
                                                href="http://www.actuaryjobs.com/cform.html"
                                                >this nice complex form</a
                                            >. Let&#8217;s look at it:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            &gt;&gt;&gt;
                                            <span class="kw1">from</span>
                                            lxml.<span class="me1">html</span>
                                            <span class="kw1">import</span>
                                            parse, tostring<br />
                                            &gt;&gt;&gt; doc = parse<span
                                                class="br0"
                                                >&#40;</span
                                            ><span class="st0"
                                                >'http://www.actuaryjobs.com/cform.html'</span
                                            ><span class="br0">&#41;</span
                                            >.<span class="me1">getroot</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &gt;&gt;&gt; doc.<span class="me1"
                                                >forms</span
                                            ><br />
                                            <span class="br0">&#91;</span
                                            >&lt;Element form at
                                            <span class="nu0">-48232164</span
                                            >&gt;<span class="br0">&#93;</span
                                            ><br />
                                            &gt;&gt;&gt; form = doc.<span
                                                class="me1"
                                                >forms</span
                                            ><span class="br0">&#91;</span
                                            ><span class="nu0">0</span
                                            ><span class="br0">&#93;</span
                                            ><br />
                                            &gt;&gt;&gt; form.<span class="me1"
                                                >inputs</span
                                            >.<span class="me1">keys</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            <span class="br0">&#91;</span
                                            ><span class="st0"
                                                >'thank_you_title'</span
                                            >, <span class="st0">'City'</span>,
                                            <span class="st0">'Zip'</span>, ...
                                            <span class="br0">&#93;</span><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            Now we have a form object.
                                            There&#8217;s two ways to get to the
                                            fields:
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >form.inputs</span
                                                ></tt
                                            >, which gives us a dictionary of
                                            all the actual
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >&lt;input&gt;</span
                                                ></tt
                                            >
                                            elements (and textarea and select).
                                            There&#8217;s also
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >form.fields</span
                                                ></tt
                                            >, which is a dictionary-like
                                            object. The dictionary-like object
                                            is convenient, for instance:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            &gt;&gt;&gt; form.<span class="me1"
                                                >fields</span
                                            ><span class="br0">&#91;</span
                                            ><span class="st0">'cEmail'</span
                                            ><span class="br0">&#93;</span> =
                                            <span class="st0"
                                                >'me&amp;#64;example.com'</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            This actually updates the input
                                            element itself:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            &gt;&gt;&gt; tostring<span
                                                class="br0"
                                                >&#40;</span
                                            >form.<span class="me1">inputs</span
                                            ><span class="br0">&#91;</span
                                            ><span class="st0">'cEmail'</span
                                            ><span class="br0">&#93;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            <span class="st0"
                                                >'&lt;input
                                                type=&quot;input&quot;
                                                name=&quot;cEmail&quot;
                                                size=&quot;30&quot;
                                                value=&quot;test2&quot;&gt;'</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            I think it&#8217;s actually a nicer
                                            API than
                                            <a
                                                class="reference external"
                                                href="http://formencode.org/htmlfill.html"
                                                >htmlfill</a
                                            >
                                            and can serve the same purpose on
                                            the server side.
                                        </p>
                                        <p>
                                            But then you can also use the same
                                            interface for scraping, by filling
                                            fields and getting the submission.
                                            That looks like:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            &gt;&gt;&gt;
                                            <span class="kw1">import</span>
                                            <span class="kw3">urllib</span
                                            ><br />
                                            &gt;&gt;&gt; action = form.<span
                                                class="me1"
                                                >action</span
                                            ><br />
                                            &gt;&gt;&gt; data =
                                            <span class="kw3">urllib</span
                                            >.<span class="me1">urlencode</span
                                            ><span class="br0">&#40;</span
                                            >form.<span class="me1"
                                                >form_values</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &gt;&gt;&gt;
                                            <span class="kw1">if</span>
                                            form.<span class="me1">method</span>
                                            ==
                                            <span class="st0">'GET'</span
                                            >:<br />
                                            ... &nbsp; &nbsp;
                                            <span class="kw1">if</span>
                                            <span class="st0">'?'</span>
                                            <span class="kw1">in</span>
                                            action:<br />
                                            ... &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="me1">action</span> +=
                                            <span class="st0"
                                                >'&amp;amp;#038;'</span
                                            >
                                            + data<br />
                                            ... &nbsp; &nbsp;
                                            <span class="kw1">else</span>:<br />
                                            ... &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="me1">action</span> +=
                                            <span class="st0">'?'</span> +
                                            data<br />
                                            ... &nbsp; &nbsp;
                                            <span class="me1">data</span> =
                                            <span class="kw2">None</span><br />
                                            &gt;&gt;&gt; resp =
                                            <span class="kw3">urllib</span
                                            >.<span class="me1">urlopen</span
                                            ><span class="br0">&#40;</span
                                            >action, data<span class="br0"
                                                >&#41;</span
                                            ><br />
                                            &gt;&gt;&gt; resp_doc = parse<span
                                                class="br0"
                                                >&#40;</span
                                            >resp<span class="br0">&#41;</span
                                            >.<span class="me1">getroot</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            Lastly, there&#8217;s
                                            <a
                                                class="reference external"
                                                href="http://codespeak.net/lxml/lxmlhtml.html#cleaning-up-html"
                                                >HTML cleaning</a
                                            >. I think all these features work
                                            together well, do useful things, and
                                            it&#8217;s based on an actual
                                            understanding HTML instead of just
                                            treating tags and attributes as
                                            arbitrary. (Also if you really like
                                            jQuery, you might want to look at
                                            <a
                                                class="reference external"
                                                href="http://pypi.python.org/pypi/pyquery"
                                                >pyquery</a
                                            >, which is a jQuery-like API on top
                                            of lxml).
                                        </p>
                                    </div>
                                    <!-- <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="https://ianbicking.org/2008/12/10/lxml-an-underappreciated-web-scraping-library/"
    dc:identifier="https://ianbicking.org/2008/12/10/lxml-an-underappreciated-web-scraping-library/"
    dc:title="lxml: an underappreciated web scraping library"
    trackback:ping="https://ianbicking.org/2008/12/10/lxml-an-underappreciated-web-scraping-library/trackback/" />
</rdf:RDF> -->
                                </div>
                                <!-- END POST-ENTRY -->
                            </div>
                            <!-- END POST-CONTENT  -->
                        </div>
                        <!-- END-CONTAINER -->
                        <div class="post-header">
                            <h3 class="post-date">2008 12 10</h3>
                            <p class="post-categories">
                                <a
                                    href="index.html"
                                    title="View all posts in HTML"
                                    rel="category tag"
                                    >HTML</a
                                ><br /><a
                                    href="../programming/index.html"
                                    title="View all posts in Programming"
                                    rel="category tag"
                                    >Programming</a
                                ><br /><a
                                    href="../python/index.html"
                                    title="View all posts in Python"
                                    rel="category tag"
                                    >Python</a
                                >
                            </p>
                            <p class="post-comments">
                                <a
                                    href="../../2008/12/10/lxml-an-underappreciated-web-scraping-library/index.html#comments"
                                    title="Comment on lxml: an underappreciated web scraping library"
                                    >Comments (51)</a
                                >
                            </p>
                            <p class="post-permalink">
                                <a
                                    href="../../2008/12/10/lxml-an-underappreciated-web-scraping-library/index.html"
                                    title="Permalink to lxml: an underappreciated web scraping library"
                                    rel="permalink"
                                    >Permalink</a
                                >
                            </p>
                        </div>
                        <!-- END POST-FOOTER -->
                    </div>
                    <!-- END POST -->

                    <div id="post-78" class="post">
                        <div class="post-container">
                            <div class="post-content">
                                <h2 class="post-title">
                                    <a
                                        href="../../2008/10/06/the-philosophy-of-deliverance/index.html"
                                        title="Permalink to The Philosophy of Deliverance"
                                        rel="bookmark"
                                        >The Philosophy of Deliverance</a
                                    >
                                </h2>
                                <div class="post-entry">
                                    <div class="document">
                                        <p>
                                            I&#8217;ll be attending
                                            <a
                                                class="reference external"
                                                href="http://plone.org/events/conferences/2008-washington-dc"
                                                >PloneConf</a
                                            >
                                            this year again, giving a
                                            <a
                                                class="reference external"
                                                href="http://plone.org/events/conferences/2008-washington-dc/agenda/using-deliverance-to-theme-a-website"
                                                >talk about Deliverance</a
                                            >. I&#8217;ve been working on
                                            <a
                                                class="reference external"
                                                href="http://deliverance.openplans.org"
                                                >Deliverance</a
                                            >
                                            lately for work, but the hard part
                                            about it is that it&#8217;s not
                                            obviously useful. To help explain it
                                            I wrote the
                                            <a
                                                class="reference external"
                                                href="http://deliverance.openplans.org/philosophy.html"
                                                >philosophy of Deliverance</a
                                            >, which I will copy here, to give
                                            you an idea of what I&#8217;ve been
                                            doing:
                                        </p>
                                        <p>
                                            Why is Deliverance? Why was it made,
                                            what purpose does it serve, why
                                            should you use it, how can it change
                                            the way you do web development?
                                        </p>
                                        <div
                                            class="section"
                                            id="on-the-subject-of-platforms"
                                        >
                                            <h2>On the Subject of Platforms</h2>
                                            <p>
                                                Right now we live in an age of
                                                <em>platforms</em>. Developers
                                                (or management or coincidence)
                                                decides on a platform, and that
                                                serves as the basis for all
                                                future development. Usually
                                                there&#8217;s some old things
                                                from a previous platform (or a
                                                primordial pre-platform age:
                                                I&#8217;m looking at you
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >formmail.pl</span
                                                    ></tt
                                                >!) The goal is always to
                                                eliminate all of these old
                                                pieces, rewriting them for the
                                                new platform. That goal is
                                                seldom attained in a timely
                                                manner, and even before it is
                                                accomplished you may be moving
                                                to the next platform.
                                            </p>
                                            <p>
                                                Why do you have to port
                                                everything forward to the newest
                                                platform? Well, presumably it is
                                                better engineered. The newest
                                                platform is presumably what
                                                people are most familiar with.
                                                But if those were the only
                                                reasons it would be hard to
                                                justify a rewrite of working
                                                software. Often the real push
                                                comes because your systems
                                                don&#8217;t work together.
                                                It&#8217;s hard to keep
                                                templates in sync across all the
                                                platforms. Multiple logins may
                                                be required. Navigation is
                                                inconsistent and incomplete.
                                                Functionality that cross-cuts
                                                pages &#8212; comments, login
                                                status, shopping cart status,
                                                etc &#8212; isn&#8217;t
                                                universally available.
                                            </p>
                                            <p>
                                                A similar conflict arises when
                                                you consider how to add new
                                                functionality to a site. For
                                                example, you may want to add a
                                                blog. Do you:
                                            </p>
                                            <ol class="arabic simple">
                                                <li>
                                                    Use the best blogging
                                                    software available?
                                                </li>
                                                <li>
                                                    Use something native to your
                                                    platform?
                                                </li>
                                                <li>
                                                    Write something yourself?
                                                </li>
                                            </ol>
                                            <p>
                                                The answer is probably 2 or 3,
                                                because it would be too hard to
                                                integrate something foreign to
                                                your platform. This form of
                                                choice means that every platform
                                                has some kind of
                                                &quot;blog&quot;, but the users
                                                of that blog are likely to only
                                                be a subset of the users of the
                                                parent platform. This makes it
                                                difficult for winners to emerge,
                                                or for a well-developed piece of
                                                software to really be
                                                successful. Platform-based
                                                software is limited by the
                                                adoption of the platform.
                                            </p>
                                            <p>
                                                Not all software has a platform.
                                                These tend to be the most
                                                successful web applications,
                                                things like
                                                <a
                                                    class="reference external"
                                                    href="http://trac.edgewall.org/"
                                                    >Trac</a
                                                >,
                                                <a
                                                    class="reference external"
                                                    href="http://wordpress.org"
                                                    >WordPress</a
                                                >, etc.
                                            </p>
                                            <p>
                                                &quot;Aha!&quot; you think
                                                &quot;I&#8217;ll just use those
                                                best-of-breed
                                                applications!&quot; But no!
                                                Those applications themselves
                                                turn into platforms. WordPress
                                                is practically a CMS. Trac too.
                                                Extensible applications, if
                                                successful, become their own
                                                platform. This is not to place
                                                blame, they aren&#8217;t
                                                necessarily any worse than any
                                                other platform, just an
                                                acknowledgment that this move to
                                                platform can happen anywhere.
                                            </p>
                                        </div>
                                        <div
                                            class="section"
                                            id="beyond-platforms-or-a-better-platform"
                                        >
                                            <h2>
                                                Beyond Platforms, or A Better
                                                Platform
                                            </h2>
                                            <p>
                                                One of the major goals of
                                                Deliverance is to move beyond
                                                platforms. It is an
                                                <em>integration tool</em>, to
                                                allow applications from
                                                different frameworks or
                                                languages to be integrated
                                                gracefully.
                                            </p>
                                            <p>
                                                There are only a few core
                                                reasons that people use
                                                platforms:
                                            </p>
                                            <ol class="arabic simple">
                                                <li>
                                                    A common look-and-feel
                                                    across the site.
                                                </li>
                                                <li>Cohesive navigation.</li>
                                                <li>
                                                    Indexing of the entire site.
                                                </li>
                                                <li>
                                                    Shared authentication and
                                                    user accounts.
                                                </li>
                                                <li>
                                                    Cross-cutting functionality
                                                    (e.g., commenting).
                                                </li>
                                            </ol>
                                            <p>
                                                Deliverance specifically
                                                addresses 1, providing a common
                                                look-and-feel across a site. It
                                                can provide some help with 2, by
                                                allowing navigation to be more
                                                centrally managed, without
                                                relying purely on
                                                per-application navigation
                                                (though per-application
                                                navigation is still essential to
                                                navigating the individual
                                                applications). 3, 4, and 5 are
                                                not addressed by Deliverance (at
                                                least not yet).
                                            </p>
                                            <p>
                                                Deliverance applies a common
                                                theme across all the
                                                applications in your site.
                                                It&#8217;s basic unit of
                                                abstraction is
                                                <strong>HTML</strong>. It
                                                doesn&#8217;t use a particular
                                                templating language. It
                                                doesn&#8217;t know what an
                                                object is. HTML is something
                                                every web application produces.
                                                Deliverance&#8217;s means of
                                                communication is
                                                <strong>HTTP</strong>. It
                                                doesn&#8217;t call functions or
                                                create request objects
                                                <a
                                                    class="footnote-reference"
                                                    href="index.html#id5"
                                                    id="id1"
                                                    >[*]</a
                                                >. Again, everything speaks
                                                HTTP.
                                            </p>
                                            <p>
                                                Deliverance also allows you to
                                                include output from multiple
                                                locations. In all cases
                                                there&#8217;s the
                                                <em>theme</em>, a plain HTML
                                                page, and the <em>content</em>,
                                                whatever the underlying
                                                application returns. You can
                                                also include output from other
                                                parts of the site, most commonly
                                                navigation content that you can
                                                manage separately. All of these
                                                pieces can be dynamic &#8212;
                                                again, Deliverance only cares
                                                about HTML and HTTP, it
                                                doesn&#8217;t worry about what
                                                produces the response.
                                            </p>
                                            <p>
                                                This is all very similar to
                                                systems built on XSLT
                                                transforms, except without the
                                                XSLT
                                                <a
                                                    class="footnote-reference"
                                                    href="index.html#id6"
                                                    id="id2"
                                                    >[†]</a
                                                >, and without XML. Strictly
                                                speaking you can apply XSLT to
                                                any parseable markup, even HTML,
                                                but the most common (or at least
                                                most talked about) way to apply
                                                XSLT is using
                                                &quot;semantic&quot; XML output
                                                that is transformed into HTML.
                                                Deliverance does not try to
                                                understand the semantics of
                                                applications, and instead
                                                expects them to provide
                                                appropriate
                                                <em>presentation</em> of
                                                whatever semantics the
                                                underlying application
                                                possesses. Presentation is more
                                                universal than semantics.
                                            </p>
                                            <p>
                                                While Deliverance does its best
                                                to work with applications
                                                as-they-exist, without making
                                                particular demands on those
                                                applications, it is not perfect.
                                                Conflicting CSS can be a serious
                                                problem. Some applications
                                                don&#8217;t have very good
                                                structure to work with. You
                                                can&#8217;t generate any content
                                                in Deliverance, you can only
                                                manipulate existing content, and
                                                often that means finding new
                                                ways to generate content, or
                                                making sure you have a place to
                                                store your content (as in the
                                                case of navigation). This is why
                                                arguably Deliverance does not
                                                <em>remove</em> the need for a
                                                platform, but is just its own
                                                platform. In so far as this is
                                                true, Deliverance tries to be a
                                                <em>better</em> platform, where
                                                &quot;better&quot; is &quot;more
                                                universal&quot; rather than
                                                &quot;more powerful&quot;. Most
                                                templating systems are more
                                                powerful than Deliverance
                                                transformations. It can be
                                                useful to have access to the
                                                underlying objects used to
                                                procude the markup. But
                                                Deliverance doesn&#8217;t give
                                                you these things, because it
                                                only implements things that can
                                                be applied to any source of
                                                content. Static files are
                                                entirely workable in
                                                Deliverance, just as any
                                                application written in Python,
                                                PHP, or even an application
                                                hosted on an entirely separate
                                                service is usable through
                                                Deliverance.
                                            </p>
                                        </div>
                                        <div
                                            class="section"
                                            id="the-missing-parts"
                                        >
                                            <h2>The Missing Parts</h2>
                                            <p>
                                                As mentioned before, two
                                                important benefits of a platform
                                                are missing from Deliverance.
                                                I&#8217;ll try to describe what
                                                I believe are the essential
                                                aspects. I hope at some time
                                                that Deliverance or some
                                                complementary application will
                                                be able to satisfy these needs.
                                                Also, I suggest some lines of
                                                development that might be easier
                                                than others.
                                            </p>
                                            <div
                                                class="section"
                                                id="indexing-the-entire-site"
                                            >
                                                <h3>
                                                    Indexing The Entire Site
                                                </h3>
                                                <p>
                                                    Typically each application
                                                    has a notion of what all the
                                                    interesting pages in that
                                                    application are. Most
                                                    applications have a set of
                                                    <em>uninteresting</em>
                                                    pages, or transient pages. A
                                                    search result is transient,
                                                    as an example. An
                                                    application also knows when
                                                    new pages appear, and when
                                                    other pages disappear. A
                                                    site-wide index of these
                                                    pages would allow things
                                                    like site maps,
                                                    cross-application search,
                                                    and cross-application
                                                    reporting to be done.
                                                </p>
                                                <p>
                                                    An interesting exception to
                                                    the knowledge an application
                                                    has of itself: search
                                                    results are generally
                                                    boring. But a search result
                                                    based on a category might
                                                    still be interesting. The
                                                    difference between a
                                                    &quot;search&quot; and a
                                                    &quot;report&quot; is
                                                    largely in the eye of the
                                                    beholder. An important
                                                    feature is that the
                                                    application shouldn&#8217;t
                                                    be the sole entity allowed
                                                    to mark interesting pages.
                                                    Manually-managed lists of
                                                    resources that may point to
                                                    specific applications can
                                                    allow people to usefully and
                                                    easily tweak the site.
                                                    Ideally even fully external
                                                    resources could be included,
                                                    such as a resource on an
                                                    entirely different site.
                                                </p>
                                                <p>
                                                    To do indexing you need both
                                                    events (to signal the
                                                    creation, update, or
                                                    deletion of an entity/page),
                                                    and a list of entities (so
                                                    the index can be completely
                                                    regenerated). A simple way
                                                    of giving a list of entities
                                                    would be the
                                                    <a
                                                        class="reference external"
                                                        href="https://www.google.com/webmasters/tools/docs/en/protocol.html#sitemapXMLFormat"
                                                        >Google Site Map XML
                                                        resource</a
                                                    >. Signaling events is much
                                                    more complex, so I
                                                    won&#8217;t go into it in
                                                    any greater depth here, but
                                                    we&#8217;re working on a
                                                    product called
                                                    <a
                                                        class="reference external"
                                                        href="http://www.openplans.org/projects/cabochon/"
                                                        >Cabochon</a
                                                    >
                                                    to handle events.
                                                </p>
                                                <p>
                                                    One thing that indexing can
                                                    provide is a way to use
                                                    <a
                                                        class="reference external"
                                                        href="http://microformats.org/"
                                                        >microformats</a
                                                    >. Right now microformats
                                                    are interesting, but for
                                                    most sites they are largely
                                                    useless. You can mark up
                                                    your content, but no one
                                                    will do anything interesting
                                                    with that markup. If you
                                                    could easily code up an
                                                    indexer that could keep
                                                    up-to-date on all the
                                                    content on your site, you
                                                    could produce interesting
                                                    results like
                                                    cross-application mapping.
                                                </p>
                                            </div>
                                            <div
                                                class="section"
                                                id="shared-authentication-and-user-accounts"
                                            >
                                                <h3>
                                                    Shared Authentication And
                                                    User Accounts
                                                </h3>
                                                <p>
                                                    Authentication is one of the
                                                    most common and annoying
                                                    integration tasks when
                                                    crossing platform
                                                    boundaries. Systems like
                                                    <a
                                                        class="reference external"
                                                        href="http://openid.net/"
                                                        >Open ID</a
                                                    >
                                                    offer the ability to unify
                                                    <em>cross-site</em>
                                                    authentication, but they
                                                    don&#8217;t actually solve
                                                    the problem of a single site
                                                    with multiple applications.
                                                </p>
                                                <p>
                                                    There is a basic protocol in
                                                    HTTP for authentication, one
                                                    that is workable for a
                                                    system like Deliverance, and
                                                    there are already several
                                                    existing products (like
                                                    <a
                                                        class="reference external"
                                                        href="http://svn.repoze.org/repoze.who/trunk/"
                                                        >repoze.who</a
                                                    >) that work this way. It
                                                    works like this:
                                                </p>
                                                <ul class="simple">
                                                    <li>
                                                        The logged-in username
                                                        is sent in some header,
                                                        e.g.,
                                                        <tt
                                                            class="docutils literal"
                                                            ><span class="pre"
                                                                >X-Remote-User</span
                                                            ></tt
                                                        >. Some kind of signing
                                                        is necessary to really
                                                        trust this header
                                                        (Deliverance could
                                                        filter out that header
                                                        in incoming requests,
                                                        but if you removed
                                                        Deliverance from the
                                                        stack you&#8217;d have a
                                                        security hole).
                                                    </li>
                                                    <li>
                                                        If the user isn&#8217;t
                                                        logged in, and the
                                                        application wants them
                                                        to log in, the
                                                        application response
                                                        with a
                                                        <tt
                                                            class="docutils literal"
                                                            ><span class="pre"
                                                                >401</span
                                                            >
                                                            <span class="pre"
                                                                >Unauthorized</span
                                                            ></tt
                                                        >
                                                        response. It is supposed
                                                        to set the
                                                        <tt
                                                            class="docutils literal"
                                                            ><span class="pre"
                                                                >WWW-Authenticate</span
                                                            ></tt
                                                        >
                                                        header, probably to some
                                                        value indicating that
                                                        the intermediary should
                                                        determine the
                                                        authentication type. In
                                                        some cases a kind of
                                                        HTTP authentication is
                                                        required (typically
                                                        <a
                                                            class="reference external"
                                                            href="http://en.wikipedia.org/wiki/Basic_access_authentication"
                                                            >Basic</a
                                                        >
                                                        or
                                                        <a
                                                            class="reference external"
                                                            href="http://en.wikipedia.org/wiki/Digest_access_authentication"
                                                            >Digest</a
                                                        >) because cookie-based
                                                        logins are too stateful
                                                        (e.g., in APIs, or for
                                                        WebDAV access).
                                                    </li>
                                                    <li>
                                                        The intermediary catches
                                                        the 401 and initiates
                                                        the login process. This
                                                        might mean a redirect to
                                                        a login page, and
                                                        setting a cookie on
                                                        successful login. The
                                                        login page and setting
                                                        the cookie could
                                                        potentially be done by
                                                        an application outside
                                                        of the intermediary; the
                                                        intermediary only has to
                                                        do the appropriate
                                                        redirects and setting of
                                                        headers.
                                                    </li>
                                                    <li>
                                                        In the case when a user
                                                        is logged in but
                                                        isn&#8217;t permitted,
                                                        the application simply
                                                        sends a
                                                        <tt
                                                            class="docutils literal"
                                                            ><span class="pre"
                                                                >403</span
                                                            >
                                                            <span class="pre"
                                                                >Forbidden</span
                                                            ></tt
                                                        >
                                                        response. The
                                                        intermediary
                                                        shouldn&#8217;t actually
                                                        do anything in this case
                                                        (though maybe it could
                                                        usefully add a logout
                                                        link to that message). I
                                                        only mention this
                                                        because some systems use
                                                        <tt
                                                            class="docutils literal"
                                                            ><span class="pre"
                                                                >401</span
                                                            ></tt
                                                        >
                                                        for Forbidden, which
                                                        causes no end of
                                                        problems.
                                                    </li>
                                                </ul>
                                                <p>
                                                    While some applications
                                                    allow for this kind of
                                                    authentication scheme, many
                                                    do not. However, the scheme
                                                    is general enough that I
                                                    think it is justifiable that
                                                    applications could be
                                                    patched to work like this.
                                                </p>
                                                <p>
                                                    This handles shared
                                                    authentication, but the only
                                                    information handed around is
                                                    a username. Information
                                                    about the user &#8212; the
                                                    real name, email, homepage,
                                                    permission roles, etc
                                                    &#8212; are not shared in
                                                    this model.
                                                </p>
                                                <p>
                                                    You could add something like
                                                    an internal location to the
                                                    username. E.g.:
                                                    <tt class="docutils literal"
                                                        ><span class="pre"
                                                            >X-Remote-User:</span
                                                        >
                                                        <span class="pre"
                                                            >bob;</span
                                                        >
                                                        <span class="pre"
                                                            >info_url=http://mysite.com/users/bob.xml</span
                                                        ></tt
                                                    >. It would be the
                                                    application&#8217;s
                                                    responsibility to make a
                                                    subrequest to fetch that
                                                    information. This can be
                                                    somewhat inefficient, though
                                                    with appropriate caching
                                                    perhaps it would be fine.
                                                    But many applications want
                                                    very much to have a complete
                                                    record of all users.
                                                    Changing this is likely to
                                                    be much harder than changing
                                                    the authentication scheme. A
                                                    more feasible system might
                                                    be something on the order of
                                                    what is described in
                                                    <a
                                                        class="reference internal"
                                                        href="index.html#indexing-the-entire-site"
                                                        >Indexing the Entire
                                                        Site</a
                                                    >: provide a complete
                                                    listing of the site as well
                                                    as events when users are
                                                    created, updated, or
                                                    deleted, and allow
                                                    applications to maintain
                                                    their own private but synced
                                                    databases of users.
                                                </p>
                                                <p>
                                                    A common permission system
                                                    is another level of
                                                    integration. One way of
                                                    handling this would be if
                                                    applications had a published
                                                    set of actions that could be
                                                    performed, and the person
                                                    integrating the application
                                                    could map actions to
                                                    roles/groups on the system.
                                                </p>
                                            </div>
                                            <div
                                                class="section"
                                                id="cross-cutting-functionality"
                                            >
                                                <h3>
                                                    Cross-cutting Functionality
                                                </h3>
                                                <p>
                                                    This item requires a bit of
                                                    explanation. This is
                                                    functionality that cuts
                                                    across multiple parts of the
                                                    site. An example might be
                                                    comments, where you want a
                                                    commenting system to be
                                                    applicable to a variety of
                                                    entities (though probably
                                                    not all entities). Or you
                                                    might want page-update
                                                    notification, or to provide
                                                    a feed of changes to the
                                                    entity.
                                                </p>
                                                <p>
                                                    You might also want to
                                                    include some request logger
                                                    like
                                                    <a
                                                        class="reference external"
                                                        href="http://www.google.com/analytics/"
                                                        >Google Analytics</a
                                                    >
                                                    to all pages, but this is
                                                    already handled well by
                                                    Deliverance theming.
                                                    Deliverance&#8217;s
                                                    aggregation handles
                                                    universal content well, but
                                                    it doesn&#8217;t handle
                                                    content (or subrequests)
                                                    that should only be present
                                                    in a portion of pages.
                                                </p>
                                                <p>
                                                    One possible way to address
                                                    this is
                                                    <a
                                                        class="reference external"
                                                        href="http://en.wikipedia.org/wiki/Transclusion"
                                                        >transclusion</a
                                                    >, where a page can
                                                    specifically request some
                                                    other resource to be
                                                    included in the page. A
                                                    simple subrequest could
                                                    accomplish this, but many
                                                    applications make it
                                                    relatively easy to include
                                                    some extra markup (e.g., by
                                                    editing their templates) but
                                                    not so easy to do something
                                                    like a subrequest.
                                                    We&#8217;ve written a
                                                    product
                                                    <a
                                                        class="reference external"
                                                        href="http://www.openplans.org/projects/transcluder/"
                                                        >Transcluder</a
                                                    >
                                                    to use an HTML format to
                                                    indicate transclusion.
                                                </p>
                                                <p>
                                                    It&#8217;s also possible
                                                    using Deliverance that you
                                                    could implement this
                                                    functionality without any
                                                    application modification,
                                                    though it means added
                                                    configuration &#8212; an
                                                    application written to be
                                                    inserted into a page via
                                                    Deliverance, and a
                                                    Deliverance rule that plugs
                                                    everything together (but if
                                                    written incorrectly would
                                                    have to be debugged).
                                                </p>
                                            </div>
                                            <div
                                                class="section"
                                                id="other-conventions"
                                            >
                                                <h3>Other Conventions</h3>
                                                <p>
                                                    In addition to this, other
                                                    platform-like conventions
                                                    would make the life of the
                                                    integrator much easier.
                                                </p>
                                                <div
                                                    class="section"
                                                    id="template-customization"
                                                >
                                                    <h4>
                                                        Template Customization
                                                    </h4>
                                                    <p>
                                                        While Deliverance
                                                        handles the
                                                        look-and-feel of a page,
                                                        it leaves the inner
                                                        chunk of content to the
                                                        application. If you want
                                                        to tweak something small
                                                        you will still need to
                                                        customize the template
                                                        of the application.
                                                    </p>
                                                    <p>
                                                        It would be wonderful if
                                                        applications could
                                                        report on what files
                                                        were used in the
                                                        construction of a
                                                        request, and used a
                                                        common search path so
                                                        you could easily
                                                        override those files.
                                                    </p>
                                                </div>
                                                <div
                                                    class="section"
                                                    id="backups-and-other-maintenance"
                                                >
                                                    <h4>
                                                        Backups and Other
                                                        Maintenance
                                                    </h4>
                                                    <p>
                                                        Process management can
                                                        be handled by something
                                                        like
                                                        <a
                                                            class="reference external"
                                                            href="http://supervisord.org/"
                                                            >Supervisor</a
                                                        >, and maybe in the
                                                        future Deliverance will
                                                        even embed Supervisor.
                                                    </p>
                                                    <p>
                                                        But even then, regular
                                                        backups of the system
                                                        are important. Typically
                                                        each application has its
                                                        own way of producing a
                                                        backup. Conventions for
                                                        producing backups would
                                                        be ideal. Additional
                                                        conventions for
                                                        restoring backups would
                                                        be even better.
                                                    </p>
                                                    <p>
                                                        Many systems also
                                                        require periodic
                                                        maintenance &#8212;
                                                        compacting databases,
                                                        checking for any
                                                        integrity problems, etc.
                                                        Some unified cron-like
                                                        system might be handy,
                                                        though it&#8217;s also
                                                        workable for
                                                        applications to handle
                                                        this internally in
                                                        whatever ad hoc way
                                                        seems appropriate.
                                                    </p>
                                                </div>
                                                <div
                                                    class="section"
                                                    id="common-error-reporting"
                                                >
                                                    <h4>
                                                        Common Error Reporting
                                                    </h4>
                                                    <p>
                                                        With a system where one
                                                        of many components can
                                                        fail, it&#8217;s
                                                        important to keep track
                                                        of these problems. If
                                                        errors just end up in
                                                        one of 10 log files,
                                                        it&#8217;s unlikely
                                                        anyone is closely
                                                        tracking them.
                                                    </p>
                                                    <p>
                                                        One product we&#8217;re
                                                        working on to help with
                                                        this is
                                                        <a
                                                            class="reference external"
                                                            href="https://svn.openplans.org/svn/ErrorEater/trunk/"
                                                            >ErrorEater</a
                                                        >, which works along
                                                        with
                                                        <a
                                                            class="reference external"
                                                            href="http://supervisord.org/"
                                                            >Supervisor</a
                                                        >. Applications have to
                                                        be modified to emit
                                                        errors in a specific
                                                        format that Supervisor
                                                        understands, but this is
                                                        generally not too
                                                        difficult.
                                                    </p>
                                                </div>
                                                <div
                                                    class="section"
                                                    id="farming"
                                                >
                                                    <h4>Farming</h4>
                                                    <p>
                                                        Application farming is
                                                        when one instance of an
                                                        application can support
                                                        many &quot;sites&quot;.
                                                        These might be sites
                                                        with their own domains,
                                                        or just distinct
                                                        projects. Examples are
                                                        <a
                                                            class="reference external"
                                                            href="http://trac.edgewall.org/"
                                                            >Trac</a
                                                        >, which supports
                                                        multiple projects in one
                                                        instance, or
                                                        <a
                                                            class="reference external"
                                                            href="http://mu.wordpress.org/"
                                                            >WordPress MU</a
                                                        >
                                                        which supports many
                                                        WordPress instances
                                                        running off a single
                                                        database and code base.
                                                    </p>
                                                    <p>
                                                        It would be nice if you
                                                        could add a simple
                                                        header to a request,
                                                        like
                                                        <tt
                                                            class="docutils literal"
                                                            ><span class="pre"
                                                                >X-Project-Name:</span
                                                            >
                                                            <span class="pre"
                                                                >foo</span
                                                            ></tt
                                                        >
                                                        and that would be used
                                                        by all these products to
                                                        select the site (or
                                                        sub-site or project or
                                                        any other organization
                                                        unit). Then mapping
                                                        domain names, paths, or
                                                        other aspects of a
                                                        request to the project
                                                        could be handled once
                                                        and the applications
                                                        could all consistently
                                                        consume it.
                                                    </p>
                                                    <p>
                                                        (Internally for
                                                        <a
                                                            class="reference external"
                                                            href="http://openplans.org"
                                                            >openplans.org</a
                                                        >
                                                        we&#8217;re using
                                                        <tt
                                                            class="docutils literal"
                                                            ><span class="pre"
                                                                >X-OpenPlans-Project</span
                                                            ></tt
                                                        >
                                                        and custom patches to
                                                        several projects to
                                                        support this, but
                                                        it&#8217;s all ad hoc.)
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="section" id="footnotes">
                                            <h2>Footnotes</h2>
                                            <table
                                                class="docutils footnote"
                                                frame="void"
                                                id="id5"
                                                rules="none"
                                            >
                                                <colgroup>
                                                    <col class="label" />
                                                    <col />
                                                </colgroup>
                                                <tbody valign="top">
                                                    <tr>
                                                        <td class="label">
                                                            [*]
                                                        </td>
                                                        <td>
                                                            This isn&#8217;t
                                                            entirely true,
                                                            Deliverance
                                                            internally uses
                                                            <a
                                                                class="reference external"
                                                                href="http://wsgi.org/wsgi/"
                                                                >WSGI</a
                                                            >
                                                            which is a
                                                            Python-level
                                                            abstraction of HTTP
                                                            calls.
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                            <table
                                                class="docutils footnote"
                                                frame="void"
                                                id="id6"
                                                rules="none"
                                            >
                                                <colgroup>
                                                    <col class="label" />
                                                    <col />
                                                </colgroup>
                                                <tbody valign="top">
                                                    <tr>
                                                        <td class="label">
                                                            [†]
                                                        </td>
                                                        <td>
                                                            At different times
                                                            in the past, in an
                                                            experimental branch
                                                            right now, and
                                                            potentially
                                                            integrated in the
                                                            future, Deliverance
                                                            has been compiled
                                                            down to XSLT rules.
                                                            So Deliverance could
                                                            be seen even as an
                                                            simple
                                                            transformation
                                                            language that
                                                            compiles down to
                                                            XSLT.
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <!-- <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="https://ianbicking.org/2008/10/06/the-philosophy-of-deliverance/"
    dc:identifier="https://ianbicking.org/2008/10/06/the-philosophy-of-deliverance/"
    dc:title="The Philosophy of Deliverance"
    trackback:ping="https://ianbicking.org/2008/10/06/the-philosophy-of-deliverance/trackback/" />
</rdf:RDF> -->
                                </div>
                                <!-- END POST-ENTRY -->
                            </div>
                            <!-- END POST-CONTENT  -->
                        </div>
                        <!-- END-CONTAINER -->
                        <div class="post-header">
                            <h3 class="post-date">2008 10 06</h3>
                            <p class="post-categories">
                                <a
                                    href="index.html"
                                    title="View all posts in HTML"
                                    rel="category tag"
                                    >HTML</a
                                ><br /><a
                                    href="../programming/index.html"
                                    title="View all posts in Programming"
                                    rel="category tag"
                                    >Programming</a
                                ><br /><a
                                    href="../python/index.html"
                                    title="View all posts in Python"
                                    rel="category tag"
                                    >Python</a
                                ><br /><a
                                    href="../web/index.html"
                                    title="View all posts in Web"
                                    rel="category tag"
                                    >Web</a
                                >
                            </p>
                            <p class="post-comments">
                                <a
                                    href="../../2008/10/06/the-philosophy-of-deliverance/index.html#comments"
                                    title="Comment on The Philosophy of Deliverance"
                                    >Comments (2)</a
                                >
                            </p>
                            <p class="post-permalink">
                                <a
                                    href="../../2008/10/06/the-philosophy-of-deliverance/index.html"
                                    title="Permalink to The Philosophy of Deliverance"
                                    rel="permalink"
                                    >Permalink</a
                                >
                            </p>
                        </div>
                        <!-- END POST-FOOTER -->
                    </div>
                    <!-- END POST -->

                    <div id="post-73" class="post">
                        <div class="post-container">
                            <div class="post-content">
                                <h2 class="post-title">
                                    <a
                                        href="../../2008/09/08/inverted-partials/index.html"
                                        title="Permalink to Inverted Partials"
                                        rel="bookmark"
                                        >Inverted Partials</a
                                    >
                                </h2>
                                <div class="post-entry">
                                    <div class="document">
                                        <p>
                                            I was talking with a coworker some
                                            time ago about
                                            <a
                                                class="reference external"
                                                href="http://melkjug.com/"
                                                >his project</a
                                            >, and he needed to update a piece
                                            of the page in-place when you go
                                            back to the page, and setting the
                                            page as uncacheable didn&#8217;t
                                            really work. Which probably makes
                                            sense; I think at one time browsers
                                            <em>did</em> respect those cache
                                            controls, but as a result going back
                                            in history <em>through</em> a page
                                            could cause some intermediate page
                                            to be refreshed and needlessly slow
                                            down your progress.
                                        </p>
                                        <p>
                                            Anyway, Rails uses
                                            <a
                                                class="reference external"
                                                href="http://wiki.rubyonrails.org/rails/pages/UnderstandingPartials"
                                                >partials</a
                                            >
                                            to facilitate this kind of stuff in
                                            a general way. Bigger chunks of your
                                            page are defined in their own
                                            template, and instead of rendering
                                            the full page you can ask just for a
                                            chunk of the page. Then you do
                                            something like
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >document.getElementById('some_block').innerHTML</span
                                                >
                                                <span class="pre">=</span>
                                                <span class="pre"
                                                    >req.responseText</span
                                                ></tt
                                            >. Mike Bayer just
                                            <a
                                                class="reference external"
                                                href="http://techspot.zzzeek.org/?p=29"
                                                >described how to do this in
                                                Mako too</a
                                            >, using template functions.
                                        </p>
                                        <p>
                                            When asked, another technique also
                                            occurred to me, using just HTML.
                                            Just add a general way of fetching
                                            an element by ID. At any time you
                                            say &quot;refresh the element with
                                            id X&quot;, and it asks the server
                                            for the current version of that
                                            element (using a query string
                                            variable
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >document_id=X</span
                                                ></tt
                                            >) and replaces the content of that
                                            element in the browser.
                                        </p>
                                        <p>
                                            The client side looks like this (it
                                            would be much simpler if you used a
                                            Javascript library):
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            function refreshId<span class="br0"
                                                >&#40;</span
                                            ><span class="kw2">id</span
                                            ><span class="br0">&#41;</span>
                                            <span class="br0">&#123;</span
                                            ><br />
                                            &nbsp; &nbsp; var el =
                                            document.<span class="me1"
                                                >getElementById</span
                                            ><span class="br0">&#40;</span
                                            ><span class="kw2">id</span
                                            ><span class="br0">&#41;</span
                                            >;<br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">if</span>
                                            <span class="br0">&#40;</span>!
                                            el<span class="br0">&#41;</span>
                                            <span class="br0">&#123;</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            throw<span class="br0">&#40;</span
                                            ><span class="st0"
                                                >&quot;No element by id
                                                '&quot;</span
                                            >
                                            + <span class="kw2">id</span> +
                                            <span class="st0"
                                                >&quot;'&quot;</span
                                            ><span class="br0">&#41;</span
                                            >;<br />
                                            &nbsp; &nbsp;
                                            <span class="br0">&#125;</span
                                            ><br />
                                            &nbsp; &nbsp; function handler<span
                                                class="br0"
                                                >&#40;</span
                                            >data<span class="br0">&#41;</span>
                                            <span class="br0">&#123;</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="kw1">if</span>
                                            <span class="br0">&#40;</span
                                            >this.<span class="me1"
                                                >readyState</span
                                            >
                                            == <span class="nu0">4</span
                                            ><span class="br0">&#41;</span>
                                            <span class="br0">&#123;</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                            &nbsp; <span class="kw1">if</span>
                                            <span class="br0">&#40;</span
                                            >this.<span class="me1"
                                                >status</span
                                            >
                                            == <span class="nu0">200</span
                                            ><span class="br0">&#41;</span>
                                            <span class="br0">&#123;</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                            &nbsp; &nbsp; &nbsp; el.<span
                                                class="me1"
                                                >innerHTML</span
                                            >
                                            = this.<span class="me1"
                                                >responseText</span
                                            >;<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                            &nbsp;
                                            <span class="br0">&#125;</span>
                                            <span class="kw1">else</span>
                                            <span class="br0">&#123;</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                            &nbsp; &nbsp; &nbsp; throw<span
                                                class="br0"
                                                >&#40;</span
                                            ><span class="st0"
                                                >&quot;Bad response getting
                                                &quot;</span
                                            >
                                            + idURL +
                                            <span class="st0"
                                                >&quot;: &quot;</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                            &nbsp; + this.<span class="me1"
                                                >status</span
                                            ><span class="br0">&#41;</span
                                            >;<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                            &nbsp;
                                            <span class="br0">&#125;</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="br0">&#125;</span
                                            ><br />
                                            &nbsp; &nbsp;
                                            <span class="br0">&#125;</span
                                            ><br />
                                            &nbsp; &nbsp; var req =
                                            <span class="kw3">new</span>
                                            XMLHttpRequest<span class="br0"
                                                >&#40;</span
                                            ><span class="br0">&#41;</span
                                            >;<br />
                                            &nbsp; &nbsp; req.<span class="me1"
                                                >onreadystatechange</span
                                            >
                                            = handler;<br />
                                            &nbsp; &nbsp; var idURL =
                                            location.<span class="me1"
                                                >href</span
                                            >
                                            + <span class="st0">''</span>;<br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">if</span>
                                            <span class="br0">&#40;</span
                                            >idURL.<span class="me1"
                                                >indexOf</span
                                            ><span class="br0">&#40;</span
                                            ><span class="st0">'?'</span
                                            ><span class="br0">&#41;</span> ==
                                            <span class="nu0">-1</span
                                            ><span class="br0">&#41;</span>
                                            <span class="br0">&#123;</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; idURL +=
                                            <span class="st0">'?'</span>;<br />
                                            &nbsp; &nbsp;
                                            <span class="br0">&#125;</span>
                                            <span class="kw1">else</span>
                                            <span class="br0">&#123;</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; idURL +=
                                            <span class="st0"
                                                >'&amp;amp;#038;'</span
                                            >;<br />
                                            &nbsp; &nbsp;
                                            <span class="br0">&#125;</span
                                            ><br />
                                            &nbsp; &nbsp; idURL +=
                                            <span class="st0"
                                                >'document_id='</span
                                            >+escape<span class="br0"
                                                >&#40;</span
                                            ><span class="kw2">id</span
                                            ><span class="br0">&#41;</span
                                            >;<br />
                                            &nbsp; &nbsp; req.<span class="kw2"
                                                >open</span
                                            ><span class="br0">&#40;</span
                                            ><span class="st0"
                                                >&quot;GET&quot;</span
                                            >, idURL<span class="br0"
                                                >&#41;</span
                                            >;<br />
                                            &nbsp; &nbsp; req.<span class="me1"
                                                >send</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            >;<br />
                                            <span class="br0">&#125;</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            Then you need the server-side
                                            component. Here&#8217;s something
                                            written for
                                            <a
                                                class="reference external"
                                                href="http://pylonshq.com/"
                                                >Pylons</a
                                            >
                                            (using
                                            <a
                                                class="reference external"
                                                href="http://codespeak.net/lxml/lxmlhtml.html"
                                                >lxml.html</a
                                            >, and Pylons 0.9.7 which is
                                            configured to use
                                            <a
                                                class="reference external"
                                                href="http://pythonpaste.org/webob/"
                                                >WebOb</a
                                            >):
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            <span class="kw1">from</span> pylons
                                            <span class="kw1">import</span>
                                            request, response<br />
                                            <span class="kw1">from</span> lxml
                                            <span class="kw1">import</span>
                                            html<br />
                                            <br />
                                            <span class="kw1">def</span>
                                            get_id<span class="br0">&#40;</span
                                            >response,
                                            <span class="kw2">id</span
                                            ><span class="br0">&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">if</span>
                                            <span class="br0">&#40;</span
                                            >response.<span class="me1"
                                                >content_type</span
                                            >
                                            ==
                                            <span class="st0">'text/html'</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="kw1">and</span>
                                            response.<span class="me1"
                                                >status_int</span
                                            >
                                            == <span class="nu0">200</span
                                            ><span class="br0">&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; doc =
                                            html.<span class="me1"
                                                >fromstring</span
                                            ><span class="br0">&#40;</span
                                            >response.<span class="me1"
                                                >body</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="kw1">try</span>:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                            &nbsp; el = doc.<span class="me1"
                                                >get_element_by_id</span
                                            ><span class="br0">&#40;</span
                                            ><span class="kw2">id</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="kw1">except</span>
                                            <span class="kw2">KeyError</span
                                            >:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                            &nbsp; <span class="kw1">pass</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="kw1">else</span>:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                            &nbsp; response.<span class="me1"
                                                >body</span
                                            >
                                            = html.<span class="me1"
                                                >tostring</span
                                            ><span class="br0">&#40;</span
                                            >el<span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">return</span>
                                            response<br />
                                            <br />
                                            <span class="kw1">class</span>
                                            BaseController<span class="br0"
                                                >&#40;</span
                                            >WSGIController<span class="br0"
                                                >&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">def</span>
                                            __after__<span class="br0"
                                                >&#40;</span
                                            ><span class="kw2">self</span
                                            ><span class="br0">&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="kw2">id</span> =
                                            req.<span class="me1">GET</span
                                            >.<span class="me1">get</span
                                            ><span class="br0">&#40;</span
                                            ><span class="st0"
                                                >'document_id'</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="kw1">if</span>
                                            <span class="kw2">id</span>:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                            &nbsp; get_id<span class="br0"
                                                >&#40;</span
                                            >response,
                                            <span class="kw2">id</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            Though I&#8217;m not sure this is
                                            appropriate for middleware, you
                                            could do it as middleware too:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            <span class="kw1">from</span> webob
                                            <span class="kw1">import</span>
                                            Request<br />
                                            <span class="kw1">class</span>
                                            DocumentIdMiddleware<span
                                                class="br0"
                                                >&#40;</span
                                            ><span class="kw2">object</span
                                            ><span class="br0">&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">def</span>
                                            <span class="kw4">__init__</span
                                            ><span class="br0">&#40;</span
                                            ><span class="kw2">self</span>,
                                            app<span class="br0">&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="kw2">self</span>.<span
                                                class="me1"
                                                >app</span
                                            >
                                            = app<br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">def</span>
                                            <span class="kw4">__call__</span
                                            ><span class="br0">&#40;</span
                                            ><span class="kw2">self</span>,
                                            environ, start_response<span
                                                class="br0"
                                                >&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; req =
                                            Request<span class="br0">&#40;</span
                                            >environ<span class="br0"
                                                >&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="kw2">id</span> =
                                            req.<span class="me1">GET</span
                                            >.<span class="me1">get</span
                                            ><span class="br0">&#40;</span
                                            ><span class="st0"
                                                >'document_id'</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="kw1">if</span>
                                            <span class="kw1">not</span>
                                            <span class="kw2">id</span>:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                            &nbsp;
                                            <span class="kw1">return</span>
                                            <span class="kw2">self</span>.<span
                                                class="me1"
                                                >app</span
                                            ><span class="br0">&#40;</span
                                            >environ, start_response<span
                                                class="br0"
                                                >&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; resp =
                                            req.<span class="me1"
                                                >get_response</span
                                            ><span class="br0">&#40;</span
                                            ><span class="kw2">self</span>.<span
                                                class="me1"
                                                >app</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; resp =
                                            get_id<span class="br0">&#40;</span
                                            >resp, <span class="kw2">id</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="kw1">return</span>
                                            resp<span class="br0">&#40;</span
                                            >environ, start_response<span
                                                class="br0"
                                                >&#41;</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                    </div>
                                    <!-- <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="https://ianbicking.org/2008/09/08/inverted-partials/"
    dc:identifier="https://ianbicking.org/2008/09/08/inverted-partials/"
    dc:title="Inverted Partials"
    trackback:ping="https://ianbicking.org/2008/09/08/inverted-partials/trackback/" />
</rdf:RDF> -->
                                </div>
                                <!-- END POST-ENTRY -->
                            </div>
                            <!-- END POST-CONTENT  -->
                        </div>
                        <!-- END-CONTAINER -->
                        <div class="post-header">
                            <h3 class="post-date">2008 09 08</h3>
                            <p class="post-categories">
                                <a
                                    href="index.html"
                                    title="View all posts in HTML"
                                    rel="category tag"
                                    >HTML</a
                                ><br /><a
                                    href="../programming/index.html"
                                    title="View all posts in Programming"
                                    rel="category tag"
                                    >Programming</a
                                ><br /><a
                                    href="../python/index.html"
                                    title="View all posts in Python"
                                    rel="category tag"
                                    >Python</a
                                >
                            </p>
                            <p class="post-comments">
                                <a
                                    href="../../2008/09/08/inverted-partials/index.html#comments"
                                    title="Comment on Inverted Partials"
                                    >Comments (6)</a
                                >
                            </p>
                            <p class="post-permalink">
                                <a
                                    href="../../2008/09/08/inverted-partials/index.html"
                                    title="Permalink to Inverted Partials"
                                    rel="permalink"
                                    >Permalink</a
                                >
                            </p>
                        </div>
                        <!-- END POST-FOOTER -->
                    </div>
                    <!-- END POST -->

                    <div id="post-48" class="post">
                        <div class="post-container">
                            <div class="post-content">
                                <h2 class="post-title">
                                    <a
                                        href="../../2008/03/30/python-html-parser-performance/index.html"
                                        title="Permalink to Python HTML Parser Performance"
                                        rel="bookmark"
                                        >Python HTML Parser Performance</a
                                    >
                                </h2>
                                <div class="post-entry">
                                    <div class="document">
                                        <p>
                                            In preparation for my
                                            <a
                                                class="reference external"
                                                href="../../2008/03/21/pycon-talks/index.html"
                                                >PyCon talk on HTML</a
                                            >
                                            I thought I&#8217;d do a performance
                                            comparison of several parsers and
                                            document models.
                                        </p>
                                        <p>
                                            The situation is a little complex
                                            because there&#8217;s different
                                            steps in handling HTML:
                                        </p>
                                        <ol class="arabic simple">
                                            <li>Parse the HTML</li>
                                            <li>
                                                Parse it <em>into</em> something
                                                (a document object)
                                            </li>
                                            <li>Serialize it</li>
                                        </ol>
                                        <p>
                                            Some libraries handle 1, some handle
                                            2, some handle 1, 2, 3, etc. For
                                            instance,
                                            <a
                                                class="reference external"
                                                href="http://effbot.org/zone/element-soup.htm"
                                                >ElementSoup</a
                                            >
                                            uses
                                            <a
                                                class="reference external"
                                                href="http://effbot.org/zone/element-index.htm"
                                                >ElementTree</a
                                            >
                                            as a document, but
                                            <a
                                                class="reference external"
                                                href="http://www.crummy.com/software/BeautifulSoup/"
                                                >BeautifulSoup</a
                                            >
                                            as the parser. BeautifulSoup itself
                                            has a document object included.
                                            <a
                                                class="reference external"
                                                href="http://python.org/doc/current/lib/module-HTMLParser.html"
                                                >HTMLParser</a
                                            >
                                            <em>only</em> parses, while
                                            <a
                                                class="reference external"
                                                href="http://code.google.com/p/html5lib/"
                                                >html5lib</a
                                            >
                                            includes tree builders for several
                                            kinds of trees. There is also XML
                                            and HTML serialization.
                                        </p>
                                        <p>
                                            So I&#8217;ve taken several
                                            combinations and made benchmarks.
                                            The combinations are:
                                        </p>
                                        <ul class="simple">
                                            <li>
                                                <a
                                                    class="reference external"
                                                    href="http://codespeak.net/lxml/"
                                                    >lxml</a
                                                >: a parser, document, and HTML
                                                serializer. Also can use
                                                BeautifulSoup and html5lib for
                                                parsing.
                                            </li>
                                            <li>
                                                <a
                                                    class="reference external"
                                                    href="http://www.crummy.com/software/BeautifulSoup/"
                                                    >BeautifulSoup</a
                                                >: a parser, document, and HTML
                                                serializer.
                                            </li>
                                            <li>
                                                <a
                                                    class="reference external"
                                                    href="http://code.google.com/p/html5lib/"
                                                    >html5lib</a
                                                >: a parser. It has a
                                                serializer, but I didn&#8217;t
                                                use it. It has a built-in
                                                document object (simpletree),
                                                but I don&#8217;t think
                                                it&#8217;s meant for much more
                                                than self-testing.
                                            </li>
                                            <li>
                                                <a
                                                    class="reference external"
                                                    href="http://effbot.org/zone/element-index.htm"
                                                    >ElementTree</a
                                                >: a document object, and XML
                                                serializer (I think newer
                                                versions might include an HTML
                                                serializer, but I didn&#8217;t
                                                use it). It doesn&#8217;t have a
                                                parser, but I used html5lib to
                                                parse to it. (I didn&#8217;t use
                                                the ElementSoup.)
                                            </li>
                                            <li>
                                                <a
                                                    class="reference external"
                                                    href="http://effbot.org/zone/celementtree.htm"
                                                    >cElementTree</a
                                                >: a document object implemented
                                                as a C extension. I didn&#8217;t
                                                find any serializer.
                                            </li>
                                            <li>
                                                <a
                                                    class="reference external"
                                                    href="http://python.org/doc/current/lib/module-HTMLParser.html"
                                                    >HTMLParser</a
                                                >: a parser. It didn&#8217;t
                                                parse <em>to</em> anything. It
                                                also doesn&#8217;t parse lots of
                                                normal (but maybe invalid) HTML.
                                                When using it, I just ran
                                                documents through the parser,
                                                not constructing any tree.
                                            </li>
                                            <li>
                                                <a
                                                    class="reference external"
                                                    href="http://formencode.org/htmlfill.html"
                                                    >htmlfill</a
                                                >: this library uses HTMLParser,
                                                but at least pays
                                                <em>a little</em> attention to
                                                the elements as they are parsed.
                                            </li>
                                            <li>
                                                <a
                                                    class="reference external"
                                                    href="http://genshi.edgewall.org/"
                                                    >Genshi</a
                                                >: includes a parser, document,
                                                and HTML serializer.
                                            </li>
                                            <li>
                                                <a
                                                    class="reference external"
                                                    href="http://python.org/doc/current/lib/module-xml.dom.minidom.html"
                                                    >xml.dom.minidom</a
                                                >: a document model built into
                                                the standard library, which
                                                html5lib can parse to. (I do not
                                                recommend using minidom for
                                                anything &#8212; some reasons
                                                will become apparent in this
                                                post, but there are many other
                                                reasons not covered why you
                                                shouldn&#8217;t use it.)
                                            </li>
                                        </ul>
                                        <p>
                                            I expected lxml to perform well, as
                                            it is based on the C library
                                            <a
                                                class="reference external"
                                                href="http://xmlsoft.org/"
                                                >libxml2</a
                                            >. But it performed better than I
                                            realized, far better than any other
                                            library. As a result, if it
                                            wasn&#8217;t for some persistent
                                            installation problems (especially on
                                            Macs) I would recommend lxml for
                                            just about any HTML task.
                                        </p>
                                        <p>
                                            You can try the code out
                                            <a
                                                class="reference external"
                                                href="http://svn.colorstudy.com/home/ianb/python-html-perf"
                                                >here</a
                                            >. I&#8217;ve included all the
                                            sample data, and the commands I ran
                                            for these graphs are
                                            <a
                                                class="reference external"
                                                href="http://svn.colorstudy.com/home/ianb/python-html-perf/results.html"
                                                >here</a
                                            >. These tests use a fairly random
                                            selection of HTML files (355 total)
                                            taken from python.org.
                                        </p>
                                        <p><strong>Parsing</strong></p>
                                        <p>
                                            <img
                                                src="../../wp-content/uploads/images/parsing-results.png"
                                                alt="lxml:0.6; BeautifulSoup:10.6; html5lib ElementTree:30.2; html5lib minidom:35.2; Genshi:7.3; HTMLParser:2.9; htmlfill:4.5"
                                                style="padding: 1em"
                                            />
                                        </p>
                                        <p>
                                            The first test parses the documents.
                                            Things to note: lxml is 6x faster
                                            than even HTMLParser, even though
                                            HTMLParser isn&#8217;t
                                            <em>doing</em> anything (lxml is
                                            building a tree in memory). I
                                            didn&#8217;t include all the things
                                            html5lib can parse to, because they
                                            all take about the same amount of
                                            time. xml.dom.minidom is only
                                            included because it is so noticeably
                                            slow. Genshi is fairly fast, but
                                            it&#8217;s the most fragile of the
                                            parsers. html5lib, lxml, and
                                            BeautifulSoup are all fairly
                                            similarly robust. html5lib has the
                                            benefit of (at least in theory)
                                            being <em>the</em> correct parsing
                                            of HTML.
                                        </p>
                                        <p>
                                            While I don&#8217;t really believe
                                            it matters often, lxml releases the
                                            GIL during parsing.
                                        </p>
                                        <p><strong>Serialization</strong></p>
                                        <p>
                                            <img
                                                src="../../wp-content/uploads/images/serialization-results.png"
                                                alt="lxml:0.3; BeautifulSoup:2.0; html5lib ElementTree:1.9; html5lib minidom:3.8; Genshi:4.4"
                                                style="padding: 1em"
                                            />
                                        </p>
                                        <p>
                                            Serialization is pretty fast across
                                            all the libraries, though again lxml
                                            leads the pack by a long distance.
                                            ElementTree and minidom are only
                                            doing XML serialization, but
                                            there&#8217;s no reason that the
                                            HTML equivalent would be any faster.
                                            That Genshi is slower than minidom
                                            is surprising. That
                                            <em>anything</em> is worse than
                                            minidom is generally surprising.
                                        </p>
                                        <p><strong>Memory</strong></p>
                                        <p>
                                            <img
                                                src="../../wp-content/uploads/images/memory-results.png"
                                                alt="lxml:26; BeautifulSoup:82; BeautifulSoup lxml:104; html5lib cElementTree:54; html5lib ElementTree:64; html5lib simpletree:98; html5lib minidom:192; Genshi:64; htmlfill:5.5; HTMLParser:4.4"
                                                style="padding: 1em"
                                            />
                                        </p>
                                        <p>
                                            The last test is of memory. I
                                            don&#8217;t have a lot of confidence
                                            in the way I made this test, but
                                            I&#8217;m sure it means
                                            <em>something</em>. This was done by
                                            parsing all the documents and
                                            holding the documents in memory, and
                                            using the RSS size reported by
                                            <tt class="docutils literal"
                                                ><span class="pre">ps</span></tt
                                            >
                                            to see how much the process had
                                            grown. All the libraries should be
                                            imported when calculating the
                                            baseline, so only the documents and
                                            parsing should cause the memory
                                            increase.
                                        </p>
                                        <p>
                                            HTMLParser is a baseline, as it just
                                            keeps the documents in memory as a
                                            string, and creates some
                                            intermediate strings. The
                                            intermediate strings don&#8217;t end
                                            up accounting for anything, since
                                            the memory used is almost exactly
                                            the combined size of all the files.
                                        </p>
                                        <p>
                                            A tricky part of this measurement is
                                            that the Python allocator
                                            doesn&#8217;t let go of memory that
                                            it requests, so if a
                                            <em>parser</em> creates lots of
                                            intermediate strings and then
                                            releases them the process will still
                                            hang onto all that memory. To detect
                                            this I tried allocating new strings
                                            until the process size grew (trying
                                            to detect allocated but unused
                                            memory), but this didn&#8217;t
                                            reveal much &#8212; only the
                                            BeautifulSoup parser, serialized to
                                            an lxml tree, showed much extra
                                            memory.
                                        </p>
                                        <p>
                                            This is one of the only places where
                                            html5lib with
                                            <strong>c</strong>ElementTree was
                                            noticeably different than html5lib
                                            with ElementTree. Not that
                                            surprising, I guess, since I
                                            didn&#8217;t find a coded-in-C
                                            serializer, and I imagine the tree
                                            building is only going to be a lot
                                            faster for cElementTree if you are
                                            building the tree from C code (as
                                            its native XML parser would do).
                                        </p>
                                        <p>
                                            lxml is probably memory efficient
                                            because it uses native libxml2 data
                                            structures, and only creates Python
                                            objects on demand.
                                        </p>
                                        <p><strong>In Conclusion</strong></p>
                                        <p>
                                            I knew lxml was fast before I
                                            started these benchmarks, but I
                                            didn&#8217;t expect it to be quite
                                            <em>this</em> fast.
                                        </p>
                                        <p>
                                            So in conclusion: lxml kicks ass.
                                            You can use it in ways you
                                            couldn&#8217;t use other systems.
                                            You can parse, serialize, parse,
                                            serialize, and repeat the process a
                                            couple times with your HTML before
                                            the performance will hurt you. With
                                            high-level constructs many
                                            constructs can happen in very fast C
                                            code without calling out to Python.
                                            As an example, if you do an XPath
                                            query, the query string is compiled
                                            into something native and traverses
                                            the native libxml2 objects, only
                                            creating Python objects to wrap the
                                            query results. In addition, things
                                            like the modest memory use make me
                                            more confident that lxml will act
                                            reliably even under unexpected load.
                                        </p>
                                        <p>
                                            I also am more confident about using
                                            a document model instead of stream
                                            parsing. It is sometimes felt that
                                            streamed parsing is better: you
                                            don&#8217;t keep the entire document
                                            in memory, and your work generally
                                            scales linearly with your document
                                            size. HTMLParser is a stream-based
                                            parser, emitting events for each
                                            kind of token (open tag, close tag,
                                            data, etc). Genshi also uses this
                                            model, with higher-level stuff like
                                            <a
                                                class="reference external"
                                                href="http://genshi.edgewall.org/wiki/Documentation/0.4.x/filters.html"
                                                >filters</a
                                            >
                                            to make it feel a bit more natural.
                                            But the stream model is
                                            <em>not</em> the natural way to
                                            process a document, it&#8217;s
                                            actually a really awkward way to
                                            handle a document that is better
                                            seen as a single thing. If you are
                                            processing gigabyte files of XML it
                                            can make sense (and both the
                                            normally document-oriented lxml and
                                            ElementTree offer options when this
                                            happens). This doesn&#8217;t make
                                            any sense for HTML. And these tests
                                            make me believe that even
                                            <em>really big</em> HTML documents
                                            can be handled quite well by lxml,
                                            so a huge outlying document
                                            won&#8217;t break a system that is
                                            appropriately optimized for handling
                                            normal sized documents.
                                        </p>
                                    </div>
                                    <!-- <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="https://ianbicking.org/2008/03/30/python-html-parser-performance/"
    dc:identifier="https://ianbicking.org/2008/03/30/python-html-parser-performance/"
    dc:title="Python HTML Parser Performance"
    trackback:ping="https://ianbicking.org/2008/03/30/python-html-parser-performance/trackback/" />
</rdf:RDF> -->
                                </div>
                                <!-- END POST-ENTRY -->
                            </div>
                            <!-- END POST-CONTENT  -->
                        </div>
                        <!-- END-CONTAINER -->
                        <div class="post-header">
                            <h3 class="post-date">2008 03 30</h3>
                            <p class="post-categories">
                                <a
                                    href="index.html"
                                    title="View all posts in HTML"
                                    rel="category tag"
                                    >HTML</a
                                ><br /><a
                                    href="../programming/index.html"
                                    title="View all posts in Programming"
                                    rel="category tag"
                                    >Programming</a
                                ><br /><a
                                    href="../python/index.html"
                                    title="View all posts in Python"
                                    rel="category tag"
                                    >Python</a
                                >
                            </p>
                            <p class="post-comments">
                                <a
                                    href="../../2008/03/30/python-html-parser-performance/index.html#comments"
                                    title="Comment on Python HTML Parser Performance"
                                    >Comments (39)</a
                                >
                            </p>
                            <p class="post-permalink">
                                <a
                                    href="../../2008/03/30/python-html-parser-performance/index.html"
                                    title="Permalink to Python HTML Parser Performance"
                                    rel="permalink"
                                    >Permalink</a
                                >
                            </p>
                        </div>
                        <!-- END POST-FOOTER -->
                    </div>
                    <!-- END POST -->

                    <div id="post-47" class="post">
                        <div class="post-container">
                            <div class="post-content">
                                <h2 class="post-title">
                                    <a
                                        href="../../2008/03/23/html-accessibility/index.html"
                                        title="Permalink to HTML Accessibility"
                                        rel="bookmark"
                                        >HTML Accessibility</a
                                    >
                                </h2>
                                <div class="post-entry">
                                    <div class="document">
                                        <p>
                                            So I gave a presentation at PyCon
                                            about HTML, which I ended up turning
                                            into an XML-sucks HTML-rocks talk.
                                            Well that&#8217;s a trivialization,
                                            but <em>I</em> have the privilege of
                                            trivializing my arguments all I
                                            want.
                                        </p>
                                        <p>
                                            Somewhat to my surprise this got me
                                            a heckler (of sorts). I think it
                                            came up when I was making my
                                            <a
                                                class="reference external"
                                                href="../../2007/08/14/reflection-and-description-of-meaning/index.html"
                                                >&lt;em&gt; lies and &lt;i&gt;
                                                is truth</a
                                            >
                                            argument. That is, presentation and
                                            intention are the same. There are
                                            those people who feel they can
                                            separate the two, creating semantic
                                            markup that represents their intent,
                                            but they are so few that the
                                            <em>reader</em> can never trust that
                                            the distinction is intentional, and
                                            so
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >&lt;i&gt;</span
                                                ></tt
                                            >
                                            and
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >&lt;em&gt;</span
                                                ></tt
                                            >
                                            must be treated as equivalent.
                                        </p>
                                        <p>
                                            Someone then yelled out something
                                            like &quot;what about blind
                                            people?&quot; The argument being
                                            that screen readers would like to
                                            distinguish between the two, as not
                                            all things we render as italic would
                                            be read with emphasis.
                                        </p>
                                        <p>
                                            It&#8217;s not surprising to me that
                                            the first time I&#8217;ve gotten an
                                            actively negative reaction to a talk
                                            it was about accessibility. When
                                            having technical discussions
                                            it&#8217;s hard to get that heated
                                            up. Is Python or Ruby better? We can
                                            talk shit on the web, where all
                                            emotions get mixed up and weirded,
                                            but in person these discussions tend
                                            to be quite calm and reasonable.
                                        </p>
                                        <p>
                                            Discussions about accessibility,
                                            however, have strong moral
                                            undertones. This isn&#8217;t just
                                            What Tool Is Right For The Job.
                                            There is a kind of moral certainty
                                            to the argument that we should be
                                            making a world that is accessible to
                                            all people.
                                        </p>
                                        <p>
                                            I fear this moral certainty has led
                                            people self-righteously down unwise
                                            paths. They believe &#8212; with of
                                            course some justification &#8212;
                                            that the world must be
                                            <em>made</em> right. And so many
                                            boil-the-ocean proposals are made,
                                            and even become codified by
                                            standards, but
                                            <em>markup standards</em> are
                                            useless unless embodied in
                                            <em>actual content</em>, and this is
                                            where accessibility falls down.
                                        </p>
                                        <p>
                                            There are two posts that together
                                            have greatly eroded my trust in
                                            accessibility advocates, so that I
                                            feel like I am left adrift,
                                            unwilling to jump through the hoops
                                            accessibility advocates put up as I
                                            strongly suspect they are pointless.
                                        </p>
                                        <p>
                                            <a
                                                class="reference external"
                                                href="http://blog.whatwg.org/the-longdesc-lottery"
                                                >The first post</a
                                            >
                                            is about the
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >longdesc</span
                                                ></tt
                                            >
                                            attribute, an obscure attribute
                                            intended to tell the story of a
                                            picture. Where
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >alt</span
                                                ></tt
                                            >
                                            is typically used as a placeholder
                                            for the image, and a short
                                            description,
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >longdesc</span
                                                ></tt
                                            >
                                            can point to a document that
                                            describes the image in length.
                                            Empirically they (<a
                                                class="reference external"
                                                href="http://ln.hixie.ch/"
                                                >Ian Hickson</a
                                            >
                                            in particular) found that the
                                            attribute was almost never used in a
                                            useful or correct way, rendering it
                                            effectively useless. If the
                                            discussion had clearly ended at this
                                            point, I would have deducted points
                                            for those people use advocated
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >longdesc</span
                                                ></tt
                                            >
                                            based on bad judgement, but it would
                                            not have effected my
                                            <em>trust</em> because anyone can
                                            mispredict. But the comments just
                                            seemed to reinforce the belief that
                                            because it <em>should</em> work,
                                            that it <em>would</em> work.
                                        </p>
                                        <p>
                                            <a
                                                class="reference external"
                                                href="http://ln.hixie.ch/?start=1188895731&amp;#038;count=1"
                                                >The second post</a
                                            >
                                            was Ian Hickson&#8217;s description
                                            of using a popular screen reader (<a
                                                class="reference external"
                                                href="http://www.blazie.com/fs_products/software_jaws.asp"
                                                >JAWS</a
                                            >) &#8212; you&#8217;ll have to dig
                                            into the article some, as it&#8217;s
                                            embedded in other wandering
                                            thoughts. In summary, JAWS is a
                                            horrible experience, and as an
                                            example it didn&#8217;t even
                                            understand paragraph breaks (where
                                            the reader would be expected to
                                            pause). What&#8217;s the point of
                                            semantic markup for accessibility
                                            when the most basic markup that is
                                            both presentation
                                            <em>and</em> semantic (<tt
                                                class="docutils literal"
                                                ><span class="pre"
                                                    >&lt;p&gt;</span
                                                ></tt
                                            >) is ignored? Ian&#8217;s brief
                                            summary is that if you want to make
                                            your page readable in JAWS
                                            you&#8217;d do better by paying
                                            attention to punctuation (which does
                                            get read) than to markup. And if you
                                            want to help improve accessibility,
                                            blind people need a screen reader
                                            that isn&#8217;t crap.
                                        </p>
                                        <p>
                                            Months later we started talking a
                                            bit about the accessibility of
                                            <a
                                                class="reference external"
                                                href="http://openplans.org"
                                                >openplans.org</a
                                            >. Everyone wants to do the right
                                            thing, no? With my trust eroded, I
                                            argued strongly that we should only
                                            implement accessibility empirically,
                                            not based on &quot;best
                                            practices&quot;. Well, barring some
                                            patterns that seem very logical to
                                            me, like putting navigation
                                            textually at the bottom of the page,
                                            and other stuff that any
                                            self-respecting web developer does
                                            these days. But except for that, if
                                            we want to really consider
                                            accessibility we should get a tool
                                            and use it. But I don&#8217;t really
                                            know what that tool should be; JAWS
                                            is around $1000, all for what sounds
                                            like a piece of crap product. We
                                            could buy that, even though of
                                            course most web developers
                                            couldn&#8217;t possibly justify the
                                            purchase. But is that
                                            <em>really</em> the right choice? I
                                            don&#8217;t know. If we could detect
                                            something in the User-Agent string
                                            we could see what our users actually
                                            use. But I don&#8217;t think
                                            there&#8217;s information there. And
                                            I don&#8217;t know what people are
                                            using. Optimizing for screen
                                            magnifiers is much different that
                                            optimizing for screen readers.
                                        </p>
                                        <p>
                                            Another shortcut for accessibility
                                            &#8212; a shortcut I also distrust
                                            &#8212; is that to make a site
                                            accessible you make sure it works
                                            without Javascript. But don&#8217;t
                                            many screen readers work directly
                                            off browsers? Browsers implement
                                            Javascript. Do blind users turn
                                            Javascript off? I don&#8217;t know.
                                            If you use no-Javascript as a hint
                                            to make the site more accessible,
                                            you might just be wasting your
                                            effort.
                                        </p>
                                        <p>
                                            There&#8217;s also some weird
                                            perspective problems with
                                            accessibility. Blind users will
                                            always be a small portion of the
                                            population. It&#8217;s just
                                            unreasonable to expect sighted users
                                            to write to this small population.
                                            Relying on hidden hints in content
                                            to provide accessibility just
                                            <em>can&#8217;t work</em>. Hidden
                                            content will be broken, only visible
                                            content can be trusted. Admitting
                                            this does not mean giving up. As a
                                            sighted reader I do not expect the
                                            written and spoken word to be
                                            equivalent. I don&#8217;t think
                                            blind listeners lose anything by
                                            hearing something that is more a
                                            dialect specific to the computer
                                            translation of written text to
                                            spoken text. (Maybe treating
                                            text-to-speech as a translation
                                            effort would be more successful
                                            anyway?)
                                        </p>
                                        <p>
                                            A freely available screen reader
                                            probably would help a lot as well. I
                                            write my markup to render in
                                            browsers, not to render to a spec.
                                            Anything else is just bad practice.
                                            I can&#8217;t seriously write my
                                            markup for readers based on a spec.
                                        </p>
                                    </div>
                                    <!-- <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="https://ianbicking.org/2008/03/23/html-accessibility/"
    dc:identifier="https://ianbicking.org/2008/03/23/html-accessibility/"
    dc:title="HTML Accessibility"
    trackback:ping="https://ianbicking.org/2008/03/23/html-accessibility/trackback/" />
</rdf:RDF> -->
                                </div>
                                <!-- END POST-ENTRY -->
                            </div>
                            <!-- END POST-CONTENT  -->
                        </div>
                        <!-- END-CONTAINER -->
                        <div class="post-header">
                            <h3 class="post-date">2008 03 23</h3>
                            <p class="post-categories">
                                <a
                                    href="index.html"
                                    title="View all posts in HTML"
                                    rel="category tag"
                                    >HTML</a
                                ><br /><a
                                    href="../programming/index.html"
                                    title="View all posts in Programming"
                                    rel="category tag"
                                    >Programming</a
                                ><br /><a
                                    href="../web/index.html"
                                    title="View all posts in Web"
                                    rel="category tag"
                                    >Web</a
                                >
                            </p>
                            <p class="post-comments">
                                <a
                                    href="../../2008/03/23/html-accessibility/index.html#comments"
                                    title="Comment on HTML Accessibility"
                                    >Comments (9)</a
                                >
                            </p>
                            <p class="post-permalink">
                                <a
                                    href="../../2008/03/23/html-accessibility/index.html"
                                    title="Permalink to HTML Accessibility"
                                    rel="permalink"
                                    >Permalink</a
                                >
                            </p>
                        </div>
                        <!-- END POST-FOOTER -->
                    </div>
                    <!-- END POST -->

                    <div class="navigation">
                        <div class="alignleft">
                            <a href="page/2/index.html">&laquo; Older posts</a>
                        </div>
                        <div class="alignright"></div>
                    </div>
                    <!-- END NAVIGATION -->
                </div>
                <!-- END CONTENT -->
            </div>
            <!-- END CONTAINER  -->

            <div id="sidebar">
                <ul>
                    <li id="home-link">
                        <h2>
                            <a
                                href="../../index.html"
                                title="Ian Bicking: a blog"
                                >Home</a
                            >
                        </h2>
                    </li>
                    <li id="text-315934862" class="widget widget_text">
                        <h2 class="widgettitle">About</h2>
                        <div class="textwidget">
                            Ian is a developer with Mozilla,
                            <a href="http://ianbicking.appspot.com/projects"
                                >Python open source developer</a
                            >, actually uses
                            <a
                                href="https://plus.google.com/u/0/104537541227697934010/posts"
                                >Google+</a
                            >
                            more than
                            <a href="http://twitter.com/ianbicking">twitter</a>
                            and lives in Minneapolis.<br />
                            <span
                                class="gittip-0001"
                                gittip-username="ianbicking"
                            ></span>
                            <script
                                id="gittip-0001"
                                src="https://www.gittip.com/assets/widgets/0001.js"
                            ></script>
                        </div>
                    </li>
                    <li id="text-315934863" class="widget widget_text">
                        <div class="textwidget">
                            <!-- <script type="text/javascript">mbgc='f5f5f5';ww='160';mbc='cecece';bbc='3F79D5';bmobc='3b71c6';bbgc='4889F0';bmoc='3F79D5';bfc='FFFFFF';bmofc='ffffff';tlc='cecece';tc='6a6a6a';nc='6a6a6a';bc='6a6a6a';l='y';fs='16';fsb='13';bw='100';ff='4';lu='6a6a6a';pc='4889F0';wh='340';b='s'; pid='104537541227697934010';</script><script type="text/javascript" src="http://widgetsplus.com/google_plus_widget.js"></script> -->
                        </div>
                    </li>
                    <li id="archives-2" class="widget widget_archive">
                        <h2 class="widgettitle">Archives</h2>
                        <ul>
                            <li>
                                <a
                                    href="../../2012/10/index.html"
                                    title="October 2012"
                                    >October 2012</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2012/02/index.html"
                                    title="February 2012"
                                    >February 2012</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2011/04/index.html"
                                    title="April 2011"
                                    >April 2011</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2011/03/index.html"
                                    title="March 2011"
                                    >March 2011</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2010/09/index.html"
                                    title="September 2010"
                                    >September 2010</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2010/08/index.html"
                                    title="August 2010"
                                    >August 2010</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2010/05/index.html"
                                    title="May 2010"
                                    >May 2010</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2010/04/index.html"
                                    title="April 2010"
                                    >April 2010</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2010/03/index.html"
                                    title="March 2010"
                                    >March 2010</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2010/02/index.html"
                                    title="February 2010"
                                    >February 2010</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2010/01/index.html"
                                    title="January 2010"
                                    >January 2010</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2009/09/index.html"
                                    title="September 2009"
                                    >September 2009</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2009/05/index.html"
                                    title="May 2009"
                                    >May 2009</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2009/04/index.html"
                                    title="April 2009"
                                    >April 2009</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2009/01/index.html"
                                    title="January 2009"
                                    >January 2009</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2008/12/index.html"
                                    title="December 2008"
                                    >December 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2008/11/index.html"
                                    title="November 2008"
                                    >November 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2008/10/index.html"
                                    title="October 2008"
                                    >October 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2008/09/index.html"
                                    title="September 2008"
                                    >September 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2008/08/index.html"
                                    title="August 2008"
                                    >August 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2008/07/index.html"
                                    title="July 2008"
                                    >July 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2008/06/index.html"
                                    title="June 2008"
                                    >June 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2008/05/index.html"
                                    title="May 2008"
                                    >May 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2008/04/index.html"
                                    title="April 2008"
                                    >April 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2008/03/index.html"
                                    title="March 2008"
                                    >March 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2008/02/index.html"
                                    title="February 2008"
                                    >February 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2008/01/index.html"
                                    title="January 2008"
                                    >January 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2007/11/index.html"
                                    title="November 2007"
                                    >November 2007</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2007/10/index.html"
                                    title="October 2007"
                                    >October 2007</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2007/09/index.html"
                                    title="September 2007"
                                    >September 2007</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2007/08/index.html"
                                    title="August 2007"
                                    >August 2007</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2007/07/index.html"
                                    title="July 2007"
                                    >July 2007</a
                                >
                            </li>
                        </ul>
                    </li>
                    <li id="text-315934861" class="widget widget_text">
                        <div class="textwidget">
                            <a href="../../archive/index.html"
                                >The Older Archives</a
                            >
                        </div>
                    </li>
                    <li id="categories-1" class="widget widget_categories">
                        <h2 class="widgettitle">Categories</h2>
                        <ul>
                            <li class="cat-item cat-item-12">
                                <a
                                    href="../erlang/index.html"
                                    title="View all posts filed under Erlang"
                                    >Erlang</a
                                >
                            </li>
                            <li class="cat-item cat-item-11 current-cat">
                                <a
                                    href="index.html"
                                    title="View all posts filed under HTML"
                                    >HTML</a
                                >
                            </li>
                            <li class="cat-item cat-item-8">
                                <a
                                    href="../javascript/index.html"
                                    title="View all posts filed under Javascript"
                                    >Javascript</a
                                >
                            </li>
                            <li class="cat-item cat-item-15">
                                <a
                                    href="../licensing/index.html"
                                    title="View all posts filed under Licensing"
                                    >Licensing</a
                                >
                            </li>
                            <li class="cat-item cat-item-18">
                                <a
                                    href="../mozilla/index.html"
                                    title="View all posts filed under Mozilla"
                                    >Mozilla</a
                                >
                            </li>
                            <li class="cat-item cat-item-5">
                                <a
                                    href="../notech/index.html"
                                    title="View all posts filed under Non-technical"
                                    >Non-technical</a
                                >
                            </li>
                            <li class="cat-item cat-item-6">
                                <a
                                    href="../olpc/index.html"
                                    title="View all posts filed under OLPC"
                                    >OLPC</a
                                >
                            </li>
                            <li class="cat-item cat-item-14">
                                <a
                                    href="../packaging/index.html"
                                    title="View all posts filed under Packaging"
                                    >Packaging</a
                                >
                            </li>
                            <li class="cat-item cat-item-4">
                                <a
                                    href="../politics/index.html"
                                    title="View all posts filed under Politics"
                                    >Politics</a
                                >
                            </li>
                            <li class="cat-item cat-item-3">
                                <a
                                    href="../programming/index.html"
                                    title="View all posts filed under Programming"
                                    >Programming</a
                                >
                            </li>
                            <li class="cat-item cat-item-7">
                                <a
                                    href="../python/index.html"
                                    title="View all posts filed under Python"
                                    >Python</a
                                >
                            </li>
                            <li class="cat-item cat-item-10">
                                <a
                                    href="../ruby/index.html"
                                    title="View all posts filed under Ruby"
                                    >Ruby</a
                                >
                            </li>
                            <li class="cat-item cat-item-19">
                                <a
                                    href="../security/index.html"
                                    title="View all posts filed under Security"
                                    >Security</a
                                >
                            </li>
                            <li class="cat-item cat-item-16">
                                <a
                                    href="../silverlining.1"
                                    title="View all posts filed under Silver Lining"
                                    >Silver Lining</a
                                >
                            </li>
                            <li class="cat-item cat-item-20">
                                <a
                                    href="../programming/testing/index.html"
                                    title="View all posts filed under Testing"
                                    >Testing</a
                                >
                            </li>
                            <li class="cat-item cat-item-9">
                                <a
                                    href="../web/index.html"
                                    title="View all posts filed under Web"
                                    >Web</a
                                >
                            </li>
                            <li class="cat-item cat-item-13">
                                <a
                                    href="../zopeplone/index.html"
                                    title="View all posts filed under Zope/Plone"
                                    >Zope/Plone</a
                                >
                            </li>
                        </ul>
                    </li>
                    <li id="search-2" class="widget widget_search">
                        <form
                            id="searchform"
                            method="get"
                            action="../../index.html"
                        >
                            <div>
                                <input
                                    id="s"
                                    name="s"
                                    type="text"
                                    value=""
                                    tabindex="1"
                                    size="10"
                                />
                                <input
                                    id="searchsubmit"
                                    name="searchsubmit"
                                    type="submit"
                                    value="Find"
                                    tabindex="2"
                                />
                            </div>
                        </form>
                    </li>
                    <li
                        id="recent-posts-2"
                        class="widget widget_recent_entries"
                    >
                        <h2 class="widgettitle">Recent Posts</h2>
                        <ul>
                            <li>
                                <a
                                    href="../../index.html?p=291"
                                    title="Why doctest.js is better than Python&#8217;s doctest"
                                    >Why doctest.js is better than
                                    Python&#8217;s doctest</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../index.html?p=283"
                                    title="Python Application Package"
                                    >Python Application Package</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../index.html?p=277"
                                    title="Git-as-sync, not source-control-as-deployment"
                                    >Git-as-sync, not
                                    source-control-as-deployment</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../index.html?p=253"
                                    title="My Unsolicited Advice For PyPy"
                                    >My Unsolicited Advice For PyPy</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../index.html?p=250"
                                    title="A Python Web Application Package and Format (we should make one)"
                                    >A Python Web Application Package and Format
                                    (we should make one)</a
                                >
                            </li>
                        </ul>
                    </li>
                    <li
                        id="recent-comments-2"
                        class="widget widget_recent_comments"
                    >
                        <h2 class="widgettitle">Recent Comments</h2>
                        <ul id="recentcomments">
                            <li class="recentcomments">
                                <a
                                    href="http://www.mirsa.com.tr"
                                    rel="external nofollow"
                                    class="url"
                                    >havalandırma</a
                                >
                                on
                                <a
                                    href="../../2012/10/02/why-doctest-js-is-better-than-pythons-doctest/comment-page-1/index.html#comment-228633"
                                    >Why doctest.js is better than
                                    Python&#8217;s doctest</a
                                >
                            </li>
                            <li class="recentcomments">
                                <a
                                    href="http://redealmeidense.com.br/portalx/modules/"
                                    rel="external nofollow"
                                    class="url"
                                    >this website</a
                                >
                                on
                                <a
                                    href="../../2012/10/02/why-doctest-js-is-better-than-pythons-doctest/comment-page-1/index.html#comment-196267"
                                    >Why doctest.js is better than
                                    Python&#8217;s doctest</a
                                >
                            </li>
                            <li class="recentcomments">
                                Eric Pierce on
                                <a
                                    href="../../2012/10/02/why-doctest-js-is-better-than-pythons-doctest/comment-page-1/index.html#comment-195322"
                                    >Why doctest.js is better than
                                    Python&#8217;s doctest</a
                                >
                            </li>
                            <li class="recentcomments">
                                Paul Brian on
                                <a
                                    href="../../2012/10/02/why-doctest-js-is-better-than-pythons-doctest/comment-page-1/index.html#comment-195321"
                                    >Why doctest.js is better than
                                    Python&#8217;s doctest</a
                                >
                            </li>
                            <li class="recentcomments">
                                <a
                                    href="http://benjiyork.com"
                                    rel="external nofollow"
                                    class="url"
                                    >Benji York</a
                                >
                                on
                                <a
                                    href="../../2012/10/02/why-doctest-js-is-better-than-pythons-doctest/comment-page-1/index.html#comment-195320"
                                    >Why doctest.js is better than
                                    Python&#8217;s doctest</a
                                >
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>

            <div id="footer">
                <p>
                    &copy; 2013 Ian Bicking<!--
Does this commenting make me evil?
			|
			Thanks, <a href="http://wordpress.org/" title="WordPress">WordPress</a>
			|
			<a href="http://www.plaintxt.org/themes/barthelme/" title="Barthelme for WordPress" rel="follow">Barthelme</a> theme by <a href="http://scottwallick.com/" title="scottwallick.com" rel="follow">Scott</a>
			| <!-- The following is a link to the theme author's sponsor. Please consider its smallness and that Scott was nice enough to make this theme publically available. -->
                    Sponsor:
                    <a
                        href="http://www.active-sandals.com/womreefsan.html"
                        title="Support: Reef Sandals"
                        >Reef Sandals</a
                    >
                    | Valid
                    <a
                        href="http://validator.w3.org/check?uri=http://blog.ianbicking.org&amp;outline=1&amp;verbose=1"
                        title="Valid XHTML 1.0 Strict"
                        rel="nofollow"
                        >XHTML</a
                    >
                    &amp;
                    <a
                        href="http://jigsaw.w3.org/css-validator/validator?uri=https://ianbicking.org/wp-content/themes/Barthelme-ianb/style.css&amp;profile=css2&amp;warning=no"
                        title="Valid CSS"
                        rel="nofollow"
                        >CSS</a
                    >
                    | --> RSS:
                    <a
                        href="../../feed/rss/index.html"
                        title="Ian Bicking: a blog RSS 2.0 (XML) Feed"
                        rel="alternate"
                        type="application/rss+xml"
                        >Posts</a
                    >
                    &amp;
                    <a
                        href="../../comments/feed/index.html"
                        title="Ian Bicking: a blog Comments RSS 2.0 (XML) Feed"
                        rel="alternate"
                        type="application/rss+xml"
                        >Comments</a
                    >
                </p>
            </div>
        </div>
        <!-- END WRAPPER -->

        <!-- Somehow 41 queries occured in 1.718 seconds. Magic! -->
        <!-- The "Barthelme" theme copyright (c) 2006 Scott Allan Wallick - http://www.plaintxt.org/themes/ -->

        <!-- Google Analytics -->
    </body>
</html>
