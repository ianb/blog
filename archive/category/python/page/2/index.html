<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <!-- MOBIFY - DO NOT ALTER - PASTE IMMEDIATELY AFTER OPENING HEAD TAG -->
        <script type="text/javascript">
            /*<![CDATA[*/ (function (a) {
                function b(a, b) {
                    if (+a) return ~a || (d.cookie = h + "=; path=/");
                    (j = d.createElement(e)),
                        (k = d.getElementsByTagName(e)[0]),
                        (j.src = a),
                        b && (j.onload = j.onerror = b),
                        k.parentNode.insertBefore(j, k);
                }
                function c() {
                    n.api || b(l.shift() || -1, c);
                }
                if (this.Mobify) return;
                var d = document,
                    e = "script",
                    f = "mobify",
                    g = "." + f + ".com/",
                    h = f + "-path",
                    i = g + "un" + f + ".js",
                    j,
                    k,
                    l = [!1, 1],
                    m,
                    n = (this.Mobify = {
                        points: [+new Date()],
                        tagVersion: [6, 0],
                    }),
                    o = /(; |#|&|^)mobify-path=([^&;]*)/g.exec(
                        location.hash + "; " + d.cookie
                    );
                o
                    ? (m = o[2]) &&
                      !+(m = sessionStorage[h] || m) &&
                      (l = [!0, "//preview" + g + escape(m)])
                    : ((l = a() || l),
                      l[0] && l.push("//cdn" + i, "//files01" + i)),
                    l.shift()
                        ? (d.write('<plaintext style="display:none;">'),
                          setTimeout(c))
                        : b(l[0]);
            })(function () {
                if (
                    /ip(hone|od)|android.*(mobile)|blackberry.*applewebkit/i.test(
                        navigator.userAgent
                    )
                ) {
                    return [
                        1,
                        "//cdn.mobify.com/sites/ians-blog/production/mobify.js",
                    ];
                }
            }); /*]]>*/
        </script>
        <!-- END MOBIFY -->
        <title>Ian Bicking: a blog :: Python</title>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
        <meta name="generator" content="WordPress 3.4.2" />
        <!-- LEAVE FOR STATS -->
        <meta name="description" content="" />
        <link
            rel="stylesheet"
            title="plaintxtSimpler"
            href="../../../../wp-content/themes/Barthelme-ianb/style.css"
            type="text/css"
            media="all"
        />
        <link
            rel="start"
            href="../../../../index.html"
            title="Ian Bicking: a blog"
        />
        <link
            rel="alternate"
            type="application/atom+xml"
            title="Ian Bicking: a blog Atom Feed"
            href="../../../../feed/atom/index.html"
        />
        <link
            rel="alternate"
            type="application/rss+xml"
            title="Ian Bicking: a blog RSS 2.0 Feed"
            href="../../../../feed/rss/index.html"
        />
        <link
            rel="alternate"
            type="application/rss+xml"
            title="Ian Bicking: a blog Comments RSS 2.0 Feed"
            href="../../../../comments/feed/index.html"
        />
        <link
            rel="alternate"
            type="application/rdf+xml"
            title="Ian Bicking: a blog RSS 1.0"
            href="../../../../feed/rdf/index.html"
        />
        <link
            rel="alternate"
            type="text/xml"
            title="Ian Bicking: a blog RSS 0.92 Feed"
            href="../../../../feed/rss/index.html"
        />

        <link
            rel="archives"
            title="October 2012"
            href="../../../../2012/10/index.html"
        />
        <link
            rel="archives"
            title="February 2012"
            href="../../../../2012/02/index.html"
        />
        <link
            rel="archives"
            title="April 2011"
            href="../../../../2011/04/index.html"
        />
        <link
            rel="archives"
            title="March 2011"
            href="../../../../2011/03/index.html"
        />
        <link
            rel="archives"
            title="September 2010"
            href="../../../../2010/09/index.html"
        />
        <link
            rel="archives"
            title="August 2010"
            href="../../../../2010/08/index.html"
        />
        <link
            rel="archives"
            title="May 2010"
            href="../../../../2010/05/index.html"
        />
        <link
            rel="archives"
            title="April 2010"
            href="../../../../2010/04/index.html"
        />
        <link
            rel="archives"
            title="March 2010"
            href="../../../../2010/03/index.html"
        />
        <link
            rel="archives"
            title="February 2010"
            href="../../../../2010/02/index.html"
        />
        <link
            rel="archives"
            title="January 2010"
            href="../../../../2010/01/index.html"
        />
        <link
            rel="archives"
            title="September 2009"
            href="../../../../2009/09/index.html"
        />
        <link
            rel="archives"
            title="May 2009"
            href="../../../../2009/05/index.html"
        />
        <link
            rel="archives"
            title="April 2009"
            href="../../../../2009/04/index.html"
        />
        <link
            rel="archives"
            title="January 2009"
            href="../../../../2009/01/index.html"
        />
        <link
            rel="archives"
            title="December 2008"
            href="../../../../2008/12/index.html"
        />
        <link
            rel="archives"
            title="November 2008"
            href="../../../../2008/11/index.html"
        />
        <link
            rel="archives"
            title="October 2008"
            href="../../../../2008/10/index.html"
        />
        <link
            rel="archives"
            title="September 2008"
            href="../../../../2008/09/index.html"
        />
        <link
            rel="archives"
            title="August 2008"
            href="../../../../2008/08/index.html"
        />
        <link
            rel="archives"
            title="July 2008"
            href="../../../../2008/07/index.html"
        />
        <link
            rel="archives"
            title="June 2008"
            href="../../../../2008/06/index.html"
        />
        <link
            rel="archives"
            title="May 2008"
            href="../../../../2008/05/index.html"
        />
        <link
            rel="archives"
            title="April 2008"
            href="../../../../2008/04/index.html"
        />
        <link
            rel="archives"
            title="March 2008"
            href="../../../../2008/03/index.html"
        />
        <link
            rel="archives"
            title="February 2008"
            href="../../../../2008/02/index.html"
        />
        <link
            rel="archives"
            title="January 2008"
            href="../../../../2008/01/index.html"
        />
        <link
            rel="archives"
            title="November 2007"
            href="../../../../2007/11/index.html"
        />
        <link
            rel="archives"
            title="October 2007"
            href="../../../../2007/10/index.html"
        />
        <link
            rel="archives"
            title="September 2007"
            href="../../../../2007/09/index.html"
        />
        <link
            rel="archives"
            title="August 2007"
            href="../../../../2007/08/index.html"
        />
        <link
            rel="archives"
            title="July 2007"
            href="../../../../2007/07/index.html"
        />
        <link
            rel="alternate"
            type="application/rss+xml"
            title="Ian Bicking: a blog &raquo; Python Category Feed"
            href="../../feed/index.html"
        />
        <link
            rel="EditURI"
            type="application/rsd+xml"
            title="RSD"
            href="../../../../xmlrpc.php?rsd"
        />
        <link
            rel="wlwmanifest"
            type="application/wlwmanifest+xml"
            href="../../../../wp-includes/wlwmanifest.xml"
        />
        <meta name="generator" content="WordPress 3.4.2" />
        <link
            rel="stylesheet"
            href="../../../../wp-content/plugins/source-code-syntax-highlighting-plugin-for-wordpress/geshi.css"
            type="text/css"
        />
        <style type="text/css">
            .recentcomments a {
                display: inline !important;
                padding: 0 !important;
                margin: 0 !important;
            }
        </style>
        <style type="text/css" media="all">
            /*<![CDATA[*/
            body {
                font-size: 100%;
            }
            body {
                font-family: tahoma, geneva, sans-serif;
            }
            div.post-header,
            h2.post-title,
            p.post-date-single,
            h2.post-title-single,
            div.post-entry h1,
            div.post-entry h2,
            div.post-entry h3,
            div.post-entry h4,
            div.post-entry h5,
            div.post-entry h6,
            div.post-entry blockquote,
            div.post-footer,
            h3#comment-count,
            h4#comment-header,
            div#comments ol li p.comment-metadata,
            h4#respond {
                font-family: verdana, geneva, sans-serif;
            }
            div.post-entry p {
                text-align: left;
            }
            div#wrapper {
                width: 100%;
            }

            /*]]>*/
        </style>
    </head>
    <body>
        <div id="wrapper">
            <div
                id="header"
                onclick="location.href='https://ianbicking.org/';"
                style="cursor: pointer"
            >
                <h1 id="title">
                    <a href="../../../../index.html" title="Ian Bicking: a blog"
                        >Ian Bicking: a blog</a
                    >
                </h1>
                <p id="description"></p>
            </div>
            <!-- WP Theme Credits -->
            <div style="display: none">
                We can answer on question
                <a href="http://www.olnevhost.net/vps-hosting.html"
                    >what is VPS</a
                >? and what is
                <a href="http://www.olnevhost.net/dedicated-servers.html"
                    ><strong>cheap dedicated servers</strong></a
                >?
            </div>
            <!-- END HEADER -->
            <div id="container">
                <div id="content" class="narrowcolumn">
                    <p class="post-date-single">{ Category Archives }</p>
                    <h2 class="post-title-single">Python</h2>

                    <div id="post-168" class="post">
                        <div class="post-container">
                            <div class="post-content">
                                <h2 class="post-title">
                                    <a
                                        href="../../../../2010/03/03/toppcloud-renamed-to-silver-lining/index.html"
                                        title="Permalink to toppcloud renamed to Silver Lining"
                                        rel="bookmark"
                                        >toppcloud renamed to Silver Lining</a
                                    >
                                </h2>
                                <div class="post-entry">
                                    <div class="document">
                                        <p>
                                            After some pondering at PyCon, I
                                            decided on a new name for toppcloud:
                                            <strong>Silver Lining</strong>.
                                            I&#8217;ll credit a mysterious
                                            commenter &quot;david&quot; with the
                                            name idea. The command line is
                                            simply
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >silver</span
                                                ></tt
                                            >
                                            &#8212;
                                            <tt class="docutils literal"
                                                ><span class="pre">silver</span>
                                                <span class="pre"
                                                    >update</span
                                                ></tt
                                            >
                                            has a nice ring to it.
                                        </p>
                                        <p>
                                            There&#8217;s a new site:
                                            <a
                                                class="reference external"
                                                href="http://cloudsilverlining.org"
                                                >cloudsilverlining.org</a
                                            >; not notably different than the
                                            old site, just a new name. The
                                            product is self-hosting now, using a
                                            <a
                                                class="reference external"
                                                href="http://bitbucket.org/ianb/silverlining/"
                                                >simple app</a
                                            >
                                            that runs after every commit to
                                            regenerate the docs, and with a
                                            small extension to Silver Lining
                                            itself (to make it easier to host
                                            static files). Now that it has a
                                            real name I also gave it a
                                            <a
                                                class="reference external"
                                                href="http://groups.google.com/group/silverlining-dev"
                                                >real mailing list</a
                                            >.
                                        </p>
                                        <p>
                                            Silver Lining also has its
                                            <a
                                                class="reference external"
                                                href="http://bitbucket.org/ianb/silverlining/src/tip/tests/functional/runtest.py"
                                                >first test</a
                                            >. Not an impressive test, but a
                                            test. I&#8217;m hoping with a
                                            <a
                                                class="reference external"
                                                href="http://mail-archives.apache.org/mod_mbox/incubator-libcloud/201003.mbox/browser"
                                                >VM-based libcloud backend</a
                                            >
                                            that a full integration test can run
                                            in a reasonable amount of time.
                                            <em>Some</em> unit tests would be
                                            possible, but so far most of the
                                            bugs have been interaction bugs so I
                                            think integration tests will have to
                                            pull most of the weight. (A
                                            continuous integration rig will be
                                            very useful; I am not sure if Silver
                                            Lining can self-host that, though
                                            it&#8217;d be nice/clever if it
                                            could.)
                                        </p>
                                    </div>
                                    <!-- <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="https://ianbicking.org/2010/03/03/toppcloud-renamed-to-silver-lining/"
    dc:identifier="https://ianbicking.org/2010/03/03/toppcloud-renamed-to-silver-lining/"
    dc:title="toppcloud renamed to Silver Lining"
    trackback:ping="https://ianbicking.org/2010/03/03/toppcloud-renamed-to-silver-lining/trackback/" />
</rdf:RDF> -->
                                </div>
                                <!-- END POST-ENTRY -->
                            </div>
                            <!-- END POST-CONTENT  -->
                        </div>
                        <!-- END-CONTAINER -->
                        <div class="post-header">
                            <h3 class="post-date">2010 03 03</h3>
                            <p class="post-categories">
                                <a
                                    href="../../../packaging/index.html"
                                    title="View all posts in Packaging"
                                    rel="category tag"
                                    >Packaging</a
                                ><br /><a
                                    href="../../../programming/index.html"
                                    title="View all posts in Programming"
                                    rel="category tag"
                                    >Programming</a
                                ><br /><a
                                    href="../../index.html"
                                    title="View all posts in Python"
                                    rel="category tag"
                                    >Python</a
                                ><br /><a
                                    href="../../../silverlining.1"
                                    title="View all posts in Silver Lining"
                                    rel="category tag"
                                    >Silver Lining</a
                                ><br /><a
                                    href="../../../web/index.html"
                                    title="View all posts in Web"
                                    rel="category tag"
                                    >Web</a
                                >
                            </p>
                            <p class="post-comments">
                                <a
                                    href="../../../../2010/03/03/toppcloud-renamed-to-silver-lining/index.html#comments"
                                    title="Comment on toppcloud renamed to Silver Lining"
                                    >Comments (7)</a
                                >
                            </p>
                            <p class="post-permalink">
                                <a
                                    href="../../../../2010/03/03/toppcloud-renamed-to-silver-lining/index.html"
                                    title="Permalink to toppcloud renamed to Silver Lining"
                                    rel="permalink"
                                    >Permalink</a
                                >
                            </p>
                        </div>
                        <!-- END POST-FOOTER -->
                    </div>
                    <!-- END POST -->

                    <div id="post-164" class="post">
                        <div class="post-container">
                            <div class="post-content">
                                <h2 class="post-title">
                                    <a
                                        href="../../../../2010/03/01/throw-out-your-frameworks-forms-included/index.html"
                                        title="Permalink to Throw out your frameworks! (forms included)"
                                        rel="bookmark"
                                        >Throw out your frameworks! (forms
                                        included)</a
                                    >
                                </h2>
                                <div class="post-entry">
                                    <div class="document">
                                        <p>
                                            No, I should say
                                            <em>forms particularly</em>.
                                        </p>
                                        <p>
                                            I have lots of things to blog about,
                                            but nothing makes me want to blog
                                            like <em>code</em>. Ideas are hard,
                                            code is easy. So when I saw
                                            <a
                                                class="reference external"
                                                href="http://jacobian.org/writing/dynamic-form-generation/"
                                                >Jacob&#8217;s writeup about
                                                dynamic Django form
                                                generation</a
                                            >
                                            I felt a desire to respond. I
                                            didn&#8217;t see the form panel at
                                            PyCon (I intended to but I hardly
                                            saw <em>any</em> talks at PyCon, and
                                            yet still didn&#8217;t even see a
                                            good number of the people I wanted
                                            to see), but as the author of an
                                            <a
                                                class="reference external"
                                                href="http://formencode.org/htmlfill.html"
                                                >ungenerator</a
                                            >
                                            and as a general
                                            <a
                                                class="reference external"
                                                href="../../../../on-form-libraries.html"
                                                >form library skeptic</a
                                            >
                                            I have a somewhat different
                                            perspective on the topic.
                                        </p>
                                        <p>
                                            The example created for the panel
                                            might display that perspective. You
                                            should go read
                                            <a
                                                class="reference external"
                                                href="http://jacobian.org/writing/dynamic-form-generation/"
                                                >Jacob&#8217;s description</a
                                            >; but basically it&#8217;s a simple
                                            registration form with a dynamic set
                                            of questions to ask.
                                        </p>
                                        <p>
                                            I have created a
                                            <a
                                                class="reference external"
                                                href="http://svn.colorstudy.com/home/ianb/formencode_answer.py"
                                                >complete example</a
                                            >, because I wanted to be sure I
                                            wasn&#8217;t skipping anything, but
                                            I&#8217;ll present a trimmed-down
                                            version.
                                        </p>
                                        <p>First, the basic control logic:</p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            <span class="kw1">from</span>
                                            webob.<span class="me1">dec</span>
                                            <span class="kw1">import</span>
                                            wsgify<br />
                                            <span class="kw1">from</span> webob
                                            <span class="kw1">import</span>
                                            exc<br />
                                            <span class="kw1">from</span>
                                            formencode
                                            <span class="kw1">import</span>
                                            htmlfill<br />
                                            <br />
                                            @<span class="co1">wsgify</span
                                            ><br />
                                            <span class="kw1">def</span>
                                            questioner<span class="br0"
                                                >&#40;</span
                                            >req<span class="br0">&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp; questions =
                                            get_questions<span class="br0"
                                                >&#40;</span
                                            >req<span class="br0">&#41;</span>
                                            <span class="co1"
                                                ># This is provided as part of
                                                the example</span
                                            ><br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">if</span>
                                            req.<span class="me1">method</span>
                                            ==
                                            <span class="st0">'POST'</span
                                            >:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; errors =
                                            validate<span class="br0"
                                                >&#40;</span
                                            >req, questions<span class="br0"
                                                >&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="kw1">if</span>
                                            <span class="kw1">not</span>
                                            errors:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                            &nbsp; ...
                                            <span class="me1">save</span>
                                            response ...<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                            &nbsp;
                                            <span class="kw1">return</span>
                                            exc.<span class="me1"
                                                >HTTPFound</span
                                            ><span class="br0">&#40;</span
                                            >location=<span class="st0"
                                                >'/thanks'</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">else</span>:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; errors =
                                            <span class="br0">&#123;</span
                                            ><span class="br0">&#125;</span
                                            ><br />
                                            &nbsp; &nbsp;
                                            <span class="co1"
                                                >## Here's the &quot;form
                                                generation&quot;:</span
                                            ><br />
                                            &nbsp; &nbsp; page =
                                            page_template.<span class="me1"
                                                >substitute</span
                                            ><span class="br0">&#40;</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            action=req.<span class="me1"
                                                >url</span
                                            >,<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            questions=questions<span class="br0"
                                                >&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; page = htmlfill.<span
                                                class="me1"
                                                >render</span
                                            ><span class="br0">&#40;</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; page,<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            defaults=req.<span class="me1"
                                                >POST</span
                                            >,<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            errors=errors<span class="br0"
                                                >&#41;</span
                                            ><br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">return</span>
                                            Response<span class="br0"
                                                >&#40;</span
                                            >page<span class="br0">&#41;</span
                                            ><br />
                                            <br />
                                            <span class="kw1">def</span>
                                            validate<span class="br0"
                                                >&#40;</span
                                            >req, questions<span class="br0"
                                                >&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp;
                                            <span class="co1"
                                                ># All manual, but do it however
                                                you want:</span
                                            ><br />
                                            &nbsp; &nbsp; errors =
                                            <span class="br0">&#123;</span
                                            ><span class="br0">&#125;</span
                                            ><br />
                                            &nbsp; &nbsp; form = req.<span
                                                class="me1"
                                                >POST</span
                                            ><br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">if</span>
                                            <span class="br0">&#40;</span
                                            >form.<span class="me1">get</span
                                            ><span class="br0">&#40;</span
                                            ><span class="st0">'password'</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="kw1">and</span>
                                            form<span class="br0">&#91;</span
                                            ><span class="st0">'password'</span
                                            ><span class="br0">&#93;</span> !=
                                            form.<span class="me1">get</span
                                            ><span class="br0">&#40;</span
                                            ><span class="st0"
                                                >'password_confirm'</span
                                            ><span class="br0">&#41;</span
                                            ><span class="br0">&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            errors<span class="br0">&#91;</span
                                            ><span class="st0"
                                                >'password_confirm'</span
                                            ><span class="br0">&#93;</span> =
                                            <span class="st0"
                                                >'Passwords do not match'</span
                                            ><br />
                                            &nbsp; &nbsp; fields = questions +
                                            <span class="br0">&#91;</span
                                            ><span class="st0">'username'</span
                                            >,
                                            <span class="st0">'password'</span
                                            ><span class="br0">&#93;</span
                                            ><br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">for</span> field
                                            <span class="kw1">in</span>
                                            fields:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="kw1">if</span>
                                            <span class="kw1">not</span>
                                            form.<span class="me1">get</span
                                            ><span class="br0">&#40;</span
                                            >field<span class="br0">&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                            &nbsp; errors<span class="br0"
                                                >&#91;</span
                                            >field<span class="br0">&#93;</span>
                                            =
                                            <span class="st0"
                                                >'Please enter a value'</span
                                            ><br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">return</span>
                                            errors<br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            I&#8217;ve just manually handled
                                            validation here. I don&#8217;t feel
                                            like doing it with FormEncode.
                                            Manual validation isn&#8217;t that
                                            big a deal; FormEncode would just
                                            produce the same
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >errors</span
                                                ></tt
                                            >
                                            dictionary anyway. In this case (as
                                            in many form validation cases) you
                                            can&#8217;t do better than
                                            hand-written validation code:
                                            it&#8217;s shorter, more
                                            self-contained, and easier to tweak.
                                        </p>
                                        <p>
                                            After validation the template is
                                            rendered:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            page = page_template.<span
                                                class="me1"
                                                >substitute</span
                                            ><span class="br0">&#40;</span
                                            ><br />
                                            &nbsp; &nbsp; action=req.<span
                                                class="me1"
                                                >url</span
                                            >,<br />
                                            &nbsp; &nbsp;
                                            questions=questions<span class="br0"
                                                >&#41;</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            I&#8217;m using
                                            <a
                                                class="reference external"
                                                href="http://pythonpaste.org/tempita/"
                                                >Tempita</a
                                            >, but it really doesn&#8217;t
                                            matter. The template looks like
                                            this:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            &lt;form action=<span class="st0"
                                                >&quot;{{action}}&quot;</span
                                            >
                                            method=<span class="st0"
                                                >&quot;POST&quot;</span
                                            >&gt;<br />
                                            New Username: &lt;input
                                            <span class="kw2">type</span>=<span
                                                class="st0"
                                                >&quot;text&quot;</span
                                            >
                                            name=<span class="st0"
                                                >&quot;username&quot;</span
                                            >&gt;&lt;br /&gt;<br />
                                            Password: &lt;input
                                            <span class="kw2">type</span>=<span
                                                class="st0"
                                                >&quot;password&quot;</span
                                            >
                                            name=<span class="st0"
                                                >&quot;password&quot;</span
                                            >&gt;&lt;br /&gt;<br />
                                            Repeat Password:<br />
                                            &nbsp; &lt;input
                                            <span class="kw2">type</span>=<span
                                                class="st0"
                                                >&quot;password&quot;</span
                                            >
                                            name=<span class="st0"
                                                >&quot;password_confirm&quot;</span
                                            >&gt;&lt;br /&gt;<br />
                                            <span class="br0">&#123;</span
                                            ><span class="br0">&#123;</span
                                            ><span class="kw1">for</span>
                                            question
                                            <span class="kw1">in</span>
                                            questions<span class="br0"
                                                >&#125;</span
                                            ><span class="br0">&#125;</span
                                            ><br />
                                            &nbsp;
                                            <span class="br0">&#123;</span
                                            ><span class="br0">&#123;</span
                                            >question<span class="br0"
                                                >&#125;</span
                                            ><span class="br0">&#125;</span>:
                                            &lt;input
                                            <span class="kw2">type</span>=<span
                                                class="st0"
                                                >&quot;text&quot;</span
                                            >
                                            name=<span class="st0"
                                                >&quot;{{question}}&quot;</span
                                            >&gt;&lt;br /&gt;<br />
                                            <span class="br0">&#123;</span
                                            ><span class="br0">&#123;</span
                                            >endfor<span class="br0"
                                                >&#125;</span
                                            ><span class="br0">&#125;</span
                                            ><br />
                                            &lt;input
                                            <span class="kw2">type</span>=<span
                                                class="st0"
                                                >&quot;submit&quot;</span
                                            >&gt;<br />
                                            &lt;/form&gt;<br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            Note that the only &quot;logic&quot;
                                            here is to render the form to
                                            include fields for all the
                                            questions. Obviously this produces
                                            an ugly form, but it&#8217;s
                                            <em>very obvious</em> how you make
                                            this form pretty, and how to tweak
                                            it in any way you might want. Also
                                            if you have deeper dynamicism (e.g.,
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >get_questions</span
                                                ></tt
                                            >
                                            start returning the type of response
                                            required, or weird validation, or
                                            whatever) it&#8217;s
                                            <em>very obvious</em> where that
                                            change would go: display logic goes
                                            in the form, validation logic goes
                                            in that validate function.
                                        </p>
                                        <p>
                                            This just gives you the raw form.
                                            You wouldn&#8217;t need a template
                                            at all if it wasn&#8217;t for the
                                            dynamicism. Everything else is added
                                            when the form is &quot;filled&quot;:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            page = htmlfill.<span class="me1"
                                                >render</span
                                            ><span class="br0">&#40;</span
                                            ><br />
                                            &nbsp; &nbsp; page,<br />
                                            &nbsp; &nbsp; defaults=req.<span
                                                class="me1"
                                                >POST</span
                                            >,<br />
                                            &nbsp; &nbsp; errors=errors<span
                                                class="br0"
                                                >&#41;</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            How exactly you want to calculate
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >defaults</span
                                                ></tt
                                            >
                                            is up to the application; you might
                                            want query string variables to be
                                            able to pre-fill the form (use
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >req.params</span
                                                ></tt
                                            >), you might want the form bare to
                                            start (like here with
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >req.POST</span
                                                ></tt
                                            >), you can easily implement wizards
                                            by stuffing
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >req.POST</span
                                                ></tt
                                            >
                                            into the session to repeat a form,
                                            you might read the defaults out of a
                                            user object to make this an edit
                                            form. And errors are just handled
                                            automatically, inserted into the
                                            HTML with appropriate CSS classes.
                                        </p>
                                        <p>
                                            A great aspect of this
                                            <em>pattern</em> if you use it
                                            (I&#8217;m not even sure it deserves
                                            the moniker <em>library</em>): when
                                            <a
                                                class="reference external"
                                                href="http://www.whatwg.org/specs/web-apps/current-work/multipage/forms.html#forms"
                                                >HTML 5 Forms</a
                                            >
                                            finally come around and we can all
                                            stop doing this stupid server-side
                                            overthought nonsense,
                                            <strong>you</strong> won&#8217;t
                                            have overthought your forms. Your
                                            mind will be free and ready to
                                            accept that the world has actually
                                            become simpler, not more
                                            complicated, and that there is
                                            knowledge worth forgetting (forms
                                            are so freakin&#8217; stupid!) If at
                                            all possible, dodging complexity is
                                            far better than cleverly responding
                                            to complexity.
                                        </p>
                                    </div>
                                    <!-- <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="https://ianbicking.org/2010/03/01/throw-out-your-frameworks-forms-included/"
    dc:identifier="https://ianbicking.org/2010/03/01/throw-out-your-frameworks-forms-included/"
    dc:title="Throw out your frameworks! (forms included)"
    trackback:ping="https://ianbicking.org/2010/03/01/throw-out-your-frameworks-forms-included/trackback/" />
</rdf:RDF> -->
                                </div>
                                <!-- END POST-ENTRY -->
                            </div>
                            <!-- END POST-CONTENT  -->
                        </div>
                        <!-- END-CONTAINER -->
                        <div class="post-header">
                            <h3 class="post-date">2010 03 01</h3>
                            <p class="post-categories">
                                <a
                                    href="../../../html/index.html"
                                    title="View all posts in HTML"
                                    rel="category tag"
                                    >HTML</a
                                ><br /><a
                                    href="../../../programming/index.html"
                                    title="View all posts in Programming"
                                    rel="category tag"
                                    >Programming</a
                                ><br /><a
                                    href="../../index.html"
                                    title="View all posts in Python"
                                    rel="category tag"
                                    >Python</a
                                ><br /><a
                                    href="../../../web/index.html"
                                    title="View all posts in Web"
                                    rel="category tag"
                                    >Web</a
                                >
                            </p>
                            <p class="post-comments">
                                <a
                                    href="../../../../2010/03/01/throw-out-your-frameworks-forms-included/index.html#comments"
                                    title="Comment on Throw out your frameworks! (forms included)"
                                    >Comments (27)</a
                                >
                            </p>
                            <p class="post-permalink">
                                <a
                                    href="../../../../2010/03/01/throw-out-your-frameworks-forms-included/index.html"
                                    title="Permalink to Throw out your frameworks! (forms included)"
                                    rel="permalink"
                                    >Permalink</a
                                >
                            </p>
                        </div>
                        <!-- END POST-FOOTER -->
                    </div>
                    <!-- END POST -->

                    <div id="post-158" class="post">
                        <div class="post-container">
                            <div class="post-content">
                                <h2 class="post-title">
                                    <a
                                        href="../../../../2010/02/10/why-toppcloud-not-agnostic/index.html"
                                        title="Permalink to Why toppcloud (Silver Lining) will not be agnostic"
                                        rel="bookmark"
                                        >Why toppcloud (Silver Lining) will not
                                        be agnostic</a
                                    >
                                </h2>
                                <div class="post-entry">
                                    <div class="document">
                                        <p>
                                            I haven&#8217;t received a great
                                            deal of <em>specific</em> feedback
                                            on toppcloud
                                            (<strong>update</strong>: renamed
                                            Silver Lining), only a few people
                                            (Ben Bangert, Jorge Vargas) seem to
                                            have really dived deeply into it.
                                            But &#8212; and this is not
                                            unexpected &#8212; I have already
                                            gotten several requests about making
                                            it more agnostic with respect
                                            to&#8230; stuff. Maybe that it not
                                            (at least forever) require Ubuntu.
                                            Or maybe that it should support
                                            different process models (e.g.,
                                            threaded and multiple processes). Or
                                            other versions of Python.
                                        </p>
                                        <p>
                                            The more I think about it, and the
                                            more I work with the tool, the more
                                            confident I am that toppcloud should
                                            not be agnostic on these issues.
                                            This is not so much about an
                                            &quot;opinionated&quot; tool;
                                            toppcloud is not actually very
                                            opinionated. It&#8217;s about a
                                            well-understood system.
                                        </p>
                                        <p>
                                            For instance, Ben noticed a problem
                                            recently with
                                            <a
                                                class="reference external"
                                                href="http://code.google.com/p/modwsgi/issues/detail?id=177"
                                                >weird import errors</a
                                            >. I don&#8217;t know
                                            <em>quite</em> why mod_wsgi has this
                                            particular problem (when other WSGI
                                            servers that I&#8217;ve used
                                            haven&#8217;t), but the fix
                                            isn&#8217;t that hard. So Ben
                                            <a
                                                class="reference external"
                                                href="http://bitbucket.org/ianb/toppcloud/changeset/27a470352a5e/"
                                                >committed a fix</a
                                            >
                                            and the problem went away.
                                        </p>
                                        <p>
                                            Personally I think this is a bug
                                            with mod_wsgi. Maybe it&#8217;s also
                                            a Python bug. But it doesn&#8217;t
                                            really matter. When a bug exists it
                                            &quot;belongs&quot; to everyone who
                                            encounters it.
                                        </p>
                                        <p>
                                            toppcloud is not intended to be a
                                            transparent system. When it&#8217;s
                                            working correctly, you should be
                                            able to ignore most of the system
                                            and concentrate on the relatively
                                            simple abstractions given to your
                                            application. So if the configuration
                                            reveals this particular bug in
                                            Python/mod_wsgi, then the bug is
                                            essentially a toppcloud bug, and
                                            toppcloud should (and <em>can</em>)
                                            fix it.
                                        </p>
                                        <p>
                                            A more flexible system can ignore
                                            such problems as being
                                            &quot;somewhere else&quot; in the
                                            system. Or, if you don&#8217;t
                                            define these problems as someone
                                            else&#8217;s problem, then a more
                                            flexible system is essentially
                                            always broken somewhere; there is
                                            always some untested combination,
                                            some new component, or some old
                                            component that might get pushed into
                                            the mix. Fixes for one
                                            person&#8217;s problem may introduce
                                            a new problem in someone
                                            else&#8217;s stack. Some fixes
                                            aren&#8217;t even clear. toppcloud
                                            has Varnish in place, so it&#8217;s
                                            quite clear where a
                                            <a
                                                class="reference external"
                                                href="http://bitbucket.org/ianb/toppcloud/changeset/614d5366be67/"
                                                >fix related to Django and
                                                Varnish configuration goes</a
                                            >. If these were each components
                                            developed by different people at
                                            different times (like with buildout
                                            recipes) then fixing something like
                                            this could get complicated.
                                        </p>
                                        <p>
                                            So I feel very resolved: toppcloud
                                            will hardcode everything it possibly
                                            can. Python 2.6 and only 2.6! (Until
                                            2.7, but then
                                            <strong>only 2.7</strong>!). Only
                                            Varnish/Apache/mod_wsgi. I
                                            haven&#8217;t figured out
                                            threads/processes exactly, but once
                                            I do, there will be only one way!
                                            And if I get it wrong, then everyone
                                            (<strong>everyone</strong>) will
                                            have to switch when it is corrected!
                                            Because I&#8217;d much rather have a
                                            system that is inflexible than one
                                            that doesn&#8217;t work. With a
                                            clear and solid design I think it is
                                            feasible to get this to work, and
                                            that is no small feat.
                                        </p>
                                        <p>
                                            Relatedly,
                                            <a
                                                class="reference external"
                                                href="../../../../2010/02/09/leaving-topp/comment-page-1/index.html#comment-151194"
                                                >I think I&#8217;m going to
                                                change the name of toppcloud</a
                                            >, so ideas are welcome!
                                        </p>
                                    </div>
                                    <!-- <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="https://ianbicking.org/2010/02/10/why-toppcloud-not-agnostic/"
    dc:identifier="https://ianbicking.org/2010/02/10/why-toppcloud-not-agnostic/"
    dc:title="Why toppcloud (Silver Lining) will not be agnostic"
    trackback:ping="https://ianbicking.org/2010/02/10/why-toppcloud-not-agnostic/trackback/" />
</rdf:RDF> -->
                                </div>
                                <!-- END POST-ENTRY -->
                            </div>
                            <!-- END POST-CONTENT  -->
                        </div>
                        <!-- END-CONTAINER -->
                        <div class="post-header">
                            <h3 class="post-date">2010 02 10</h3>
                            <p class="post-categories">
                                <a
                                    href="../../../programming/index.html"
                                    title="View all posts in Programming"
                                    rel="category tag"
                                    >Programming</a
                                ><br /><a
                                    href="../../index.html"
                                    title="View all posts in Python"
                                    rel="category tag"
                                    >Python</a
                                ><br /><a
                                    href="../../../silverlining.1"
                                    title="View all posts in Silver Lining"
                                    rel="category tag"
                                    >Silver Lining</a
                                ><br /><a
                                    href="../../../web/index.html"
                                    title="View all posts in Web"
                                    rel="category tag"
                                    >Web</a
                                >
                            </p>
                            <p class="post-comments">
                                <a
                                    href="../../../../2010/02/10/why-toppcloud-not-agnostic/index.html#comments"
                                    title="Comment on Why toppcloud (Silver Lining) will not be agnostic"
                                    >Comments (23)</a
                                >
                            </p>
                            <p class="post-permalink">
                                <a
                                    href="../../../../2010/02/10/why-toppcloud-not-agnostic/index.html"
                                    title="Permalink to Why toppcloud (Silver Lining) will not be agnostic"
                                    rel="permalink"
                                    >Permalink</a
                                >
                            </p>
                        </div>
                        <!-- END POST-FOOTER -->
                    </div>
                    <!-- END POST -->

                    <div id="post-143" class="post">
                        <div class="post-container">
                            <div class="post-content">
                                <h2 class="post-title">
                                    <a
                                        href="../../../../2010/02/05/toppcloud-and-django/index.html"
                                        title="Permalink to toppcloud (Silver Lining) and Django"
                                        rel="bookmark"
                                        >toppcloud (Silver Lining) and Django</a
                                    >
                                </h2>
                                <div class="post-entry">
                                    <div class="document">
                                        <p>
                                            I wrote up instructions on using
                                            <a
                                                class="reference external"
                                                href="../../../../2010/01/29/new-way-to-deploy-web-apps/index.html"
                                                >toppcloud</a
                                            >
                                            (<strong>update</strong>: renamed
                                            Silver Lining) with Django. They are
                                            <a
                                                class="reference external"
                                                href="http://toppcloud.colorstudy.com/django-quickstart.html"
                                                >up on the site</a
                                            >
                                            (where they will be updated in the
                                            future), but I&#8217;ll drop them
                                            here too&#8230;
                                        </p>
                                        <div
                                            class="section"
                                            id="creating-a-layout"
                                        >
                                            <h2>Creating a Layout</h2>
                                            <p>
                                                First thing you have to do
                                                (after installing toppcloud of
                                                course) is create an environment
                                                for your new application. Do
                                                that like:
                                            </p>
                                            <div
                                                class="dean_ch"
                                                style="white-space: wrap"
                                            >
                                                <br />
                                                $ toppcloud init sampleapp<br />
                                                &nbsp;
                                            </div>
                                            <p>
                                                This creates a directory
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >sampleapp/</span
                                                    ></tt
                                                >
                                                with a basic layout. The first
                                                thing we&#8217;ll do is set up
                                                version control for our project.
                                                For the sake of documentation,
                                                imagine you go to
                                                <a
                                                    class="reference external"
                                                    href="http://bitbucket.org"
                                                    >bitbucket</a
                                                >
                                                and create two new repositories,
                                                one called
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >sampleapp</span
                                                    ></tt
                                                >
                                                and another called
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >sampleapp-lib</span
                                                    ></tt
                                                >
                                                (and for the examples
                                                we&#8217;ll use the username
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >USER</span
                                                    ></tt
                                                >).
                                            </p>
                                            <p>
                                                We&#8217;ll go into our new
                                                environment and use these:
                                            </p>
                                            <div
                                                class="dean_ch"
                                                style="white-space: wrap"
                                            >
                                                <br />
                                                $
                                                <span class="kw3">cd</span>
                                                sampleapp<br />
                                                $ hg clone
                                                http://bitbucket.<span
                                                    class="me1"
                                                    >org</span
                                                >/USER/sampleapp
                                                src/sampleapp<br />
                                                $ rm -r lib/python/<br />
                                                $ hg clone
                                                http://bitbucket.<span
                                                    class="me1"
                                                    >org</span
                                                >/USER/sampleapp-lib
                                                lib/python<br />
                                                $ mkdir lib/python/bin/<br />
                                                $ echo
                                                <span class="st0"
                                                    >&quot;syntax: glob<br />
                                                    bin/python*<br />
                                                    bin/activate<br />
                                                    bin/activate_this.py<br />
                                                    bin/pip<br />
                                                    bin/easy_install*<br />
                                                    &quot;</span
                                                >
                                                &gt; lib/python/.<span
                                                    class="me1"
                                                    >hgignore</span
                                                ><br />
                                                $ mv bin/* lib/python/bin/<br />
                                                $ rmdir bin/<br />
                                                $ ln -s lib/python/bin bin<br />
                                                &nbsp;
                                            </div>
                                            <p>
                                                Now there is a basic layout
                                                setup, with all your libraries
                                                going into the
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >sampleapp-lib</span
                                                    ></tt
                                                >
                                                repository, and your main
                                                application in the
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >sampleapp</span
                                                    ></tt
                                                >
                                                repository.
                                            </p>
                                            <p>
                                                Next we&#8217;ll install Django:
                                            </p>
                                            <div
                                                class="dean_ch"
                                                style="white-space: wrap"
                                            >
                                                <br />
                                                $ source bin/activate<br />
                                                $ pip install Django<br />
                                                &nbsp;
                                            </div>
                                            <p>
                                                Then we&#8217;ll set up a
                                                standard Django site:
                                            </p>
                                            <div
                                                class="dean_ch"
                                                style="white-space: wrap"
                                            >
                                                <br />
                                                $
                                                <span class="kw3">cd</span>
                                                src/sampleapp<br />
                                                $ django-admin.<span class="me1"
                                                    >py</span
                                                >
                                                sampleapp<br />
                                                &nbsp;
                                            </div>
                                            <p>
                                                Also we&#8217;d like to be able
                                                to import this file. It&#8217;d
                                                be nice if there was a
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >setup.py</span
                                                    ></tt
                                                >
                                                file, and we could run
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >pip</span
                                                    >
                                                    <span class="pre">-e</span>
                                                    <span class="pre"
                                                        >src/sampleapp</span
                                                    ></tt
                                                >, but
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >django-admin.py</span
                                                    ></tt
                                                >
                                                doesn&#8217;t create that
                                                itself. Instead we&#8217;ll get
                                                that on the import path more
                                                manually with a
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >.pth</span
                                                    ></tt
                                                >
                                                file:
                                            </p>
                                            <div
                                                class="dean_ch"
                                                style="white-space: wrap"
                                            >
                                                <br />
                                                $ echo
                                                <span class="st0"
                                                    >&quot;../../src/sampleapp&quot;</span
                                                >
                                                &gt; lib/python/sampleapp.<span
                                                    class="me1"
                                                    >pth</span
                                                ><br />
                                                &nbsp;
                                            </div>
                                            <p>
                                                Also there&#8217;s the tricky
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >$DJANGO_SETTINGS_MODULE</span
                                                    ></tt
                                                >
                                                that you might have had problems
                                                with before. We&#8217;ll use the
                                                file
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >lib/python/toppcustomize.py</span
                                                    ></tt
                                                >
                                                (which is imported everytime
                                                Python is started) to make sure
                                                that is always set:
                                            </p>
                                            <div
                                                class="dean_ch"
                                                style="white-space: wrap"
                                            >
                                                <br />
                                                $ echo
                                                <span class="st0"
                                                    >&quot;import os<br />
                                                    os.environ['DJANGO_SETTINGS_MODULE']
                                                    = 'sampleapp.settings'<br />
                                                    &quot;</span
                                                >
                                                &gt;
                                                lib/python/toppcustomize.<span
                                                    class="me1"
                                                    >py</span
                                                ><br />
                                                &nbsp;
                                            </div>
                                            <p>
                                                Also we have a file
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >src/sampleapp/sampleapp/manage.py</span
                                                    ></tt
                                                >, and that file doesn&#8217;t
                                                work <em>quite</em> how
                                                we&#8217;d like. Instead
                                                we&#8217;ll put a file into
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >bin/manage.py</span
                                                    ></tt
                                                >
                                                that does the same thing:
                                            </p>
                                            <div
                                                class="dean_ch"
                                                style="white-space: wrap"
                                            >
                                                <br />
                                                $ rm sampleapp/manage.<span
                                                    class="me1"
                                                    >py</span
                                                ><br />
                                                $
                                                <span class="kw3">cd</span>
                                                ../..<br />
                                                $ echo
                                                <span class="st0"
                                                    >'#!/usr/bin/env python<br />
                                                    from django.core.management
                                                    import execute_manager<br />
                                                    from sampleapp import
                                                    settings<br />
                                                    if __name__ ==
                                                    &quot;__main__&quot;:<br />
                                                    &nbsp; &nbsp;
                                                    execute_manager(settings)<br />
                                                    '</span
                                                >
                                                &gt; bin/manage.<span
                                                    class="me1"
                                                    >py</span
                                                ><br />
                                                $ chmod +x bin/manage.<span
                                                    class="me1"
                                                    >py</span
                                                ><br />
                                                &nbsp;
                                            </div>
                                            <p>
                                                Now, if you were just using
                                                plain Django you&#8217;d do
                                                something like run
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >python</span
                                                    >
                                                    <span class="pre"
                                                        >manage.py</span
                                                    >
                                                    <span class="pre"
                                                        >runserver</span
                                                    ></tt
                                                >. But we&#8217;ll be using
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >toppcloud</span
                                                    >
                                                    <span class="pre"
                                                        >serve</span
                                                    ></tt
                                                >
                                                instead, which means we have to
                                                set up the two other files
                                                toppcloud needs:
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >app.ini</span
                                                    ></tt
                                                >
                                                and the runner. Here&#8217;s a
                                                simple
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >app.ini</span
                                                    ></tt
                                                >:
                                            </p>
                                            <div
                                                class="dean_ch"
                                                style="white-space: wrap"
                                            >
                                                <br />
                                                $ echo
                                                <span class="st0"
                                                    >'[production]<br />
                                                    app_name = sampleapp<br />
                                                    version = 1<br />
                                                    runner =
                                                    src/sampleapp/toppcloud-runner.py<br />
                                                    '</span
                                                >
                                                &gt;
                                                src/sampleapp/toppcloud-app.<span
                                                    class="me1"
                                                    >ini</span
                                                ><br />
                                                $ rm app.<span class="me1"
                                                    >ini</span
                                                ><br />
                                                $ ln -s
                                                src/sampleapp/toppcloud-app.<span
                                                    class="me1"
                                                    >ini</span
                                                >
                                                app.<span class="me1">ini</span
                                                ><br />
                                                &nbsp;
                                            </div>
                                            <p>
                                                The file <em>must</em> be in the
                                                &quot;root&quot; of your
                                                application, and named
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >app.ini</span
                                                    ></tt
                                                >, but it&#8217;s good to keep
                                                it in version control, so we set
                                                it up with a symlink.
                                            </p>
                                            <p>
                                                It also refers to a
                                                &quot;runner&quot;, which is the
                                                Python file that loads up the
                                                WSGI application. This looks
                                                about the same for any Django
                                                application, and we&#8217;ll put
                                                it in
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >src/sampleapp/toppcloud-runner.py</span
                                                    ></tt
                                                >:
                                            </p>
                                            <div
                                                class="dean_ch"
                                                style="white-space: wrap"
                                            >
                                                <br />
                                                $ echo
                                                <span class="st0"
                                                    >'import
                                                    django.core.handlers.wsgi<br />
                                                    application =
                                                    django.core.handlers.wsgi.WSGIHandler()<br />
                                                    '</span
                                                >
                                                &gt;
                                                src/sampleapp/toppcloud-runner.<span
                                                    class="me1"
                                                    >py</span
                                                ><br />
                                                &nbsp;
                                            </div>
                                            <p>
                                                Now if you want to run the
                                                application, you can:
                                            </p>
                                            <div
                                                class="dean_ch"
                                                style="white-space: wrap"
                                            >
                                                <br />
                                                $ toppcloud serve .<br />
                                                &nbsp;
                                            </div>
                                            <p>
                                                This will load it up on
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >http://localhost:8080</span
                                                    ></tt
                                                >, and serve up a boring page.
                                                To do something interesting
                                                we&#8217;ll want to use a
                                                database.
                                            </p>
                                        </div>
                                        <div
                                            class="section"
                                            id="setting-up-a-database"
                                        >
                                            <h2>Setting Up A Database</h2>
                                            <p>
                                                At the moment the only good
                                                database to use is PostgreSQL
                                                with the PostGIS extensions. Add
                                                this line to
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >app.ini</span
                                                    ></tt
                                                >:
                                            </p>
                                            <div
                                                class="dean_ch"
                                                style="white-space: wrap"
                                            >
                                                <br />
                                                service.<span class="me1"
                                                    >postgis</span
                                                >
                                                =<br />
                                                &nbsp;
                                            </div>
                                            <p>
                                                This makes the database
                                                &quot;available&quot; to the
                                                application. For development you
                                                still have to set it up
                                                yourself. You should create a
                                                database
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >sampleapp</span
                                                    ></tt
                                                >
                                                on your computer.
                                            </p>
                                            <p>
                                                Next, we&#8217;ll need to change
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >settings.py</span
                                                    ></tt
                                                >
                                                to use the new database
                                                configuration. Here&#8217;s the
                                                lines that you&#8217;ll see:
                                            </p>
                                            <div
                                                class="dean_ch"
                                                style="white-space: wrap"
                                            >
                                                <br />
                                                DATABASE_ENGINE =
                                                <span class="st0">''</span>
                                                &nbsp; &nbsp; &nbsp; &nbsp;
                                                &nbsp;
                                                <span class="co1"
                                                    ># 'postgresql_psycopg2',
                                                    'postgresql', 'mysql',
                                                    'sqlite3' or 'oracle'.</span
                                                ><br />
                                                DATABASE_NAME =
                                                <span class="st0">''</span>
                                                &nbsp; &nbsp; &nbsp; &nbsp;
                                                &nbsp; &nbsp;
                                                <span class="co1"
                                                    ># Or path to database file
                                                    if using sqlite3.</span
                                                ><br />
                                                DATABASE_USER =
                                                <span class="st0">''</span>
                                                &nbsp; &nbsp; &nbsp; &nbsp;
                                                &nbsp; &nbsp;
                                                <span class="co1"
                                                    ># Not used with
                                                    sqlite3.</span
                                                ><br />
                                                DATABASE_PASSWORD =
                                                <span class="st0">''</span>
                                                &nbsp; &nbsp; &nbsp; &nbsp;
                                                <span class="co1"
                                                    ># Not used with
                                                    sqlite3.</span
                                                ><br />
                                                DATABASE_HOST =
                                                <span class="st0">''</span>
                                                &nbsp; &nbsp; &nbsp; &nbsp;
                                                &nbsp; &nbsp;
                                                <span class="co1"
                                                    ># Set to empty string for
                                                    localhost. Not used with
                                                    sqlite3.</span
                                                ><br />
                                                DATABASE_PORT =
                                                <span class="st0">''</span>
                                                &nbsp; &nbsp; &nbsp; &nbsp;
                                                &nbsp; &nbsp;
                                                <span class="co1"
                                                    ># Set to empty string for
                                                    default. Not used with
                                                    sqlite3.</span
                                                ><br />
                                                &nbsp;
                                            </div>
                                            <p>
                                                First add this to the top of the
                                                file:
                                            </p>
                                            <div
                                                class="dean_ch"
                                                style="white-space: wrap"
                                            >
                                                <br />
                                                <span class="kw1">import</span>
                                                <span class="kw3">os</span
                                                ><br />
                                                &nbsp;
                                            </div>
                                            <p>
                                                Then you&#8217;ll change those
                                                lines to:
                                            </p>
                                            <div
                                                class="dean_ch"
                                                style="white-space: wrap"
                                            >
                                                <br />
                                                DATABASE_ENGINE =
                                                <span class="st0"
                                                    >'postgresql_psycopg2'</span
                                                ><br />
                                                DATABASE_NAME =
                                                <span class="kw3">os</span
                                                >.<span class="me1"
                                                    >environ</span
                                                ><span class="br0">&#91;</span
                                                ><span class="st0"
                                                    >'CONFIG_PG_DBNAME'</span
                                                ><span class="br0">&#93;</span
                                                ><br />
                                                DATABASE_USER =
                                                <span class="kw3">os</span
                                                >.<span class="me1"
                                                    >environ</span
                                                ><span class="br0">&#91;</span
                                                ><span class="st0"
                                                    >'CONFIG_PG_USER'</span
                                                ><span class="br0">&#93;</span
                                                ><br />
                                                DATABASE_PASSWORD =
                                                <span class="kw3">os</span
                                                >.<span class="me1"
                                                    >environ</span
                                                ><span class="br0">&#91;</span
                                                ><span class="st0"
                                                    >'CONFIG_PG_PASSWORD'</span
                                                ><span class="br0">&#93;</span
                                                ><br />
                                                DATABASE_HOST =
                                                <span class="kw3">os</span
                                                >.<span class="me1"
                                                    >environ</span
                                                ><span class="br0">&#91;</span
                                                ><span class="st0"
                                                    >'CONFIG_PG_HOST'</span
                                                ><span class="br0">&#93;</span
                                                ><br />
                                                DATABASE_PORT =
                                                <span class="st0">''</span
                                                ><br />
                                                &nbsp;
                                            </div>
                                            <p>
                                                Now we can create all the
                                                default tables:
                                            </p>
                                            <div
                                                class="dean_ch"
                                                style="white-space: wrap"
                                            >
                                                <br />
                                                $ manage.<span class="me1"
                                                    >py</span
                                                >
                                                syncdb<br />
                                                Creating table
                                                auth_permission<br />
                                                Creating table auth_group<br />
                                                Creating table auth_user<br />
                                                Creating table auth_message<br />
                                                Creating table
                                                django_content_type<br />
                                                Creating table django_session<br />
                                                Creating table django_site<br />
                                                ...<br />
                                                &nbsp;
                                            </div>
                                            <p>
                                                Now we have an empty project
                                                that doesn&#8217;t do anything.
                                                Let&#8217;s make it do a little
                                                something (this is all really
                                                based on
                                                <a
                                                    class="reference external"
                                                    href="http://docs.djangoproject.com/en/dev/intro/tutorial01/"
                                                    >the Django tutorial</a
                                                >).
                                            </p>
                                            <div
                                                class="dean_ch"
                                                style="white-space: wrap"
                                            >
                                                <br />
                                                $ manage.<span class="me1"
                                                    >py</span
                                                >
                                                startapp polls<br />
                                                &nbsp;
                                            </div>
                                            <p>
                                                Django magically knows to put
                                                the code in
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >src/sampleapp/sampleapp/polls/</span
                                                    ></tt
                                                >
                                                &#8212; we&#8217;ll setup the
                                                model in
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >src/sampleapp/sampleapp/polls/models.py</span
                                                    ></tt
                                                >:
                                            </p>
                                            <div
                                                class="dean_ch"
                                                style="white-space: wrap"
                                            >
                                                <br />
                                                <span class="kw1">from</span>
                                                django.<span class="me1"
                                                    >db</span
                                                >
                                                <span class="kw1">import</span>
                                                models<br />
                                                <br />
                                                <span class="kw1">class</span>
                                                Poll<span class="br0"
                                                    >&#40;</span
                                                >models.<span class="me1"
                                                    >Model</span
                                                ><span class="br0">&#41;</span
                                                >:<br />
                                                &nbsp; &nbsp; question =
                                                models.<span class="me1"
                                                    >CharField</span
                                                ><span class="br0">&#40;</span
                                                >max_length=<span class="nu0"
                                                    >200</span
                                                ><span class="br0">&#41;</span
                                                ><br />
                                                &nbsp; &nbsp; pub_date =
                                                models.<span class="me1"
                                                    >DateTimeField</span
                                                ><span class="br0">&#40;</span
                                                ><span class="st0"
                                                    >'date published'</span
                                                ><span class="br0">&#41;</span
                                                ><br />
                                                <br />
                                                <span class="kw1">class</span>
                                                Choice<span class="br0"
                                                    >&#40;</span
                                                >models.<span class="me1"
                                                    >Model</span
                                                ><span class="br0">&#41;</span
                                                >:<br />
                                                &nbsp; &nbsp; poll =
                                                models.<span class="me1"
                                                    >ForeignKey</span
                                                ><span class="br0">&#40;</span
                                                >Poll<span class="br0"
                                                    >&#41;</span
                                                ><br />
                                                &nbsp; &nbsp; choice =
                                                models.<span class="me1"
                                                    >CharField</span
                                                ><span class="br0">&#40;</span
                                                >max_length=<span class="nu0"
                                                    >200</span
                                                ><span class="br0">&#41;</span
                                                ><br />
                                                &nbsp; &nbsp; votes =
                                                models.<span class="me1"
                                                    >IntegerField</span
                                                ><span class="br0">&#40;</span
                                                ><span class="br0">&#41;</span
                                                ><br />
                                                &nbsp;
                                            </div>
                                            <p>
                                                And activate the application by
                                                adding
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >'sampleapp.polls'</span
                                                    ></tt
                                                >
                                                to
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >INSTALLED_APPS</span
                                                    ></tt
                                                >
                                                in
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >src/sampleapp/sampleapp/settings.py</span
                                                    ></tt
                                                >. Also add
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >'django.contrib.admin'</span
                                                    ></tt
                                                >
                                                to get the admin app in place.
                                                Run
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >manage.py</span
                                                    >
                                                    <span class="pre"
                                                        >syncdb</span
                                                    ></tt
                                                >
                                                to get the tables in place.
                                            </p>
                                            <p>
                                                You can try
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >toppcloud</span
                                                    >
                                                    <span class="pre"
                                                        >serve</span
                                                    >
                                                    <span class="pre"
                                                        >.</span
                                                    ></tt
                                                >
                                                and go to
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >/admin/</span
                                                    ></tt
                                                >
                                                to login and see your tables.
                                                You might notice all the CSS is
                                                broken.
                                            </p>
                                            <p>
                                                toppcloud serves static files
                                                out of the
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >static/</span
                                                    ></tt
                                                >
                                                directory. You don&#8217;t
                                                actually put
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >static</span
                                                    ></tt
                                                >
                                                in the URLs, these files are
                                                available at the top-level
                                                (unless you create a
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >static/static/</span
                                                    ></tt
                                                >
                                                directory). The best way to put
                                                files in there is generally
                                                symbolic links.
                                            </p>
                                            <p>For Django admin, do this:</p>
                                            <div
                                                class="dean_ch"
                                                style="white-space: wrap"
                                            >
                                                <br />
                                                $
                                                <span class="kw3">cd</span>
                                                static<br />
                                                $ ln -s
                                                ../lib/python/django/contrib/admin/media
                                                admin-media<br />
                                                &nbsp;
                                            </div>
                                            <p>
                                                Now edit
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >src/sampleapp/sampleapp/settings.py</span
                                                    ></tt
                                                >
                                                and change
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >ADMIN_MEDIA_PREFIX</span
                                                    ></tt
                                                >
                                                to
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >'/admin-media'</span
                                                    ></tt
                                                >.
                                            </p>
                                            <p>
                                                (Probably some other links
                                                should be added.)
                                            </p>
                                            <p>
                                                One <em>last</em> little thing
                                                you might want to do; replace
                                                this line in<br />
                                                settings:
                                            </p>
                                            <div
                                                class="dean_ch"
                                                style="white-space: wrap"
                                            >
                                                <br />
                                                SECRET_KEY =
                                                <span class="st0"
                                                    >'ASF#&amp;#64;$&amp;#64;#JFAS#&amp;#64;'</span
                                                ><br />
                                                &nbsp;
                                            </div>
                                            <p>With this:</p>
                                            <div
                                                class="dean_ch"
                                                style="white-space: wrap"
                                            >
                                                <br />
                                                <span class="kw1">from</span>
                                                tcsupport.<span class="me1"
                                                    >secret</span
                                                >
                                                <span class="kw1">import</span>
                                                get_secret<br />
                                                SECRET_KEY = get_secret<span
                                                    class="br0"
                                                    >&#40;</span
                                                ><span class="br0">&#41;</span
                                                ><br />
                                                &nbsp;
                                            </div>
                                            <p>
                                                Then you don&#8217;t have to
                                                worry about checking a secret
                                                into version control.
                                            </p>
                                            <p>
                                                You still don&#8217;t really
                                                have an application, but the
                                                rest is mere
                                                &quot;programming&quot; so have
                                                at it!
                                            </p>
                                        </div>
                                    </div>
                                    <!-- <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="https://ianbicking.org/2010/02/05/toppcloud-and-django/"
    dc:identifier="https://ianbicking.org/2010/02/05/toppcloud-and-django/"
    dc:title="toppcloud (Silver Lining) and Django"
    trackback:ping="https://ianbicking.org/2010/02/05/toppcloud-and-django/trackback/" />
</rdf:RDF> -->
                                </div>
                                <!-- END POST-ENTRY -->
                            </div>
                            <!-- END POST-CONTENT  -->
                        </div>
                        <!-- END-CONTAINER -->
                        <div class="post-header">
                            <h3 class="post-date">2010 02 05</h3>
                            <p class="post-categories">
                                <a
                                    href="../../../programming/index.html"
                                    title="View all posts in Programming"
                                    rel="category tag"
                                    >Programming</a
                                ><br /><a
                                    href="../../index.html"
                                    title="View all posts in Python"
                                    rel="category tag"
                                    >Python</a
                                ><br /><a
                                    href="../../../silverlining.1"
                                    title="View all posts in Silver Lining"
                                    rel="category tag"
                                    >Silver Lining</a
                                ><br /><a
                                    href="../../../web/index.html"
                                    title="View all posts in Web"
                                    rel="category tag"
                                    >Web</a
                                >
                            </p>
                            <p class="post-comments">
                                <a
                                    href="../../../../2010/02/05/toppcloud-and-django/index.html#comments"
                                    title="Comment on toppcloud (Silver Lining) and Django"
                                    >Comments (2)</a
                                >
                            </p>
                            <p class="post-permalink">
                                <a
                                    href="../../../../2010/02/05/toppcloud-and-django/index.html"
                                    title="Permalink to toppcloud (Silver Lining) and Django"
                                    rel="permalink"
                                    >Permalink</a
                                >
                            </p>
                        </div>
                        <!-- END POST-FOOTER -->
                    </div>
                    <!-- END POST -->

                    <div id="post-132" class="post">
                        <div class="post-container">
                            <div class="post-content">
                                <h2 class="post-title">
                                    <a
                                        href="../../../../2010/01/29/new-way-to-deploy-web-apps/index.html"
                                        title="Permalink to A new way to deploy web applications"
                                        rel="bookmark"
                                        >A new way to deploy web applications</a
                                    >
                                </h2>
                                <div class="post-entry">
                                    <div class="document">
                                        <p>
                                            Deployment is one of the things I
                                            like least about development, and
                                            yet without deployment the
                                            development doesn&#8217;t really
                                            matter.
                                        </p>
                                        <p>
                                            I&#8217;ve tried a few things (e.g.
                                            <a
                                                class="reference external"
                                                href="../../../../2008/06/19/my-experience-writing-a-build-system/index.html"
                                                >fassembler</a
                                            >), built a few things (<a
                                                class="reference external"
                                                href="http://virtualenv.openplans.org"
                                                >virtualenv</a
                                            >,
                                            <a
                                                class="reference external"
                                                href="http://pip.openplans.org"
                                                >pip</a
                                            >), but deployment just sucked
                                            <em>less</em> as a result. Then I
                                            got excited about
                                            <a
                                                class="reference external"
                                                href="http://appengine.google.com"
                                                >App Engine</a
                                            >; everyone else was getting excited
                                            about &quot;scaling&quot;, but
                                            really I was
                                            <a
                                                class="reference external"
                                                href="../../../../2008/04/09/app-engine-and-open-source/index.html"
                                                >excited about an accessible
                                                deployment process</a
                                            >. When it comes to deployment App
                                            Engine is the first thing that has
                                            really felt good to me.
                                        </p>
                                        <p>
                                            <strong>But</strong> I can&#8217;t
                                            actually <em>use</em> App Engine. I
                                            was able to come to terms with the
                                            idea of writing an application to
                                            the platform, but there are
                                            limits&#8230; and with App Engine
                                            there were simply too many limits.
                                            Geo stuff on App Engine is at best a
                                            crippled hack, I miss
                                            <a
                                                class="reference external"
                                                href="http://codespeak.net/lxml/"
                                                >lxml</a
                                            >
                                            terribly, I never hated relational
                                            databases, and almost nothing large
                                            works without some degree of
                                            rewriting. Sometimes you can work
                                            around it, but you can never be sure
                                            you won&#8217;t hit some wall later.
                                            And frankly working around the
                                            platform is tiring and not very
                                            rewarding.
                                        </p>
                                        <hr class="docutils" />
                                        <p>
                                            So&#8230; App Engine seemed neat,
                                            but I couldn&#8217;t use it, and
                                            deployment was still a problem.
                                        </p>
                                        <p>
                                            What I like about App Engine: an
                                            application is just files.
                                            There&#8217;s no build process, no
                                            fancy copying of things in weird
                                            locations, nothing like that; you
                                            upload files, and uploading files
                                            <em>just works</em>. Also, you can
                                            check <em>everything</em> into
                                            version control. Not just your
                                            application code, but every library
                                            you use, the exact files that you
                                            installed. I really wanted a system
                                            like that.
                                        </p>
                                        <p>
                                            At the same time, I started looking
                                            into &quot;the cloud&quot;. It took
                                            me a while to get a handle on what
                                            &quot;cloud computing&quot; really
                                            means. What I learned: don&#8217;t
                                            overthink it. It&#8217;s not magic.
                                            It&#8217;s just virtual private
                                            servers that can be requisitioned
                                            automatically via an API, and are
                                            billed on a short time cycle. You
                                            can expand or change the definition
                                            a bit, but this definition is the
                                            one that matters to <em>me</em>.
                                            (I&#8217;ve also realized that I
                                            cannot get excited about complicated
                                            solutions; only once I realized how
                                            simple cloud computing is could I
                                            really get excited about the idea.)
                                        </p>
                                        <p>
                                            Given the modest functionality of
                                            cloud computing, why does it matter?
                                            Because with a cloud computing
                                            system you can actually
                                            <em>test</em> the full deployment
                                            stack. You can create a brand-new
                                            server, identical to all servers you
                                            will create in the future; you can
                                            set this server up; you can deploy
                                            to it. You get it wrong, you throw
                                            away that virtual server and start
                                            over from the beginning, fixing
                                            things until you get it right.
                                            Billing is important here too; with
                                            hourly billing you pay cents for
                                            these tests, and you don&#8217;t
                                            need a pool of ready servers because
                                            the cloud service basically manages
                                            that pool of ready servers for you.
                                        </p>
                                        <p>
                                            Without &quot;cloud computing&quot;
                                            we each too easily find ourselves in
                                            a situation where deployments are ad
                                            hoc, server installations develop
                                            over time, and servers and
                                            applications are inconsistent in
                                            their configuration. Cloud computing
                                            makes servers disposable, which
                                            means we can treat them in
                                            consistent ways, testing our work as
                                            we go. It makes it easy to treat
                                            operations with the same discipline
                                            as software.
                                        </p>
                                        <p>
                                            Given the idea from App Engine, and
                                            the easy-to-use infrastructure of a
                                            cloud service, I started to script
                                            together something to manage the
                                            servers and start up applications. I
                                            didn&#8217;t know what exactly I
                                            wanted to do to start, and I&#8217;m
                                            not completely sure where I&#8217;m
                                            going with this. But on the whole
                                            this feels pretty right. So I
                                            present the provisionally-named:
                                            <a
                                                class="reference external"
                                                href="http://toppcloud.colorstudy.com"
                                                >toppcloud</a
                                            >
                                            (<strong>Update</strong>: this has
                                            been renamed Silver Cloud).
                                        </p>
                                        <hr class="docutils" />
                                        <p>
                                            How it works: first you have a
                                            directory of files that defines your
                                            application. This probably includes
                                            a checkout of your
                                            &quot;application&quot; (let&#8217;s
                                            say in
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >src/mynewapp/</span
                                                ></tt
                                            >), and I find it also useful to use
                                            source control on the libraries
                                            (which are put in
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >lib/python/</span
                                                ></tt
                                            >). There&#8217;s a file in
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >app.ini</span
                                                ></tt
                                            >
                                            that defines some details of the
                                            application (very similar to
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >app.yaml</span
                                                ></tt
                                            >).
                                        </p>
                                        <p>
                                            While app.ini is a (<a
                                                class="reference external"
                                                href="http://toppcloud.colorstudy.com/appconfig.html"
                                                >very minimal</a
                                            >) description of the
                                            <em>application</em>, there is no
                                            description of the environment. You
                                            do not specify database connection
                                            details, for instance. Instead your
                                            application <em>requests</em> access
                                            to a database service. For instance,
                                            one of these services is a
                                            PostgreSQL/PostGIS database (which
                                            you get if you put
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >service.postgis</span
                                                ></tt
                                            >
                                            in your app.ini file). If you ask
                                            for that then there will be
                                            evironmental variables,
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >CONFIG_PG_DBNAME</span
                                                ></tt
                                            >
                                            etc., that will tell your
                                            application how to connect to the
                                            database. (For local development you
                                            can provide your own configuration,
                                            based on how you have PostgreSQL or
                                            some other service installed.)
                                        </p>
                                        <p>
                                            The standard setup is also a
                                            <a
                                                class="reference external"
                                                href="http://virtualenv.openplans.org"
                                                >virtualenv</a
                                            >
                                            environment. It is setup so
                                            <em>every time</em> you start that
                                            virtualenv environment you&#8217;ll
                                            get those configuration-related
                                            environmental variables. This means
                                            your application configuration is
                                            always present, your services always
                                            available. It&#8217;s available in
                                            tests just like it is during a
                                            request. Django accomplishes
                                            something similar with the (much
                                            maligned)
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >$DJANGO_SETTINGS_MODULE</span
                                                ></tt
                                            >
                                            but toppcloud builds it into the
                                            virtualenv environment instead of
                                            the shell environment.
                                        </p>
                                        <p>
                                            And how is the server setup? Much
                                            like with App Engine that is merely
                                            an implementation detail. Unlike App
                                            Engine that&#8217;s an
                                            implementation detail you can
                                            actually <em>look</em> at and change
                                            (by changing toppcloud), but
                                            it&#8217;s not something you are
                                            supposed to concern yourself with
                                            during regular application
                                            development.
                                        </p>
                                        <p>
                                            The basic lifecycle using toppcloud
                                            looks like:
                                        </p>
                                        <dl class="docutils">
                                            <dt>
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >toppcloud</span
                                                    >
                                                    <span class="pre"
                                                        >create-node</span
                                                    ></tt
                                                >
                                            </dt>
                                            <dd>
                                                Create a new virtual server; you
                                                can create any kind of supported
                                                server, but only Ubuntu Jaunty
                                                or Karmic are supported (and
                                                Jaunty should probably be
                                                dropped). This step is where the
                                                &quot;cloud&quot; part actually
                                                ends. If you want to install a
                                                bare Ubuntu onto an existing
                                                physical machine that&#8217;s
                                                fine too &#8212; after
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >toppcloud</span
                                                    >
                                                    <span class="pre"
                                                        >create-node</span
                                                    ></tt
                                                >
                                                the &quot;cloud&quot; part of
                                                the process is pretty much done.
                                                Just don&#8217;t go using some
                                                old Ubuntu install; this tool is
                                                for clean systems that are used
                                                only for toppcloud.
                                            </dd>
                                            <dt>
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >toppcloud</span
                                                    >
                                                    <span class="pre"
                                                        >setup-node</span
                                                    ></tt
                                                >
                                            </dt>
                                            <dd>
                                                Take that bare Ubuntu server and
                                                set it up (or update it) for use
                                                with toppcloud. This installs
                                                all the basic standard stuff
                                                (things like Apache, mod_wsgi,
                                                Varnish) and some management
                                                script that toppcloud runs. This
                                                is written to be safe to run
                                                over and over, so upgrading and
                                                setting up a machine are the
                                                same. It needs to be a bare
                                                server, but
                                            </dd>
                                            <dt>
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >toppcloud</span
                                                    >
                                                    <span class="pre"
                                                        >init</span
                                                    >
                                                    <span class="pre"
                                                        >path/to/app/</span
                                                    ></tt
                                                >
                                            </dt>
                                            <dd>
                                                Setup a basic virtualenv
                                                environment with some toppcloud
                                                customizations.
                                            </dd>
                                            <dt>
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >toppcloud</span
                                                    >
                                                    <span class="pre"
                                                        >serve</span
                                                    >
                                                    <span class="pre"
                                                        >path/to/app</span
                                                    ></tt
                                                >
                                            </dt>
                                            <dd>
                                                Serve up the application
                                                locally.
                                            </dd>
                                            <dt>
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >toppcloud</span
                                                    >
                                                    <span class="pre"
                                                        >update</span
                                                    >
                                                    <span class="pre"
                                                        >--host=test.example.com</span
                                                    >
                                                    <span class="pre"
                                                        >path/to/app/</span
                                                    ></tt
                                                >
                                            </dt>
                                            <dd>
                                                This creates or updates an
                                                application at the given host.
                                                It edits
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >/etc/hosts</span
                                                    ></tt
                                                >
                                                so that the domain is locally
                                                viewable.
                                            </dd>
                                            <dt>
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >toppcloud</span
                                                    >
                                                    <span class="pre">run</span>
                                                    <span class="pre"
                                                        >test.example.com</span
                                                    >
                                                    <span class="pre"
                                                        >script.py</span
                                                    ></tt
                                                >
                                            </dt>
                                            <dd>
                                                Run a script (from
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >bin/</span
                                                    ></tt
                                                >) on a remote server. This
                                                allows you to run things like
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >django-admin.py</span
                                                    >
                                                    <span class="pre"
                                                        >syncdb</span
                                                    ></tt
                                                >.
                                            </dd>
                                        </dl>
                                        <p>
                                            There&#8217;s a few other things
                                            &#8212; stuff to manage the servers
                                            and change around hostnames or the
                                            active version of applications.
                                            It&#8217;s growing to fit a variety
                                            of workflows, but I don&#8217;t
                                            think its growth is unbounded.
                                        </p>
                                        <hr class="docutils" />
                                        <p>
                                            So&#8230; this is what toppcloud.
                                            From the outside it doen&#8217;t do
                                            a lot. From the inside it&#8217;s
                                            not actually that complicated
                                            either. I&#8217;ve included a lot of
                                            constraints in the tool but I think
                                            it offers an excellent balance. The
                                            constraints are workable for
                                            applications (insignificant for many
                                            applications), while still exposing
                                            a simple and consistent system
                                            that&#8217;s easier to reason about
                                            than a big-ball-of-server.
                                        </p>
                                        <p>Some of the constraints:</p>
                                        <ol class="arabic simple">
                                            <li>
                                                Binary packages are supported
                                                via Ubuntu packages; you only
                                                upload portable files. If you
                                                need a library like lxml, you
                                                need to request that package
                                                (<tt class="docutils literal"
                                                    ><span class="pre"
                                                        >python-lxml</span
                                                    ></tt
                                                >) to be installed in your
                                                app.ini. If you need a version
                                                of a binary library that is not
                                                yet packaged, I think creating a
                                                new deb is reasonable.
                                            </li>
                                            <li>
                                                There is no Linux distribution
                                                abstraction, but I don&#8217;t
                                                care.
                                            </li>
                                            <li>
                                                There is no option for the way
                                                your application is run &#8212;
                                                there&#8217;s one way
                                                applications are run, because I
                                                believe there is a best
                                                practice. I might have gotten
                                                the best practice wrong, but
                                                that should be resolved inside
                                                toppcloud, not inside
                                                applications. Is Varnish a
                                                terrible cache? Probably not,
                                                but if it is we should all be
                                                able to agree on that and
                                                replace it. If there are
                                                genuinely different needs then
                                                maybe additional application or
                                                deployment configuration will be
                                                called for &#8212; but we
                                                shouldn&#8217;t add
                                                configuration just because
                                                someone <em>says</em> there is a
                                                better practice (and a better
                                                practice that is not universally
                                                better); there must be
                                                justifications.
                                            </li>
                                            <li>
                                                By abstracting out services and
                                                persistence some additional code
                                                is required for each such
                                                service, and that code is
                                                centralized in toppcloud, but it
                                                means we can also start to add
                                                consistent tools usable across a
                                                wide set of applications and
                                                backends.
                                            </li>
                                            <li>
                                                All file paths have to be
                                                relative, because files get
                                                moved around. I know of some
                                                particularly problematic files
                                                (e.g.,
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >.pth</span
                                                    ></tt
                                                >
                                                files), and toppcloud fixes
                                                these automatically. Mostly this
                                                isn&#8217;t so hard to do.
                                            </li>
                                        </ol>
                                        <p>
                                            These particular compromises are
                                            ones I have not seen in many systems
                                            (and
                                            <a
                                                class="reference external"
                                                href="http://toppcloud.colorstudy.com/comparisons.html"
                                                >I&#8217;ve started to look
                                                more</a
                                            >). App Engine I think goes too far
                                            with its constraints.
                                            <a
                                                class="reference external"
                                                href="http://heroku.com/"
                                                >Heroku</a
                                            >
                                            is close, but closed source.
                                        </p>
                                        <p>
                                            This is different than a strict
                                            everything-must-be-a-package
                                            strategy. This deployment system is
                                            light and simple and takes into
                                            account reasonable web development
                                            workflows. The pieces of an
                                            application that move around a lot
                                            are all well-greased and agile. The
                                            parts of an application that are
                                            better to Do Right And Then Leave
                                            Alone (like Apache configuration)
                                            are static.
                                        </p>
                                        <p>
                                            Unlike generalized systems like
                                            buildout this system avoids
                                            &quot;building&quot; entirely,
                                            making deployment a simpler and
                                            lower risk action, leaning on system
                                            packages for the things they do
                                            best. Other open source tools
                                            emphasize a greater degree of
                                            flexibility than I think is
                                            necessary, allowing people to encode
                                            exploratory service integration into
                                            what <em>appears</em> to be an
                                            encapsulated build (I&#8217;m
                                            looking at you buildout).
                                        </p>
                                        <p>
                                            Unlike
                                            <a
                                                class="reference external"
                                                href="http://pip.openplans.org/requirement-format.html"
                                                >requirement sets</a
                                            >
                                            and packaging and versioning
                                            libraries, this makes all the Python
                                            libraries (typically the most
                                            volatile libraries) explicit and
                                            controlled, and can better ensure
                                            that small updates really are small.
                                            It doesn&#8217;t invalidate
                                            installers and versioning, but it
                                            makes that process even more
                                            explicit and encourages greater
                                            thoughtfulness.
                                        </p>
                                        <p>
                                            Unlike many production-oriented
                                            systems (what I&#8217;ve seen in a
                                            lot of &quot;cloud&quot; tools) this
                                            encorporates both the development
                                            environment and production
                                            environment; but unlike some
                                            developer-oriented systems this does
                                            not try to normalize
                                            everyone&#8217;s environment and
                                            instead relies on developers to set
                                            up their systems however is
                                            appropriate. And unlike
                                            platform-neutral systems this can
                                            ensure an amount of reliability and
                                            predictability through extremely
                                            hard requirements (it is deployed on
                                            Ubuntu Jaunty/Karmic <em>only</em>).
                                        </p>
                                        <p>
                                            But it&#8217;s not all constraints.
                                            Toppcloud is solidly web framework
                                            neutral. It&#8217;s even
                                            <a
                                                class="reference external"
                                                href="http://toppcloud.colorstudy.com/php.html"
                                                >slightly language neutral</a
                                            >. Though it does require support
                                            code for each persistence technique,
                                            it is fairly easy to do, and there
                                            are no requirements for
                                            &quot;scalable systems&quot;; I
                                            think unscalable systems are a
                                            perfectly reasonable implementation
                                            choice for many problems. I believe
                                            a more scalable system could be
                                            built on this, but as a deployment
                                            and development option, not a
                                            starting requirement.
                                        </p>
                                        <p>
                                            So far I&#8217;ve done some
                                            deployments using toppcloud; not a
                                            lot, but some. And I can say that it
                                            feels really good; lots of rough
                                            edges still, but the core concept
                                            feels really right. I&#8217;ve made
                                            a lot of sideways attacks on
                                            deployment, and a few direct
                                            attacks&#8230; sometimes I write
                                            things that I think are useful, and
                                            sometimes I write things that I
                                            think are right. Toppcloud is at the
                                            moment maybe more right than useful.
                                            But I genuinely believe this is (in
                                            theory) a universally appropriate
                                            deployment tool.
                                        </p>
                                        <hr class="docutils" />
                                        <p>
                                            Alright, so now you think maybe you
                                            should look more at toppcloud&#8230;
                                        </p>
                                        <p>
                                            Well, I can offer you
                                            <a
                                                class="reference external"
                                                href="http://toppcloud.colorstudy.com"
                                                >a fair amount of
                                                documentation</a
                                            >. A lot of that documentation
                                            refers to design, and a bit of it to
                                            examples. There&#8217;s also a
                                            couple projects you can look at;
                                            they are all small, but :
                                        </p>
                                        <ul class="simple">
                                            <li>
                                                <a
                                                    class="reference external"
                                                    href="http://bitbucket.org/geraldmc/frank-src/src/tip/build-fs-layout"
                                                    >Frank</a
                                                >
                                                (will be
                                                interactivesomerville.org) which
                                                is another similar Django/Pinax
                                                project (Pinax was a bit
                                                tricky). This is probably the
                                                largest project. It&#8217;s a
                                                Django/Pinax volunteer-written
                                                application for collecting
                                                community feedback the Boston
                                                Greenline project, if that
                                                sounds interesting to you might
                                                want to chip in on the
                                                development (if so
                                                <a
                                                    class="reference external"
                                                    href="https://projects.openplans.org/greenline"
                                                    >check out the wiki</a
                                                >).
                                            </li>
                                            <li>
                                                <a
                                                    class="reference external"
                                                    href="http://github.com/ianb/neighborly/blob/master/INSTALL.txt"
                                                    >Neighborly</a
                                                >, with minimal functionality
                                                (we need to run more sprints)
                                                but an installation story.
                                            </li>
                                            <li>
                                                <a
                                                    class="reference external"
                                                    href="http://bitbucket.org/ianb/bbdocs/src/tip/create-layout.sh"
                                                    >bbdocs</a
                                                >
                                                which is a very simple bitbucket
                                                document generator, that makes
                                                the toppcloud site.
                                            </li>
                                            <li>
                                                <a
                                                    class="reference external"
                                                    href="http://bitbucket.org/ianb/geodns"
                                                    >geodns</a
                                                >
                                                which is another simple
                                                no-framework PostGIS project.
                                            </li>
                                        </ul>
                                        <hr class="docutils" />
                                        <p>
                                            Now, the letdown. One thing I cannot
                                            offer you is support.
                                            <strong>THERE IS NO SUPPORT</strong
                                            >. I cannot now, and I might never
                                            really be able to support this tool.
                                            This tool is appropriate for
                                            collaborators, for people who like
                                            the idea and are ready to build on
                                            it. If it grows well I hope that it
                                            can grow a community, I hope people
                                            can support each other. I&#8217;d
                                            like to help that happen. But I
                                            can&#8217;t do that by bootstrapping
                                            it through unending support, because
                                            I&#8217;m not good at it and
                                            I&#8217;m not consistent and
                                            it&#8217;s unrealistic and
                                            unsustainable. This is not a open
                                            source dead drop. But it&#8217;s
                                            also not My Future; I&#8217;m not
                                            going to build a company around it,
                                            and I&#8217;m not going to use all
                                            my free time supporting it.
                                            It&#8217;s a tool I want to exist. I
                                            <strong>very much</strong> want it
                                            to exist. But even very much wanting
                                            something is not the same as being
                                            an undying champion, and I am not an
                                            undying champion. If you want to
                                            tell me what my process
                                            <em>should</em> be, please do!
                                        </p>
                                        <hr class="docutils" />
                                        <blockquote>
                                            <p>
                                                If you want to see me get
                                                philosophical about packaging
                                                and deployment and other stuff
                                                like that, see my upcoming talk
                                                at
                                                <a
                                                    class="reference external"
                                                    href="http://us.pycon.org/"
                                                    >PyCon</a
                                                >.
                                            </p>
                                        </blockquote>
                                    </div>
                                    <!-- <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="https://ianbicking.org/2010/01/29/new-way-to-deploy-web-apps/"
    dc:identifier="https://ianbicking.org/2010/01/29/new-way-to-deploy-web-apps/"
    dc:title="A new way to deploy web applications"
    trackback:ping="https://ianbicking.org/2010/01/29/new-way-to-deploy-web-apps/trackback/" />
</rdf:RDF> -->
                                </div>
                                <!-- END POST-ENTRY -->
                            </div>
                            <!-- END POST-CONTENT  -->
                        </div>
                        <!-- END-CONTAINER -->
                        <div class="post-header">
                            <h3 class="post-date">2010 01 29</h3>
                            <p class="post-categories">
                                <a
                                    href="../../../packaging/index.html"
                                    title="View all posts in Packaging"
                                    rel="category tag"
                                    >Packaging</a
                                ><br /><a
                                    href="../../../programming/index.html"
                                    title="View all posts in Programming"
                                    rel="category tag"
                                    >Programming</a
                                ><br /><a
                                    href="../../index.html"
                                    title="View all posts in Python"
                                    rel="category tag"
                                    >Python</a
                                ><br /><a
                                    href="../../../silverlining.1"
                                    title="View all posts in Silver Lining"
                                    rel="category tag"
                                    >Silver Lining</a
                                ><br /><a
                                    href="../../../web/index.html"
                                    title="View all posts in Web"
                                    rel="category tag"
                                    >Web</a
                                >
                            </p>
                            <p class="post-comments">
                                <a
                                    href="../../../../2010/01/29/new-way-to-deploy-web-apps/index.html#comments"
                                    title="Comment on A new way to deploy web applications"
                                    >Comments (13)</a
                                >
                            </p>
                            <p class="post-permalink">
                                <a
                                    href="../../../../2010/01/29/new-way-to-deploy-web-apps/index.html"
                                    title="Permalink to A new way to deploy web applications"
                                    rel="permalink"
                                    >Permalink</a
                                >
                            </p>
                        </div>
                        <!-- END POST-FOOTER -->
                    </div>
                    <!-- END POST -->

                    <div id="post-122" class="post">
                        <div class="post-container">
                            <div class="post-content">
                                <h2 class="post-title">
                                    <a
                                        href="../../../../2009/05/22/webob-decorator/index.html"
                                        title="Permalink to WebOb decorator"
                                        rel="bookmark"
                                        >WebOb decorator</a
                                    >
                                </h2>
                                <div class="post-entry">
                                    <div class="document">
                                        <p>
                                            Lately I&#8217;ve been writing a few
                                            applications (e.g.,
                                            <a
                                                class="reference external"
                                                href="http://pickywiki.org"
                                                >PickyWiki</a
                                            >
                                            and a revisiting a request-tracking
                                            application
                                            <a
                                                class="reference external"
                                                href="http://svn.pythonpaste.org/Paste/VaingloriousEye/trunk"
                                                >VaingloriousEye</a
                                            >), and I usually use no framework
                                            at all.
                                            <a
                                                class="reference external"
                                                href="http://pylonshq.com"
                                                >Pylons</a
                                            >
                                            would be a natural choice, but given
                                            that I am comfortable with all the
                                            components, I find myself inclined
                                            to assemble the pieces myself.
                                        </p>
                                        <p>
                                            In the process I keep writing bits
                                            of code to make WSGI applications
                                            from simple
                                            <a
                                                class="reference external"
                                                href="http://pythonpaste.org/webob/"
                                                >WebOb</a
                                            >
                                            -based request/response cycles. The
                                            simplest form looks like this:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            <span class="kw1">from</span> webob
                                            <span class="kw1">import</span>
                                            Request, Response, exc<br />
                                            <br />
                                            <span class="kw1">def</span>
                                            wsgiwrap<span class="br0"
                                                >&#40;</span
                                            >func<span class="br0">&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">def</span>
                                            wsgi_app<span class="br0"
                                                >&#40;</span
                                            >environ, start_response<span
                                                class="br0"
                                                >&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; req =
                                            Request<span class="br0">&#40;</span
                                            >environ<span class="br0"
                                                >&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="kw1">try</span>:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                            &nbsp; resp = func<span class="br0"
                                                >&#40;</span
                                            >req<span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="kw1">except</span>
                                            exc.<span class="me1"
                                                >HTTPException</span
                                            >, e:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                            &nbsp; resp = e<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="kw1">return</span>
                                            resp<span class="br0">&#40;</span
                                            >environ, start_response<span
                                                class="br0"
                                                >&#41;</span
                                            ><br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">return</span>
                                            wsgi_app<br />
                                            <br />
                                            @<span class="co1">wsgiwrap</span
                                            ><br />
                                            <span class="kw1">def</span>
                                            hello_world<span class="br0"
                                                >&#40;</span
                                            >req<span class="br0">&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">return</span>
                                            Response<span class="br0"
                                                >&#40;</span
                                            ><span class="st0">'Hi %s!'</span> %
                                            <span class="br0">&#40;</span
                                            >req.<span class="me1">POST</span
                                            >.<span class="me1">get</span
                                            ><span class="br0">&#40;</span
                                            ><span class="st0">'name'</span>,
                                            <span class="st0">'You'</span
                                            ><span class="br0">&#41;</span
                                            ><span class="br0">&#41;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            But each time I&#8217;d write it, I
                                            change things slightly, implementing
                                            more or less features. For instance,
                                            <a
                                                class="reference external"
                                                href="../../../../2008/10/24/decorators-and-descriptors/index.html"
                                                >handling methods</a
                                            >, or coercing other responses, or
                                            handling middleware.
                                        </p>
                                        <p>
                                            Having implemented several of these
                                            (and
                                            <a
                                                class="reference external"
                                                href="http://svn.pythonpaste.org/Paste/WebOb/contrib"
                                                >reading other people&#8217;s
                                                implementations</a
                                            >) I decided I wanted WebOb to
                                            include a kind of reference
                                            implementation. But I don&#8217;t
                                            like to include anything in WebOb
                                            unless I&#8217;m sure I can get it
                                            <em>right</em>, so I&#8217;d really
                                            like feedback. (There&#8217;s been
                                            some
                                            <a
                                                class="reference external"
                                                href="http://groups.google.com/group/paste-users/browse_thread/thread/7346e75940413f46"
                                                >less than positive feedback</a
                                            >, but I trudge on.)
                                        </p>
                                        <p>
                                            My implementation is in a
                                            <a
                                                class="reference external"
                                                href="http://svn.pythonpaste.org/Paste/WebOb/branches/ianb-decorator-experiment"
                                                >WebOb branch</a
                                            >, primarily in
                                            <a
                                                class="reference external"
                                                href="http://svn.pythonpaste.org/Paste/WebOb/branches/ianb-decorator-experiment/webob/dec.py"
                                                >webob.dec</a
                                            >
                                            (along with some
                                            <a
                                                class="reference external"
                                                href="http://svn.pythonpaste.org/Paste/WebOb/branches/ianb-decorator-experiment/tests/test_dec.txt"
                                                >doctests</a
                                            >).
                                        </p>
                                        <p>
                                            The most prominent way this is
                                            different from the example I gave is
                                            that it doesn&#8217;t change the
                                            function signature, instead it adds
                                            an attribute
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >.wsgi_app</span
                                                ></tt
                                            >
                                            which is WSGI application associated
                                            with the function. My goal with this
                                            is that the decorator isn&#8217;t
                                            intrusive. Here&#8217;s the case
                                            where I&#8217;ve been bothered:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            <span class="kw1">class</span>
                                            MyClass<span class="br0">&#40;</span
                                            ><span class="kw2">object</span
                                            ><span class="br0">&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp; @<span class="co1"
                                                >wsgiwrap</span
                                            ><br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">def</span>
                                            form<span class="br0">&#40;</span
                                            ><span class="kw2">self</span>,
                                            req<span class="br0">&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="kw1">return</span>
                                            Response<span class="br0"
                                                >&#40;</span
                                            >form_html...<span class="br0"
                                                >&#41;</span
                                            ><br />
                                            <br />
                                            &nbsp; &nbsp; @<span class="co1"
                                                >wsgiwrap</span
                                            ><br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">def</span>
                                            form_post<span class="br0"
                                                >&#40;</span
                                            ><span class="kw2">self</span>,
                                            req<span class="br0">&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; handle
                                            submission<br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            OK, that&#8217;s fine, then I add
                                            validation:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            @<span class="co1">wsgiwrap</span
                                            ><br />
                                            <span class="kw1">def</span>
                                            form_post<span class="br0"
                                                >&#40;</span
                                            ><span class="kw2">self</span>,
                                            req<span class="br0">&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">if</span> req
                                            <span class="kw1">not</span>
                                            valid:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="kw1">return</span>
                                            <span class="kw2">self</span>.<span
                                                class="me1"
                                                >form</span
                                            ><br />
                                            &nbsp; &nbsp; handle submission<br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            This still works, because the
                                            decorator allows you to return
                                            <em>any</em> WSGI application, not
                                            just a WebOb Response object. But
                                            that&#8217;s not helpful, because I
                                            need errors&#8230;
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            @<span class="co1">wsgiwrap</span
                                            ><br />
                                            <span class="kw1">def</span>
                                            form_post<span class="br0"
                                                >&#40;</span
                                            ><span class="kw2">self</span>,
                                            req<span class="br0">&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">if</span> req
                                            <span class="kw1">not</span>
                                            valid:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="kw1">return</span>
                                            <span class="kw2">self</span>.<span
                                                class="me1"
                                                >form</span
                                            ><span class="br0">&#40;</span>req,
                                            errors<span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; handle submission<br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            That is, I want to have an option
                                            argument to the
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >form</span
                                                ></tt
                                            >
                                            method that passes in errors. But I
                                            can&#8217;t do this with the
                                            traditional
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >wsgiwrap</span
                                                ></tt
                                            >
                                            decorator, instead I have to
                                            refactor the code to have a third
                                            method that both
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >form</span
                                                ></tt
                                            >
                                            and
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >form_post</span
                                                ></tt
                                            >
                                            use. Of course, there&#8217;s more
                                            than one way to address this issue,
                                            but this is the technique I like.
                                        </p>
                                        <p>
                                            The one other notable feature is
                                            that you can also make middleware:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            @<span class="co1"
                                                >wsgify.middleware</span
                                            ><br />
                                            <span class="kw1">def</span>
                                            cap_middleware<span class="br0"
                                                >&#40;</span
                                            >req, app<span class="br0"
                                                >&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp; resp = app<span
                                                class="br0"
                                                >&#40;</span
                                            >req<span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; resp.<span class="me1"
                                                >body</span
                                            >
                                            = resp.<span class="me1">body</span
                                            >.<span class="me1">upper</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">return</span>
                                            resp<br />
                                            <br />
                                            capped_app = cap_middleware<span
                                                class="br0"
                                                >&#40;</span
                                            >some_wsgi_app<span class="br0"
                                                >&#41;</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            Otherwise, for some reason
                                            I&#8217;ve found myself putting an
                                            inordinate amount of time into
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >__repr__</span
                                                ></tt
                                            >. Why I&#8217;ve done this I cannot
                                            say.
                                        </p>
                                    </div>
                                    <!-- <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="https://ianbicking.org/2009/05/22/webob-decorator/"
    dc:identifier="https://ianbicking.org/2009/05/22/webob-decorator/"
    dc:title="WebOb decorator"
    trackback:ping="https://ianbicking.org/2009/05/22/webob-decorator/trackback/" />
</rdf:RDF> -->
                                </div>
                                <!-- END POST-ENTRY -->
                            </div>
                            <!-- END POST-CONTENT  -->
                        </div>
                        <!-- END-CONTAINER -->
                        <div class="post-header">
                            <h3 class="post-date">2009 05 22</h3>
                            <p class="post-categories">
                                <a
                                    href="../../../programming/index.html"
                                    title="View all posts in Programming"
                                    rel="category tag"
                                    >Programming</a
                                ><br /><a
                                    href="../../index.html"
                                    title="View all posts in Python"
                                    rel="category tag"
                                    >Python</a
                                ><br /><a
                                    href="../../../web/index.html"
                                    title="View all posts in Web"
                                    rel="category tag"
                                    >Web</a
                                >
                            </p>
                            <p class="post-comments">
                                <a
                                    href="../../../../2009/05/22/webob-decorator/index.html#comments"
                                    title="Comment on WebOb decorator"
                                    >Comments (11)</a
                                >
                            </p>
                            <p class="post-permalink">
                                <a
                                    href="../../../../2009/05/22/webob-decorator/index.html"
                                    title="Permalink to WebOb decorator"
                                    rel="permalink"
                                    >Permalink</a
                                >
                            </p>
                        </div>
                        <!-- END POST-FOOTER -->
                    </div>
                    <!-- END POST -->

                    <div id="post-90" class="post">
                        <div class="post-container">
                            <div class="post-content">
                                <h2 class="post-title">
                                    <a
                                        href="../../../../2008/12/27/avoiding-silos-link-as-a-first-class-object/index.html"
                                        title="Permalink to Avoiding Silos: &#8220;link&#8221; as a first-class object"
                                        rel="bookmark"
                                        >Avoiding Silos: &#8220;link&#8221; as a
                                        first-class object</a
                                    >
                                </h2>
                                <div class="post-entry">
                                    <div class="document">
                                        <p>
                                            One of the constant annoyances to me
                                            in web applications is the
                                            self-proclaimed need for those
                                            applications to know about
                                            everything and do everything, and
                                            only spotty ad hoc techniques for
                                            including things from other
                                            applications.
                                        </p>
                                        <p>
                                            An example might be blog navigation
                                            or search, where you can only
                                            include data from the application
                                            itself. Or &quot;Recent Posts&quot;
                                            which can only show locally-produce
                                            posts. What if I post something
                                            elsewhere? I have to create some
                                            shoddy placeholder post to refer to
                                            it. Bah! Underlying this the data is
                                            usually structured in a specific
                                            way, with the HTML being a sort of
                                            artifact of the database, the markup
                                            transient and a slave to the
                                            database&#8217;s structure.
                                        </p>
                                        <p>
                                            An example of this might be a recent
                                            post listing like:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            &lt;ul&gt;<br />
                                            &nbsp;
                                            <span class="kw1">for</span> post
                                            <span class="kw1">in</span>
                                            recent_posts:<br />
                                            &nbsp; &nbsp; &lt;li&gt;<br />
                                            &nbsp; &nbsp; &nbsp; &lt;a
                                            href=<span class="st0"
                                                >&quot;/post/{{post.year}}/{{post.month}}/{{post.slug}}&quot;</span
                                            >&gt;<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="br0">&#123;</span
                                            ><span class="br0">&#123;</span
                                            >post.<span class="me1">title</span
                                            ><span class="br0">&#125;</span
                                            ><span class="br0">&#125;</span
                                            >&lt;/a&gt;<br />
                                            &nbsp; &nbsp; &lt;/li&gt;<br />
                                            &lt;/ul&gt;<br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            There&#8217;s clearly no room for
                                            exceptions in this code. I am thus
                                            proposing that any system like this
                                            should have the notion of a
                                            &quot;link&quot; as a first-class
                                            object. The code should look like
                                            this:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            &lt;ul&gt;<br />
                                            &nbsp;
                                            <span class="kw1">for</span> post
                                            <span class="kw1">in</span>
                                            recent_posts:<br />
                                            &nbsp; &nbsp; &lt;li&gt;<br />
                                            &nbsp; &nbsp; &nbsp;
                                            <span class="br0">&#123;</span
                                            ><span class="br0">&#123;</span
                                            >post.<span class="me1">link</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            ><span class="br0">&#125;</span
                                            ><span class="br0">&#125;</span
                                            ><br />
                                            &nbsp; &nbsp; &lt;/li&gt;<br />
                                            &lt;/ul&gt;<br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            Just like with
                                            <a
                                                class="reference external"
                                                href="../../../../2008/10/24/hypertext-driven-urls/index.html"
                                                >changing IDs to links</a
                                            >
                                            in service documents, the template
                                            doesn&#8217;t actually look any more
                                            complicated than it did before
                                            (simpler, even). But now we can use
                                            simple object-oriented techniques to
                                            create first-class links. The code
                                            might look like:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            <span class="kw1">class</span>
                                            Post<span class="br0">&#40;</span
                                            >SomeORM<span class="br0"
                                                >&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">def</span>
                                            url<span class="br0">&#40;</span
                                            ><span class="kw2">self</span
                                            ><span class="br0">&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="kw1">if</span>
                                            <span class="kw2">self</span>.<span
                                                class="kw2"
                                                >type</span
                                            >
                                            ==
                                            <span class="st0">'link'</span
                                            >:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                            &nbsp;
                                            <span class="kw1">return</span>
                                            <span class="kw2">self</span>.<span
                                                class="me1"
                                                >body</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="kw1">else</span>:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                            &nbsp; base = get_request<span
                                                class="br0"
                                                >&#40;</span
                                            ><span class="br0">&#41;</span
                                            >.<span class="me1"
                                                >application_url</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                            &nbsp;
                                            <span class="kw1">return</span>
                                            <span class="st0"
                                                >'%s/%s/%s/%s'</span
                                            >
                                            % <span class="br0">&#40;</span
                                            ><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                            &nbsp; &nbsp; &nbsp; base,
                                            <span class="kw2">self</span>.<span
                                                class="me1"
                                                >year</span
                                            >,
                                            <span class="kw2">self</span>.<span
                                                class="me1"
                                                >month</span
                                            >,
                                            <span class="kw2">self</span>.<span
                                                class="me1"
                                                >slug</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            <br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">def</span>
                                            link<span class="br0">&#40;</span
                                            ><span class="kw2">self</span
                                            ><span class="br0">&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="kw1">return</span>
                                            html<span class="br0">&#40;</span
                                            ><span class="st0"
                                                >'&lt;a
                                                href=&quot;%s&quot;&gt;%s&lt;/a&gt;'</span
                                            ><span class="br0">&#41;</span> %
                                            <span class="br0">&#40;</span><br />
                                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                                            &nbsp;
                                            <span class="kw2">self</span>.<span
                                                class="me1"
                                                >url</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span>,
                                            <span class="kw2">self</span>.<span
                                                class="me1"
                                                >title</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            The addition of the
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >.url()</span
                                                ></tt
                                            >
                                            method has the obvious effect of
                                            making these offsite links work.
                                            Using a
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >.link()</span
                                                ></tt
                                            >
                                            method has the added advantage of
                                            allowing things like HTML snippets
                                            to be inserted into the system (even
                                            though that is not implemented
                                            here). By allowing arbitrary HTML in
                                            certain places you make it possible
                                            for people to extend the site in
                                            little ways &#8212; possibly adding
                                            markup to a title, or allowing an
                                            item in the list that actually
                                            contains two URLs (e.g.,
                                            <tt class="docutils literal"
                                                ><span class="pre">&lt;a</span>
                                                <span class="pre"
                                                    >href=&quot;url1&quot;&gt;Some</span
                                                >
                                                <span class="pre"
                                                    >Item&lt;/a&gt;</span
                                                >
                                                <span class="pre">(&lt;a</span>
                                                <span class="pre"
                                                    >href=&quot;url2&quot;&gt;via&lt;/a&gt;)</span
                                                ></tt
                                            >).
                                        </p>
                                        <p>
                                            In the context of Python I recommend
                                            making these into methods, not
                                            properties, because it allows you to
                                            later add keyword arguments to
                                            specialize the markup (like
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >post.link(abbreviated=True)</span
                                                ></tt
                                            >).
                                        </p>
                                        <p>
                                            One negative aspect of this is that
                                            you cannot affect all the markup
                                            through the template alone, you may
                                            have to go into the Python code to
                                            change things. Anyone have ideas for
                                            handling this problem?
                                        </p>
                                    </div>
                                    <!-- <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="https://ianbicking.org/2008/12/27/avoiding-silos-link-as-a-first-class-object/"
    dc:identifier="https://ianbicking.org/2008/12/27/avoiding-silos-link-as-a-first-class-object/"
    dc:title="Avoiding Silos: &#8220;link&#8221; as a first-class object"
    trackback:ping="https://ianbicking.org/2008/12/27/avoiding-silos-link-as-a-first-class-object/trackback/" />
</rdf:RDF> -->
                                </div>
                                <!-- END POST-ENTRY -->
                            </div>
                            <!-- END POST-CONTENT  -->
                        </div>
                        <!-- END-CONTAINER -->
                        <div class="post-header">
                            <h3 class="post-date">2008 12 27</h3>
                            <p class="post-categories">
                                <a
                                    href="../../../html/index.html"
                                    title="View all posts in HTML"
                                    rel="category tag"
                                    >HTML</a
                                ><br /><a
                                    href="../../../programming/index.html"
                                    title="View all posts in Programming"
                                    rel="category tag"
                                    >Programming</a
                                ><br /><a
                                    href="../../index.html"
                                    title="View all posts in Python"
                                    rel="category tag"
                                    >Python</a
                                ><br /><a
                                    href="../../../web/index.html"
                                    title="View all posts in Web"
                                    rel="category tag"
                                    >Web</a
                                >
                            </p>
                            <p class="post-comments">
                                <a
                                    href="../../../../2008/12/27/avoiding-silos-link-as-a-first-class-object/index.html#comments"
                                    title="Comment on Avoiding Silos: &#8220;link&#8221; as a first-class object"
                                    >Comments (13)</a
                                >
                            </p>
                            <p class="post-permalink">
                                <a
                                    href="../../../../2008/12/27/avoiding-silos-link-as-a-first-class-object/index.html"
                                    title="Permalink to Avoiding Silos: &#8220;link&#8221; as a first-class object"
                                    rel="permalink"
                                    >Permalink</a
                                >
                            </p>
                        </div>
                        <!-- END POST-FOOTER -->
                    </div>
                    <!-- END POST -->

                    <div id="post-87" class="post">
                        <div class="post-container">
                            <div class="post-content">
                                <h2 class="post-title">
                                    <a
                                        href="../../../../2008/12/16/using-pip-requirements/index.html"
                                        title="Permalink to Using pip Requirements"
                                        rel="bookmark"
                                        >Using pip Requirements</a
                                    >
                                </h2>
                                <div class="post-entry">
                                    <div class="document">
                                        <p>
                                            Following onto a set of recent posts
                                            (from
                                            <a
                                                class="reference external"
                                                href="http://www.b-list.org/weblog/2008/dec/14/packaging/"
                                                >James</a
                                            >,
                                            <a
                                                class="reference external"
                                                href="../../../../2008/12/14/a-few-corrections-to-on-packaging/index.html"
                                                >me</a
                                            >, then
                                            <a
                                                class="reference external"
                                                href="http://www.b-list.org/weblog/2008/dec/15/pip/"
                                                >James again</a
                                            >), Martijn Faassen
                                            <a
                                                class="reference external"
                                                href="http://faassen.n--tree.net/blog/view/weblog/2008/12/16/0"
                                                >wrote a description of
                                                Grok&#8217;s version
                                                management</a
                                            >. Our ideas are pretty close, but
                                            he&#8217;s using buildout, and
                                            I&#8217;ll describe out to do the
                                            same things with pip.
                                        </p>
                                        <p>
                                            Here&#8217;s a kind of development
                                            workflow that I think works well:
                                        </p>
                                        <ul class="simple">
                                            <li>
                                                A framework release is prepared.
                                                Ideally there&#8217;s a buildbot
                                                that has been running (as
                                                <a
                                                    class="reference external"
                                                    href="http://pylonshq.com:8010/"
                                                    >Pylons has</a
                                                >, for example), so the
                                                integration has been running for
                                                a while.
                                            </li>
                                            <li>
                                                People make sure there are
                                                released versions of all the
                                                important components. If there
                                                are known conflicts between
                                                pieces, libraries and the
                                                framework update their
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >install_requires</span
                                                    ></tt
                                                >
                                                in their
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >setup.py</span
                                                    ></tt
                                                >
                                                files to make sure people
                                                don&#8217;t use conflicting
                                                pieces together.
                                            </li>
                                            <li>
                                                Once everything has been
                                                released, there is a known set
                                                of packages that work together.
                                                Using a buildbot maybe future
                                                versions will also work
                                                together, but they won&#8217;t
                                                necessarily work together with
                                                applications built on the
                                                framework. And breakage can also
                                                occur regardless of a buildbot.
                                            </li>
                                            <li>
                                                Also, people may have versions
                                                of libraries already installed,
                                                but just because they&#8217;ve
                                                installed something
                                                doesn&#8217;t mean they really
                                                mean to stay with an old
                                                version. While known conflicts
                                                have been noted, there&#8217;s
                                                going to be lots of unknown
                                                conflicts and future conflicts.
                                            </li>
                                            <li>
                                                When starting development with a
                                                framework, the developer would
                                                like to start with some
                                                known-good set, which is a set
                                                that can be developed by the
                                                framework developers, or
                                                potentially by any person. For
                                                instance, if you extend a public
                                                framework with an internal
                                                framework (or even a public
                                                sub-framework like
                                                <a
                                                    class="reference external"
                                                    href="http://pinaxproject.com/"
                                                    >Pinax</a
                                                >) then the known-good set will
                                                be developed by a different set
                                                of people.
                                            </li>
                                            <li>
                                                As an application is developed,
                                                the developer will add on other
                                                libraries, or use some of their
                                                own libraries. Development will
                                                probably occur at the trunk/tip
                                                of several libraries as they are
                                                developed together.
                                            </li>
                                            <li>
                                                A developer might upgrade the
                                                entire framework, or just
                                                upgrade one piece (for instance,
                                                to get a bug fix they are
                                                interested in, or follow a
                                                branch that has functionality
                                                they care about). The developer
                                                doesn&#8217;t necessarily have
                                                the same notion of
                                                &quot;stable&quot; and
                                                &quot;released&quot; as the core
                                                framework developers have.
                                            </li>
                                            <li>
                                                At the time of deployment the
                                                developer wants to make sure all
                                                the pieces are deployed together
                                                as they&#8217;ve tested them,
                                                and how they know them to work.
                                                At any time, another developer
                                                may want to clone the same set
                                                of libraries.
                                            </li>
                                            <li>
                                                After initial deployment, the
                                                developer may want to upgrade a
                                                single component, if only to
                                                test that an upgrade works, or
                                                if it resolves a bug. They may
                                                test out combinations only to
                                                throw them away, and they
                                                don&#8217;t want to bump
                                                versions of libraries in order
                                                to deploy new combinations.
                                            </li>
                                        </ul>
                                        <p>
                                            This is the kind of development
                                            pattern that requirement files are
                                            meant to assist with. They can
                                            provide a known-good set of
                                            packages. Or they can provide a
                                            starting point for an active line of
                                            development. Or they can provide a
                                            historical record of how something
                                            was put together.
                                        </p>
                                        <p>
                                            The easy way to start a requirement
                                            file for pip is just to put the
                                            packages you know you want to work
                                            with. For instance, we&#8217;ll call
                                            this
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >project-start.txt</span
                                                ></tt
                                            >:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            Pylons<br />
                                            -e
                                            svn+http://mycompany/svn/MyApp/trunk<span
                                                class="co1"
                                                >#egg=MyApp</span
                                            ><br />
                                            -e
                                            svn+http://mycompany/svn/MyLibrary/trunk<span
                                                class="co1"
                                                >#egg=MyLibrary</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            You can plug away for a while, and
                                            maybe you decide you want to freeze
                                            the file. So you do:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            $ pip freeze -r project-start.<span
                                                class="me1"
                                                >txt</span
                                            >
                                            project-frozen.<span class="me1"
                                                >txt</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            By using
                                            <tt class="docutils literal"
                                                ><span class="pre">-r</span>
                                                <span class="pre"
                                                    >project-start.txt</span
                                                ></tt
                                            >
                                            you give
                                            <tt class="docutils literal"
                                                ><span class="pre">pip</span>
                                                <span class="pre"
                                                    >freeze</span
                                                ></tt
                                            >
                                            a template for it to start with.
                                            From that, you&#8217;ll get
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >project-frozen.txt</span
                                                ></tt
                                            >
                                            that will look like:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            Pylons==<span class="nu0">0.9</span
                                            ><span class="nu0">.7</span><br />
                                            -e
                                            svn+http://mycompany/svn/MyApp/trunk@<span
                                                class="co1"
                                                >1045#egg=MyApp</span
                                            ><br />
                                            -e
                                            svn+http://mycompany/svn/MyLibrary/trunk@<span
                                                class="co1"
                                                >1058#egg=MyLibrary</span
                                            ><br />
                                            <br />
                                            <span class="co1"
                                                >## The following requirements
                                                were added by pip
                                                --freeze:</span
                                            ><br />
                                            Beaker==<span class="nu0">0.2</span
                                            ><span class="nu0">.1</span><br />
                                            WebHelpers==<span class="nu0"
                                                >0.9</span
                                            ><span class="nu0">.1</span><br />
                                            nose==<span class="nu0">1.4</span
                                            ><br />
                                            <span class="co1"
                                                ># Installing as editable to
                                                satisfy requirement
                                                INITools==0.2.1dev-r3488:</span
                                            ><br />
                                            -e svn+http://svn.<span class="me1"
                                                >colorstudy</span
                                            >.<span class="me1">com</span
                                            >/INITools/trunk@<span class="co1"
                                                >3488#egg=INITools-0.2.1dev_r3488</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            At that point you might decide that
                                            you don&#8217;t care about the nose
                                            version, or you might have installed
                                            something from trunk when you could
                                            have used the last release. So you
                                            go and adjust some things.
                                        </p>
                                        <p>
                                            Martijn also asks: how do you have
                                            framework developers maintain one
                                            file, and then also have developers
                                            maintain their own lists for their
                                            projects?
                                        </p>
                                        <p>
                                            You could start with a file like
                                            this for the framework itself.
                                            Pylons for instance could ship with
                                            something like this. To install
                                            Pylons you could then do:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            $ pip -E MyProject install \\<br />
                                            &gt; &nbsp; &nbsp;-r
                                            http://pylonshq.<span class="me1"
                                                >com</span
                                            >/<span class="nu0">0.9</span
                                            ><span class="nu0">.7</span
                                            >-requirements.<span class="me1"
                                                >txt</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            You can also download that file
                                            yourself, add some comments, rename
                                            the file and add your project to it,
                                            and use that. When you freeze the
                                            order of the packages and any
                                            comments will be preserved, so you
                                            can keep track of what changed. Also
                                            it should be ameniable to source
                                            control, and diffs would be
                                            sensible.
                                        </p>
                                        <p>
                                            You could also use indirection,
                                            creating a file like this for your
                                            project:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            -r http://pylonshq.<span class="me1"
                                                >com</span
                                            >/<span class="nu0">0.9</span
                                            ><span class="nu0">.7</span
                                            >-requirements.<span class="me1"
                                                >txt</span
                                            ><br />
                                            -e
                                            svn+http://mycompany/svn/MyApp/trunk<span
                                                class="co1"
                                                >#egg=MyApp</span
                                            ><br />
                                            -e
                                            svn+http://mycompany/svn/MyLibrary/trunk<span
                                                class="co1"
                                                >#egg=MyLibrary</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            That is, requirements files can
                                            refer to each other. So if you want
                                            to maintain your own requirements
                                            file alongside the development of an
                                            upstream requirements file, you
                                            could do that.
                                        </p>
                                    </div>
                                    <!-- <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="https://ianbicking.org/2008/12/16/using-pip-requirements/"
    dc:identifier="https://ianbicking.org/2008/12/16/using-pip-requirements/"
    dc:title="Using pip Requirements"
    trackback:ping="https://ianbicking.org/2008/12/16/using-pip-requirements/trackback/" />
</rdf:RDF> -->
                                </div>
                                <!-- END POST-ENTRY -->
                            </div>
                            <!-- END POST-CONTENT  -->
                        </div>
                        <!-- END-CONTAINER -->
                        <div class="post-header">
                            <h3 class="post-date">2008 12 16</h3>
                            <p class="post-categories">
                                <a
                                    href="../../../packaging/index.html"
                                    title="View all posts in Packaging"
                                    rel="category tag"
                                    >Packaging</a
                                ><br /><a
                                    href="../../index.html"
                                    title="View all posts in Python"
                                    rel="category tag"
                                    >Python</a
                                >
                            </p>
                            <p class="post-comments">
                                <a
                                    href="../../../../2008/12/16/using-pip-requirements/index.html#comments"
                                    title="Comment on Using pip Requirements"
                                    >Comments (3)</a
                                >
                            </p>
                            <p class="post-permalink">
                                <a
                                    href="../../../../2008/12/16/using-pip-requirements/index.html"
                                    title="Permalink to Using pip Requirements"
                                    rel="permalink"
                                    >Permalink</a
                                >
                            </p>
                        </div>
                        <!-- END POST-FOOTER -->
                    </div>
                    <!-- END POST -->

                    <div id="post-86" class="post">
                        <div class="post-container">
                            <div class="post-content">
                                <h2 class="post-title">
                                    <a
                                        href="../../../../2008/12/14/a-few-corrections-to-on-packaging/index.html"
                                        title="Permalink to A Few Corrections To &#8220;On Packaging&#8221;"
                                        rel="bookmark"
                                        >A Few Corrections To &#8220;On
                                        Packaging&#8221;</a
                                    >
                                </h2>
                                <div class="post-entry">
                                    <div class="document">
                                        <p>
                                            <a
                                                class="reference external"
                                                href="http://www.b-list.org/weblog/2008/dec/14/packaging/"
                                                >James Bennett recently wrote an
                                                article on Python packaging and
                                                installation</a
                                            >, and Setuptools. There&#8217;s a
                                            lot of issues, and writing up my
                                            thoughts could take a long time, but
                                            I thought at least I should correct
                                            some errors, specifically category
                                            errors. Figuring out where all the
                                            pieces in Setuptools (and pip and
                                            virtualenv) fit
                                            <em>is</em> difficult, so I
                                            don&#8217;t blame James for making
                                            some mistakes, but in the interest
                                            of clarifying the discussion&#8230;
                                        </p>
                                        <p>
                                            I will start with a kind of
                                            glossary:
                                        </p>
                                        <dl class="docutils">
                                            <dt>Distribution:</dt>
                                            <dd>
                                                This is
                                                something-with-a-setup.py. A
                                                tarball, zip, a checkout, etc.
                                                Distributions have names; this
                                                is the name in
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >setup(name=&quot;...&quot;)</span
                                                    ></tt
                                                >
                                                in the setup.py file. They have
                                                some other metadata too
                                                (description, version, etc), and
                                                Setuptools adds to that metadata
                                                some. Distutils doesn&#8217;t
                                                make it very easy to add to the
                                                metadata &#8212; it&#8217;ll
                                                whine a little about things it
                                                doesn&#8217;t know, but
                                                won&#8217;t do anything with
                                                that extra data. Fixing this
                                                problem in Distutils is an
                                                important aspect of Setuptools,
                                                and part of what Distutils
                                                itself unsuitable as a basis for
                                                good library management.
                                            </dd>
                                            <dt>package/module:</dt>
                                            <dd>
                                                This is something you import. It
                                                is not the same as a
                                                distribution, though usually a
                                                distribution will have the same
                                                name as a package. In my own
                                                libraries I try to name the
                                                distribution with mixed case
                                                (like Paste) and the package
                                                with lower case (like paste).
                                                Keeping the terminology straight
                                                here is <em>very</em> difficult;
                                                and usually it doesn&#8217;t
                                                matter, but sometimes it does.
                                            </dd>
                                            <dt>
                                                Setuptools The Distribution:
                                            </dt>
                                            <dd>
                                                This is what you install when
                                                you install Setuptools. It
                                                includes several pieces that
                                                Phillip Eby wrote, that work
                                                together but are not strictly a
                                                single thing.
                                            </dd>
                                            <dt>setuptools The Package:</dt>
                                            <dd>
                                                This is what you get when you do
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >import</span
                                                    >
                                                    <span class="pre"
                                                        >setuptools</span
                                                    ></tt
                                                >. Setuptools largely works by
                                                monkeypatching distutils, so
                                                simply importing setuptools
                                                activates its functionality from
                                                then on. This package is
                                                entirely focused on installation
                                                and package management, it is
                                                not something you should use at
                                                runtime (unless you are
                                                installing packages as your
                                                runtime, of course).
                                            </dd>
                                            <dt>pkg_resources The Module:</dt>
                                            <dd>
                                                This is also included in
                                                Setuptools The Distribution, and
                                                is for use at runtime. This is a
                                                single module that provides the
                                                ability to query what
                                                distributions are installed,
                                                metadata about those
                                                distributions, information about
                                                the location where they are
                                                installed. It also allows
                                                distributions to be
                                                &quot;activated&quot;. A
                                                <em>distribution</em> can be
                                                available but not activated.
                                                Activating a distribution means
                                                adding its location to
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >sys.path</span
                                                    ></tt
                                                >, and probably you&#8217;ve
                                                noticed how long sys.path is
                                                when you use easy_install.
                                                Almost everything that allows
                                                different libraries to be
                                                installed, or allows different
                                                versions of libraries, does it
                                                through some management of
                                                sys.path. pkg_resources also
                                                allows for generic access to
                                                &quot;resources&quot; (i.e.,
                                                non-code files), and let&#8217;s
                                                those resources be in zip files.
                                                pkg_resources is safe to use, it
                                                doesn&#8217;t do any of the
                                                funny stuff that people get
                                                annoyed with.
                                            </dd>
                                            <dt>easy_install:</dt>
                                            <dd>
                                                This is also in Setuptools The
                                                Distribution. The basic
                                                functionality it provides is
                                                that given a name, it can search
                                                for package with that
                                                distribution name, and also
                                                satisfying a version
                                                requirement. It then downloads
                                                the package, installs it (using
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >setup.py</span
                                                    >
                                                    <span class="pre"
                                                        >install</span
                                                    ></tt
                                                >, but with the setuptools
                                                monkeypatches in place). After
                                                that, it checks the newly
                                                installed distribution to see if
                                                it requires any other libraries
                                                that aren&#8217;t yet installed,
                                                and if so it installs them.
                                            </dd>
                                            <dt>
                                                Eggs the Distribution Format:
                                            </dt>
                                            <dd>
                                                These are zip files that
                                                Setuptools creates when you run
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >python</span
                                                    >
                                                    <span class="pre"
                                                        >setup.py</span
                                                    >
                                                    <span class="pre"
                                                        >bdist_egg</span
                                                    ></tt
                                                >. Unlike a tarball, these can
                                                be binary packages, containing
                                                compiled modules, and generally
                                                contain .pyc files (which are
                                                portable across platforms, but
                                                not Python versions). This
                                                format only includes files that
                                                will actually be installed; as a
                                                result it does not include doc
                                                files or
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >setup.py</span
                                                    ></tt
                                                >
                                                itself. All the metadata from
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >setup.py</span
                                                    ></tt
                                                >
                                                that is needed for installation
                                                is put in files in a directory
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >EGG-INFO</span
                                                    ></tt
                                                >.
                                            </dd>
                                            <dt>
                                                Eggs the Installation Format:
                                            </dt>
                                            <dd>
                                                Eggs the Distribution Format are
                                                a subset of the Installation
                                                Format. That is, if you put an
                                                Egg zip file on the path, it is
                                                installed, no other process is
                                                necessary. But the Installation
                                                Format is more general. To have
                                                an egg installed, you either
                                                need something like
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >DistroName-X.Y.egg/</span
                                                    ></tt
                                                >
                                                on the path, and then an
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >EGG-INFO/</span
                                                    ></tt
                                                >
                                                directory under that with the
                                                metadata, or a path like
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >DistroName.egg-info/</span
                                                    ></tt
                                                >
                                                with the metadata directly in
                                                that directory. This metadata
                                                can exist anywhere, and
                                                doesn&#8217;t have to be
                                                directly alongside the actual
                                                Python code. Egg directories are
                                                required for pkg_resources to
                                                activate and deactivate
                                                distributions, but otherwise
                                                they aren&#8217;t necessary.
                                            </dd>
                                            <dt>pip:</dt>
                                            <dd>
                                                This is an alternative to
                                                easy_install. It works
                                                <em>somewhat</em> differently
                                                than easy_install, but not much.
                                                Mostly it is
                                                <em>better</em> than
                                                easy_install, in that it has
                                                some extra features and is
                                                easier to use. Unlike
                                                easy_install, it downloads all
                                                distributions up-front, and
                                                generates the metadata to read
                                                distribution and version
                                                requirements. It uses Setuptools
                                                to generate this metadata from a
                                                setup.py file, and uses
                                                pkg_resources to parse this
                                                metadata. It then installs
                                                packages
                                                <em
                                                    >with the setuptools
                                                    monkeypatches applied</em
                                                >. It just happens to use an
                                                option
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >python</span
                                                    >
                                                    <span class="pre"
                                                        >setup.py</span
                                                    >
                                                    <span class="pre"
                                                        >--single-version-externally-managed</span
                                                    ></tt
                                                >, which gets Setuptools to
                                                install packages in a more flat
                                                manner, with
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >Distro.egg-info/</span
                                                    ></tt
                                                >
                                                directories alongside the
                                                package. Pip installs eggs!
                                                I&#8217;ve heard the many
                                                complaints about easy_install
                                                (and I&#8217;ve had many
                                                myself), but ultimately I think
                                                pip does well by just fixing a
                                                few small issues. Pip is
                                                <em>not</em> a repudiation of
                                                Setuptools or the basic
                                                mechanisms that easy_install
                                                uses.
                                            </dd>
                                            <dt>PoachEggs:</dt>
                                            <dd>
                                                This is a defunct package that
                                                had some of the features of pip
                                                (particularly requirement files)
                                                but used easy_install for
                                                installation. Don&#8217;t bother
                                                with this, it was just a bridge
                                                to get to pip.
                                            </dd>
                                            <dt>virtualenv:</dt>
                                            <dd>
                                                This is a little hack that
                                                creates isolated Python
                                                environments. It&#8217;s based
                                                on
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >virtual-python.py</span
                                                    ></tt
                                                >, which is something I wrote
                                                based on some documentation
                                                notes PJE wrote for Setuptools.
                                                Basically virtualenv just
                                                creates a
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >bin/python</span
                                                    ></tt
                                                >
                                                interpreter that has its own
                                                value of
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >sys.prefix</span
                                                    ></tt
                                                >, but uses the system Python
                                                and standard library. It also
                                                installs Setuptools to make it
                                                easier to bootstrap the
                                                environment (because
                                                bootstrapping Setuptools is
                                                itself a bit tedious).
                                                I&#8217;ll add pip to it too
                                                sometime. Using virtualenv you
                                                don&#8217;t have to worry about
                                                different library versions,
                                                because for any one environment
                                                you will probably only need one
                                                version of a library. On any one
                                                <em>machine</em> you probably
                                                need different versions, which
                                                is why installing packages
                                                system-wide is problematic for
                                                most libraries. (I&#8217;ve been
                                                meaning to write a post on why I
                                                think using system packaging for
                                                libraries is counter-productive,
                                                but that&#8217;ll wait for
                                                another time.)
                                            </dd>
                                        </dl>
                                        <hr class="docutils" />
                                        <p>
                                            So&#8230; there&#8217;s the pieces
                                            involved, at least the ones I can
                                            remember now. And I haven&#8217;t
                                            really discussed .pth files, entry
                                            points, sys.path trickery, site.py,
                                            distutils.cfg&#8230; sadly this is a
                                            complex state of affairs, but it was
                                            also complex before Setuptools.
                                        </p>
                                        <p>
                                            There are a few things that I think
                                            people really dislike about
                                            Setuptools.
                                        </p>
                                        <p>
                                            First, zip files. Setuptools prefers
                                            zip files, for reasons that
                                            won&#8217;t mean much to you, and
                                            maybe are more historical than
                                            anything. When a distribution
                                            doesn&#8217;t indicate if it is
                                            zip-safe, Setuptools looks at the
                                            code and sees if it uses
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >__file__</span
                                                ></tt
                                            >, an if not it presumes that the
                                            code is probably zip-safe. The
                                            specific problem James cites is what
                                            appears to be a bug in Django, that
                                            Django looks for code and
                                            can&#8217;t traverse into zip files
                                            in the same way that Python itself
                                            can. Setuptools didn&#8217;t itself
                                            add anything to Python to make it
                                            import zip files, that functionality
                                            was added to Python some time
                                            before. The zipped eggs that
                                            Setuptools installs are using
                                            existing (standard!) Python
                                            functionality.
                                        </p>
                                        <p>
                                            That said, I don&#8217;t think
                                            zipping libraries up is all that
                                            useful, and while it
                                            <em>should</em> work, it
                                            doesn&#8217;t always, and it makes
                                            code harder to inspect and
                                            understand. So since it&#8217;s not
                                            that useful, I&#8217;ve disabled it
                                            when pip installs packages. I also
                                            have had it disabled on my own
                                            system for years now, by creating a
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >distutils.cfg</span
                                                ></tt
                                            >
                                            file with
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >[easy_install]</span
                                                >
                                                <span class="pre">zip_ok</span>
                                                <span class="pre">=</span>
                                                <span class="pre"
                                                    >False</span
                                                ></tt
                                            >
                                            in it. Sadly App Engine is forcing
                                            me to use zip files again, because
                                            of its absurdly small file
                                            limits&#8230; but that&#8217;s a
                                            different topic. (There is an
                                            experimental
                                            <tt class="docutils literal"
                                                ><span class="pre">pip</span>
                                                <span class="pre">zip</span></tt
                                            >
                                            command mostly intended for App
                                            Engine.)
                                        </p>
                                        <p>
                                            Another pain point is version
                                            management with
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >setup.py</span
                                                ></tt
                                            >
                                            and Setuptools. Indeed it is easy to
                                            get things messed up, and it is easy
                                            to piss people off by
                                            overspecifying, and sometimes things
                                            can get in a weird state for no good
                                            reason (often because of
                                            easy_install&#8217;s rather naive
                                            leap-before-you-look installation
                                            order). Pip fixes that last point,
                                            but it also tries to suggest more
                                            constructive and less painful ways
                                            to manage other pieces.
                                        </p>
                                        <p>
                                            Pip requirement files are an
                                            assertion of
                                            <strong
                                                >versions that work
                                                together</strong
                                            >. setup.py requirements (the
                                            Setuptools requirements) should
                                            contain two things:
                                            <strong>1</strong>: all the
                                            libraries used by the distribution
                                            (without which there&#8217;s no way
                                            it&#8217;ll work) and
                                            <strong>2</strong>: exclusions of
                                            the versions of those libraries that
                                            are
                                            <strong>known not to work</strong>.
                                            setup.py requirements should not be
                                            viewed as an assertion that by
                                            satisfying those requirements
                                            everything <em>will</em> work, just
                                            that it <em>might</em> work. Only
                                            the end developer, testing the
                                            system together, can figure out if
                                            it really works. Then pip gives you
                                            a way to record that working set
                                            (using
                                            <a
                                                class="reference external"
                                                href="http://pip.openplans.org/#freezing-requirements"
                                                >pip freeze</a
                                            >), separate from any single
                                            distribution or library.
                                        </p>
                                        <p>
                                            There&#8217;s also a lot of
                                            conflicts between Setuptools and
                                            package maintainers. This is kind of
                                            a proxy war between developers and
                                            sysadmins, who have very different
                                            motivations. It deserves a post of
                                            its own, but the conflicts are about
                                            more than just how Setuptools is
                                            implemented.
                                        </p>
                                        <p>
                                            I&#8217;d love if there was a
                                            language-neutral library
                                            installation and management tool
                                            that really worked. Linux system
                                            package managers are absolutely not
                                            that tool; frankly it is absurd to
                                            even consider them as an
                                            alternative. So for now we do our
                                            best in our respective language
                                            communities. If we&#8217;re going to
                                            move forward, we&#8217;ll have to
                                            acknowledge what&#8217;s come
                                            before, and the reasoning for it.
                                        </p>
                                    </div>
                                    <!-- <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="https://ianbicking.org/2008/12/14/a-few-corrections-to-on-packaging/"
    dc:identifier="https://ianbicking.org/2008/12/14/a-few-corrections-to-on-packaging/"
    dc:title="A Few Corrections To &#8220;On Packaging&#8221;"
    trackback:ping="https://ianbicking.org/2008/12/14/a-few-corrections-to-on-packaging/trackback/" />
</rdf:RDF> -->
                                </div>
                                <!-- END POST-ENTRY -->
                            </div>
                            <!-- END POST-CONTENT  -->
                        </div>
                        <!-- END-CONTAINER -->
                        <div class="post-header">
                            <h3 class="post-date">2008 12 14</h3>
                            <p class="post-categories">
                                <a
                                    href="../../../packaging/index.html"
                                    title="View all posts in Packaging"
                                    rel="category tag"
                                    >Packaging</a
                                ><br /><a
                                    href="../../index.html"
                                    title="View all posts in Python"
                                    rel="category tag"
                                    >Python</a
                                >
                            </p>
                            <p class="post-comments">
                                <a
                                    href="../../../../2008/12/14/a-few-corrections-to-on-packaging/index.html#comments"
                                    title="Comment on A Few Corrections To &#8220;On Packaging&#8221;"
                                    >Comments (40)</a
                                >
                            </p>
                            <p class="post-permalink">
                                <a
                                    href="../../../../2008/12/14/a-few-corrections-to-on-packaging/index.html"
                                    title="Permalink to A Few Corrections To &#8220;On Packaging&#8221;"
                                    rel="permalink"
                                    >Permalink</a
                                >
                            </p>
                        </div>
                        <!-- END POST-FOOTER -->
                    </div>
                    <!-- END POST -->

                    <div id="post-85" class="post">
                        <div class="post-container">
                            <div class="post-content">
                                <h2 class="post-title">
                                    <a
                                        href="../../../../2008/12/10/lxml-an-underappreciated-web-scraping-library/index.html"
                                        title="Permalink to lxml: an underappreciated web scraping library"
                                        rel="bookmark"
                                        >lxml: an underappreciated web scraping
                                        library</a
                                    >
                                </h2>
                                <div class="post-entry">
                                    <div class="document">
                                        <p>
                                            When people think about web scraping
                                            in Python, they usually think
                                            <a
                                                class="reference external"
                                                href="http://www.crummy.com/software/BeautifulSoup/"
                                                >BeautifulSoup</a
                                            >. That&#8217;s okay, but I would
                                            encourage you to also consider
                                            <a
                                                class="reference external"
                                                href="http://codespeak.net/lxml/"
                                                >lxml</a
                                            >.
                                        </p>
                                        <p>
                                            First, people think BeautifulSoup is
                                            better at parsing broken HTML.
                                            <strong
                                                >This is not correct.</strong
                                            >
                                            lxml parses broken HTML quite
                                            nicely. I haven&#8217;t done any
                                            thorough testing, but at least
                                            <a
                                                class="reference external"
                                                href="http://www.crummy.com/software/BeautifulSoup/documentation.html#Parsing%20HTML"
                                                >the BeautifulSoup broken HTML
                                                example</a
                                            >
                                            is parsed better by lxml (which
                                            knows that
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >&lt;td&gt;</span
                                                ></tt
                                            >
                                            elements should go inside
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >&lt;table&gt;</span
                                                ></tt
                                            >
                                            elements).
                                        </p>
                                        <p>
                                            Second, people feel lxml is harder
                                            to install. This is correct.
                                            <strong>BUT</strong>, lxml 2.2alpha1
                                            includes an option to compile static
                                            versions of the underlying C
                                            libraries, which should improve the
                                            installation experience, especially
                                            on Macs. To install this new way,
                                            try:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            $ STATIC_DEPS=true easy_install
                                            <span class="st0"
                                                >'lxml&gt;=2.2alpha1'</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            One you have lxml installed, you
                                            have a great parser (which happens
                                            to be
                                            <a
                                                class="reference external"
                                                href="../../../../2008/03/30/python-html-parser-performance/index.html"
                                                >super-fast</a
                                            >
                                            and that is
                                            <strong>not a tradeoff</strong>).
                                            You get a fairly familiar API based
                                            on
                                            <a
                                                class="reference external"
                                                href="http://docs.python.org/library/xml.etree.elementtree.html#module-xml.etree.ElementTree"
                                                >ElementTree</a
                                            >, which though a little strange
                                            feeling at first, offers a compact
                                            and canonical representation of a
                                            document tree, compared to more
                                            traditional representations. But
                                            there&#8217;s more&#8230;
                                        </p>
                                        <p>
                                            One of the features that should be
                                            appealing to many people doing
                                            screen scraping is that you get CSS
                                            selectors. You can use XPath as
                                            well, but usually that&#8217;s more
                                            complicated (<a
                                                class="reference external"
                                                href="http://css2xpath.appspot.com/?css=div.pad%20a&amp;amp;format=html"
                                                >for example</a
                                            >). Here&#8217;s
                                            <a
                                                class="reference external"
                                                href="http://crowtheries.net/?p=60"
                                                >an example I found</a
                                            >
                                            getting links from a menu in a page
                                            in BeautifulSoup:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            <span class="kw1">from</span>
                                            BeautifulSoup
                                            <span class="kw1">import</span>
                                            BeautifulSoup<br />
                                            <span class="kw1">import</span>
                                            <span class="kw3">urllib2</span
                                            ><br />
                                            soup = BeautifulSoup<span
                                                class="br0"
                                                >&#40;</span
                                            ><span class="kw3">urllib2</span
                                            >.<span class="me1">urlopen</span
                                            ><span class="br0">&#40;</span
                                            ><span class="st0"
                                                >'http://java.sun.com'</span
                                            ><span class="br0">&#41;</span
                                            >.<span class="me1">read</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            menu = soup.<span class="me1"
                                                >findAll</span
                                            ><span class="br0">&#40;</span
                                            ><span class="st0">'div'</span
                                            >,attrs=<span class="br0"
                                                >&#123;</span
                                            ><span class="st0">'class'</span
                                            >:<span class="st0">'pad'</span
                                            ><span class="br0">&#125;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            <span class="kw1">for</span> subMenu
                                            <span class="kw1">in</span>
                                            menu:<br />
                                            &nbsp; &nbsp; links = subMenu.<span
                                                class="me1"
                                                >findAll</span
                                            ><span class="br0">&#40;</span
                                            ><span class="st0">'a'</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">for</span> link
                                            <span class="kw1">in</span>
                                            links:<br />
                                            &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="kw1">print</span>
                                            <span class="st0"
                                                >&quot;%s : %s&quot;</span
                                            >
                                            %
                                            <span class="br0">&#40;</span
                                            >link.<span class="kw3">string</span
                                            >, link<span class="br0">&#91;</span
                                            ><span class="st0">'href'</span
                                            ><span class="br0">&#93;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            Here&#8217;s the same example in
                                            lxml:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            <span class="kw1">from</span>
                                            lxml.<span class="me1">html</span>
                                            <span class="kw1">import</span>
                                            parse<br />
                                            doc = parse<span class="br0"
                                                >&#40;</span
                                            ><span class="st0"
                                                >'http://java.sun.com'</span
                                            ><span class="br0">&#41;</span
                                            >.<span class="me1">getroot</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            <span class="kw1">for</span> link
                                            <span class="kw1">in</span>
                                            doc.<span class="me1"
                                                >cssselect</span
                                            ><span class="br0">&#40;</span
                                            ><span class="st0">'div.pad a'</span
                                            ><span class="br0">&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">print</span>
                                            <span class="st0">'%s: %s'</span> %
                                            <span class="br0">&#40;</span
                                            >link.<span class="me1"
                                                >text_content</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span>,
                                            link.<span class="me1">get</span
                                            ><span class="br0">&#40;</span
                                            ><span class="st0">'href'</span
                                            ><span class="br0">&#41;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            lxml generally knows more about HTML
                                            than BeautifulSoup. Also I think it
                                            does well with the small details;
                                            for instance, the lxml example will
                                            match elements in
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >&lt;div</span
                                                >
                                                <span class="pre"
                                                    >class=&quot;pad</span
                                                >
                                                <span class="pre"
                                                    >menu&quot;&gt;</span
                                                ></tt
                                            >
                                            (space-separated classes), which the
                                            BeautifulSoup example does not do
                                            (obviously there are other ways to
                                            search, but
                                            <a
                                                class="reference external"
                                                href="http://www.crummy.com/software/BeautifulSoup/documentation.html#Searching%20by%20CSS%20class"
                                                >the obvious and documented
                                                technique</a
                                            >
                                            doesn&#8217;t pay attention to HTML
                                            semantics).
                                        </p>
                                        <p>
                                            One feature that I think is really
                                            useful is
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >.make_links_absolute()</span
                                                ></tt
                                            >. This takes the base URL of the
                                            page (<tt class="docutils literal"
                                                ><span class="pre"
                                                    >doc.base</span
                                                ></tt
                                            >) and uses it to make all the links
                                            absolute. This makes it possible to
                                            relocate snippets of HTML or whole
                                            sets of documents (as with
                                            <a
                                                class="reference external"
                                                href="http://svn.colorstudy.com/home/ianb/PageCollector/trunk"
                                                >this program</a
                                            >). This isn&#8217;t just
                                            <tt class="docutils literal"
                                                ><span class="pre">&lt;a</span>
                                                <span class="pre"
                                                    >href&gt;</span
                                                ></tt
                                            >
                                            links, but stylesheets, inline CSS
                                            with
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >&#64;import</span
                                                ></tt
                                            >
                                            statements,
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >background</span
                                                ></tt
                                            >
                                            attributes, etc. It doesn&#8217;t
                                            see quite <em>all</em> links (for
                                            instance, links in Javascript) but
                                            it sees most of them, and works well
                                            for most sites. So if you want to
                                            make a local copy of a site:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            <span class="kw1">from</span>
                                            lxml.<span class="me1">html</span>
                                            <span class="kw1">import</span>
                                            parse, open_in_browser<br />
                                            doc = parse<span class="br0"
                                                >&#40;</span
                                            ><span class="st0"
                                                >'http://wiki.python.org/moin/'</span
                                            ><span class="br0">&#41;</span
                                            >.<span class="me1">getroot</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            doc.<span class="me1"
                                                >make_links_absolute</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            open_in_browser<span class="br0"
                                                >&#40;</span
                                            >doc<span class="br0">&#41;</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >open_in_browser</span
                                                ></tt
                                            >
                                            serializes the document to a
                                            temporary file and then opens a web
                                            browser (using
                                            <a
                                                class="reference external"
                                                href="http://docs.python.org/library/webbrowser.html"
                                                >webbrowser</a
                                            >).
                                        </p>
                                        <p>
                                            Here&#8217;s
                                            <a
                                                class="reference external"
                                                href="http://svn.colorstudy.com/home/ianb/recipes/lxmldiff.py"
                                                >an example</a
                                            >
                                            that compares two pages using
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >lxml.html.diff</span
                                                ></tt
                                            >:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            <span class="kw1">from</span>
                                            lxml.<span class="me1">html</span
                                            >.<span class="me1">diff</span>
                                            <span class="kw1">import</span>
                                            htmldiff<br />
                                            <span class="kw1">from</span>
                                            lxml.<span class="me1">html</span>
                                            <span class="kw1">import</span>
                                            parse, tostring, open_in_browser,
                                            fromstring<br />
                                            <br />
                                            <span class="kw1">def</span>
                                            get_page<span class="br0"
                                                >&#40;</span
                                            >url<span class="br0">&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp; doc = parse<span
                                                class="br0"
                                                >&#40;</span
                                            >url<span class="br0">&#41;</span
                                            >.<span class="me1">getroot</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; doc.<span class="me1"
                                                >make_links_absolute</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">return</span>
                                            tostring<span class="br0"
                                                >&#40;</span
                                            >doc<span class="br0">&#41;</span
                                            ><br />
                                            <br />
                                            <span class="kw1">def</span>
                                            compare_pages<span class="br0"
                                                >&#40;</span
                                            >url1, url2, selector=<span
                                                class="st0"
                                                >'body div'</span
                                            ><span class="br0">&#41;</span
                                            >:<br />
                                            &nbsp; &nbsp; basis = parse<span
                                                class="br0"
                                                >&#40;</span
                                            >url1<span class="br0">&#41;</span
                                            >.<span class="me1">getroot</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; basis.<span
                                                class="me1"
                                                >make_links_absolute</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; other = parse<span
                                                class="br0"
                                                >&#40;</span
                                            >url2<span class="br0">&#41;</span
                                            >.<span class="me1">getroot</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; other.<span
                                                class="me1"
                                                >make_links_absolute</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; el1 = basis.<span
                                                class="me1"
                                                >cssselect</span
                                            ><span class="br0">&#40;</span
                                            >selector<span class="br0"
                                                >&#41;</span
                                            ><span class="br0">&#91;</span
                                            ><span class="nu0">0</span
                                            ><span class="br0">&#93;</span
                                            ><br />
                                            &nbsp; &nbsp; el2 = other.<span
                                                class="me1"
                                                >cssselect</span
                                            ><span class="br0">&#40;</span
                                            >selector<span class="br0"
                                                >&#41;</span
                                            ><span class="br0">&#91;</span
                                            ><span class="nu0">0</span
                                            ><span class="br0">&#93;</span
                                            ><br />
                                            &nbsp; &nbsp; diff_content =
                                            htmldiff<span class="br0"
                                                >&#40;</span
                                            >tostring<span class="br0"
                                                >&#40;</span
                                            >el1<span class="br0">&#41;</span>,
                                            tostring<span class="br0"
                                                >&#40;</span
                                            >el2<span class="br0">&#41;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; diff_el =
                                            fromstring<span class="br0"
                                                >&#40;</span
                                            >diff_content<span class="br0"
                                                >&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; el1.<span class="me1"
                                                >getparent</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            >.<span class="me1">insert</span
                                            ><span class="br0">&#40;</span
                                            >el1.<span class="me1"
                                                >getparent</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            >.<span class="me1">index</span
                                            ><span class="br0">&#40;</span
                                            >el1<span class="br0">&#41;</span>,
                                            diff_el<span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; el1.<span class="me1"
                                                >getparent</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            >.<span class="me1">remove</span
                                            ><span class="br0">&#40;</span
                                            >el1<span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">return</span>
                                            basis<br />
                                            <br />
                                            <span class="kw1">if</span> __name__
                                            ==
                                            <span class="st0">'__main__'</span
                                            >:<br />
                                            &nbsp; &nbsp;
                                            <span class="kw1">import</span>
                                            <span class="kw3">sys</span><br />
                                            &nbsp; &nbsp; doc =
                                            compare_pages<span class="br0"
                                                >&#40;</span
                                            ><span class="kw3">sys</span>.<span
                                                class="me1"
                                                >argv</span
                                            ><span class="br0">&#91;</span
                                            ><span class="nu0">1</span
                                            ><span class="br0">&#93;</span>,
                                            <span class="kw3">sys</span>.<span
                                                class="me1"
                                                >argv</span
                                            ><span class="br0">&#91;</span
                                            ><span class="nu0">2</span
                                            ><span class="br0">&#93;</span>,
                                            <span class="kw3">sys</span>.<span
                                                class="me1"
                                                >argv</span
                                            ><span class="br0">&#91;</span
                                            ><span class="nu0">3</span
                                            ><span class="br0">&#93;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp; &nbsp; open_in_browser<span
                                                class="br0"
                                                >&#40;</span
                                            >doc<span class="br0">&#41;</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>You can use it like:</p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            $ python lxmldiff.<span class="me1"
                                                >py</span
                                            >
                                            \<br />
                                            <span class="st0"
                                                >'http://wiki.python.org/moin/BeginnersGuide?action=recall&amp;amp;#038;rev=70'</span
                                            >
                                            \<br />
                                            <span class="st0"
                                                >'http://wiki.python.org/moin/BeginnersGuide?action=recall&amp;amp;#038;rev=81'</span
                                            >
                                            \<br />
                                            <span class="st0"
                                                >'div#content'</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            Another feature lxml has is form
                                            handling. All the cool sexy new
                                            sites use minimal forms, but
                                            searching for &quot;registration
                                            forms&quot; I get
                                            <a
                                                class="reference external"
                                                href="http://www.actuaryjobs.com/cform.html"
                                                >this nice complex form</a
                                            >. Let&#8217;s look at it:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            &gt;&gt;&gt;
                                            <span class="kw1">from</span>
                                            lxml.<span class="me1">html</span>
                                            <span class="kw1">import</span>
                                            parse, tostring<br />
                                            &gt;&gt;&gt; doc = parse<span
                                                class="br0"
                                                >&#40;</span
                                            ><span class="st0"
                                                >'http://www.actuaryjobs.com/cform.html'</span
                                            ><span class="br0">&#41;</span
                                            >.<span class="me1">getroot</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &gt;&gt;&gt; doc.<span class="me1"
                                                >forms</span
                                            ><br />
                                            <span class="br0">&#91;</span
                                            >&lt;Element form at
                                            <span class="nu0">-48232164</span
                                            >&gt;<span class="br0">&#93;</span
                                            ><br />
                                            &gt;&gt;&gt; form = doc.<span
                                                class="me1"
                                                >forms</span
                                            ><span class="br0">&#91;</span
                                            ><span class="nu0">0</span
                                            ><span class="br0">&#93;</span
                                            ><br />
                                            &gt;&gt;&gt; form.<span class="me1"
                                                >inputs</span
                                            >.<span class="me1">keys</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            <span class="br0">&#91;</span
                                            ><span class="st0"
                                                >'thank_you_title'</span
                                            >, <span class="st0">'City'</span>,
                                            <span class="st0">'Zip'</span>, ...
                                            <span class="br0">&#93;</span><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            Now we have a form object.
                                            There&#8217;s two ways to get to the
                                            fields:
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >form.inputs</span
                                                ></tt
                                            >, which gives us a dictionary of
                                            all the actual
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >&lt;input&gt;</span
                                                ></tt
                                            >
                                            elements (and textarea and select).
                                            There&#8217;s also
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >form.fields</span
                                                ></tt
                                            >, which is a dictionary-like
                                            object. The dictionary-like object
                                            is convenient, for instance:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            &gt;&gt;&gt; form.<span class="me1"
                                                >fields</span
                                            ><span class="br0">&#91;</span
                                            ><span class="st0">'cEmail'</span
                                            ><span class="br0">&#93;</span> =
                                            <span class="st0"
                                                >'me&amp;#64;example.com'</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            This actually updates the input
                                            element itself:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            &gt;&gt;&gt; tostring<span
                                                class="br0"
                                                >&#40;</span
                                            >form.<span class="me1">inputs</span
                                            ><span class="br0">&#91;</span
                                            ><span class="st0">'cEmail'</span
                                            ><span class="br0">&#93;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            <span class="st0"
                                                >'&lt;input
                                                type=&quot;input&quot;
                                                name=&quot;cEmail&quot;
                                                size=&quot;30&quot;
                                                value=&quot;test2&quot;&gt;'</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            I think it&#8217;s actually a nicer
                                            API than
                                            <a
                                                class="reference external"
                                                href="http://formencode.org/htmlfill.html"
                                                >htmlfill</a
                                            >
                                            and can serve the same purpose on
                                            the server side.
                                        </p>
                                        <p>
                                            But then you can also use the same
                                            interface for scraping, by filling
                                            fields and getting the submission.
                                            That looks like:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            &gt;&gt;&gt;
                                            <span class="kw1">import</span>
                                            <span class="kw3">urllib</span
                                            ><br />
                                            &gt;&gt;&gt; action = form.<span
                                                class="me1"
                                                >action</span
                                            ><br />
                                            &gt;&gt;&gt; data =
                                            <span class="kw3">urllib</span
                                            >.<span class="me1">urlencode</span
                                            ><span class="br0">&#40;</span
                                            >form.<span class="me1"
                                                >form_values</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &gt;&gt;&gt;
                                            <span class="kw1">if</span>
                                            form.<span class="me1">method</span>
                                            ==
                                            <span class="st0">'GET'</span
                                            >:<br />
                                            ... &nbsp; &nbsp;
                                            <span class="kw1">if</span>
                                            <span class="st0">'?'</span>
                                            <span class="kw1">in</span>
                                            action:<br />
                                            ... &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="me1">action</span> +=
                                            <span class="st0"
                                                >'&amp;amp;#038;'</span
                                            >
                                            + data<br />
                                            ... &nbsp; &nbsp;
                                            <span class="kw1">else</span>:<br />
                                            ... &nbsp; &nbsp; &nbsp; &nbsp;
                                            <span class="me1">action</span> +=
                                            <span class="st0">'?'</span> +
                                            data<br />
                                            ... &nbsp; &nbsp;
                                            <span class="me1">data</span> =
                                            <span class="kw2">None</span><br />
                                            &gt;&gt;&gt; resp =
                                            <span class="kw3">urllib</span
                                            >.<span class="me1">urlopen</span
                                            ><span class="br0">&#40;</span
                                            >action, data<span class="br0"
                                                >&#41;</span
                                            ><br />
                                            &gt;&gt;&gt; resp_doc = parse<span
                                                class="br0"
                                                >&#40;</span
                                            >resp<span class="br0">&#41;</span
                                            >.<span class="me1">getroot</span
                                            ><span class="br0">&#40;</span
                                            ><span class="br0">&#41;</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            Lastly, there&#8217;s
                                            <a
                                                class="reference external"
                                                href="http://codespeak.net/lxml/lxmlhtml.html#cleaning-up-html"
                                                >HTML cleaning</a
                                            >. I think all these features work
                                            together well, do useful things, and
                                            it&#8217;s based on an actual
                                            understanding HTML instead of just
                                            treating tags and attributes as
                                            arbitrary. (Also if you really like
                                            jQuery, you might want to look at
                                            <a
                                                class="reference external"
                                                href="http://pypi.python.org/pypi/pyquery"
                                                >pyquery</a
                                            >, which is a jQuery-like API on top
                                            of lxml).
                                        </p>
                                    </div>
                                    <!-- <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="https://ianbicking.org/2008/12/10/lxml-an-underappreciated-web-scraping-library/"
    dc:identifier="https://ianbicking.org/2008/12/10/lxml-an-underappreciated-web-scraping-library/"
    dc:title="lxml: an underappreciated web scraping library"
    trackback:ping="https://ianbicking.org/2008/12/10/lxml-an-underappreciated-web-scraping-library/trackback/" />
</rdf:RDF> -->
                                </div>
                                <!-- END POST-ENTRY -->
                            </div>
                            <!-- END POST-CONTENT  -->
                        </div>
                        <!-- END-CONTAINER -->
                        <div class="post-header">
                            <h3 class="post-date">2008 12 10</h3>
                            <p class="post-categories">
                                <a
                                    href="../../../html/index.html"
                                    title="View all posts in HTML"
                                    rel="category tag"
                                    >HTML</a
                                ><br /><a
                                    href="../../../programming/index.html"
                                    title="View all posts in Programming"
                                    rel="category tag"
                                    >Programming</a
                                ><br /><a
                                    href="../../index.html"
                                    title="View all posts in Python"
                                    rel="category tag"
                                    >Python</a
                                >
                            </p>
                            <p class="post-comments">
                                <a
                                    href="../../../../2008/12/10/lxml-an-underappreciated-web-scraping-library/index.html#comments"
                                    title="Comment on lxml: an underappreciated web scraping library"
                                    >Comments (51)</a
                                >
                            </p>
                            <p class="post-permalink">
                                <a
                                    href="../../../../2008/12/10/lxml-an-underappreciated-web-scraping-library/index.html"
                                    title="Permalink to lxml: an underappreciated web scraping library"
                                    rel="permalink"
                                    >Permalink</a
                                >
                            </p>
                        </div>
                        <!-- END POST-FOOTER -->
                    </div>
                    <!-- END POST -->

                    <div class="navigation">
                        <div class="alignleft">
                            <a
                                href="https://ianbicking.org/category/python/page/3/"
                                >&laquo; Older posts</a
                            >
                        </div>
                        <div class="alignright">
                            <a href="../../index.html">Newer posts &raquo;</a>
                        </div>
                    </div>
                    <!-- END NAVIGATION -->
                </div>
                <!-- END CONTENT -->
            </div>
            <!-- END CONTAINER  -->

            <div id="sidebar">
                <ul>
                    <li id="home-link">
                        <h2>
                            <a
                                href="../../../../index.html"
                                title="Ian Bicking: a blog"
                                >Home</a
                            >
                        </h2>
                    </li>
                    <li id="text-315934862" class="widget widget_text">
                        <h2 class="widgettitle">About</h2>
                        <div class="textwidget">
                            Ian is a developer with Mozilla,
                            <a href="http://ianbicking.appspot.com/projects"
                                >Python open source developer</a
                            >, actually uses
                            <a
                                href="https://plus.google.com/u/0/104537541227697934010/posts"
                                >Google+</a
                            >
                            more than
                            <a href="http://twitter.com/ianbicking">twitter</a>
                            and lives in Minneapolis.<br />
                            <span
                                class="gittip-0001"
                                gittip-username="ianbicking"
                            ></span>
                            <script
                                id="gittip-0001"
                                src="https://www.gittip.com/assets/widgets/0001.js"
                            ></script>
                        </div>
                    </li>
                    <li id="text-315934863" class="widget widget_text">
                        <div class="textwidget">
                            <!-- <script type="text/javascript">mbgc='f5f5f5';ww='160';mbc='cecece';bbc='3F79D5';bmobc='3b71c6';bbgc='4889F0';bmoc='3F79D5';bfc='FFFFFF';bmofc='ffffff';tlc='cecece';tc='6a6a6a';nc='6a6a6a';bc='6a6a6a';l='y';fs='16';fsb='13';bw='100';ff='4';lu='6a6a6a';pc='4889F0';wh='340';b='s'; pid='104537541227697934010';</script><script type="text/javascript" src="http://widgetsplus.com/google_plus_widget.js"></script> -->
                        </div>
                    </li>
                    <li id="archives-2" class="widget widget_archive">
                        <h2 class="widgettitle">Archives</h2>
                        <ul>
                            <li>
                                <a
                                    href="../../../../2012/10/index.html"
                                    title="October 2012"
                                    >October 2012</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../2012/02/index.html"
                                    title="February 2012"
                                    >February 2012</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../2011/04/index.html"
                                    title="April 2011"
                                    >April 2011</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../2011/03/index.html"
                                    title="March 2011"
                                    >March 2011</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../2010/09/index.html"
                                    title="September 2010"
                                    >September 2010</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../2010/08/index.html"
                                    title="August 2010"
                                    >August 2010</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../2010/05/index.html"
                                    title="May 2010"
                                    >May 2010</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../2010/04/index.html"
                                    title="April 2010"
                                    >April 2010</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../2010/03/index.html"
                                    title="March 2010"
                                    >March 2010</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../2010/02/index.html"
                                    title="February 2010"
                                    >February 2010</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../2010/01/index.html"
                                    title="January 2010"
                                    >January 2010</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../2009/09/index.html"
                                    title="September 2009"
                                    >September 2009</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../2009/05/index.html"
                                    title="May 2009"
                                    >May 2009</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../2009/04/index.html"
                                    title="April 2009"
                                    >April 2009</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../2009/01/index.html"
                                    title="January 2009"
                                    >January 2009</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../2008/12/index.html"
                                    title="December 2008"
                                    >December 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../2008/11/index.html"
                                    title="November 2008"
                                    >November 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../2008/10/index.html"
                                    title="October 2008"
                                    >October 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../2008/09/index.html"
                                    title="September 2008"
                                    >September 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../2008/08/index.html"
                                    title="August 2008"
                                    >August 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../2008/07/index.html"
                                    title="July 2008"
                                    >July 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../2008/06/index.html"
                                    title="June 2008"
                                    >June 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../2008/05/index.html"
                                    title="May 2008"
                                    >May 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../2008/04/index.html"
                                    title="April 2008"
                                    >April 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../2008/03/index.html"
                                    title="March 2008"
                                    >March 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../2008/02/index.html"
                                    title="February 2008"
                                    >February 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../2008/01/index.html"
                                    title="January 2008"
                                    >January 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../2007/11/index.html"
                                    title="November 2007"
                                    >November 2007</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../2007/10/index.html"
                                    title="October 2007"
                                    >October 2007</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../2007/09/index.html"
                                    title="September 2007"
                                    >September 2007</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../2007/08/index.html"
                                    title="August 2007"
                                    >August 2007</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../2007/07/index.html"
                                    title="July 2007"
                                    >July 2007</a
                                >
                            </li>
                        </ul>
                    </li>
                    <li id="text-315934861" class="widget widget_text">
                        <div class="textwidget">
                            <a href="../../../../archive/index.html"
                                >The Older Archives</a
                            >
                        </div>
                    </li>
                    <li id="categories-1" class="widget widget_categories">
                        <h2 class="widgettitle">Categories</h2>
                        <ul>
                            <li class="cat-item cat-item-12">
                                <a
                                    href="../../../erlang/index.html"
                                    title="View all posts filed under Erlang"
                                    >Erlang</a
                                >
                            </li>
                            <li class="cat-item cat-item-11">
                                <a
                                    href="../../../html/index.html"
                                    title="View all posts filed under HTML"
                                    >HTML</a
                                >
                            </li>
                            <li class="cat-item cat-item-8">
                                <a
                                    href="../../../javascript/index.html"
                                    title="View all posts filed under Javascript"
                                    >Javascript</a
                                >
                            </li>
                            <li class="cat-item cat-item-15">
                                <a
                                    href="../../../licensing/index.html"
                                    title="View all posts filed under Licensing"
                                    >Licensing</a
                                >
                            </li>
                            <li class="cat-item cat-item-18">
                                <a
                                    href="../../../mozilla/index.html"
                                    title="View all posts filed under Mozilla"
                                    >Mozilla</a
                                >
                            </li>
                            <li class="cat-item cat-item-5">
                                <a
                                    href="../../../notech/index.html"
                                    title="View all posts filed under Non-technical"
                                    >Non-technical</a
                                >
                            </li>
                            <li class="cat-item cat-item-6">
                                <a
                                    href="../../../olpc/index.html"
                                    title="View all posts filed under OLPC"
                                    >OLPC</a
                                >
                            </li>
                            <li class="cat-item cat-item-14">
                                <a
                                    href="../../../packaging/index.html"
                                    title="View all posts filed under Packaging"
                                    >Packaging</a
                                >
                            </li>
                            <li class="cat-item cat-item-4">
                                <a
                                    href="../../../politics/index.html"
                                    title="View all posts filed under Politics"
                                    >Politics</a
                                >
                            </li>
                            <li class="cat-item cat-item-3">
                                <a
                                    href="../../../programming/index.html"
                                    title="View all posts filed under Programming"
                                    >Programming</a
                                >
                            </li>
                            <li class="cat-item cat-item-7 current-cat">
                                <a
                                    href="../../index.html"
                                    title="View all posts filed under Python"
                                    >Python</a
                                >
                            </li>
                            <li class="cat-item cat-item-10">
                                <a
                                    href="../../../ruby/index.html"
                                    title="View all posts filed under Ruby"
                                    >Ruby</a
                                >
                            </li>
                            <li class="cat-item cat-item-19">
                                <a
                                    href="../../../security/index.html"
                                    title="View all posts filed under Security"
                                    >Security</a
                                >
                            </li>
                            <li class="cat-item cat-item-16">
                                <a
                                    href="../../../silverlining.1"
                                    title="View all posts filed under Silver Lining"
                                    >Silver Lining</a
                                >
                            </li>
                            <li class="cat-item cat-item-20">
                                <a
                                    href="../../../programming/testing/index.html"
                                    title="View all posts filed under Testing"
                                    >Testing</a
                                >
                            </li>
                            <li class="cat-item cat-item-9">
                                <a
                                    href="../../../web/index.html"
                                    title="View all posts filed under Web"
                                    >Web</a
                                >
                            </li>
                            <li class="cat-item cat-item-13">
                                <a
                                    href="../../../zopeplone/index.html"
                                    title="View all posts filed under Zope/Plone"
                                    >Zope/Plone</a
                                >
                            </li>
                        </ul>
                    </li>
                    <li id="search-2" class="widget widget_search">
                        <form
                            id="searchform"
                            method="get"
                            action="../../../../index.html"
                        >
                            <div>
                                <input
                                    id="s"
                                    name="s"
                                    type="text"
                                    value=""
                                    tabindex="1"
                                    size="10"
                                />
                                <input
                                    id="searchsubmit"
                                    name="searchsubmit"
                                    type="submit"
                                    value="Find"
                                    tabindex="2"
                                />
                            </div>
                        </form>
                    </li>
                    <li
                        id="recent-posts-2"
                        class="widget widget_recent_entries"
                    >
                        <h2 class="widgettitle">Recent Posts</h2>
                        <ul>
                            <li>
                                <a
                                    href="../../../../index.html?p=291"
                                    title="Why doctest.js is better than Python&#8217;s doctest"
                                    >Why doctest.js is better than
                                    Python&#8217;s doctest</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../index.html?p=283"
                                    title="Python Application Package"
                                    >Python Application Package</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../index.html?p=277"
                                    title="Git-as-sync, not source-control-as-deployment"
                                    >Git-as-sync, not
                                    source-control-as-deployment</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../index.html?p=253"
                                    title="My Unsolicited Advice For PyPy"
                                    >My Unsolicited Advice For PyPy</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../../../index.html?p=250"
                                    title="A Python Web Application Package and Format (we should make one)"
                                    >A Python Web Application Package and Format
                                    (we should make one)</a
                                >
                            </li>
                        </ul>
                    </li>
                    <li
                        id="recent-comments-2"
                        class="widget widget_recent_comments"
                    >
                        <h2 class="widgettitle">Recent Comments</h2>
                        <ul id="recentcomments">
                            <li class="recentcomments">
                                <a
                                    href="http://www.mirsa.com.tr"
                                    rel="external nofollow"
                                    class="url"
                                    >havalandrma</a
                                >
                                on
                                <a
                                    href="../../../../2012/10/02/why-doctest-js-is-better-than-pythons-doctest/comment-page-1/index.html#comment-228633"
                                    >Why doctest.js is better than
                                    Python&#8217;s doctest</a
                                >
                            </li>
                            <li class="recentcomments">
                                <a
                                    href="http://redealmeidense.com.br/portalx/modules/"
                                    rel="external nofollow"
                                    class="url"
                                    >this website</a
                                >
                                on
                                <a
                                    href="../../../../2012/10/02/why-doctest-js-is-better-than-pythons-doctest/comment-page-1/index.html#comment-196267"
                                    >Why doctest.js is better than
                                    Python&#8217;s doctest</a
                                >
                            </li>
                            <li class="recentcomments">
                                Eric Pierce on
                                <a
                                    href="../../../../2012/10/02/why-doctest-js-is-better-than-pythons-doctest/comment-page-1/index.html#comment-195322"
                                    >Why doctest.js is better than
                                    Python&#8217;s doctest</a
                                >
                            </li>
                            <li class="recentcomments">
                                Paul Brian on
                                <a
                                    href="../../../../2012/10/02/why-doctest-js-is-better-than-pythons-doctest/comment-page-1/index.html#comment-195321"
                                    >Why doctest.js is better than
                                    Python&#8217;s doctest</a
                                >
                            </li>
                            <li class="recentcomments">
                                <a
                                    href="http://benjiyork.com"
                                    rel="external nofollow"
                                    class="url"
                                    >Benji York</a
                                >
                                on
                                <a
                                    href="../../../../2012/10/02/why-doctest-js-is-better-than-pythons-doctest/comment-page-1/index.html#comment-195320"
                                    >Why doctest.js is better than
                                    Python&#8217;s doctest</a
                                >
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>

            <div id="footer">
                <p>
                    &copy; 2013 Ian Bicking<!--
Does this commenting make me evil?
			|
			Thanks, <a href="http://wordpress.org/" title="WordPress">WordPress</a>
			|
			<a href="http://www.plaintxt.org/themes/barthelme/" title="Barthelme for WordPress" rel="follow">Barthelme</a> theme by <a href="http://scottwallick.com/" title="scottwallick.com" rel="follow">Scott</a>
			| <!-- The following is a link to the theme author's sponsor. Please consider its smallness and that Scott was nice enough to make this theme publically available. -->
                    Sponsor:
                    <a
                        href="http://www.active-sandals.com/womreefsan.html"
                        title="Support: Reef Sandals"
                        >Reef Sandals</a
                    >
                    | Valid
                    <a
                        href="http://validator.w3.org/check?uri=http://blog.ianbicking.org&amp;outline=1&amp;verbose=1"
                        title="Valid XHTML 1.0 Strict"
                        rel="nofollow"
                        >XHTML</a
                    >
                    &amp;
                    <a
                        href="http://jigsaw.w3.org/css-validator/validator?uri=https://ianbicking.org/wp-content/themes/Barthelme-ianb/style.css&amp;profile=css2&amp;warning=no"
                        title="Valid CSS"
                        rel="nofollow"
                        >CSS</a
                    >
                    | --> RSS:
                    <a
                        href="../../../../feed/rss/index.html"
                        title="Ian Bicking: a blog RSS 2.0 (XML) Feed"
                        rel="alternate"
                        type="application/rss+xml"
                        >Posts</a
                    >
                    &amp;
                    <a
                        href="../../../../comments/feed/index.html"
                        title="Ian Bicking: a blog Comments RSS 2.0 (XML) Feed"
                        rel="alternate"
                        type="application/rss+xml"
                        >Comments</a
                    >
                </p>
            </div>
        </div>
        <!-- END WRAPPER -->

        <!-- Somehow 41 queries occured in 1.824 seconds. Magic! -->
        <!-- The "Barthelme" theme copyright (c) 2006 Scott Allan Wallick - http://www.plaintxt.org/themes/ -->

        <!-- Google Analytics -->
        <script
            src="http://www.google-analytics.com/urchin.js"
            type="text/javascript"
        ></script>
        <script type="text/javascript">
            _uacct = "UA-2442258-1";
            urchinTracker();
        </script>
    </body>
</html>
