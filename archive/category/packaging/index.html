<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <!-- MOBIFY - DO NOT ALTER - PASTE IMMEDIATELY AFTER OPENING HEAD TAG -->
        <script type="text/javascript">
            /*<![CDATA[*/ (function (a) {
                function b(a, b) {
                    if (+a) return ~a || (d.cookie = h + "=; path=/");
                    (j = d.createElement(e)),
                        (k = d.getElementsByTagName(e)[0]),
                        (j.src = a),
                        b && (j.onload = j.onerror = b),
                        k.parentNode.insertBefore(j, k);
                }
                function c() {
                    n.api || b(l.shift() || -1, c);
                }
                if (this.Mobify) return;
                var d = document,
                    e = "script",
                    f = "mobify",
                    g = "." + f + ".com/",
                    h = f + "-path",
                    i = g + "un" + f + ".js",
                    j,
                    k,
                    l = [!1, 1],
                    m,
                    n = (this.Mobify = {
                        points: [+new Date()],
                        tagVersion: [6, 0],
                    }),
                    o = /(; |#|&|^)mobify-path=([^&;]*)/g.exec(
                        location.hash + "; " + d.cookie
                    );
                o
                    ? (m = o[2]) &&
                      !+(m = sessionStorage[h] || m) &&
                      (l = [!0, "//preview" + g + escape(m)])
                    : ((l = a() || l),
                      l[0] && l.push("//cdn" + i, "//files01" + i)),
                    l.shift()
                        ? (d.write('<plaintext style="display:none;">'),
                          setTimeout(c))
                        : b(l[0]);
            })(function () {
                if (
                    /ip(hone|od)|android.*(mobile)|blackberry.*applewebkit/i.test(
                        navigator.userAgent
                    )
                ) {
                    return [
                        1,
                        "//cdn.mobify.com/sites/ians-blog/production/mobify.js",
                    ];
                }
            }); /*]]>*/
        </script>
        <!-- END MOBIFY -->
        <title>Ian Bicking: a blog :: Packaging</title>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
        <meta name="generator" content="WordPress 3.4.2" />
        <!-- LEAVE FOR STATS -->
        <meta name="description" content="" />
        <link
            rel="stylesheet"
            title="plaintxtSimpler"
            href="../../wp-content/themes/Barthelme-ianb/style.css"
            type="text/css"
            media="all"
        />
        <link rel="start" href="../../index.html" title="Ian Bicking: a blog" />
        <link
            rel="alternate"
            type="application/atom+xml"
            title="Ian Bicking: a blog Atom Feed"
            href="../../feed/atom/index.html"
        />
        <link
            rel="alternate"
            type="application/rss+xml"
            title="Ian Bicking: a blog RSS 2.0 Feed"
            href="../../feed/rss/index.html"
        />
        <link
            rel="alternate"
            type="application/rss+xml"
            title="Ian Bicking: a blog Comments RSS 2.0 Feed"
            href="../../comments/feed/index.html"
        />
        <link
            rel="alternate"
            type="application/rdf+xml"
            title="Ian Bicking: a blog RSS 1.0"
            href="../../feed/rdf/index.html"
        />
        <link
            rel="alternate"
            type="text/xml"
            title="Ian Bicking: a blog RSS 0.92 Feed"
            href="../../feed/rss/index.html"
        />

        <link
            rel="archives"
            title="October 2012"
            href="../../2012/10/index.html"
        />
        <link
            rel="archives"
            title="February 2012"
            href="../../2012/02/index.html"
        />
        <link
            rel="archives"
            title="April 2011"
            href="../../2011/04/index.html"
        />
        <link
            rel="archives"
            title="March 2011"
            href="../../2011/03/index.html"
        />
        <link
            rel="archives"
            title="September 2010"
            href="../../2010/09/index.html"
        />
        <link
            rel="archives"
            title="August 2010"
            href="../../2010/08/index.html"
        />
        <link rel="archives" title="May 2010" href="../../2010/05/index.html" />
        <link
            rel="archives"
            title="April 2010"
            href="../../2010/04/index.html"
        />
        <link
            rel="archives"
            title="March 2010"
            href="../../2010/03/index.html"
        />
        <link
            rel="archives"
            title="February 2010"
            href="../../2010/02/index.html"
        />
        <link
            rel="archives"
            title="January 2010"
            href="../../2010/01/index.html"
        />
        <link
            rel="archives"
            title="September 2009"
            href="../../2009/09/index.html"
        />
        <link rel="archives" title="May 2009" href="../../2009/05/index.html" />
        <link
            rel="archives"
            title="April 2009"
            href="../../2009/04/index.html"
        />
        <link
            rel="archives"
            title="January 2009"
            href="../../2009/01/index.html"
        />
        <link
            rel="archives"
            title="December 2008"
            href="../../2008/12/index.html"
        />
        <link
            rel="archives"
            title="November 2008"
            href="../../2008/11/index.html"
        />
        <link
            rel="archives"
            title="October 2008"
            href="../../2008/10/index.html"
        />
        <link
            rel="archives"
            title="September 2008"
            href="../../2008/09/index.html"
        />
        <link
            rel="archives"
            title="August 2008"
            href="../../2008/08/index.html"
        />
        <link
            rel="archives"
            title="July 2008"
            href="../../2008/07/index.html"
        />
        <link
            rel="archives"
            title="June 2008"
            href="../../2008/06/index.html"
        />
        <link rel="archives" title="May 2008" href="../../2008/05/index.html" />
        <link
            rel="archives"
            title="April 2008"
            href="../../2008/04/index.html"
        />
        <link
            rel="archives"
            title="March 2008"
            href="../../2008/03/index.html"
        />
        <link
            rel="archives"
            title="February 2008"
            href="../../2008/02/index.html"
        />
        <link
            rel="archives"
            title="January 2008"
            href="../../2008/01/index.html"
        />
        <link
            rel="archives"
            title="November 2007"
            href="../../2007/11/index.html"
        />
        <link
            rel="archives"
            title="October 2007"
            href="../../2007/10/index.html"
        />
        <link
            rel="archives"
            title="September 2007"
            href="../../2007/09/index.html"
        />
        <link
            rel="archives"
            title="August 2007"
            href="../../2007/08/index.html"
        />
        <link
            rel="archives"
            title="July 2007"
            href="../../2007/07/index.html"
        />
        <link
            rel="alternate"
            type="application/rss+xml"
            title="Ian Bicking: a blog &raquo; Packaging Category Feed"
            href="feed/index.html"
        />
        <link
            rel="EditURI"
            type="application/rsd+xml"
            title="RSD"
            href="../../xmlrpc.php?rsd"
        />
        <link
            rel="wlwmanifest"
            type="application/wlwmanifest+xml"
            href="../../wp-includes/wlwmanifest.xml"
        />
        <meta name="generator" content="WordPress 3.4.2" />
        <link
            rel="stylesheet"
            href="../../wp-content/plugins/source-code-syntax-highlighting-plugin-for-wordpress/geshi.css"
            type="text/css"
        />
        <style type="text/css">
            .recentcomments a {
                display: inline !important;
                padding: 0 !important;
                margin: 0 !important;
            }
        </style>
        <style type="text/css" media="all">
            /*<![CDATA[*/
            body {
                font-size: 100%;
            }
            body {
                font-family: tahoma, geneva, sans-serif;
            }
            div.post-header,
            h2.post-title,
            p.post-date-single,
            h2.post-title-single,
            div.post-entry h1,
            div.post-entry h2,
            div.post-entry h3,
            div.post-entry h4,
            div.post-entry h5,
            div.post-entry h6,
            div.post-entry blockquote,
            div.post-footer,
            h3#comment-count,
            h4#comment-header,
            div#comments ol li p.comment-metadata,
            h4#respond {
                font-family: verdana, geneva, sans-serif;
            }
            div.post-entry p {
                text-align: left;
            }
            div#wrapper {
                width: 100%;
            }

            /*]]>*/
        </style>
    </head>
    <body>
        <div id="wrapper">
            <div
                id="header"
                onclick="location.href='https://ianbicking.org/';"
                style="cursor: pointer"
            >
                <h1 id="title">
                    <a href="../../index.html" title="Ian Bicking: a blog"
                        >Ian Bicking: a blog</a
                    >
                </h1>
                <p id="description"></p>
            </div>
            <!-- WP Theme Credits -->
            <div style="display: none">
                We can answer on question
                <a href="http://www.olnevhost.net/vps-hosting.html"
                    >what is VPS</a
                >? and what is
                <a href="http://www.olnevhost.net/dedicated-servers.html"
                    ><strong>cheap dedicated servers</strong></a
                >?
            </div>
            <!-- END HEADER -->
            <div id="container">
                <div id="content" class="narrowcolumn">
                    <p class="post-date-single">{ Category Archives }</p>
                    <h2 class="post-title-single">Packaging</h2>

                    <div id="post-283" class="post">
                        <div class="post-container">
                            <div class="post-content">
                                <h2 class="post-title">
                                    <a
                                        href="../../index.html?p=283"
                                        title="Permalink to Python Application Package"
                                        rel="bookmark"
                                        >Python Application Package</a
                                    >
                                </h2>
                                <div class="post-entry">
                                    <div class="document">
                                        <p>
                                            I&#8217;ve been thinking some more
                                            about deployment of Python web
                                            applications, and deployment in
                                            general (in part leading up to the
                                            <a
                                                class="reference external"
                                                href="https://us.pycon.org/2012/community/WebDevSummit/"
                                                >Web Summit</a
                                            >). And I&#8217;ve got an idea.
                                        </p>
                                        <p>
                                            I
                                            <a
                                                class="reference external"
                                                href="../../index.html?p=250"
                                                >wrote about this about a year
                                                ago</a
                                            >
                                            and
                                            <a
                                                class="reference external"
                                                href="https://github.com/ianb/pywebapp/blob/master/docs/spec.txt"
                                                >recently revised some notes on
                                                a proposal</a
                                            >
                                            but I&#8217;ve been thinking about
                                            something a bit more basic: a way to
                                            simply ship server applications,
                                            bundles of code. Web applications
                                            are just one use case for this.
                                        </p>
                                        <p>
                                            For now lets call this a
                                            &quot;Python application
                                            package&quot;. It has these
                                            features:
                                        </p>
                                        <ol class="arabic simple">
                                            <li>
                                                There is an
                                                <em>application description</em
                                                >: this tells the
                                                <em>environment</em> about the
                                                application. (This is sometimes
                                                called &quot;configuration&quot;
                                                but that term is very confusing
                                                and overloaded; I think
                                                &quot;description&quot; is much
                                                clearer.)
                                            </li>
                                            <li>
                                                Given the description, you can
                                                create an execution environment
                                                to run code from the application
                                                and acquire objects from the
                                                application. So there would be a
                                                specific way to setup
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >sys.path</span
                                                    ></tt
                                                >, and a way to indicate any
                                                libraries that are required but
                                                not bundled directly with the
                                                application.
                                            </li>
                                            <li>
                                                The environment can inject
                                                information into the
                                                application. (Also this sort of
                                                thing is sometimes called
                                                &quot;configuration&quot;, but
                                                let&#8217;s not do that either.)
                                                This is where the environment
                                                could indicate, for instance,
                                                what database the application
                                                should connect to (host,
                                                username, etc).
                                            </li>
                                            <li>
                                                There would be a way to run
                                                commands and get objects from
                                                the application. The environment
                                                would look in the application
                                                description to get the names of
                                                commands or objects, and use
                                                them in some specific manner
                                                depending on the purpose of the
                                                application. For instance, WSGI
                                                web applications would point the
                                                environment to an application
                                                object. A Tornado application
                                                might simply have a command to
                                                start itself (with the
                                                environment indicating what port
                                                to use through its injection).
                                            </li>
                                        </ol>
                                        <p>
                                            There&#8217;s a lot of things you
                                            can build from these pieces, and in
                                            a sophisticated application you
                                            might use a bunch of them at once.
                                            You might have some WSGI, maybe a
                                            seperate non-WSGI server to handle
                                            Web Sockets, something for a Celery
                                            queue, a way to accept incoming
                                            email, etc. In pretty much all cases
                                            I think basic application lifecycle
                                            is needed: commands to run when an
                                            application is first installed,
                                            something to verify the environment
                                            is acceptable, when you want to back
                                            up its data, when you want to
                                            uninstall it.
                                        </p>
                                        <p>
                                            There&#8217;s also some things that
                                            all environments should setup the
                                            same or inject into the application.
                                            E.g.,
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >$TMPDIR</span
                                                ></tt
                                            >
                                            should point to a place where the
                                            application can keep its temporary
                                            files. Or, every application should
                                            have a directory (perhaps specified
                                            in another environmental variable)
                                            where it can write log files.
                                        </p>
                                        <div class="section" id="details">
                                            <h2>Details?</h2>
                                            <p>
                                                To get more concrete,
                                                here&#8217;s what I can imagine
                                                from a small application
                                                description; probably YAML would
                                                be a good format:
                                            </p>
                                            <div
                                                class="dean_ch"
                                                style="white-space: wrap"
                                            >
                                                <br />
                                                <span class="kw3">platform</span
                                                >: python, wsgi<br />
                                                require:<br />
                                                &nbsp;
                                                <span class="kw3">os</span>:
                                                <span class="kw3">posix</span
                                                ><br />
                                                &nbsp; python: &lt;<span
                                                    class="nu0"
                                                    >3</span
                                                ><br />
                                                &nbsp; rpm: m2crypto<br />
                                                &nbsp; deb: python-m2crypto<br />
                                                &nbsp; pip: requirements.<span
                                                    class="me1"
                                                    >txt</span
                                                ><br />
                                                python:<br />
                                                &nbsp; paths: vendor/<br />
                                                wsgi:<br />
                                                &nbsp; app: myapp.<span
                                                    class="me1"
                                                    >wsgiapp</span
                                                >:application<br />
                                                &nbsp;
                                            </div>
                                            <p>
                                                I imagine
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >platform</span
                                                    ></tt
                                                >
                                                as kind of a series of mixins.
                                                This system doesn&#8217;t really
                                                need to be Python-specific; when
                                                creating something similar for
                                                <a
                                                    class="reference external"
                                                    href="http://cloudsilverlining.org"
                                                    >Silver Lining</a
                                                >
                                                I found PHP support relatively
                                                easy to add (handling languages
                                                that aren&#8217;t naturally
                                                portable, like Go, might be more
                                                of a stretch). So
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >python</span
                                                    ></tt
                                                >
                                                is one of the features this
                                                application uses. You can
                                                imagine lots of modularization
                                                for other features, but it would
                                                be easy and unproductive to get
                                                distracted by that.
                                            </p>
                                            <p>
                                                The application has certain
                                                requirements of its environment,
                                                like the version of Python and
                                                the general OS type. The
                                                application might also require
                                                libraries, ideally one libraries
                                                that are not portable (M2Crypto
                                                being an example). Modern
                                                package management works pretty
                                                nicely for this stuff, so
                                                relying on system packages as a
                                                first try I believe is best
                                                (I&#8217;d offer
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >requirements.txt</span
                                                    ></tt
                                                >
                                                as a fallback, not as the
                                                primary way to handle
                                                dependencies).
                                            </p>
                                            <p>
                                                I think it&#8217;s much more
                                                reliable if applications
                                                primarily rely on bundling their
                                                dependencies directly (i.e.,
                                                using a vendor directory). The
                                                tool support for this is a bit
                                                spotty, but I believe this
                                                package format could clarify the
                                                problems and solutions.
                                                <a
                                                    class="reference external"
                                                    href="https://gist.github.com/1368649"
                                                    >Here is an example</a
                                                >
                                                of how you might set up a
                                                virtualenv environment for
                                                <em>managing</em> vendor
                                                libraries (you then do not need
                                                virtualenv to <em>use</em> those
                                                same libraries), and do so in a
                                                way where you can check the
                                                results into source control.
                                                It&#8217;s kind of complicated,
                                                but works (well, almost works
                                                &#8211;
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >bin/</span
                                                    ></tt
                                                >
                                                files need fixing up).
                                                It&#8217;s a start at least.
                                            </p>
                                        </div>
                                        <div
                                            class="section"
                                            id="support-library"
                                        >
                                            <h2>Support Library</h2>
                                            <p>
                                                On the environment side we need
                                                a good support library.
                                                <a
                                                    class="reference external"
                                                    href="https://github.com/ianb/pywebapp/"
                                                    >pywebapp</a
                                                >
                                                has some of the basic features,
                                                though it is quite incomplete. I
                                                imagine a library looking
                                                something like this:
                                            </p>
                                            <div
                                                class="dean_ch"
                                                style="white-space: wrap"
                                            >
                                                <br />
                                                <span class="kw1">from</span>
                                                apppackage
                                                <span class="kw1">import</span>
                                                AppPackage<br />
                                                app = AppPackage<span
                                                    class="br0"
                                                    >&#40;</span
                                                ><span class="st0"
                                                    >'/var/apps/app1.2012.02.11'</span
                                                ><span class="br0">&#41;</span
                                                ><br />
                                                <span class="co1"
                                                    ># Maybe a little Debian
                                                    support directly:</span
                                                ><br />
                                                <span class="kw3"
                                                    >subprocess</span
                                                >.<span class="me1">call</span
                                                ><span class="br0">&#40;</span
                                                ><span class="br0">&#91;</span
                                                ><span class="st0"
                                                    >'apt-get'</span
                                                >,
                                                <span class="st0"
                                                    >'install'</span
                                                ><span class="br0">&#93;</span>
                                                +<br />
                                                &nbsp; &nbsp; &nbsp; &nbsp;
                                                &nbsp; &nbsp; &nbsp; &nbsp;
                                                app.<span class="me1"
                                                    >config</span
                                                ><span class="br0">&#91;</span
                                                ><span class="st0"
                                                    >'require'</span
                                                ><span class="br0">&#93;</span
                                                ><span class="br0">&#91;</span
                                                ><span class="st0">'deb'</span
                                                ><span class="br0">&#93;</span
                                                ><span class="br0">&#41;</span
                                                ><br />
                                                <span class="co1"
                                                    ># Or fall back of
                                                    virtualenv/pip</span
                                                ><br />
                                                app.<span class="me1"
                                                    >create_virtualenv</span
                                                ><span class="br0">&#40;</span
                                                ><span class="st0"
                                                    >'/var/app/venvs/app1.2012.02.11'</span
                                                ><span class="br0">&#41;</span
                                                ><br />
                                                app.<span class="me1"
                                                    >install_pip_requirements</span
                                                ><span class="br0">&#40;</span
                                                ><span class="br0">&#41;</span
                                                ><br />
                                                wsgi_app = app.<span class="me1"
                                                    >load_object</span
                                                ><span class="br0">&#40;</span
                                                >app.<span class="me1"
                                                    >config</span
                                                ><span class="br0">&#91;</span
                                                ><span class="st0">'wsgi'</span
                                                ><span class="br0">&#93;</span
                                                ><span class="br0">&#91;</span
                                                ><span class="st0">'app'</span
                                                ><span class="br0">&#93;</span
                                                ><span class="br0">&#41;</span
                                                ><br />
                                                &nbsp;
                                            </div>
                                            <p>
                                                You can imagine building hosting
                                                services on this sort of thing,
                                                or setting up continuous
                                                integration servers (<tt
                                                    class="docutils literal"
                                                    ><span class="pre"
                                                        >app.run_command(app.config['unit_test'])</span
                                                    ></tt
                                                >), and so forth.
                                            </p>
                                        </div>
                                        <div
                                            class="section"
                                            id="local-development"
                                        >
                                            <h2>Local Development</h2>
                                            <p>
                                                If designed properly, I think
                                                this format is as usable for
                                                local development as it is for
                                                deployment. It should be able to
                                                run directly from a checkout,
                                                with the &quot;development
                                                environment&quot; being an
                                                environment just like any other.
                                            </p>
                                            <p>
                                                This rules out, or at least
                                                makes less exciting, the use of
                                                zip files or tarballs as a
                                                package format. The only
                                                justification I see for using
                                                such archives is that they are
                                                easy to move around; but we live
                                                in the FUTURE and there are many
                                                ways to move directories around
                                                and we don&#8217;t need to cater
                                                to silly old fashions. If that
                                                means a script that creates a
                                                tarball, FTPs it to another
                                                computer, and there it is
                                                unzipped, then fine &#8211; this
                                                format
                                                <em>should not</em> specify
                                                anything about how you actually
                                                deliver the files. But
                                                let&#8217;s not worry about
                                                copying
                                                <a
                                                    class="reference external"
                                                    href="http://en.wikipedia.org/wiki/WAR_file_format_%28Sun%29"
                                                    >WARs</a
                                                >.
                                            </p>
                                        </div>
                                    </div>
                                    <!-- <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="https://ianbicking.org/2012/02/29/python-application-package/"
    dc:identifier="https://ianbicking.org/2012/02/29/python-application-package/"
    dc:title="Python Application Package"
    trackback:ping="https://ianbicking.org/2012/02/29/python-application-package/trackback/" />
</rdf:RDF> -->
                                </div>
                                <!-- END POST-ENTRY -->
                            </div>
                            <!-- END POST-CONTENT  -->
                        </div>
                        <!-- END-CONTAINER -->
                        <div class="post-header">
                            <h3 class="post-date">2012 02 29</h3>
                            <p class="post-categories">
                                <a
                                    href="index.html"
                                    title="View all posts in Packaging"
                                    rel="category tag"
                                    >Packaging</a
                                ><br /><a
                                    href="../python/index.html"
                                    title="View all posts in Python"
                                    rel="category tag"
                                    >Python</a
                                ><br /><a
                                    href="../silverlining.1"
                                    title="View all posts in Silver Lining"
                                    rel="category tag"
                                    >Silver Lining</a
                                ><br /><a
                                    href="../web/index.html"
                                    title="View all posts in Web"
                                    rel="category tag"
                                    >Web</a
                                >
                            </p>
                            <p class="post-comments">
                                <a
                                    href="../../index.html?p=283#comments"
                                    title="Comment on Python Application Package"
                                    >Comments (9)</a
                                >
                            </p>
                            <p class="post-permalink">
                                <a
                                    href="../../index.html?p=283"
                                    title="Permalink to Python Application Package"
                                    rel="permalink"
                                    >Permalink</a
                                >
                            </p>
                        </div>
                        <!-- END POST-FOOTER -->
                    </div>
                    <!-- END POST -->

                    <div id="post-250" class="post">
                        <div class="post-container">
                            <div class="post-content">
                                <h2 class="post-title">
                                    <a
                                        href="../../index.html?p=250"
                                        title="Permalink to A Python Web Application Package and Format (we should make one)"
                                        rel="bookmark"
                                        >A Python Web Application Package and
                                        Format (we should make one)</a
                                    >
                                </h2>
                                <div class="post-entry">
                                    <div class="document">
                                        <p>
                                            At PyCon there was an open space
                                            about deployment, and the idea of
                                            drop-in applications
                                            (Java-WAR-style).
                                        </p>
                                        <p>
                                            I generally get pessimistic about
                                            80% solutions, and dropping in a WAR
                                            file feels like an 80% solution to
                                            me. I&#8217;ve used the
                                            Hudson/Jenkins installer (which I
                                            think is <em>specifically</em> a
                                            project that got WARs on
                                            people&#8217;s minds), and in a lot
                                            of ways that installer is nice, but
                                            it&#8217;s also kind of wonky, it
                                            makes configuration unclear,
                                            it&#8217;s not always clear when it
                                            installs or configures itself
                                            through the web, and when you have
                                            to do this at the system level, nor
                                            is it clear where it puts files and
                                            data, etc. So a great initial
                                            experience doesn&#8217;t feel like a
                                            great ongoing experience to me
                                            &#8212; and
                                            <em
                                                >it doesn&#8217;t have to be
                                                that way</em
                                            >. If those were
                                            <em>necessary</em> compromises,
                                            sure, but they aren&#8217;t. And
                                            because we
                                            <em>don&#8217;t have</em> WAR files,
                                            if we&#8217;re proposing to make
                                            something new, then we have every
                                            opportunity to make things better.
                                        </p>
                                        <p>
                                            So the question then is what
                                            we&#8217;re trying to make. To me:
                                            we want applications that are easy
                                            to install, that are
                                            self-describing, self-configuring
                                            (or at least guide you through
                                            configuration), reliable with
                                            respect to their environment (not
                                            dependent on system tweaking),
                                            upgradable, and respectful of
                                            persistence (the data that outlives
                                            the application install). A lot of
                                            this can be done by the
                                            &quot;container&quot; (to use Java
                                            parlance; or
                                            &quot;environment&quot;) &#8212; if
                                            you just have the app packaged in a
                                            nice way, the container (server
                                            environment, hosting service, etc)
                                            can handle all the system-specific
                                            things to make the application
                                            actually work.
                                        </p>
                                        <p>
                                            At which point I am of course
                                            reminded of my
                                            <a
                                                class="reference external"
                                                href="http://cloudsilverlining.org"
                                                >Silver Lining</a
                                            >
                                            project, which defines something
                                            very much like this. Silver Lining
                                            isn&#8217;t <em>just</em> an
                                            application format, and things
                                            aren&#8217;t fully extracted along
                                            these lines, but it&#8217;s pretty
                                            close and it addresses a lot of
                                            important issues in the lifecycle of
                                            an application. To be clear: Silver
                                            Lining is an application packaging
                                            format, a server configuration
                                            library, a cloud server management
                                            tool, a persistence management tool,
                                            and a tool to manage the application
                                            with respect to all these services
                                            over time. It is a bunch of things,
                                            maybe too many things, so it is not
                                            unreasonable to pick out a smaller
                                            subset to focus on. Maybe an easy
                                            place to start (and good for Silver
                                            Lining itself) would be to separate
                                            at least the application format (and
                                            tools to manage applications in that
                                            state, e.g., installing new
                                            libraries) from the tools that make
                                            use of such applications (deploy,
                                            etc).
                                        </p>
                                        <p>
                                            Some opinions I have on this format,
                                            exemplified in Silver Lining:
                                        </p>
                                        <ul class="simple">
                                            <li>
                                                It&#8217;s not zipped or a
                                                single file, unlike WARs.
                                                Uploading zip files is not a
                                                great API. Geez. I know
                                                there&#8217;s this desire to
                                                &quot;just drop in a file&quot;;
                                                but there&#8217;s no getting
                                                around the fact that
                                                &quot;dropping a file&quot;
                                                becomes a
                                                <em>deployment protocol</em>
                                                <strong>and</strong>
                                                <em
                                                    >it&#8217;s an incredibly
                                                    impoverished protocol</em
                                                >. The format is also not subtly
                                                git-based (ala Heroku) because
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >git</span
                                                    >
                                                    <span class="pre"
                                                        >push</span
                                                    ></tt
                                                >
                                                is not a good deployment
                                                protocol.
                                            </li>
                                            <li>
                                                But of course there isn&#8217;t
                                                really any deployment protocol
                                                inferred by a format anyway, so
                                                maybe I&#8217;m getting ahead of
                                                myself ;) I&#8217;m saying a
                                                tool that deploys should take as
                                                an argument a directory, not a
                                                single file. (If the tool then
                                                zips it up and uploads it,
                                                fine!)
                                            </li>
                                            <li>
                                                Configuration &quot;comes from
                                                the outside&quot;. That is, an
                                                application requests services,
                                                and the <em>container</em> tells
                                                the application where those
                                                services are. For Silver Lining
                                                I&#8217;ve used environmental
                                                variables. I think this one
                                                point is really important
                                                &#8212; the container
                                                <em>tells</em> the application.
                                                As a counter-example, an
                                                application that comes with a
                                                Puppet deployment recipe is
                                                essentially <em>telling</em> the
                                                server how to arrange itself to
                                                suit the application. This will
                                                never be reliable or simple!
                                            </li>
                                            <li>
                                                The application indicates what
                                                &quot;services&quot; it wants;
                                                for instance, it may want to
                                                have access to a MySQL database.
                                                The container then provides this
                                                to the application. In practice
                                                this means installing the actual
                                                packages, but also creating a
                                                database and setting up
                                                permissions appropriately. The
                                                alternative is never having
                                                <em>any</em> dependencies,
                                                meaning you have to use SQLite
                                                databases or ad hoc structures,
                                                etc. But in fact installing
                                                databases really isn&#8217;t
                                                that hard these days.
                                            </li>
                                            <li>
                                                <em>All</em> persistence has to
                                                use a service of some kind. If
                                                you want to be able to write to
                                                files, you need to use a file
                                                service. This means the
                                                container is fully aware of
                                                everything the application is
                                                leaving behind. All the various
                                                paths an application should use
                                                are given in different
                                                environmental variables (many of
                                                which don&#8217;t need to be
                                                invented anew, e.g.,
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >$TMPDIR</span
                                                    ></tt
                                                >).
                                            </li>
                                            <li>
                                                It uses vendor libraries
                                                exclusively for Python
                                                libraries. That means the
                                                application bundles all the
                                                libraries it requires. Nothing
                                                ever gets installed at
                                                deploy-time. This is in contrast
                                                to using a
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >requirements.txt</span
                                                    ></tt
                                                >
                                                list of packages at deployment
                                                time. If you want to use those
                                                tools for development
                                                that&#8217;s fine, just not for
                                                deployment.
                                            </li>
                                            <li>
                                                There <em>is</em> also a way to
                                                indicate other libraries you
                                                might require; e.g., you might
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >lxml</span
                                                    ></tt
                                                >, or even something that
                                                isn&#8217;t quite a library,
                                                like
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >git</span
                                                    ></tt
                                                >
                                                (if you are making a github
                                                clone). You can&#8217;t do those
                                                as vendor libraries (they
                                                include non-portable binaries).
                                                Currently in Silver Lining the
                                                application description can
                                                contain a list of Ubuntu package
                                                names to install. Of course that
                                                would have to be abstracted
                                                some.
                                            </li>
                                            <li>
                                                You can ask for scripts or a
                                                request to be invoked for an
                                                application after an
                                                installation or deployment.
                                                It&#8217;s lame to try to test
                                                if is-this-app-installed on
                                                <em>every</em> request, which is
                                                the frequent alternative. Also,
                                                it gives the application the
                                                chance to signal that the
                                                installation failed.
                                            </li>
                                            <li>
                                                It has a very simple
                                                (possibly/probably too simple)
                                                sense of configuration. You
                                                don&#8217;t have to use this if
                                                you make your app
                                                self-configuring (i.e., build in
                                                a web-accessible settings
                                                screen), but in practice it felt
                                                like some simple sense of
                                                configuration would be helpful.
                                            </li>
                                        </ul>
                                        <p>Things that could be improved:</p>
                                        <ul class="simple">
                                            <li>
                                                There are some places where you
                                                might be encouraged to use
                                                routines from the
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >silversupport</span
                                                    ></tt
                                                >
                                                package. There are very few! But
                                                maybe an alternative could be
                                                provided for these cases.
                                            </li>
                                            <li>
                                                A little
                                                convention-over-configuration is
                                                probably suitable for the
                                                bundled libraries; silver
                                                includes tools to manage things,
                                                but it gets a little twisty.
                                                When creating a new project I
                                                find myself creating several
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >.pth</span
                                                    ></tt
                                                >
                                                files, special customizing
                                                modules, etc. Managing vendor
                                                libraries is also not obvious.
                                            </li>
                                            <li>
                                                <a
                                                    class="reference external"
                                                    href="http://cloudsilverlining.org/services.html"
                                                    >Services</a
                                                >
                                                are IMHO quite important and
                                                useful, but also need to be
                                                carefully specified.
                                            </li>
                                            <li>
                                                There&#8217;s a bunch of runtime
                                                expectations that aren&#8217;t
                                                part of the format, but in
                                                practice would be part of how
                                                the application is written. For
                                                instance, I make sure each app
                                                has its own temporary directory,
                                                and that it is cleared on
                                                update. If you keep session
                                                files in that location, and you
                                                expect the environment to clean
                                                up old sessions &#8212; well,
                                                either all environments should
                                                do that, or none should.
                                            </li>
                                            <li>
                                                The process model is not
                                                entirely clear. I tried to
                                                simply define one process model
                                                (unthreaded, multiple
                                                processes), but I&#8217;m not
                                                sure that&#8217;s suitable
                                                &#8212; most notably, multiple
                                                processes have a significant
                                                memory impact compared to
                                                threads. An application should
                                                at least be able to indicate
                                                what process models it accepts
                                                and prefers.
                                            </li>
                                            <li>
                                                Static files are
                                                <em>all</em> convention over
                                                configuration &#8212; you put
                                                static files under
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >static/</span
                                                    ></tt
                                                >
                                                and then they are available. So
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >static/style.css</span
                                                    ></tt
                                                >
                                                would be at
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >/style.css</span
                                                    ></tt
                                                >. I think this is generally
                                                <em>good</em>, but putting all
                                                static files under one URL path
                                                (e.g.,
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >/media/</span
                                                    ></tt
                                                >) can be good for other reasons
                                                as well. Maybe there should be
                                                conventions for both.
                                            </li>
                                            <li>
                                                Cron jobs are important. Though
                                                maybe they could just be yet
                                                another kind of service? Many
                                                extra features could be new
                                                services.
                                            </li>
                                            <li>
                                                Logging is also important;
                                                Silver Lining attempts to handle
                                                that somewhat, but it could be
                                                specified much better.
                                            </li>
                                            <li>
                                                Silver Lining also supports PHP,
                                                which seemed to cause a bit of
                                                stress. But just ignore that.
                                                It&#8217;s really easy to
                                                ignore.
                                            </li>
                                        </ul>
                                        <p>
                                            There is a
                                            <a
                                                class="reference external"
                                                href="http://cloudsilverlining.org/appconfig.html"
                                                >description of the
                                                configuration file for apps</a
                                            >. The
                                            <a
                                                class="reference external"
                                                href="http://cloudsilverlining.org/envvariables.html"
                                                >environmental variables</a
                                            >
                                            are also notably part of the
                                            application&#8217;s expectations.
                                            The file layout is explained
                                            (together with a bunch of Silver
                                            Lining-specific concepts) in
                                            <a
                                                class="reference external"
                                                href="http://cloudsilverlining.org/devpatterns.html"
                                                >Development Patterns</a
                                            >. Besides all that there is
                                            admittedly some other stuff that is
                                            only really specified in code; but
                                            in Silver Lining&#8217;s defense,
                                            specified in code is better than
                                            unspecified ;) App Engine provides
                                            another example of an application
                                            format, and would be worth using as
                                            a point of discussion or contrast (I
                                            did that myself when writing Silver
                                            Lining).
                                        </p>
                                        <p>
                                            Discussing WSGI stuff with Ben
                                            Bangert at PyCon he noted that he
                                            didn&#8217;t really feel like the
                                            WSGI pieces needed that much more
                                            work, or at least that&#8217;s not
                                            where the interesting work was
                                            &#8212; the interesting work is in
                                            the tooling. An application format
                                            could provide a great basis for
                                            building this tooling. And I
                                            honestly think that the tooling has
                                            been held back more by divergent
                                            patterns of development than by the
                                            difficulty of writing the tools
                                            themselves; and a good, general
                                            application format could fix that.
                                        </p>
                                    </div>
                                    <!-- <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="https://ianbicking.org/2011/03/31/python-webapp-package/"
    dc:identifier="https://ianbicking.org/2011/03/31/python-webapp-package/"
    dc:title="A Python Web Application Package and Format (we should make one)"
    trackback:ping="https://ianbicking.org/2011/03/31/python-webapp-package/trackback/" />
</rdf:RDF> -->
                                </div>
                                <!-- END POST-ENTRY -->
                            </div>
                            <!-- END POST-CONTENT  -->
                        </div>
                        <!-- END-CONTAINER -->
                        <div class="post-header">
                            <h3 class="post-date">2011 03 31</h3>
                            <p class="post-categories">
                                <a
                                    href="index.html"
                                    title="View all posts in Packaging"
                                    rel="category tag"
                                    >Packaging</a
                                ><br /><a
                                    href="../programming/index.html"
                                    title="View all posts in Programming"
                                    rel="category tag"
                                    >Programming</a
                                ><br /><a
                                    href="../python/index.html"
                                    title="View all posts in Python"
                                    rel="category tag"
                                    >Python</a
                                ><br /><a
                                    href="../web/index.html"
                                    title="View all posts in Web"
                                    rel="category tag"
                                    >Web</a
                                >
                            </p>
                            <p class="post-comments">
                                <a
                                    href="../../index.html?p=250#comments"
                                    title="Comment on A Python Web Application Package and Format (we should make one)"
                                    >Comments (18)</a
                                >
                            </p>
                            <p class="post-permalink">
                                <a
                                    href="../../index.html?p=250"
                                    title="Permalink to A Python Web Application Package and Format (we should make one)"
                                    rel="permalink"
                                    >Permalink</a
                                >
                            </p>
                        </div>
                        <!-- END POST-FOOTER -->
                    </div>
                    <!-- END POST -->

                    <div id="post-220" class="post">
                        <div class="post-container">
                            <div class="post-content">
                                <h2 class="post-title">
                                    <a
                                        href="../../index.html?p=220"
                                        title="Permalink to Core Competencies, Silver Lining, Packaging"
                                        rel="bookmark"
                                        >Core Competencies, Silver Lining,
                                        Packaging</a
                                    >
                                </h2>
                                <div class="post-entry">
                                    <div class="document">
                                        <p>
                                            I&#8217;ve been leaning heavily on
                                            Ubuntu and Debian packages for
                                            <a
                                                class="reference external"
                                                href="http://cloudsilverlining.org"
                                                >Silver Lining</a
                                            >. Lots of &quot;configuration
                                            management&quot; problems are easy
                                            when you rely on the system
                                            packages&#8230; not for any magical
                                            reason, but because the package
                                            maintainers have done the
                                            configuration management for me.
                                            This includes dependencies, but also
                                            things like starting up services in
                                            the right order, and of course
                                            upgrades and security fixes. For
                                            this reason I really want everything
                                            that isn&#8217;t part of Silver
                                            Lining&#8217;s core to be in the
                                            form of a package.
                                        </p>
                                        <p>
                                            But then, why isn&#8217;t
                                            <em>everything</em> a package?
                                            Arguably some pieces really should
                                            be, I&#8217;m just too lazy and
                                            developing those pieces too quickly
                                            to do it. But more specifically, why
                                            aren&#8217;t applications packages?
                                            It&#8217;s not the complexity really
                                            &#8212; the tool could encapsulate
                                            all the complexity of packaging if I
                                            chose. I always knew intuitively it
                                            didn&#8217;t make sense, but it took
                                            me a while to decide quite
                                            <em>why</em>.
                                        </p>
                                        <p>
                                            There are a lot of specific reasons,
                                            but the overriding reason is that I
                                            don&#8217;t want to
                                            <a
                                                class="reference external"
                                                href="http://www.joelonsoftware.com/articles/fog0000000007.html"
                                                >outsource a core function</a
                                            >. Silver Lining isn&#8217;t a tool
                                            to install database servers. That is
                                            something it does, but that&#8217;s
                                            not its purpose, and so it can
                                            install a server with
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >apt-get</span
                                                >
                                                <span class="pre">install</span>
                                                <span class="pre"
                                                    >mysql-server-5.1</span
                                                ></tt
                                            >. In doing so it&#8217;s saving a
                                            lot of work, it&#8217;s building on
                                            the knowledge of people more
                                            interested in MySQL than I, but
                                            it&#8217;s also deferring a lot of
                                            control. When it comes to actually
                                            deploying applications I&#8217;m not
                                            willing to have Silver Lining defer
                                            to another system, because deploying
                                            applications is the
                                            <em>entire point</em> of the tool.
                                        </p>
                                        <p>
                                            There are many specific reasons. I
                                            want multiple instances of an
                                            application deployed simultaneously.
                                            I can optimize the actual code
                                            delivery (using rsync) instead of
                                            delivering an entire bundle of code.
                                            The setup is specific to the
                                            environment and configuration
                                            I&#8217;ve set up on servers,
                                            it&#8217;s not a generic package
                                            that makes sense on a generic Ubuntu
                                            system. I don&#8217;t want any
                                            central repository of packages or a
                                            single place where releases have to
                                            go through. I want to allow for the
                                            possibility of multiple versions of
                                            an application running
                                            simultaneously. I&#8217;m
                                            coordinating services even as I
                                            deploy the application, something
                                            which Debian packages try to do a
                                            <em>little</em>, but don&#8217;t do
                                            consistently or well. But while
                                            there&#8217;s a list of reasons, it
                                            doesn&#8217;t matter that much
                                            &#8212; there&#8217;s no particular
                                            size of list that scared me off, and
                                            if I&#8217;m misinformed about the
                                            way packages work or if there are
                                            techniques to avoid these problems
                                            it doesn&#8217;t really matter to
                                            me&#8230; the real reason is that I
                                            don&#8217;t want to defer control
                                            over the one thing that Silver
                                            Lining <em>must</em> do well.
                                        </p>
                                    </div>
                                    <!-- <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="https://ianbicking.org/2010/04/09/core-competencies-silver-lining-packaging/"
    dc:identifier="https://ianbicking.org/2010/04/09/core-competencies-silver-lining-packaging/"
    dc:title="Core Competencies, Silver Lining, Packaging"
    trackback:ping="https://ianbicking.org/2010/04/09/core-competencies-silver-lining-packaging/trackback/" />
</rdf:RDF> -->
                                </div>
                                <!-- END POST-ENTRY -->
                            </div>
                            <!-- END POST-CONTENT  -->
                        </div>
                        <!-- END-CONTAINER -->
                        <div class="post-header">
                            <h3 class="post-date">2010 04 09</h3>
                            <p class="post-categories">
                                <a
                                    href="index.html"
                                    title="View all posts in Packaging"
                                    rel="category tag"
                                    >Packaging</a
                                ><br /><a
                                    href="../silverlining.1"
                                    title="View all posts in Silver Lining"
                                    rel="category tag"
                                    >Silver Lining</a
                                >
                            </p>
                            <p class="post-comments">
                                <span>Comments Off</span>
                            </p>
                            <p class="post-permalink">
                                <a
                                    href="../../index.html?p=220"
                                    title="Permalink to Core Competencies, Silver Lining, Packaging"
                                    rel="permalink"
                                    >Permalink</a
                                >
                            </p>
                        </div>
                        <!-- END POST-FOOTER -->
                    </div>
                    <!-- END POST -->

                    <div id="post-168" class="post">
                        <div class="post-container">
                            <div class="post-content">
                                <h2 class="post-title">
                                    <a
                                        href="../../2010/03/03/toppcloud-renamed-to-silver-lining/index.html"
                                        title="Permalink to toppcloud renamed to Silver Lining"
                                        rel="bookmark"
                                        >toppcloud renamed to Silver Lining</a
                                    >
                                </h2>
                                <div class="post-entry">
                                    <div class="document">
                                        <p>
                                            After some pondering at PyCon, I
                                            decided on a new name for toppcloud:
                                            <strong>Silver Lining</strong>.
                                            I&#8217;ll credit a mysterious
                                            commenter &quot;david&quot; with the
                                            name idea. The command line is
                                            simply
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >silver</span
                                                ></tt
                                            >
                                            &#8212;
                                            <tt class="docutils literal"
                                                ><span class="pre">silver</span>
                                                <span class="pre"
                                                    >update</span
                                                ></tt
                                            >
                                            has a nice ring to it.
                                        </p>
                                        <p>
                                            There&#8217;s a new site:
                                            <a
                                                class="reference external"
                                                href="http://cloudsilverlining.org"
                                                >cloudsilverlining.org</a
                                            >; not notably different than the
                                            old site, just a new name. The
                                            product is self-hosting now, using a
                                            <a
                                                class="reference external"
                                                href="http://bitbucket.org/ianb/silverlining/"
                                                >simple app</a
                                            >
                                            that runs after every commit to
                                            regenerate the docs, and with a
                                            small extension to Silver Lining
                                            itself (to make it easier to host
                                            static files). Now that it has a
                                            real name I also gave it a
                                            <a
                                                class="reference external"
                                                href="http://groups.google.com/group/silverlining-dev"
                                                >real mailing list</a
                                            >.
                                        </p>
                                        <p>
                                            Silver Lining also has its
                                            <a
                                                class="reference external"
                                                href="http://bitbucket.org/ianb/silverlining/src/tip/tests/functional/runtest.py"
                                                >first test</a
                                            >. Not an impressive test, but a
                                            test. I&#8217;m hoping with a
                                            <a
                                                class="reference external"
                                                href="http://mail-archives.apache.org/mod_mbox/incubator-libcloud/201003.mbox/browser"
                                                >VM-based libcloud backend</a
                                            >
                                            that a full integration test can run
                                            in a reasonable amount of time.
                                            <em>Some</em> unit tests would be
                                            possible, but so far most of the
                                            bugs have been interaction bugs so I
                                            think integration tests will have to
                                            pull most of the weight. (A
                                            continuous integration rig will be
                                            very useful; I am not sure if Silver
                                            Lining can self-host that, though
                                            it&#8217;d be nice/clever if it
                                            could.)
                                        </p>
                                    </div>
                                    <!-- <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="https://ianbicking.org/2010/03/03/toppcloud-renamed-to-silver-lining/"
    dc:identifier="https://ianbicking.org/2010/03/03/toppcloud-renamed-to-silver-lining/"
    dc:title="toppcloud renamed to Silver Lining"
    trackback:ping="https://ianbicking.org/2010/03/03/toppcloud-renamed-to-silver-lining/trackback/" />
</rdf:RDF> -->
                                </div>
                                <!-- END POST-ENTRY -->
                            </div>
                            <!-- END POST-CONTENT  -->
                        </div>
                        <!-- END-CONTAINER -->
                        <div class="post-header">
                            <h3 class="post-date">2010 03 03</h3>
                            <p class="post-categories">
                                <a
                                    href="index.html"
                                    title="View all posts in Packaging"
                                    rel="category tag"
                                    >Packaging</a
                                ><br /><a
                                    href="../programming/index.html"
                                    title="View all posts in Programming"
                                    rel="category tag"
                                    >Programming</a
                                ><br /><a
                                    href="../python/index.html"
                                    title="View all posts in Python"
                                    rel="category tag"
                                    >Python</a
                                ><br /><a
                                    href="../silverlining.1"
                                    title="View all posts in Silver Lining"
                                    rel="category tag"
                                    >Silver Lining</a
                                ><br /><a
                                    href="../web/index.html"
                                    title="View all posts in Web"
                                    rel="category tag"
                                    >Web</a
                                >
                            </p>
                            <p class="post-comments">
                                <a
                                    href="../../2010/03/03/toppcloud-renamed-to-silver-lining/index.html#comments"
                                    title="Comment on toppcloud renamed to Silver Lining"
                                    >Comments (7)</a
                                >
                            </p>
                            <p class="post-permalink">
                                <a
                                    href="../../2010/03/03/toppcloud-renamed-to-silver-lining/index.html"
                                    title="Permalink to toppcloud renamed to Silver Lining"
                                    rel="permalink"
                                    >Permalink</a
                                >
                            </p>
                        </div>
                        <!-- END POST-FOOTER -->
                    </div>
                    <!-- END POST -->

                    <div id="post-132" class="post">
                        <div class="post-container">
                            <div class="post-content">
                                <h2 class="post-title">
                                    <a
                                        href="../../2010/01/29/new-way-to-deploy-web-apps/index.html"
                                        title="Permalink to A new way to deploy web applications"
                                        rel="bookmark"
                                        >A new way to deploy web applications</a
                                    >
                                </h2>
                                <div class="post-entry">
                                    <div class="document">
                                        <p>
                                            Deployment is one of the things I
                                            like least about development, and
                                            yet without deployment the
                                            development doesn&#8217;t really
                                            matter.
                                        </p>
                                        <p>
                                            I&#8217;ve tried a few things (e.g.
                                            <a
                                                class="reference external"
                                                href="../../2008/06/19/my-experience-writing-a-build-system/index.html"
                                                >fassembler</a
                                            >), built a few things (<a
                                                class="reference external"
                                                href="http://virtualenv.openplans.org"
                                                >virtualenv</a
                                            >,
                                            <a
                                                class="reference external"
                                                href="http://pip.openplans.org"
                                                >pip</a
                                            >), but deployment just sucked
                                            <em>less</em> as a result. Then I
                                            got excited about
                                            <a
                                                class="reference external"
                                                href="http://appengine.google.com"
                                                >App Engine</a
                                            >; everyone else was getting excited
                                            about &quot;scaling&quot;, but
                                            really I was
                                            <a
                                                class="reference external"
                                                href="../../2008/04/09/app-engine-and-open-source/index.html"
                                                >excited about an accessible
                                                deployment process</a
                                            >. When it comes to deployment App
                                            Engine is the first thing that has
                                            really felt good to me.
                                        </p>
                                        <p>
                                            <strong>But</strong> I can&#8217;t
                                            actually <em>use</em> App Engine. I
                                            was able to come to terms with the
                                            idea of writing an application to
                                            the platform, but there are
                                            limits&#8230; and with App Engine
                                            there were simply too many limits.
                                            Geo stuff on App Engine is at best a
                                            crippled hack, I miss
                                            <a
                                                class="reference external"
                                                href="http://codespeak.net/lxml/"
                                                >lxml</a
                                            >
                                            terribly, I never hated relational
                                            databases, and almost nothing large
                                            works without some degree of
                                            rewriting. Sometimes you can work
                                            around it, but you can never be sure
                                            you won&#8217;t hit some wall later.
                                            And frankly working around the
                                            platform is tiring and not very
                                            rewarding.
                                        </p>
                                        <hr class="docutils" />
                                        <p>
                                            So&#8230; App Engine seemed neat,
                                            but I couldn&#8217;t use it, and
                                            deployment was still a problem.
                                        </p>
                                        <p>
                                            What I like about App Engine: an
                                            application is just files.
                                            There&#8217;s no build process, no
                                            fancy copying of things in weird
                                            locations, nothing like that; you
                                            upload files, and uploading files
                                            <em>just works</em>. Also, you can
                                            check <em>everything</em> into
                                            version control. Not just your
                                            application code, but every library
                                            you use, the exact files that you
                                            installed. I really wanted a system
                                            like that.
                                        </p>
                                        <p>
                                            At the same time, I started looking
                                            into &quot;the cloud&quot;. It took
                                            me a while to get a handle on what
                                            &quot;cloud computing&quot; really
                                            means. What I learned: don&#8217;t
                                            overthink it. It&#8217;s not magic.
                                            It&#8217;s just virtual private
                                            servers that can be requisitioned
                                            automatically via an API, and are
                                            billed on a short time cycle. You
                                            can expand or change the definition
                                            a bit, but this definition is the
                                            one that matters to <em>me</em>.
                                            (I&#8217;ve also realized that I
                                            cannot get excited about complicated
                                            solutions; only once I realized how
                                            simple cloud computing is could I
                                            really get excited about the idea.)
                                        </p>
                                        <p>
                                            Given the modest functionality of
                                            cloud computing, why does it matter?
                                            Because with a cloud computing
                                            system you can actually
                                            <em>test</em> the full deployment
                                            stack. You can create a brand-new
                                            server, identical to all servers you
                                            will create in the future; you can
                                            set this server up; you can deploy
                                            to it. You get it wrong, you throw
                                            away that virtual server and start
                                            over from the beginning, fixing
                                            things until you get it right.
                                            Billing is important here too; with
                                            hourly billing you pay cents for
                                            these tests, and you don&#8217;t
                                            need a pool of ready servers because
                                            the cloud service basically manages
                                            that pool of ready servers for you.
                                        </p>
                                        <p>
                                            Without &quot;cloud computing&quot;
                                            we each too easily find ourselves in
                                            a situation where deployments are ad
                                            hoc, server installations develop
                                            over time, and servers and
                                            applications are inconsistent in
                                            their configuration. Cloud computing
                                            makes servers disposable, which
                                            means we can treat them in
                                            consistent ways, testing our work as
                                            we go. It makes it easy to treat
                                            operations with the same discipline
                                            as software.
                                        </p>
                                        <p>
                                            Given the idea from App Engine, and
                                            the easy-to-use infrastructure of a
                                            cloud service, I started to script
                                            together something to manage the
                                            servers and start up applications. I
                                            didn&#8217;t know what exactly I
                                            wanted to do to start, and I&#8217;m
                                            not completely sure where I&#8217;m
                                            going with this. But on the whole
                                            this feels pretty right. So I
                                            present the provisionally-named:
                                            <a
                                                class="reference external"
                                                href="http://toppcloud.colorstudy.com"
                                                >toppcloud</a
                                            >
                                            (<strong>Update</strong>: this has
                                            been renamed Silver Cloud).
                                        </p>
                                        <hr class="docutils" />
                                        <p>
                                            How it works: first you have a
                                            directory of files that defines your
                                            application. This probably includes
                                            a checkout of your
                                            &quot;application&quot; (let&#8217;s
                                            say in
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >src/mynewapp/</span
                                                ></tt
                                            >), and I find it also useful to use
                                            source control on the libraries
                                            (which are put in
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >lib/python/</span
                                                ></tt
                                            >). There&#8217;s a file in
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >app.ini</span
                                                ></tt
                                            >
                                            that defines some details of the
                                            application (very similar to
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >app.yaml</span
                                                ></tt
                                            >).
                                        </p>
                                        <p>
                                            While app.ini is a (<a
                                                class="reference external"
                                                href="http://toppcloud.colorstudy.com/appconfig.html"
                                                >very minimal</a
                                            >) description of the
                                            <em>application</em>, there is no
                                            description of the environment. You
                                            do not specify database connection
                                            details, for instance. Instead your
                                            application <em>requests</em> access
                                            to a database service. For instance,
                                            one of these services is a
                                            PostgreSQL/PostGIS database (which
                                            you get if you put
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >service.postgis</span
                                                ></tt
                                            >
                                            in your app.ini file). If you ask
                                            for that then there will be
                                            evironmental variables,
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >CONFIG_PG_DBNAME</span
                                                ></tt
                                            >
                                            etc., that will tell your
                                            application how to connect to the
                                            database. (For local development you
                                            can provide your own configuration,
                                            based on how you have PostgreSQL or
                                            some other service installed.)
                                        </p>
                                        <p>
                                            The standard setup is also a
                                            <a
                                                class="reference external"
                                                href="http://virtualenv.openplans.org"
                                                >virtualenv</a
                                            >
                                            environment. It is setup so
                                            <em>every time</em> you start that
                                            virtualenv environment you&#8217;ll
                                            get those configuration-related
                                            environmental variables. This means
                                            your application configuration is
                                            always present, your services always
                                            available. It&#8217;s available in
                                            tests just like it is during a
                                            request. Django accomplishes
                                            something similar with the (much
                                            maligned)
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >$DJANGO_SETTINGS_MODULE</span
                                                ></tt
                                            >
                                            but toppcloud builds it into the
                                            virtualenv environment instead of
                                            the shell environment.
                                        </p>
                                        <p>
                                            And how is the server setup? Much
                                            like with App Engine that is merely
                                            an implementation detail. Unlike App
                                            Engine that&#8217;s an
                                            implementation detail you can
                                            actually <em>look</em> at and change
                                            (by changing toppcloud), but
                                            it&#8217;s not something you are
                                            supposed to concern yourself with
                                            during regular application
                                            development.
                                        </p>
                                        <p>
                                            The basic lifecycle using toppcloud
                                            looks like:
                                        </p>
                                        <dl class="docutils">
                                            <dt>
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >toppcloud</span
                                                    >
                                                    <span class="pre"
                                                        >create-node</span
                                                    ></tt
                                                >
                                            </dt>
                                            <dd>
                                                Create a new virtual server; you
                                                can create any kind of supported
                                                server, but only Ubuntu Jaunty
                                                or Karmic are supported (and
                                                Jaunty should probably be
                                                dropped). This step is where the
                                                &quot;cloud&quot; part actually
                                                ends. If you want to install a
                                                bare Ubuntu onto an existing
                                                physical machine that&#8217;s
                                                fine too &#8212; after
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >toppcloud</span
                                                    >
                                                    <span class="pre"
                                                        >create-node</span
                                                    ></tt
                                                >
                                                the &quot;cloud&quot; part of
                                                the process is pretty much done.
                                                Just don&#8217;t go using some
                                                old Ubuntu install; this tool is
                                                for clean systems that are used
                                                only for toppcloud.
                                            </dd>
                                            <dt>
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >toppcloud</span
                                                    >
                                                    <span class="pre"
                                                        >setup-node</span
                                                    ></tt
                                                >
                                            </dt>
                                            <dd>
                                                Take that bare Ubuntu server and
                                                set it up (or update it) for use
                                                with toppcloud. This installs
                                                all the basic standard stuff
                                                (things like Apache, mod_wsgi,
                                                Varnish) and some management
                                                script that toppcloud runs. This
                                                is written to be safe to run
                                                over and over, so upgrading and
                                                setting up a machine are the
                                                same. It needs to be a bare
                                                server, but
                                            </dd>
                                            <dt>
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >toppcloud</span
                                                    >
                                                    <span class="pre"
                                                        >init</span
                                                    >
                                                    <span class="pre"
                                                        >path/to/app/</span
                                                    ></tt
                                                >
                                            </dt>
                                            <dd>
                                                Setup a basic virtualenv
                                                environment with some toppcloud
                                                customizations.
                                            </dd>
                                            <dt>
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >toppcloud</span
                                                    >
                                                    <span class="pre"
                                                        >serve</span
                                                    >
                                                    <span class="pre"
                                                        >path/to/app</span
                                                    ></tt
                                                >
                                            </dt>
                                            <dd>
                                                Serve up the application
                                                locally.
                                            </dd>
                                            <dt>
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >toppcloud</span
                                                    >
                                                    <span class="pre"
                                                        >update</span
                                                    >
                                                    <span class="pre"
                                                        >--host=test.example.com</span
                                                    >
                                                    <span class="pre"
                                                        >path/to/app/</span
                                                    ></tt
                                                >
                                            </dt>
                                            <dd>
                                                This creates or updates an
                                                application at the given host.
                                                It edits
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >/etc/hosts</span
                                                    ></tt
                                                >
                                                so that the domain is locally
                                                viewable.
                                            </dd>
                                            <dt>
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >toppcloud</span
                                                    >
                                                    <span class="pre">run</span>
                                                    <span class="pre"
                                                        >test.example.com</span
                                                    >
                                                    <span class="pre"
                                                        >script.py</span
                                                    ></tt
                                                >
                                            </dt>
                                            <dd>
                                                Run a script (from
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >bin/</span
                                                    ></tt
                                                >) on a remote server. This
                                                allows you to run things like
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >django-admin.py</span
                                                    >
                                                    <span class="pre"
                                                        >syncdb</span
                                                    ></tt
                                                >.
                                            </dd>
                                        </dl>
                                        <p>
                                            There&#8217;s a few other things
                                            &#8212; stuff to manage the servers
                                            and change around hostnames or the
                                            active version of applications.
                                            It&#8217;s growing to fit a variety
                                            of workflows, but I don&#8217;t
                                            think its growth is unbounded.
                                        </p>
                                        <hr class="docutils" />
                                        <p>
                                            So&#8230; this is what toppcloud.
                                            From the outside it doen&#8217;t do
                                            a lot. From the inside it&#8217;s
                                            not actually that complicated
                                            either. I&#8217;ve included a lot of
                                            constraints in the tool but I think
                                            it offers an excellent balance. The
                                            constraints are workable for
                                            applications (insignificant for many
                                            applications), while still exposing
                                            a simple and consistent system
                                            that&#8217;s easier to reason about
                                            than a big-ball-of-server.
                                        </p>
                                        <p>Some of the constraints:</p>
                                        <ol class="arabic simple">
                                            <li>
                                                Binary packages are supported
                                                via Ubuntu packages; you only
                                                upload portable files. If you
                                                need a library like lxml, you
                                                need to request that package
                                                (<tt class="docutils literal"
                                                    ><span class="pre"
                                                        >python-lxml</span
                                                    ></tt
                                                >) to be installed in your
                                                app.ini. If you need a version
                                                of a binary library that is not
                                                yet packaged, I think creating a
                                                new deb is reasonable.
                                            </li>
                                            <li>
                                                There is no Linux distribution
                                                abstraction, but I don&#8217;t
                                                care.
                                            </li>
                                            <li>
                                                There is no option for the way
                                                your application is run &#8212;
                                                there&#8217;s one way
                                                applications are run, because I
                                                believe there is a best
                                                practice. I might have gotten
                                                the best practice wrong, but
                                                that should be resolved inside
                                                toppcloud, not inside
                                                applications. Is Varnish a
                                                terrible cache? Probably not,
                                                but if it is we should all be
                                                able to agree on that and
                                                replace it. If there are
                                                genuinely different needs then
                                                maybe additional application or
                                                deployment configuration will be
                                                called for &#8212; but we
                                                shouldn&#8217;t add
                                                configuration just because
                                                someone <em>says</em> there is a
                                                better practice (and a better
                                                practice that is not universally
                                                better); there must be
                                                justifications.
                                            </li>
                                            <li>
                                                By abstracting out services and
                                                persistence some additional code
                                                is required for each such
                                                service, and that code is
                                                centralized in toppcloud, but it
                                                means we can also start to add
                                                consistent tools usable across a
                                                wide set of applications and
                                                backends.
                                            </li>
                                            <li>
                                                All file paths have to be
                                                relative, because files get
                                                moved around. I know of some
                                                particularly problematic files
                                                (e.g.,
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >.pth</span
                                                    ></tt
                                                >
                                                files), and toppcloud fixes
                                                these automatically. Mostly this
                                                isn&#8217;t so hard to do.
                                            </li>
                                        </ol>
                                        <p>
                                            These particular compromises are
                                            ones I have not seen in many systems
                                            (and
                                            <a
                                                class="reference external"
                                                href="http://toppcloud.colorstudy.com/comparisons.html"
                                                >I&#8217;ve started to look
                                                more</a
                                            >). App Engine I think goes too far
                                            with its constraints.
                                            <a
                                                class="reference external"
                                                href="http://heroku.com/"
                                                >Heroku</a
                                            >
                                            is close, but closed source.
                                        </p>
                                        <p>
                                            This is different than a strict
                                            everything-must-be-a-package
                                            strategy. This deployment system is
                                            light and simple and takes into
                                            account reasonable web development
                                            workflows. The pieces of an
                                            application that move around a lot
                                            are all well-greased and agile. The
                                            parts of an application that are
                                            better to Do Right And Then Leave
                                            Alone (like Apache configuration)
                                            are static.
                                        </p>
                                        <p>
                                            Unlike generalized systems like
                                            buildout this system avoids
                                            &quot;building&quot; entirely,
                                            making deployment a simpler and
                                            lower risk action, leaning on system
                                            packages for the things they do
                                            best. Other open source tools
                                            emphasize a greater degree of
                                            flexibility than I think is
                                            necessary, allowing people to encode
                                            exploratory service integration into
                                            what <em>appears</em> to be an
                                            encapsulated build (I&#8217;m
                                            looking at you buildout).
                                        </p>
                                        <p>
                                            Unlike
                                            <a
                                                class="reference external"
                                                href="http://pip.openplans.org/requirement-format.html"
                                                >requirement sets</a
                                            >
                                            and packaging and versioning
                                            libraries, this makes all the Python
                                            libraries (typically the most
                                            volatile libraries) explicit and
                                            controlled, and can better ensure
                                            that small updates really are small.
                                            It doesn&#8217;t invalidate
                                            installers and versioning, but it
                                            makes that process even more
                                            explicit and encourages greater
                                            thoughtfulness.
                                        </p>
                                        <p>
                                            Unlike many production-oriented
                                            systems (what I&#8217;ve seen in a
                                            lot of &quot;cloud&quot; tools) this
                                            encorporates both the development
                                            environment and production
                                            environment; but unlike some
                                            developer-oriented systems this does
                                            not try to normalize
                                            everyone&#8217;s environment and
                                            instead relies on developers to set
                                            up their systems however is
                                            appropriate. And unlike
                                            platform-neutral systems this can
                                            ensure an amount of reliability and
                                            predictability through extremely
                                            hard requirements (it is deployed on
                                            Ubuntu Jaunty/Karmic <em>only</em>).
                                        </p>
                                        <p>
                                            But it&#8217;s not all constraints.
                                            Toppcloud is solidly web framework
                                            neutral. It&#8217;s even
                                            <a
                                                class="reference external"
                                                href="http://toppcloud.colorstudy.com/php.html"
                                                >slightly language neutral</a
                                            >. Though it does require support
                                            code for each persistence technique,
                                            it is fairly easy to do, and there
                                            are no requirements for
                                            &quot;scalable systems&quot;; I
                                            think unscalable systems are a
                                            perfectly reasonable implementation
                                            choice for many problems. I believe
                                            a more scalable system could be
                                            built on this, but as a deployment
                                            and development option, not a
                                            starting requirement.
                                        </p>
                                        <p>
                                            So far I&#8217;ve done some
                                            deployments using toppcloud; not a
                                            lot, but some. And I can say that it
                                            feels really good; lots of rough
                                            edges still, but the core concept
                                            feels really right. I&#8217;ve made
                                            a lot of sideways attacks on
                                            deployment, and a few direct
                                            attacks&#8230; sometimes I write
                                            things that I think are useful, and
                                            sometimes I write things that I
                                            think are right. Toppcloud is at the
                                            moment maybe more right than useful.
                                            But I genuinely believe this is (in
                                            theory) a universally appropriate
                                            deployment tool.
                                        </p>
                                        <hr class="docutils" />
                                        <p>
                                            Alright, so now you think maybe you
                                            should look more at toppcloud&#8230;
                                        </p>
                                        <p>
                                            Well, I can offer you
                                            <a
                                                class="reference external"
                                                href="http://toppcloud.colorstudy.com"
                                                >a fair amount of
                                                documentation</a
                                            >. A lot of that documentation
                                            refers to design, and a bit of it to
                                            examples. There&#8217;s also a
                                            couple projects you can look at;
                                            they are all small, but :
                                        </p>
                                        <ul class="simple">
                                            <li>
                                                <a
                                                    class="reference external"
                                                    href="http://bitbucket.org/geraldmc/frank-src/src/tip/build-fs-layout"
                                                    >Frank</a
                                                >
                                                (will be
                                                interactivesomerville.org) which
                                                is another similar Django/Pinax
                                                project (Pinax was a bit
                                                tricky). This is probably the
                                                largest project. It&#8217;s a
                                                Django/Pinax volunteer-written
                                                application for collecting
                                                community feedback the Boston
                                                Greenline project, if that
                                                sounds interesting to you might
                                                want to chip in on the
                                                development (if so
                                                <a
                                                    class="reference external"
                                                    href="https://projects.openplans.org/greenline"
                                                    >check out the wiki</a
                                                >).
                                            </li>
                                            <li>
                                                <a
                                                    class="reference external"
                                                    href="http://github.com/ianb/neighborly/blob/master/INSTALL.txt"
                                                    >Neighborly</a
                                                >, with minimal functionality
                                                (we need to run more sprints)
                                                but an installation story.
                                            </li>
                                            <li>
                                                <a
                                                    class="reference external"
                                                    href="http://bitbucket.org/ianb/bbdocs/src/tip/create-layout.sh"
                                                    >bbdocs</a
                                                >
                                                which is a very simple bitbucket
                                                document generator, that makes
                                                the toppcloud site.
                                            </li>
                                            <li>
                                                <a
                                                    class="reference external"
                                                    href="http://bitbucket.org/ianb/geodns"
                                                    >geodns</a
                                                >
                                                which is another simple
                                                no-framework PostGIS project.
                                            </li>
                                        </ul>
                                        <hr class="docutils" />
                                        <p>
                                            Now, the letdown. One thing I cannot
                                            offer you is support.
                                            <strong>THERE IS NO SUPPORT</strong
                                            >. I cannot now, and I might never
                                            really be able to support this tool.
                                            This tool is appropriate for
                                            collaborators, for people who like
                                            the idea and are ready to build on
                                            it. If it grows well I hope that it
                                            can grow a community, I hope people
                                            can support each other. I&#8217;d
                                            like to help that happen. But I
                                            can&#8217;t do that by bootstrapping
                                            it through unending support, because
                                            I&#8217;m not good at it and
                                            I&#8217;m not consistent and
                                            it&#8217;s unrealistic and
                                            unsustainable. This is not a open
                                            source dead drop. But it&#8217;s
                                            also not My Future; I&#8217;m not
                                            going to build a company around it,
                                            and I&#8217;m not going to use all
                                            my free time supporting it.
                                            It&#8217;s a tool I want to exist. I
                                            <strong>very much</strong> want it
                                            to exist. But even very much wanting
                                            something is not the same as being
                                            an undying champion, and I am not an
                                            undying champion. If you want to
                                            tell me what my process
                                            <em>should</em> be, please do!
                                        </p>
                                        <hr class="docutils" />
                                        <blockquote>
                                            <p>
                                                If you want to see me get
                                                philosophical about packaging
                                                and deployment and other stuff
                                                like that, see my upcoming talk
                                                at
                                                <a
                                                    class="reference external"
                                                    href="http://us.pycon.org/"
                                                    >PyCon</a
                                                >.
                                            </p>
                                        </blockquote>
                                    </div>
                                    <!-- <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="https://ianbicking.org/2010/01/29/new-way-to-deploy-web-apps/"
    dc:identifier="https://ianbicking.org/2010/01/29/new-way-to-deploy-web-apps/"
    dc:title="A new way to deploy web applications"
    trackback:ping="https://ianbicking.org/2010/01/29/new-way-to-deploy-web-apps/trackback/" />
</rdf:RDF> -->
                                </div>
                                <!-- END POST-ENTRY -->
                            </div>
                            <!-- END POST-CONTENT  -->
                        </div>
                        <!-- END-CONTAINER -->
                        <div class="post-header">
                            <h3 class="post-date">2010 01 29</h3>
                            <p class="post-categories">
                                <a
                                    href="index.html"
                                    title="View all posts in Packaging"
                                    rel="category tag"
                                    >Packaging</a
                                ><br /><a
                                    href="../programming/index.html"
                                    title="View all posts in Programming"
                                    rel="category tag"
                                    >Programming</a
                                ><br /><a
                                    href="../python/index.html"
                                    title="View all posts in Python"
                                    rel="category tag"
                                    >Python</a
                                ><br /><a
                                    href="../silverlining.1"
                                    title="View all posts in Silver Lining"
                                    rel="category tag"
                                    >Silver Lining</a
                                ><br /><a
                                    href="../web/index.html"
                                    title="View all posts in Web"
                                    rel="category tag"
                                    >Web</a
                                >
                            </p>
                            <p class="post-comments">
                                <a
                                    href="../../2010/01/29/new-way-to-deploy-web-apps/index.html#comments"
                                    title="Comment on A new way to deploy web applications"
                                    >Comments (13)</a
                                >
                            </p>
                            <p class="post-permalink">
                                <a
                                    href="../../2010/01/29/new-way-to-deploy-web-apps/index.html"
                                    title="Permalink to A new way to deploy web applications"
                                    rel="permalink"
                                    >Permalink</a
                                >
                            </p>
                        </div>
                        <!-- END POST-FOOTER -->
                    </div>
                    <!-- END POST -->

                    <div id="post-87" class="post">
                        <div class="post-container">
                            <div class="post-content">
                                <h2 class="post-title">
                                    <a
                                        href="../../2008/12/16/using-pip-requirements/index.html"
                                        title="Permalink to Using pip Requirements"
                                        rel="bookmark"
                                        >Using pip Requirements</a
                                    >
                                </h2>
                                <div class="post-entry">
                                    <div class="document">
                                        <p>
                                            Following onto a set of recent posts
                                            (from
                                            <a
                                                class="reference external"
                                                href="http://www.b-list.org/weblog/2008/dec/14/packaging/"
                                                >James</a
                                            >,
                                            <a
                                                class="reference external"
                                                href="../../2008/12/14/a-few-corrections-to-on-packaging/index.html"
                                                >me</a
                                            >, then
                                            <a
                                                class="reference external"
                                                href="http://www.b-list.org/weblog/2008/dec/15/pip/"
                                                >James again</a
                                            >), Martijn Faassen
                                            <a
                                                class="reference external"
                                                href="http://faassen.n--tree.net/blog/view/weblog/2008/12/16/0"
                                                >wrote a description of
                                                Grok&#8217;s version
                                                management</a
                                            >. Our ideas are pretty close, but
                                            he&#8217;s using buildout, and
                                            I&#8217;ll describe out to do the
                                            same things with pip.
                                        </p>
                                        <p>
                                            Here&#8217;s a kind of development
                                            workflow that I think works well:
                                        </p>
                                        <ul class="simple">
                                            <li>
                                                A framework release is prepared.
                                                Ideally there&#8217;s a buildbot
                                                that has been running (as
                                                <a
                                                    class="reference external"
                                                    href="http://pylonshq.com:8010/"
                                                    >Pylons has</a
                                                >, for example), so the
                                                integration has been running for
                                                a while.
                                            </li>
                                            <li>
                                                People make sure there are
                                                released versions of all the
                                                important components. If there
                                                are known conflicts between
                                                pieces, libraries and the
                                                framework update their
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >install_requires</span
                                                    ></tt
                                                >
                                                in their
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >setup.py</span
                                                    ></tt
                                                >
                                                files to make sure people
                                                don&#8217;t use conflicting
                                                pieces together.
                                            </li>
                                            <li>
                                                Once everything has been
                                                released, there is a known set
                                                of packages that work together.
                                                Using a buildbot maybe future
                                                versions will also work
                                                together, but they won&#8217;t
                                                necessarily work together with
                                                applications built on the
                                                framework. And breakage can also
                                                occur regardless of a buildbot.
                                            </li>
                                            <li>
                                                Also, people may have versions
                                                of libraries already installed,
                                                but just because they&#8217;ve
                                                installed something
                                                doesn&#8217;t mean they really
                                                mean to stay with an old
                                                version. While known conflicts
                                                have been noted, there&#8217;s
                                                going to be lots of unknown
                                                conflicts and future conflicts.
                                            </li>
                                            <li>
                                                When starting development with a
                                                framework, the developer would
                                                like to start with some
                                                known-good set, which is a set
                                                that can be developed by the
                                                framework developers, or
                                                potentially by any person. For
                                                instance, if you extend a public
                                                framework with an internal
                                                framework (or even a public
                                                sub-framework like
                                                <a
                                                    class="reference external"
                                                    href="http://pinaxproject.com/"
                                                    >Pinax</a
                                                >) then the known-good set will
                                                be developed by a different set
                                                of people.
                                            </li>
                                            <li>
                                                As an application is developed,
                                                the developer will add on other
                                                libraries, or use some of their
                                                own libraries. Development will
                                                probably occur at the trunk/tip
                                                of several libraries as they are
                                                developed together.
                                            </li>
                                            <li>
                                                A developer might upgrade the
                                                entire framework, or just
                                                upgrade one piece (for instance,
                                                to get a bug fix they are
                                                interested in, or follow a
                                                branch that has functionality
                                                they care about). The developer
                                                doesn&#8217;t necessarily have
                                                the same notion of
                                                &quot;stable&quot; and
                                                &quot;released&quot; as the core
                                                framework developers have.
                                            </li>
                                            <li>
                                                At the time of deployment the
                                                developer wants to make sure all
                                                the pieces are deployed together
                                                as they&#8217;ve tested them,
                                                and how they know them to work.
                                                At any time, another developer
                                                may want to clone the same set
                                                of libraries.
                                            </li>
                                            <li>
                                                After initial deployment, the
                                                developer may want to upgrade a
                                                single component, if only to
                                                test that an upgrade works, or
                                                if it resolves a bug. They may
                                                test out combinations only to
                                                throw them away, and they
                                                don&#8217;t want to bump
                                                versions of libraries in order
                                                to deploy new combinations.
                                            </li>
                                        </ul>
                                        <p>
                                            This is the kind of development
                                            pattern that requirement files are
                                            meant to assist with. They can
                                            provide a known-good set of
                                            packages. Or they can provide a
                                            starting point for an active line of
                                            development. Or they can provide a
                                            historical record of how something
                                            was put together.
                                        </p>
                                        <p>
                                            The easy way to start a requirement
                                            file for pip is just to put the
                                            packages you know you want to work
                                            with. For instance, we&#8217;ll call
                                            this
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >project-start.txt</span
                                                ></tt
                                            >:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            Pylons<br />
                                            -e
                                            svn+http://mycompany/svn/MyApp/trunk<span
                                                class="co1"
                                                >#egg=MyApp</span
                                            ><br />
                                            -e
                                            svn+http://mycompany/svn/MyLibrary/trunk<span
                                                class="co1"
                                                >#egg=MyLibrary</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            You can plug away for a while, and
                                            maybe you decide you want to freeze
                                            the file. So you do:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            $ pip freeze -r project-start.<span
                                                class="me1"
                                                >txt</span
                                            >
                                            project-frozen.<span class="me1"
                                                >txt</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            By using
                                            <tt class="docutils literal"
                                                ><span class="pre">-r</span>
                                                <span class="pre"
                                                    >project-start.txt</span
                                                ></tt
                                            >
                                            you give
                                            <tt class="docutils literal"
                                                ><span class="pre">pip</span>
                                                <span class="pre"
                                                    >freeze</span
                                                ></tt
                                            >
                                            a template for it to start with.
                                            From that, you&#8217;ll get
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >project-frozen.txt</span
                                                ></tt
                                            >
                                            that will look like:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            Pylons==<span class="nu0">0.9</span
                                            ><span class="nu0">.7</span><br />
                                            -e
                                            svn+http://mycompany/svn/MyApp/trunk@<span
                                                class="co1"
                                                >1045#egg=MyApp</span
                                            ><br />
                                            -e
                                            svn+http://mycompany/svn/MyLibrary/trunk@<span
                                                class="co1"
                                                >1058#egg=MyLibrary</span
                                            ><br />
                                            <br />
                                            <span class="co1"
                                                >## The following requirements
                                                were added by pip
                                                --freeze:</span
                                            ><br />
                                            Beaker==<span class="nu0">0.2</span
                                            ><span class="nu0">.1</span><br />
                                            WebHelpers==<span class="nu0"
                                                >0.9</span
                                            ><span class="nu0">.1</span><br />
                                            nose==<span class="nu0">1.4</span
                                            ><br />
                                            <span class="co1"
                                                ># Installing as editable to
                                                satisfy requirement
                                                INITools==0.2.1dev-r3488:</span
                                            ><br />
                                            -e svn+http://svn.<span class="me1"
                                                >colorstudy</span
                                            >.<span class="me1">com</span
                                            >/INITools/trunk@<span class="co1"
                                                >3488#egg=INITools-0.2.1dev_r3488</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            At that point you might decide that
                                            you don&#8217;t care about the nose
                                            version, or you might have installed
                                            something from trunk when you could
                                            have used the last release. So you
                                            go and adjust some things.
                                        </p>
                                        <p>
                                            Martijn also asks: how do you have
                                            framework developers maintain one
                                            file, and then also have developers
                                            maintain their own lists for their
                                            projects?
                                        </p>
                                        <p>
                                            You could start with a file like
                                            this for the framework itself.
                                            Pylons for instance could ship with
                                            something like this. To install
                                            Pylons you could then do:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            $ pip -E MyProject install \\<br />
                                            &gt; &nbsp; &nbsp;-r
                                            http://pylonshq.<span class="me1"
                                                >com</span
                                            >/<span class="nu0">0.9</span
                                            ><span class="nu0">.7</span
                                            >-requirements.<span class="me1"
                                                >txt</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            You can also download that file
                                            yourself, add some comments, rename
                                            the file and add your project to it,
                                            and use that. When you freeze the
                                            order of the packages and any
                                            comments will be preserved, so you
                                            can keep track of what changed. Also
                                            it should be ameniable to source
                                            control, and diffs would be
                                            sensible.
                                        </p>
                                        <p>
                                            You could also use indirection,
                                            creating a file like this for your
                                            project:
                                        </p>
                                        <div
                                            class="dean_ch"
                                            style="white-space: wrap"
                                        >
                                            <br />
                                            -r http://pylonshq.<span class="me1"
                                                >com</span
                                            >/<span class="nu0">0.9</span
                                            ><span class="nu0">.7</span
                                            >-requirements.<span class="me1"
                                                >txt</span
                                            ><br />
                                            -e
                                            svn+http://mycompany/svn/MyApp/trunk<span
                                                class="co1"
                                                >#egg=MyApp</span
                                            ><br />
                                            -e
                                            svn+http://mycompany/svn/MyLibrary/trunk<span
                                                class="co1"
                                                >#egg=MyLibrary</span
                                            ><br />
                                            &nbsp;
                                        </div>
                                        <p>
                                            That is, requirements files can
                                            refer to each other. So if you want
                                            to maintain your own requirements
                                            file alongside the development of an
                                            upstream requirements file, you
                                            could do that.
                                        </p>
                                    </div>
                                    <!-- <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="https://ianbicking.org/2008/12/16/using-pip-requirements/"
    dc:identifier="https://ianbicking.org/2008/12/16/using-pip-requirements/"
    dc:title="Using pip Requirements"
    trackback:ping="https://ianbicking.org/2008/12/16/using-pip-requirements/trackback/" />
</rdf:RDF> -->
                                </div>
                                <!-- END POST-ENTRY -->
                            </div>
                            <!-- END POST-CONTENT  -->
                        </div>
                        <!-- END-CONTAINER -->
                        <div class="post-header">
                            <h3 class="post-date">2008 12 16</h3>
                            <p class="post-categories">
                                <a
                                    href="index.html"
                                    title="View all posts in Packaging"
                                    rel="category tag"
                                    >Packaging</a
                                ><br /><a
                                    href="../python/index.html"
                                    title="View all posts in Python"
                                    rel="category tag"
                                    >Python</a
                                >
                            </p>
                            <p class="post-comments">
                                <a
                                    href="../../2008/12/16/using-pip-requirements/index.html#comments"
                                    title="Comment on Using pip Requirements"
                                    >Comments (3)</a
                                >
                            </p>
                            <p class="post-permalink">
                                <a
                                    href="../../2008/12/16/using-pip-requirements/index.html"
                                    title="Permalink to Using pip Requirements"
                                    rel="permalink"
                                    >Permalink</a
                                >
                            </p>
                        </div>
                        <!-- END POST-FOOTER -->
                    </div>
                    <!-- END POST -->

                    <div id="post-86" class="post">
                        <div class="post-container">
                            <div class="post-content">
                                <h2 class="post-title">
                                    <a
                                        href="../../2008/12/14/a-few-corrections-to-on-packaging/index.html"
                                        title="Permalink to A Few Corrections To &#8220;On Packaging&#8221;"
                                        rel="bookmark"
                                        >A Few Corrections To &#8220;On
                                        Packaging&#8221;</a
                                    >
                                </h2>
                                <div class="post-entry">
                                    <div class="document">
                                        <p>
                                            <a
                                                class="reference external"
                                                href="http://www.b-list.org/weblog/2008/dec/14/packaging/"
                                                >James Bennett recently wrote an
                                                article on Python packaging and
                                                installation</a
                                            >, and Setuptools. There&#8217;s a
                                            lot of issues, and writing up my
                                            thoughts could take a long time, but
                                            I thought at least I should correct
                                            some errors, specifically category
                                            errors. Figuring out where all the
                                            pieces in Setuptools (and pip and
                                            virtualenv) fit
                                            <em>is</em> difficult, so I
                                            don&#8217;t blame James for making
                                            some mistakes, but in the interest
                                            of clarifying the discussion&#8230;
                                        </p>
                                        <p>
                                            I will start with a kind of
                                            glossary:
                                        </p>
                                        <dl class="docutils">
                                            <dt>Distribution:</dt>
                                            <dd>
                                                This is
                                                something-with-a-setup.py. A
                                                tarball, zip, a checkout, etc.
                                                Distributions have names; this
                                                is the name in
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >setup(name=&quot;...&quot;)</span
                                                    ></tt
                                                >
                                                in the setup.py file. They have
                                                some other metadata too
                                                (description, version, etc), and
                                                Setuptools adds to that metadata
                                                some. Distutils doesn&#8217;t
                                                make it very easy to add to the
                                                metadata &#8212; it&#8217;ll
                                                whine a little about things it
                                                doesn&#8217;t know, but
                                                won&#8217;t do anything with
                                                that extra data. Fixing this
                                                problem in Distutils is an
                                                important aspect of Setuptools,
                                                and part of what Distutils
                                                itself unsuitable as a basis for
                                                good library management.
                                            </dd>
                                            <dt>package/module:</dt>
                                            <dd>
                                                This is something you import. It
                                                is not the same as a
                                                distribution, though usually a
                                                distribution will have the same
                                                name as a package. In my own
                                                libraries I try to name the
                                                distribution with mixed case
                                                (like Paste) and the package
                                                with lower case (like paste).
                                                Keeping the terminology straight
                                                here is <em>very</em> difficult;
                                                and usually it doesn&#8217;t
                                                matter, but sometimes it does.
                                            </dd>
                                            <dt>
                                                Setuptools The Distribution:
                                            </dt>
                                            <dd>
                                                This is what you install when
                                                you install Setuptools. It
                                                includes several pieces that
                                                Phillip Eby wrote, that work
                                                together but are not strictly a
                                                single thing.
                                            </dd>
                                            <dt>setuptools The Package:</dt>
                                            <dd>
                                                This is what you get when you do
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >import</span
                                                    >
                                                    <span class="pre"
                                                        >setuptools</span
                                                    ></tt
                                                >. Setuptools largely works by
                                                monkeypatching distutils, so
                                                simply importing setuptools
                                                activates its functionality from
                                                then on. This package is
                                                entirely focused on installation
                                                and package management, it is
                                                not something you should use at
                                                runtime (unless you are
                                                installing packages as your
                                                runtime, of course).
                                            </dd>
                                            <dt>pkg_resources The Module:</dt>
                                            <dd>
                                                This is also included in
                                                Setuptools The Distribution, and
                                                is for use at runtime. This is a
                                                single module that provides the
                                                ability to query what
                                                distributions are installed,
                                                metadata about those
                                                distributions, information about
                                                the location where they are
                                                installed. It also allows
                                                distributions to be
                                                &quot;activated&quot;. A
                                                <em>distribution</em> can be
                                                available but not activated.
                                                Activating a distribution means
                                                adding its location to
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >sys.path</span
                                                    ></tt
                                                >, and probably you&#8217;ve
                                                noticed how long sys.path is
                                                when you use easy_install.
                                                Almost everything that allows
                                                different libraries to be
                                                installed, or allows different
                                                versions of libraries, does it
                                                through some management of
                                                sys.path. pkg_resources also
                                                allows for generic access to
                                                &quot;resources&quot; (i.e.,
                                                non-code files), and let&#8217;s
                                                those resources be in zip files.
                                                pkg_resources is safe to use, it
                                                doesn&#8217;t do any of the
                                                funny stuff that people get
                                                annoyed with.
                                            </dd>
                                            <dt>easy_install:</dt>
                                            <dd>
                                                This is also in Setuptools The
                                                Distribution. The basic
                                                functionality it provides is
                                                that given a name, it can search
                                                for package with that
                                                distribution name, and also
                                                satisfying a version
                                                requirement. It then downloads
                                                the package, installs it (using
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >setup.py</span
                                                    >
                                                    <span class="pre"
                                                        >install</span
                                                    ></tt
                                                >, but with the setuptools
                                                monkeypatches in place). After
                                                that, it checks the newly
                                                installed distribution to see if
                                                it requires any other libraries
                                                that aren&#8217;t yet installed,
                                                and if so it installs them.
                                            </dd>
                                            <dt>
                                                Eggs the Distribution Format:
                                            </dt>
                                            <dd>
                                                These are zip files that
                                                Setuptools creates when you run
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >python</span
                                                    >
                                                    <span class="pre"
                                                        >setup.py</span
                                                    >
                                                    <span class="pre"
                                                        >bdist_egg</span
                                                    ></tt
                                                >. Unlike a tarball, these can
                                                be binary packages, containing
                                                compiled modules, and generally
                                                contain .pyc files (which are
                                                portable across platforms, but
                                                not Python versions). This
                                                format only includes files that
                                                will actually be installed; as a
                                                result it does not include doc
                                                files or
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >setup.py</span
                                                    ></tt
                                                >
                                                itself. All the metadata from
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >setup.py</span
                                                    ></tt
                                                >
                                                that is needed for installation
                                                is put in files in a directory
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >EGG-INFO</span
                                                    ></tt
                                                >.
                                            </dd>
                                            <dt>
                                                Eggs the Installation Format:
                                            </dt>
                                            <dd>
                                                Eggs the Distribution Format are
                                                a subset of the Installation
                                                Format. That is, if you put an
                                                Egg zip file on the path, it is
                                                installed, no other process is
                                                necessary. But the Installation
                                                Format is more general. To have
                                                an egg installed, you either
                                                need something like
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >DistroName-X.Y.egg/</span
                                                    ></tt
                                                >
                                                on the path, and then an
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >EGG-INFO/</span
                                                    ></tt
                                                >
                                                directory under that with the
                                                metadata, or a path like
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >DistroName.egg-info/</span
                                                    ></tt
                                                >
                                                with the metadata directly in
                                                that directory. This metadata
                                                can exist anywhere, and
                                                doesn&#8217;t have to be
                                                directly alongside the actual
                                                Python code. Egg directories are
                                                required for pkg_resources to
                                                activate and deactivate
                                                distributions, but otherwise
                                                they aren&#8217;t necessary.
                                            </dd>
                                            <dt>pip:</dt>
                                            <dd>
                                                This is an alternative to
                                                easy_install. It works
                                                <em>somewhat</em> differently
                                                than easy_install, but not much.
                                                Mostly it is
                                                <em>better</em> than
                                                easy_install, in that it has
                                                some extra features and is
                                                easier to use. Unlike
                                                easy_install, it downloads all
                                                distributions up-front, and
                                                generates the metadata to read
                                                distribution and version
                                                requirements. It uses Setuptools
                                                to generate this metadata from a
                                                setup.py file, and uses
                                                pkg_resources to parse this
                                                metadata. It then installs
                                                packages
                                                <em
                                                    >with the setuptools
                                                    monkeypatches applied</em
                                                >. It just happens to use an
                                                option
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >python</span
                                                    >
                                                    <span class="pre"
                                                        >setup.py</span
                                                    >
                                                    <span class="pre"
                                                        >--single-version-externally-managed</span
                                                    ></tt
                                                >, which gets Setuptools to
                                                install packages in a more flat
                                                manner, with
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >Distro.egg-info/</span
                                                    ></tt
                                                >
                                                directories alongside the
                                                package. Pip installs eggs!
                                                I&#8217;ve heard the many
                                                complaints about easy_install
                                                (and I&#8217;ve had many
                                                myself), but ultimately I think
                                                pip does well by just fixing a
                                                few small issues. Pip is
                                                <em>not</em> a repudiation of
                                                Setuptools or the basic
                                                mechanisms that easy_install
                                                uses.
                                            </dd>
                                            <dt>PoachEggs:</dt>
                                            <dd>
                                                This is a defunct package that
                                                had some of the features of pip
                                                (particularly requirement files)
                                                but used easy_install for
                                                installation. Don&#8217;t bother
                                                with this, it was just a bridge
                                                to get to pip.
                                            </dd>
                                            <dt>virtualenv:</dt>
                                            <dd>
                                                This is a little hack that
                                                creates isolated Python
                                                environments. It&#8217;s based
                                                on
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >virtual-python.py</span
                                                    ></tt
                                                >, which is something I wrote
                                                based on some documentation
                                                notes PJE wrote for Setuptools.
                                                Basically virtualenv just
                                                creates a
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >bin/python</span
                                                    ></tt
                                                >
                                                interpreter that has its own
                                                value of
                                                <tt class="docutils literal"
                                                    ><span class="pre"
                                                        >sys.prefix</span
                                                    ></tt
                                                >, but uses the system Python
                                                and standard library. It also
                                                installs Setuptools to make it
                                                easier to bootstrap the
                                                environment (because
                                                bootstrapping Setuptools is
                                                itself a bit tedious).
                                                I&#8217;ll add pip to it too
                                                sometime. Using virtualenv you
                                                don&#8217;t have to worry about
                                                different library versions,
                                                because for any one environment
                                                you will probably only need one
                                                version of a library. On any one
                                                <em>machine</em> you probably
                                                need different versions, which
                                                is why installing packages
                                                system-wide is problematic for
                                                most libraries. (I&#8217;ve been
                                                meaning to write a post on why I
                                                think using system packaging for
                                                libraries is counter-productive,
                                                but that&#8217;ll wait for
                                                another time.)
                                            </dd>
                                        </dl>
                                        <hr class="docutils" />
                                        <p>
                                            So&#8230; there&#8217;s the pieces
                                            involved, at least the ones I can
                                            remember now. And I haven&#8217;t
                                            really discussed .pth files, entry
                                            points, sys.path trickery, site.py,
                                            distutils.cfg&#8230; sadly this is a
                                            complex state of affairs, but it was
                                            also complex before Setuptools.
                                        </p>
                                        <p>
                                            There are a few things that I think
                                            people really dislike about
                                            Setuptools.
                                        </p>
                                        <p>
                                            First, zip files. Setuptools prefers
                                            zip files, for reasons that
                                            won&#8217;t mean much to you, and
                                            maybe are more historical than
                                            anything. When a distribution
                                            doesn&#8217;t indicate if it is
                                            zip-safe, Setuptools looks at the
                                            code and sees if it uses
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >__file__</span
                                                ></tt
                                            >, an if not it presumes that the
                                            code is probably zip-safe. The
                                            specific problem James cites is what
                                            appears to be a bug in Django, that
                                            Django looks for code and
                                            can&#8217;t traverse into zip files
                                            in the same way that Python itself
                                            can. Setuptools didn&#8217;t itself
                                            add anything to Python to make it
                                            import zip files, that functionality
                                            was added to Python some time
                                            before. The zipped eggs that
                                            Setuptools installs are using
                                            existing (standard!) Python
                                            functionality.
                                        </p>
                                        <p>
                                            That said, I don&#8217;t think
                                            zipping libraries up is all that
                                            useful, and while it
                                            <em>should</em> work, it
                                            doesn&#8217;t always, and it makes
                                            code harder to inspect and
                                            understand. So since it&#8217;s not
                                            that useful, I&#8217;ve disabled it
                                            when pip installs packages. I also
                                            have had it disabled on my own
                                            system for years now, by creating a
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >distutils.cfg</span
                                                ></tt
                                            >
                                            file with
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >[easy_install]</span
                                                >
                                                <span class="pre">zip_ok</span>
                                                <span class="pre">=</span>
                                                <span class="pre"
                                                    >False</span
                                                ></tt
                                            >
                                            in it. Sadly App Engine is forcing
                                            me to use zip files again, because
                                            of its absurdly small file
                                            limits&#8230; but that&#8217;s a
                                            different topic. (There is an
                                            experimental
                                            <tt class="docutils literal"
                                                ><span class="pre">pip</span>
                                                <span class="pre">zip</span></tt
                                            >
                                            command mostly intended for App
                                            Engine.)
                                        </p>
                                        <p>
                                            Another pain point is version
                                            management with
                                            <tt class="docutils literal"
                                                ><span class="pre"
                                                    >setup.py</span
                                                ></tt
                                            >
                                            and Setuptools. Indeed it is easy to
                                            get things messed up, and it is easy
                                            to piss people off by
                                            overspecifying, and sometimes things
                                            can get in a weird state for no good
                                            reason (often because of
                                            easy_install&#8217;s rather naive
                                            leap-before-you-look installation
                                            order). Pip fixes that last point,
                                            but it also tries to suggest more
                                            constructive and less painful ways
                                            to manage other pieces.
                                        </p>
                                        <p>
                                            Pip requirement files are an
                                            assertion of
                                            <strong
                                                >versions that work
                                                together</strong
                                            >. setup.py requirements (the
                                            Setuptools requirements) should
                                            contain two things:
                                            <strong>1</strong>: all the
                                            libraries used by the distribution
                                            (without which there&#8217;s no way
                                            it&#8217;ll work) and
                                            <strong>2</strong>: exclusions of
                                            the versions of those libraries that
                                            are
                                            <strong>known not to work</strong>.
                                            setup.py requirements should not be
                                            viewed as an assertion that by
                                            satisfying those requirements
                                            everything <em>will</em> work, just
                                            that it <em>might</em> work. Only
                                            the end developer, testing the
                                            system together, can figure out if
                                            it really works. Then pip gives you
                                            a way to record that working set
                                            (using
                                            <a
                                                class="reference external"
                                                href="http://pip.openplans.org/#freezing-requirements"
                                                >pip freeze</a
                                            >), separate from any single
                                            distribution or library.
                                        </p>
                                        <p>
                                            There&#8217;s also a lot of
                                            conflicts between Setuptools and
                                            package maintainers. This is kind of
                                            a proxy war between developers and
                                            sysadmins, who have very different
                                            motivations. It deserves a post of
                                            its own, but the conflicts are about
                                            more than just how Setuptools is
                                            implemented.
                                        </p>
                                        <p>
                                            I&#8217;d love if there was a
                                            language-neutral library
                                            installation and management tool
                                            that really worked. Linux system
                                            package managers are absolutely not
                                            that tool; frankly it is absurd to
                                            even consider them as an
                                            alternative. So for now we do our
                                            best in our respective language
                                            communities. If we&#8217;re going to
                                            move forward, we&#8217;ll have to
                                            acknowledge what&#8217;s come
                                            before, and the reasoning for it.
                                        </p>
                                    </div>
                                    <!-- <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="https://ianbicking.org/2008/12/14/a-few-corrections-to-on-packaging/"
    dc:identifier="https://ianbicking.org/2008/12/14/a-few-corrections-to-on-packaging/"
    dc:title="A Few Corrections To &#8220;On Packaging&#8221;"
    trackback:ping="https://ianbicking.org/2008/12/14/a-few-corrections-to-on-packaging/trackback/" />
</rdf:RDF> -->
                                </div>
                                <!-- END POST-ENTRY -->
                            </div>
                            <!-- END POST-CONTENT  -->
                        </div>
                        <!-- END-CONTAINER -->
                        <div class="post-header">
                            <h3 class="post-date">2008 12 14</h3>
                            <p class="post-categories">
                                <a
                                    href="index.html"
                                    title="View all posts in Packaging"
                                    rel="category tag"
                                    >Packaging</a
                                ><br /><a
                                    href="../python/index.html"
                                    title="View all posts in Python"
                                    rel="category tag"
                                    >Python</a
                                >
                            </p>
                            <p class="post-comments">
                                <a
                                    href="../../2008/12/14/a-few-corrections-to-on-packaging/index.html#comments"
                                    title="Comment on A Few Corrections To &#8220;On Packaging&#8221;"
                                    >Comments (40)</a
                                >
                            </p>
                            <p class="post-permalink">
                                <a
                                    href="../../2008/12/14/a-few-corrections-to-on-packaging/index.html"
                                    title="Permalink to A Few Corrections To &#8220;On Packaging&#8221;"
                                    rel="permalink"
                                    >Permalink</a
                                >
                            </p>
                        </div>
                        <!-- END POST-FOOTER -->
                    </div>
                    <!-- END POST -->

                    <div class="navigation">
                        <div class="alignleft"></div>
                        <div class="alignright"></div>
                    </div>
                    <!-- END NAVIGATION -->
                </div>
                <!-- END CONTENT -->
            </div>
            <!-- END CONTAINER  -->

            <div id="sidebar">
                <ul>
                    <li id="home-link">
                        <h2>
                            <a
                                href="../../index.html"
                                title="Ian Bicking: a blog"
                                >Home</a
                            >
                        </h2>
                    </li>
                    <li id="text-315934862" class="widget widget_text">
                        <h2 class="widgettitle">About</h2>
                        <div class="textwidget">
                            Ian is a developer with Mozilla,
                            <a href="http://ianbicking.appspot.com/projects"
                                >Python open source developer</a
                            >, actually uses
                            <a
                                href="https://plus.google.com/u/0/104537541227697934010/posts"
                                >Google+</a
                            >
                            more than
                            <a href="http://twitter.com/ianbicking">twitter</a>
                            and lives in Minneapolis.<br />
                            <span
                                class="gittip-0001"
                                gittip-username="ianbicking"
                            ></span>
                            <script
                                id="gittip-0001"
                                src="https://www.gittip.com/assets/widgets/0001.js"
                            ></script>
                        </div>
                    </li>
                    <li id="text-315934863" class="widget widget_text">
                        <div class="textwidget">
                            <!-- <script type="text/javascript">mbgc='f5f5f5';ww='160';mbc='cecece';bbc='3F79D5';bmobc='3b71c6';bbgc='4889F0';bmoc='3F79D5';bfc='FFFFFF';bmofc='ffffff';tlc='cecece';tc='6a6a6a';nc='6a6a6a';bc='6a6a6a';l='y';fs='16';fsb='13';bw='100';ff='4';lu='6a6a6a';pc='4889F0';wh='340';b='s'; pid='104537541227697934010';</script><script type="text/javascript" src="http://widgetsplus.com/google_plus_widget.js"></script> -->
                        </div>
                    </li>
                    <li id="archives-2" class="widget widget_archive">
                        <h2 class="widgettitle">Archives</h2>
                        <ul>
                            <li>
                                <a
                                    href="../../2012/10/index.html"
                                    title="October 2012"
                                    >October 2012</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2012/02/index.html"
                                    title="February 2012"
                                    >February 2012</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2011/04/index.html"
                                    title="April 2011"
                                    >April 2011</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2011/03/index.html"
                                    title="March 2011"
                                    >March 2011</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2010/09/index.html"
                                    title="September 2010"
                                    >September 2010</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2010/08/index.html"
                                    title="August 2010"
                                    >August 2010</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2010/05/index.html"
                                    title="May 2010"
                                    >May 2010</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2010/04/index.html"
                                    title="April 2010"
                                    >April 2010</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2010/03/index.html"
                                    title="March 2010"
                                    >March 2010</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2010/02/index.html"
                                    title="February 2010"
                                    >February 2010</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2010/01/index.html"
                                    title="January 2010"
                                    >January 2010</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2009/09/index.html"
                                    title="September 2009"
                                    >September 2009</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2009/05/index.html"
                                    title="May 2009"
                                    >May 2009</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2009/04/index.html"
                                    title="April 2009"
                                    >April 2009</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2009/01/index.html"
                                    title="January 2009"
                                    >January 2009</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2008/12/index.html"
                                    title="December 2008"
                                    >December 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2008/11/index.html"
                                    title="November 2008"
                                    >November 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2008/10/index.html"
                                    title="October 2008"
                                    >October 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2008/09/index.html"
                                    title="September 2008"
                                    >September 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2008/08/index.html"
                                    title="August 2008"
                                    >August 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2008/07/index.html"
                                    title="July 2008"
                                    >July 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2008/06/index.html"
                                    title="June 2008"
                                    >June 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2008/05/index.html"
                                    title="May 2008"
                                    >May 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2008/04/index.html"
                                    title="April 2008"
                                    >April 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2008/03/index.html"
                                    title="March 2008"
                                    >March 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2008/02/index.html"
                                    title="February 2008"
                                    >February 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2008/01/index.html"
                                    title="January 2008"
                                    >January 2008</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2007/11/index.html"
                                    title="November 2007"
                                    >November 2007</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2007/10/index.html"
                                    title="October 2007"
                                    >October 2007</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2007/09/index.html"
                                    title="September 2007"
                                    >September 2007</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2007/08/index.html"
                                    title="August 2007"
                                    >August 2007</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../2007/07/index.html"
                                    title="July 2007"
                                    >July 2007</a
                                >
                            </li>
                        </ul>
                    </li>
                    <li id="text-315934861" class="widget widget_text">
                        <div class="textwidget">
                            <a href="../../archive/index.html"
                                >The Older Archives</a
                            >
                        </div>
                    </li>
                    <li id="categories-1" class="widget widget_categories">
                        <h2 class="widgettitle">Categories</h2>
                        <ul>
                            <li class="cat-item cat-item-12">
                                <a
                                    href="../erlang/index.html"
                                    title="View all posts filed under Erlang"
                                    >Erlang</a
                                >
                            </li>
                            <li class="cat-item cat-item-11">
                                <a
                                    href="../html/index.html"
                                    title="View all posts filed under HTML"
                                    >HTML</a
                                >
                            </li>
                            <li class="cat-item cat-item-8">
                                <a
                                    href="../javascript/index.html"
                                    title="View all posts filed under Javascript"
                                    >Javascript</a
                                >
                            </li>
                            <li class="cat-item cat-item-15">
                                <a
                                    href="../licensing/index.html"
                                    title="View all posts filed under Licensing"
                                    >Licensing</a
                                >
                            </li>
                            <li class="cat-item cat-item-18">
                                <a
                                    href="../mozilla/index.html"
                                    title="View all posts filed under Mozilla"
                                    >Mozilla</a
                                >
                            </li>
                            <li class="cat-item cat-item-5">
                                <a
                                    href="../notech/index.html"
                                    title="View all posts filed under Non-technical"
                                    >Non-technical</a
                                >
                            </li>
                            <li class="cat-item cat-item-6">
                                <a
                                    href="../olpc/index.html"
                                    title="View all posts filed under OLPC"
                                    >OLPC</a
                                >
                            </li>
                            <li class="cat-item cat-item-14 current-cat">
                                <a
                                    href="index.html"
                                    title="View all posts filed under Packaging"
                                    >Packaging</a
                                >
                            </li>
                            <li class="cat-item cat-item-4">
                                <a
                                    href="../politics/index.html"
                                    title="View all posts filed under Politics"
                                    >Politics</a
                                >
                            </li>
                            <li class="cat-item cat-item-3">
                                <a
                                    href="../programming/index.html"
                                    title="View all posts filed under Programming"
                                    >Programming</a
                                >
                            </li>
                            <li class="cat-item cat-item-7">
                                <a
                                    href="../python/index.html"
                                    title="View all posts filed under Python"
                                    >Python</a
                                >
                            </li>
                            <li class="cat-item cat-item-10">
                                <a
                                    href="../ruby/index.html"
                                    title="View all posts filed under Ruby"
                                    >Ruby</a
                                >
                            </li>
                            <li class="cat-item cat-item-19">
                                <a
                                    href="../security/index.html"
                                    title="View all posts filed under Security"
                                    >Security</a
                                >
                            </li>
                            <li class="cat-item cat-item-16">
                                <a
                                    href="../silverlining.1"
                                    title="View all posts filed under Silver Lining"
                                    >Silver Lining</a
                                >
                            </li>
                            <li class="cat-item cat-item-20">
                                <a
                                    href="../programming/testing/index.html"
                                    title="View all posts filed under Testing"
                                    >Testing</a
                                >
                            </li>
                            <li class="cat-item cat-item-9">
                                <a
                                    href="../web/index.html"
                                    title="View all posts filed under Web"
                                    >Web</a
                                >
                            </li>
                            <li class="cat-item cat-item-13">
                                <a
                                    href="../zopeplone/index.html"
                                    title="View all posts filed under Zope/Plone"
                                    >Zope/Plone</a
                                >
                            </li>
                        </ul>
                    </li>
                    <li id="search-2" class="widget widget_search">
                        <form
                            id="searchform"
                            method="get"
                            action="../../index.html"
                        >
                            <div>
                                <input
                                    id="s"
                                    name="s"
                                    type="text"
                                    value=""
                                    tabindex="1"
                                    size="10"
                                />
                                <input
                                    id="searchsubmit"
                                    name="searchsubmit"
                                    type="submit"
                                    value="Find"
                                    tabindex="2"
                                />
                            </div>
                        </form>
                    </li>
                    <li
                        id="recent-posts-2"
                        class="widget widget_recent_entries"
                    >
                        <h2 class="widgettitle">Recent Posts</h2>
                        <ul>
                            <li>
                                <a
                                    href="../../index.html?p=291"
                                    title="Why doctest.js is better than Python&#8217;s doctest"
                                    >Why doctest.js is better than
                                    Python&#8217;s doctest</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../index.html?p=283"
                                    title="Python Application Package"
                                    >Python Application Package</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../index.html?p=277"
                                    title="Git-as-sync, not source-control-as-deployment"
                                    >Git-as-sync, not
                                    source-control-as-deployment</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../index.html?p=253"
                                    title="My Unsolicited Advice For PyPy"
                                    >My Unsolicited Advice For PyPy</a
                                >
                            </li>
                            <li>
                                <a
                                    href="../../index.html?p=250"
                                    title="A Python Web Application Package and Format (we should make one)"
                                    >A Python Web Application Package and Format
                                    (we should make one)</a
                                >
                            </li>
                        </ul>
                    </li>
                    <li
                        id="recent-comments-2"
                        class="widget widget_recent_comments"
                    >
                        <h2 class="widgettitle">Recent Comments</h2>
                        <ul id="recentcomments">
                            <li class="recentcomments">
                                <a
                                    href="http://www.mirsa.com.tr"
                                    rel="external nofollow"
                                    class="url"
                                    >havalandrma</a
                                >
                                on
                                <a
                                    href="../../2012/10/02/why-doctest-js-is-better-than-pythons-doctest/comment-page-1/index.html#comment-228633"
                                    >Why doctest.js is better than
                                    Python&#8217;s doctest</a
                                >
                            </li>
                            <li class="recentcomments">
                                <a
                                    href="http://redealmeidense.com.br/portalx/modules/"
                                    rel="external nofollow"
                                    class="url"
                                    >this website</a
                                >
                                on
                                <a
                                    href="../../2012/10/02/why-doctest-js-is-better-than-pythons-doctest/comment-page-1/index.html#comment-196267"
                                    >Why doctest.js is better than
                                    Python&#8217;s doctest</a
                                >
                            </li>
                            <li class="recentcomments">
                                Eric Pierce on
                                <a
                                    href="../../2012/10/02/why-doctest-js-is-better-than-pythons-doctest/comment-page-1/index.html#comment-195322"
                                    >Why doctest.js is better than
                                    Python&#8217;s doctest</a
                                >
                            </li>
                            <li class="recentcomments">
                                Paul Brian on
                                <a
                                    href="../../2012/10/02/why-doctest-js-is-better-than-pythons-doctest/comment-page-1/index.html#comment-195321"
                                    >Why doctest.js is better than
                                    Python&#8217;s doctest</a
                                >
                            </li>
                            <li class="recentcomments">
                                <a
                                    href="http://benjiyork.com"
                                    rel="external nofollow"
                                    class="url"
                                    >Benji York</a
                                >
                                on
                                <a
                                    href="../../2012/10/02/why-doctest-js-is-better-than-pythons-doctest/comment-page-1/index.html#comment-195320"
                                    >Why doctest.js is better than
                                    Python&#8217;s doctest</a
                                >
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>

            <div id="footer">
                <p>
                    &copy; 2013 Ian<!--
Does this commenting make me evil?
			|
			Thanks, <a href="http://wordpress.org/" title="WordPress">WordPress</a>
			|
			<a href="http://www.plaintxt.org/themes/barthelme/" title="Barthelme for WordPress" rel="follow">Barthelme</a> theme by <a href="http://scottwallick.com/" title="scottwallick.com" rel="follow">Scott</a>
			| <!-- The following is a link to the theme author's sponsor. Please consider its smallness and that Scott was nice enough to make this theme publically available. -->
                    Sponsor:
                    <a
                        href="http://www.active-sandals.com/womreefsan.html"
                        title="Support: Reef Sandals"
                        >Reef Sandals</a
                    >
                    | Valid
                    <a
                        href="http://validator.w3.org/check?uri=http://blog.ianbicking.org&amp;outline=1&amp;verbose=1"
                        title="Valid XHTML 1.0 Strict"
                        rel="nofollow"
                        >XHTML</a
                    >
                    &amp;
                    <a
                        href="http://jigsaw.w3.org/css-validator/validator?uri=https://ianbicking.org/wp-content/themes/Barthelme-ianb/style.css&amp;profile=css2&amp;warning=no"
                        title="Valid CSS"
                        rel="nofollow"
                        >CSS</a
                    >
                    | --> RSS:
                    <a
                        href="../../feed/rss/index.html"
                        title="Ian Bicking: a blog RSS 2.0 (XML) Feed"
                        rel="alternate"
                        type="application/rss+xml"
                        >Posts</a
                    >
                    &amp;
                    <a
                        href="../../comments/feed/index.html"
                        title="Ian Bicking: a blog Comments RSS 2.0 (XML) Feed"
                        rel="alternate"
                        type="application/rss+xml"
                        >Comments</a
                    >
                </p>
            </div>
        </div>
        <!-- END WRAPPER -->

        <!-- Somehow 41 queries occured in 1.790 seconds. Magic! -->
        <!-- The "Barthelme" theme copyright (c) 2006 Scott Allan Wallick - http://www.plaintxt.org/themes/ -->

        <!-- Google Analytics -->
        <script
            src="http://www.google-analytics.com/urchin.js"
            type="text/javascript"
        ></script>
        <script type="text/javascript">
            _uacct = "UA-2442258-1";
            urchinTracker();
        </script>
    </body>
</html>
