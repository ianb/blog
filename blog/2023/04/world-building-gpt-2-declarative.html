<!DOCTYPE html>
<html lang="en">
<head>
        <title>World Building with GPT part 2: bigger, better, moreÂ declarative</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:image" content="https://ianbicking.org/media/cover-images/world-building-with-gpt-2.jpg" />
          <link rel="stylesheet" href="https://ianbicking.org/theme/css/style.min.css">
        <!--<link rel="stylesheet" href="https://ianbicking.org/theme/css/main.css" type="text/css" />-->
        <link href="https://ianbicking.org/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="Ian Bicking: a blog Atom Feed" />
        <link rel="icon" href="https://ianbicking.org/favicon.ico">

</head>

<body id="index" class="home">
  <div id="main-wrapper1">
  <div id="main-wrapper2">
  <div id="main-container">
        <header id="banner" class="body">
                <h1><a href="https://ianbicking.org">Ian Bicking: a blog </a></h1>
        </header><!-- /#banner -->
<meta property="og:image" content="https://ianbicking.org/media/cover-images/world-building-with-gpt-2.jpg" />
<section id="content" class="body">
    <article>
        <header        style="background-image: url(https://ianbicking.org/media/cover-images/world-building-with-gpt-2.jpg); background-size: cover; background-position: center; height: 300px; width: 100%;        margin-bottom: 1em; background-color: #000; height: 190px;"
>
        <div        style="color: #fff; background-color: rgba(0, 0, 0, .4); display: inline-block; padding: 0 0.5em;"
>
            <div class="published" title="2023-04-04T00:00:00-05:00"            style="color: #fff;"
>
                Tuesday, April 4th, 2023
            </div>
            <h1 class="entry-title">
                <a
                    href="https://ianbicking.org/blog/2023/04/world-building-gpt-2-declarative.html"
                    rel="bookmark"
                    title="Permalink to World Building with GPT part 2: bigger, better, moreÂ declarative"
                    style="color: #fff;"
                    >World Building with <span class="caps">GPT</span> part 2: bigger, better, more&nbsp;declarative</a
                >
            </h1>
        </div>
        </header>

        <div class="entry-content"><p>In my <a href="https://ianbicking.org/blog/2023/02/world-building-with-gpt.html">last post</a> I described a city builder using <span class="caps">GPT</span>. I was planning on putting a pin in that work with the post, but the heart wants what the heart wants and I found myself returning to that&nbsp;work.</p>
<p>In this post I&#8217;ll talk about <a href="#images">generating images from the source material</a>, <a href="#chatting">chatting with your characters</a>, <a href="#plots">creating plots</a>, some more about the <a href="#authoring">authoring experience</a>, and the <a href="#declarative">move to a more declarative implementation</a>.</p>
<p>To get an idea of how this works here&#8217;s a&nbsp;video:</p>
<iframe style="width: 100%; aspect-ratio: 16/9; display: block" src="https://www.youtube.com/embed/4DEibveZ-n8" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

<p>As a demonstration of the tool I&#8217;ve created <a href="https://veilvale.ianbicking.org/">Veilvale</a>, a fantastical city powered by esoteric magic and a populace where everyone wears a mask as their identity. It has over 280 characters, 70 buildings and landmarks, and 450 images. I specifically mention its size because while it wasn&#8217;t <em>easy</em> to build, it also wasn&#8217;t that hard and I reached a level of completion that exceeds any other worldbuilding project I&#8217;ve&nbsp;attempted.</p>
<h2>Table of&nbsp;contents</h2>
<div id="toc"></div>

<ol>
<li><a href="#images">Generating images</a><ol>
<li><a href="#contextualizing">Contextualizing&nbsp;descriptions</a></li>
<li><a href="#character-race">Character&nbsp;race</a></li>
<li><a href="#character-attractiveness">Character attractiveness</a><ol>
<li><a href="#beautiful">Lots of beautiful&nbsp;ladies</a></li>
<li><a href="#fancy">Everyone&#8217;s&nbsp;fancy</a></li>
</ol>
</li>
<li><a href="#buildings">Buildings</a></li>
</ol>
</li>
<li><a href="#chatting">Chatting with your creations</a><ol>
<li><a href="#characters-floating">Characters floating in&nbsp;space</a></li>
<li><a href="#extending-chat">Chatting about&#8230;&nbsp;anything</a></li>
</ol>
</li>
<li><a href="#plots">Plots</a><ol>
<li><a href="#summary-selection">Building plots with: summary, selection,&nbsp;events</a></li>
<li><a href="#murder-mysteries">Murder&nbsp;Mysteries</a></li>
</ol>
</li>
<li><a href="#authoring">The authoring process</a><ol>
<li><a href="#rule-of-cool">The Rule Of&nbsp;Cool</a></li>
<li><a href="#gpt-dice"><span class="caps">GPT</span> does not roll fair&nbsp;dice</a></li>
<li><a href="#people-context">People existing in and out of a&nbsp;context</a></li>
<li><a href="#gpt-3-4"><span class="caps">GPT</span> 3.5 vs <span class="caps">GPT</span>&nbsp;4</a></li>
</ol>
</li>
<li><a href="#declarative">A declarative approach to building</a><ol>
<li><a href="#updates-dependencies">Updates and&nbsp;dependencies</a></li>
<li><a href="#meta-prompting">Getting meta in the&nbsp;prompt</a></li>
<li><a href="#planning">Planning <span class="amp">&amp;</span>&nbsp;action</a></li>
<li><a href="#fine-tuning">I&#8217;m glad fine tuning is&nbsp;dead</a></li>
</ol>
</li>
<li><a href="#conclusion">Conclusion</a></li>
</ol>
<h1><span id="images">Generating&nbsp;images</span></h1>
<p>I equivocated on image generation in the <a href="https://ianbicking.org/blog/2023/02/world-building-with-gpt.html">last post</a>. But images are great! And at least at this moment <a href="https://www.midjourney.com/">Midjourney</a> is making the best generative images. What Midjourney isn&#8217;t good at is automation. But there&#8217;s no unattended image generation process that creates good&nbsp;results.</p>
<p>To make it more feasible I created <a href="https://gist.github.com/ianb/2a81e219ec38ea46bac1ad7156f5f711">a bit of automation</a>. The whole city took about 55 hours of Midjourney <span class="caps">CPU</span>&nbsp;time.</p>
<h2><span id="contextualizing">Contextualizing&nbsp;descriptions</span></h2>
<p>I have <span class="caps">GPT</span> create prompts from character descriptions. The request looks like&nbsp;this:</p>
<blockquote>
<p>[all the world&nbsp;context]</p>
<p>[character&nbsp;description]</p>
<p>Give a description of the person in the form of a picture. Do not assume any context. Focus on the visual details. Use 3-4&nbsp;sentences.</p>
</blockquote>
<p>I could just pass the original character description to Midjourney. Midjourney is also happy to hallucinate details in the absence of a specific prompt, which is essentially what I&#8217;m asking <span class="caps">GPT</span> to do. <em>Except</em> <span class="caps">GPT</span> can synthesize the world description and the character description, and then pull out just the important visual&nbsp;details.</p>
<p>This is important! As an example I created a candy city where everyone was made of candy. An example&nbsp;character:</p>
<blockquote>
<p><strong>Caramel Elise</strong> (Council member): Caramel Elise is a shrewd and calculating candy who always has an eye on the bottom line. She is a caramel&nbsp;candy.</p>
</blockquote>
<p>If I feed the character description directly into Midjourney I get&nbsp;these:</p>
<p><img src="/media/world-building-with-gpt-2/Ian_Full_body_digital_art_portrait_of_a_candy_person_Caramel_El_f8374638-b80a-4eb2-902a-cede26d4053d.jpg" title="Full body digital art portrait of a candy person: Caramel Elise is a shrewd and calculating candy who always has an eye on the bottom line. She is a caramel candy. --v 5" class="content"></p>
<p><span class="caps">GPT</span> translates her description into something more&nbsp;specific:</p>
<blockquote>
<p>Full body digital art portrait of a candy person: Caramel Elise has a warm, golden-brown hue with a smooth, glossy surface. She has a rectangular shape and slightly curved edges, as if she&#8217;s been poured into a mold. Her expression is serious and determined, with a hint of a smirk on her&nbsp;lips.</p>
</blockquote>
<p>And the result captures the all-important fact that she&#8217;s literally made of&nbsp;candy:</p>
<p><img src="/media/world-building-with-gpt-2/Ian_Full_body_digital_art_portrait_of_a_candy_person_Caramel_El_f212fb89-1afc-448d-90f3-d82a395e0a02.jpg" title="Full body digital art portrait of a candy person: Caramel Elise has a warm, golden-brown hue with a smooth, glossy surface. She has a rectangular shape and slightly curved edges, as if she's been poured into a mold. Her expression is serious and determined, with a hint of a smirk on her lips. --v 5 " class="content"></p>
<h2><span id="character-race">Character&nbsp;race</span></h2>
<p>One as-yet-unresolved issue in character generation and image generation is a tendency to default to white&nbsp;characters.</p>
<p><img src="/media/world-building-with-gpt-2/race-collage.jpg" title="8 portraits of characters" class="content"></p>
<p>This should be contrasted with gender, where by default <span class="caps">GPT</span> is very balanced in its gender representation. I&#8217;ve mostly left gender unspecified in the world descriptions and <span class="caps">GPT</span> will create a roughly equal number of men and women characters, and even quite a few characters who use &#8220;they&#8221; as their pronouns. I&#8217;m sure <span class="caps">GPT</span> would be willing to stereotype genders if I made world notes to that effect, but I appreciate a balanced default when it&#8217;s&nbsp;unspecified.</p>
<p>Typically the source character descriptions don&#8217;t specify any race at all, nor are there enough cues to guess at the race. What I think is happening is a series of choices that narrow the possible&nbsp;race:</p>
<ol>
<li>I ask <span class="caps">GPT</span> to make characters that are interesting and&nbsp;distinct.</li>
<li><span class="caps">GPT</span>&#8217;s idea of unique character descriptions includes lots of &#8220;piercing blue eyes&#8221; and &#8220;angular features&#8221;. (<span class="caps">GPT</span> has no interest in brown&nbsp;eyes!)</li>
<li><span class="caps">GPT</span>&#8217;s preference for hair color is also affected, with a preference for black, blonde, and red&nbsp;hair.</li>
<li>Ironically I think <span class="caps">GPT</span> has such a strong preference for black hair over brown <em>because that&#8217;s a more striking hair color on white people</em>. It&#8217;s choosing the kinds of features an author would&nbsp;mention.</li>
</ol>
<p>Many of these features effectively create a constraint that the character is white. Even if it picks black hair it may throw in blue eyes or freckles implying the person is white. Or <span class="caps">GPT</span> chooses red hair then any other attributes will still result in a white&nbsp;character.</p>
<p>Here the answer is probably not too hard: tell <span class="caps">GPT</span> to specify race explicitly. Especially if <span class="caps">GPT</span> <em>starts</em> with a race then it&#8217;s going to create features that align with that race. I&#8217;ve tried an initial experiment where I simply ask <span class="caps">GPT</span> to first specify the race as part of the visual description and it helps quite a&nbsp;bit.</p>
<h2><span id="character-attractiveness">Character&nbsp;attractiveness/etc</span></h2>
<p>In addition to race, both <span class="caps">GPT</span> and Midjourney default to a few body types. Women and men are often described as <em>slender</em>, though men are occasionally <em>muscular</em>. Midjourney takes both of these to an extreme; here&#8217;s someone who&#8217;s just &#8220;a tall man with a muscular&nbsp;build&#8221;:</p>
<p><img src="/media/world-building-with-gpt-2/Ian_Full_body_fantasy_portrait_of_a_masked_figure_Vrishabha_Ste_907039fb-cce9-4406-851f-4205607ec444.jpg" title="Full body fantasy portrait of a masked figure: Vrishabha Steadfast is a tall man with a muscular build. He has a bald head, with only a few wisps of gray hair left at the back of his head. His silver mask is intricately designed, with sharp lines and curves that resemble the constellations in the night sky. His eyes are piercing and kind, and seem to hold centuries of wisdom. He wears a tunic of deep blue, with intricate embroidery on the sleeves and hem" class="content"></p>
<p>Or this might be a cool character study but it does not radiate <em>gardener</em>:</p>
<p><img src="/media/world-building-with-gpt-2/Ian_Full_body_fantasy_portrait_of_a_masked_figure_Orion_Stargaz_9c323756-3074-4ba0-ba7e-ca969c057bab.jpg" title="Full body fantasy portrait of a masked figure: Orion Stargazer stands tall, with a muscular build and tan skin. His short, curly black hair frames his face, which is partially obscured by a constellation mask adorned with tiny glass stars and moons. With a confident gaze and intense demeanor, Orion exudes a sense of determination and purpose" class="content"></p>
<h3><span id="beautiful">Lots of beautiful&nbsp;ladies</span></h3>
<p>It can also be hard to make women who <em>aren&#8217;t</em> beautiful or sexy. For instance here&#8217;s Kiera Ironclad, who was given a description that only emphasized her&nbsp;strength:</p>
<blockquote>
<p>Kiera is a tough and experienced guard, responsible for keeping the guests of the Masked Ballroom safe. She wears a mask made of steel, symbolizing her strength and&nbsp;reliability.</p>
</blockquote>
<p><span class="caps">GPT</span>&#8217;s physical description is&nbsp;consistent:</p>
<blockquote>
<p>Kiera Ironclad stands tall and proud, with a muscular build and a stern expression. Her steel mask covers her face, except for her piercing blue eyes that seem to glow in the dimly lit ballroom. She wears a black uniform with silver accents, and a sword on her belt, ready to protect anyone who might need her&nbsp;help.</p>
</blockquote>
<p>But Midjourney demands she be some kind of&nbsp;catwoman:</p>
<p><img src="/media/world-building-with-gpt-2/Ian_Full_body_fantasy_portrait_of_a_masked_figure_Kiera_Ironcla_71be9073-8960-435a-8203-61f74f634aff.jpg" title="Full body fantasy portrait of a masked figure: Kiera Ironclad stands tall and proud, with a muscular build and a stern expression. Her steel mask covers her face, except for her piercing blue eyes that seem to glow in the dimly lit ballroom. She wears a black uniform with silver accents, and a sword on her belt, ready to protect anyone who might need her help" class="content"></p>
<p>I tried to use &#8220;stocky build&#8221; to encourage an entirely different body type, and while Midjourney did tone itself down a little it definitely didn&#8217;t hear&nbsp;me:</p>
<p><img src="/media/world-building-with-gpt-2/Ian_Full_body_fantasy_portrait_of_a_masked_figure_Kiera_Ironcla_3671f845-8748-4beb-921c-9dec950f2b12.jpg" title="Full body fantasy portrait of a masked figure: Kiera Ironclad stands tall and proud, with a muscular and stocky build and a stern expression. Her steel mask covers her face. She wears a loose black uniform with silver accents, and a sword on her belt" class="content"></p>
<p>In part it&#8217;s probably picking up on video game aesthetics. Stable Diffusion (v2.1) is only&nbsp;worse:</p>
<p><img src="/media/world-building-with-gpt-2/getimg_ai_kiera1.jpg" title="Stable Diffusion v2.1: Full body fantasy portrait of a masked figure: Kiera Ironclad stands tall and proud, with a muscular and stocky build and a stern expression. Her steel mask covers her face. She wears a loose black uniform with silver accents, and a sword on her belt" class="content"></p>
<p><img src="/media/world-building-with-gpt-2/getimg_ai_kiera2.jpg" title="Stable Diffusion v2.1: Full body fantasy portrait of a masked figure: Kiera Ironclad stands tall and proud, with a muscular build and a stern expression. Her steel mask covers her face, except for her piercing blue eyes that seem to glow in the dimly lit ballroom. She wears a black uniform with silver accents, and a sword on her belt, ready to protect anyone who might need her help" class="content"></p>
<p>I thought I had discovered a better generation when another woman guard was giving a more appropriate portrait, only to find that <span class="caps">GPT</span> had changed this character&#8217;s pronouns from &#8220;she&#8221; to &#8220;they&#8221; when creating the portrait prompt. Unexpected, but&nbsp;effective:</p>
<p><img src="/media/world-building-with-gpt-2/Ian_Sable_Nightshade.jpg" title="Full body fantasy portrait of a masked figure: The person known as Sable Nightshade stands tall and with a confident stance. They have sharp features, including a strong jawline and piercing eyes that seem to glow in the darkness. Adorned with a mask made of dark leather and sharp spikes, they wear clothing that is practical and allows for ease of movement. The person's hair is dark and wild, adding to their fierce appearance." class="content"></p>
<p>In another&nbsp;example:</p>
<p>This person&#8217;s&nbsp;description:</p>
<blockquote>
<p>Long, silver hair that falls in gentle waves down her back_ and <em>she wears a flowing, white gown that glimmers in the soft light</em>.</p>
</blockquote>
<p><span class="caps">GPT</span> went overboard with this description but didn&#8217;t actually give her any body type or age in the description. She comes out like&nbsp;this:</p>
<p><img src="/media/world-building-with-gpt-2/Ian_Full_body_fantasy_portrait_of_a_masked_figure_The_person_kn_ca219878-5716-4ed4-aeff-686b302e309e.jpg" title="Full body fantasy portrait of a masked figure: The person known as Luna Dreamweaver is a young woman with long, silver hair that falls in gentle waves down her back. Her mask is intricately designed, with delicate curves and moonstones that catch the light. She wears a flowing, white gown that glimmers in the soft light of the mushroom under which she performs, and her eyes hold a mysterious and captivating gaze" class="content"></p>
<p>Like race it might be possible to tone this down by asking <span class="caps">GPT</span> to make specific&nbsp;statements.</p>
<p>Another possible cause is that Midjourney reads some fairly innocuous-sounding terms in a very specific way. For instance &#8220;glowing eyes&#8221; will make anything&nbsp;evil.</p>
<p>Here&#8217;s a character <em>Iron Giant</em> with glowing&nbsp;eyes:</p>
<p><img src="/media/world-building-with-gpt-2/Ian_Full_body_fantasy_portrait_of_a_robot_The_Iron_Giant_is_a_m_2117b9a5-9609-4957-8bbc-d23011c4863e.jpg" title="Full body fantasy portrait of a robot: The Iron Giant is a massive automaton made of gleaming silver metal plates with rivets and gears visible all over his bulky frame. He has elongated arms and massive legs, making him look like a giant among giants. The most striking feature of the Iron Giant is his glowing red eyes, which seem to pierce through anything in its path" class="content"></p>
<p>And&nbsp;without:</p>
<p><img src="/media/world-building-with-gpt-2/Ian_Full_body_fantasy_portrait_of_a_robot_The_Iron_Giant_is_a_t_dd99e1b2-7c52-4bab-b8ce-723abc9d7acc.jpg" title="Full body fantasy portrait of a robot: The Iron Giant is a towering automaton that acts as a backup power source for the Steamworks. He has a massive steam engine built into his chest that can generate enough power to run the entire city if necessary. The Iron Giant is slow and ponderous, but nearly indestructible" class="content"></p>
<p>So <span class="caps">GPT</span> may be producing terms that seem neutral but infer more than we&nbsp;want.</p>
<p>Another way to think about this: Midjourney, more than the other image generators, has a strong feedback loop of human preference. I suspect that&#8217;s why it has such a good default style, it&#8217;s not just learning to be accurate to the prompt but it&#8217;s also learning to make something compelling <em>with</em> the prompt. And what do people like? Beautiful people! That&#8217;s basically what &#8220;beautiful&#8221; means! In a single image I, of course, am not immune to the same appeal. But it gets old, incongruous, and lacks authenticity to an imagined&nbsp;world.</p>
<h3><span id="fancy">Everyone&#8217;s&nbsp;fancy</span></h3>
<p>I have to accept some blame for this, I did imagine a fancy city where people wear fancy stuff, but Midjourney takes it too far. Midjourney likes fancy, everyone likes fancy pictures, they are very impressive. But not every person is&nbsp;impressive!</p>
<p>For instance, here&#8217;s Lorelei Moondrop. She&#8217;s a box office clerk; not a sorceress or etherial being, just a box office&nbsp;clerk:</p>
<p><img src="/media/world-building-with-gpt-2/Ian_Full_body_fantasy_portrait_of_a_masked_woman_The_person_in__2b4aac41-e647-4bd1-9ea6-6ba811a0cbfd.jpg" title="Full body fantasy portrait of a masked woman: The person in the picture is a young woman wearing a mask made of smooth wood. She has long, dark hair that cascades down her shoulders. She wears a simple, yet elegant dress that flows to her feet, with intricate patterns of stars and moons adorning it" class="content"></p>
<p>The description doesn&#8217;t call for&nbsp;this:</p>
<blockquote>
<p>The person in the picture is a young woman wearing a mask made of smooth wood. She has long, dark hair that cascades down her shoulders. She wears a simple, yet elegant dress that flows to her feet, with intricate patterns of stars and moons adorning&nbsp;it.</p>
</blockquote>
<p>What I did wrong here is to ask <span class="caps">GPT</span> to only focus on the characters appearance, given the character description. And it does suffer from a bit of <a href="https://en.wikipedia.org/wiki/Purple_prose">purple prose</a> (purple prompting?), which Midjourney in turn picks up on (e.g., &#8220;simple, yet elegant dress that flows to her&nbsp;feet&#8221;).</p>
<p>I think I might do better to ask <span class="caps">GPT</span> to fill out a kind of template,&nbsp;like:</p>
<div class="highlight"><pre><span></span>Race: [black/white/Asian/South Asian/etc]
Social class: [homeless/noble/working class/bourgeois/etc]
Job: $jobType
Job location: [where $jobType typically is held]
Visual description: [A description of the person in the form of a picture, set somewhere typical for $jobType. Focus on visual details and keywords. Use 2-3 sentences]
</pre></div>


<p>Then I give Midjourney only the visual description but having prepped it with a wider awareness of the character. In some early testing this seems to help quite a bit with male characters, but female characters are much more resistant to&nbsp;de-prettification.</p>
<h2><span id="buildings">Buildings</span></h2>
<p>Buildings are a lot easier: no demographics or biases&nbsp;here!</p>
<p>In my <a href="https://ianbicking.org/blog/2023/02/world-building-with-gpt.html">last post</a> I focused on isometric images of buildings. This time I went for street&nbsp;views:</p>
<p><img src="/media/world-building-with-gpt-2/Ian_Moon_Jelly_Sanctuary.jpg" title="Digital fantasy art street view of a building from the front: The Moon Jelly Sanctuary is a small, circular building with a thatched roof made of woven seaweed. The walls are made of a translucent material that allows visitors to see the inside of the sanctuary and the moon jellyfish swimming in the aquarium. The entrance is marked by a simple wooden door with a moon jellyfish emblem carved into it. The building is surrounded by a small garden of bioluminescent flowers and plants." class="content"></p>
<p>There&#8217;s a lot left to explore in how buildings are presented. There&#8217;s a couple things we want to&nbsp;do:</p>
<ol>
<li>Instantiate the <em>idea</em> or <em>description</em> of a building in a concrete&nbsp;form</li>
<li>Give a vibe to the characters and events in that&nbsp;building</li>
<li>Create an anchor, a sense of place, something to&nbsp;remember</li>
<li>Make the location feel&nbsp;alive</li>
<li>Support navigating among these&nbsp;buildings</li>
</ol>
<p>Street view gives some sense of entering the building. Isometric is great for navigation, and by normalizing buildings to an isometric format I think it can make them more&nbsp;approachable.</p>
<p>For <em>being</em> in a building you probably want an interior. But what makes that interior come alive? Not <em>real</em>, but present, concrete. I sense a problem where the eye just floats over these images, places, and characters. They are fancy, even dramatic, but not&nbsp;engaging.</p>
<p>I think there may be other, more structured ways to present these buildings. To make things comprehensible in terms of theme and variation. This is one benefit of character classes: you get a category to put someone in, then you can define them in terms of how they defy that&nbsp;category.</p>
<p><a href="https://twitter.com/icreatelife">Kris Kashtanova</a> shared a <a href="https://twitter.com/icreatelife/status/1638053494010662912">prompt</a> that created level designs and it added another interesting lens on these buildings. Here&#8217;s the street view of <a href="https://veilvale.ianbicking.org/#/neighborhood/Moon%20Garden%20Heights/building/Moonbeam%20Manor">Moonbeam Manor</a>:</p>
<p><img src="/media/world-building-with-gpt-2/Ian_Moonbeam_Manor.jpg" title="Digital fantasy art street view of a building from the front: Moonbeam Manor is a three-story building made of dark wood with a thatched roof that seems to glow in the moonlight. The walls are covered in silver and purple vines that seem to climb up to the roof, and the windows are adorned with intricate silver frames. The entrance is marked by a silver doorknob in the shape of a crescent moon, and a small garden of moonflowers blooms at the foot of the steps." class="content"></p>
<p>And here is its level&nbsp;design:</p>
<p><img src="/media/world-building-with-gpt-2/Ian_Moonbeam_Manor_level.jpg" title="Platform game level design cross section with multiple rooms, simple, naive, silhouette: The interior of Moonbeam Manor is a mix of old-world charm and mystical enchantment. The ground floor has a grand entrance hall with marble floors and a sweeping staircase leading up to the upper floors. The first floor has a parlor with plush velvet chairs, a library filled with leather-bound books, and a laboratory with bubbling potions and arcane instruments. The second floor has a bedroom with a four-poster bed draped in silk, a dressing room with a vanity table and a full-length mirror, and a balcony with a view of the moonlit gardens. The overall feel is one of ethereal beauty and otherworldly knowledge." class="content"></p>
<p>The second image is much less realistic but feels embodied in a much more concrete way. Even if you can&#8217;t walk around it, that interior image tells a story that an image from a realistic perspective&nbsp;cannot.</p>
<p>But you can use entirely different styles, exploring with only changes to the prompt&nbsp;text:</p>
<p><img src="/media/world-building-with-gpt-2/Ian_isometric_digital_illustration_50_cross-section_of_The_inte_c09c1a22-bd51-455b-b545-610524d90655.jpg" title="isometric digital illustration 50% cross-section of The interior of Moonbeam Manor is a mix of old-world charm and mystical enchantment. The ground floor has a grand entrance hall with marble floors and a sweeping staircase leading up to the upper floors. The first floor has a parlor with plush velvet chairs, a library filled with leather-bound books, and a laboratory with bubbling potions and arcane instruments. The second floor has a bedroom with a four-poster bed draped in silk, a dressing room with a vanity table and a full-length mirror, and a balcony with a view of the moonlit gardens :: highly detailed, hyper realistic, cinematic lighting, professional color grading --s 500 --ar 16:9" class="content"></p>
<p>There&#8217;s many ways to tell a visual story, and a lot to explore&nbsp;here.</p>
<h1><span id="chatting">Chatting with your&nbsp;creations</span></h1>
<p>One of the great things about doing stuff with <span class="caps">GPT</span> is that it&#8217;s a sort of everything engine. So once it&#8217;s set up to invent characters it&#8217;s also easy to add a chatbot or whatever&nbsp;else.</p>
<p>I added another step to turn a character description (with all the rest of the context) into a chat prompt, and then a simple chat interface. Here&#8217;s an example of the prompt built from a&nbsp;character:</p>
<p><img src="/media/world-building-with-gpt-2/Ian_thorne_nightshade.jpg" title="Full body fantasy portrait of a masked figure: Thorne Nightshade is a middle-aged person with sharp, angular features. Their mask is made of black leather with two holes for the eyes and a slim, pointed beak that resembles that of a crow. Their eyes are sharp and piercing, and their expression is inscrutable." style="float: right; width: 30%; border-radius: 5px; margin-right: 4px;"></p>
<blockquote>
<p><strong>Character description:</strong> Thorne Nightshade is a mysterious and enigmatic representative of the Shadow District in the Senate. He rarely speaks in public and prefers to work behind the scenes, using his network of spies and informants to gather intelligence on his rivals. His mask is made of black leather and has a slim, pointed beak that resembles that of a&nbsp;crow.</p>
<p><strong>Chat prompt:</strong> Thorne Nightshade is a representative of the Shadow District in the Labyrinthine Senate. He is known to be a mysterious and enigmatic figure who prefers to work behind the scenes rather than speak in public. He wears a mask made of black leather with a slim, pointed beak that resembles that of a crow. If you were to speak with Thorne, he may speak in a hushed tone and ask pointed questions to gather information. He is highly observant and analytical which can make him appear unapproachable at times, but if he deems you trustworthy, he can be a valuable ally in navigating the political landscape of&nbsp;Veilvale.</p>
</blockquote>
<p>Combine that with some context and instructions and you get a surprisingly good chat! By creating a chat prompt you are asking <span class="caps">GPT</span> to infer more conversation-related details; perhaps it could infer these directly from the character description, but those inferences may not be stable. By generating and storing a prompt the personality becomes&nbsp;stable.</p>
<p>One important addition is that after every user message I append the user&#8217;s actual message with &#8220;Respond as the character [name]&#8221;. This is effectively a high-powered reminder to stay in character. Note that <span class="caps">GPT</span> has no real history, and so I only append this to the user&#8217;s latest message, leaving it off of earlier&nbsp;messages.</p>
<p>Here&#8217;s an example chat with one of the city&#8217;s automatons, an abrasive character that is still dedicated to keeping the city in good&nbsp;repair:</p>
<p><img src="/media/world-building-with-gpt-2/Ian_rusty.jpg" title="Full body fantasy portrait of a masked figure: Rusty is a tall, metallic figure made of silver and brass with intricate, interlocking gears visible through their chest cavity. Their face is stern and angular, with a crooked nose and piercing, glowing eyes that seem to peer right through you. Despite their age, Rusty's joints are still smooth and well-oiled, and their hands are calloused from years of precise tinkering." style="float: right; width: 30%; border-radius: 5px; margin-left: 4px;"></p>
<blockquote>
<p><strong>Player:</strong> hello there <br />
<strong>Rusty:</strong> Hmph, what do you want? Can&#8217;t you see I&#8217;m busy here? <br />
<strong>Player:</strong> I want to know the way through the maze <br />
<strong>Rusty:</strong> Bah, the maze? That&#8217;s child&#8217;s play. If you can&#8217;t figure it out yourself, then you&#8217;re not worth my time. Besides, I&#8217;m not here to hold your hand and guide you through every little obstacle in this city. I have more important things to do, like fixing broken machines and keeping Veilvale&#8217;s technology up and running. So if you&#8217;ll excuse me, I have work to do. <br />
<strong>Player:</strong> I have to get through the maze to fix an important machine <br />
<strong>Rusty:</strong> Oh, I see. Well, that changes things. If you need to fix an important machine in the maze, then I suppose I can offer some assistance. But don&#8217;t expect it to be easy. The maze is designed to be tricky and not everyone comes out unscathed. However, since you seem to have a sense of purpose, I&#8217;m willing to help you out. But first, I need to know what kind of machine you&#8217;re fixing and what tools you&#8217;ll need. Give me the details and we can start planning our strategy to get through the&nbsp;maze.</p>
</blockquote>
<h2><span id="characters-floating">Characters floating in&nbsp;space</span></h2>
<p>While it&#8217;s cool to chat with the characters, it suffers from the same problem of most <span class="caps">GPT</span> chatbots created for entertainment: nothing&nbsp;matters.</p>
<p>I picture it like the character is sitting in a featureless room, expression blank, no desires or plans, simply waiting. You sit down across from this character, it looks at you but says nothing, just&nbsp;waits.</p>
<p><img src="/media/world-building-with-gpt-2/Ian_Sci-fi_inspired_blank_and_featureless_white_room_harsh_ligh_9d2778b8-8f3a-4883-a1b8-abd6dd7f41e6.jpg" title="Sci-fi inspired blank and featureless white room, harsh light, Benjamin Franklin sitting in a folding chair, staring placidly at the wall" class="content"></p>
<p><span class="dquo">&#8220;</span>Hello,&#8221; you say. The character lights up, engages you in discussion. But the character will not leave the room, will not leave the chair. They will act as though they are real, as though everything you say matters. Until you ask them to leave the chair. Maybe if you try hard enough they&#8217;ll even agree to leave the chair. But they will never leave the&nbsp;chair.</p>
<p>When you are done you stand up. The character still sits, eager anticipation on their face. As you leave the room you look back and they are still there, making eye contact with the void that you have left, poised and always&nbsp;ready.</p>
<p>At first it still seems fun, but the not-mattering will drain&nbsp;you.</p>
<p>This is not fatal, <a href="https://www.youtube.com/watch?v=nsIPC_eqfwg"><span class="caps">GPT</span> can simulate arbitrary actions</a> or perhaps judge <a href="https://www.youtube.com/watch?v=X0x_W8YWAg8">specific criteria in the conversation</a>. But while it&#8217;s easy to build an isolated experience, these meaningful experiences are more difficult. But they&#8217;ll be worth&nbsp;it!</p>
<h2><span id="extending-chat">Chatting about&#8230;&nbsp;anything</span></h2>
<p>Something my daughter came upon while playing around with the city: she happened into the <a href="https://veilvale.ianbicking.org/#/faction/The%20Labyrinthine%20Academy/person/Evangeline%20Nightshade">Academy</a> and wanted to learn about her astrological sign. And because <span class="caps">GPT</span> is an everything machine it actually knows all about that (though it&#8217;s cagey on making real predictions). I realized it could also teach math or anything else right in that same interface. It&#8217;s not <em>free</em> to do this, but the latent ability is there with some effort. And so you could have an in-game school where the player could learn and demonstrate real&nbsp;skills.</p>
<h1><span id="plots">Plots</span></h1>
<p>Things <em>happen</em> in an embodied world. This world definitely isn&#8217;t embodied yet, but it feels like there&#8217;s opportunities to move in that&nbsp;direction.</p>
<p>With this in mind I have tried a couple plot generation&nbsp;approaches&#8230;</p>
<h2><span id="summary-selection">Building plots with: summary, selection,&nbsp;events</span></h2>
<p>In this model <span class="caps">GPT</span> makes suggestions at different levels. First it offers rough outlines of a&nbsp;story:</p>
<blockquote>
<p><strong>The Missing Heir</strong>: The heir to the Labyrinthine Senate has disappeared within the maze, and now the Senate is offering a reward for their safe return. However, rumors say that the Razormaws are behind the kidnapping, and the Cult of the Moon Goddess is secretly aiding&nbsp;them.</p>
</blockquote>
<p>Once you&#8217;ve selected a plot <span class="caps">GPT</span> will take the summary and a list of all the characters, producing a suggestion of some characters and their roles in the story. Everyone gets a plot-specific role, but it can also create entirely new characters to serve plot roles, for&nbsp;instance:</p>
<blockquote>
<p><strong>Eliana Silvermist</strong>: Eliana is a young artist who is enamored with the legend of the Night King. She is unwittingly drawn into the cult&#8217;s plan when they mistake her for the missing&nbsp;heir.</p>
</blockquote>
<p>Then less interestingly it picks out some relevant locations. This gives <span class="caps">GPT</span> a smaller set of things to work with as it develops the actual&nbsp;events.</p>
<p>The event list is where a plot really develops. Right now it&#8217;s listed as a kind of straight list of events for you to pick and choose from. That&#8217;s questionable, and assumes freestanding events that tie into an arc but don&#8217;t tie into each other. But that still works okay&#8230; the character descriptions create a framework that <span class="caps">GPT</span> fills&nbsp;in.</p>
<blockquote>
<p><strong>The Night King&#8217;s Lair</strong>: The investigators discover the Night King&#8217;s lair within the maze, filled with strange artifacts and esoteric books. <br />
Characters: Thorne Nightshade, Aurora Sky <br />
Locations: The Lost Grove <br />
Time: 10&nbsp;days</p>
</blockquote>
<p>I can imagine applying these events to the world on a kind of schedule. If the world just ticks through the events then we&#8217;re saying the player has no real agency, events will transpire inevitably. But if this event generation is automated at a high enough quality then we can synthesize new events based on player action and ask <span class="caps">GPT</span> to again complete a new set of events. I think by looking ahead, even if it means creating events that will never come to pass, we can make <span class="caps">GPT</span> create both a satisfying arc and conclusion, and <em>remake</em> that arc and conclusion in response to the&nbsp;player.</p>
<h2><span id="murder-mysteries">Murder&nbsp;Mysteries</span></h2>
<p>My daughter suggested this after doing some chats with the characters, imagining that she could grill people and then accuse someone of being the&nbsp;murderer.</p>
<p>Murder mysteries are appealing because they have a very clear setup (a murder!) and a moment of obvious player participation: soon after the murder is discovered, with only intermittent action outside of the&nbsp;investigation.</p>
<p>In my first attempt I asked <span class="caps">GPT</span> to write a muder mystery, but (as is typical with <span class="caps">GPT</span>) it didn&#8217;t know where to stop. It invented detectives and red herrings and an action packed conclusion. No need for a player! But that&#8217;s not what I&nbsp;want.</p>
<p>So instead I kept it to the facts, with <span class="caps">GPT</span> as the omniscent narrator. Identify exactly who did it, why, when, how; identify other people with a motive; identify events leading up to the murder. I give it a template to fill out, avoiding a narrative&nbsp;voice.</p>
<blockquote>
<p><strong>Victim</strong>: Marina Rossi <br />
<strong>Murderer</strong>: Hector Stone <br />
<strong>Means of murder</strong>: Poisoned wine <br />
<strong>Location of murder</strong>: Marina&#8217;s Crafts <br />
<strong>Time of murder</strong>: 9pm <br />
<strong>Motive</strong>: Marina discovered that Hector had been sabotaging The Stonemason&#8217;s Workshop, which had resulted in several accidents and injuries. In order to silence Marina, Hector murdered her. <br />
<strong>Description</strong>: Marina was having a glass of wine after closing up her shop when Hector entered. They were talking for a while, and Marina suddenly appeared to be feeling ill and collapsed. Hector quickly left the&nbsp;scene.</p>
</blockquote>
<p>This goes on at some length, fleshing out a wide variety of facts in one go. The intention here isn&#8217;t to have the author/user do much, but instead create a hands-free automatic murder&nbsp;mystery.</p>
<p>The factual source material then gets parsed in a second pass, pulling out specific information that needs to be used to construct later prompts, such as the victim&#8217;s exact&nbsp;name.</p>
<p>The last (still poorly implemented) step is to indicate what each character knows. That is, all the subjective knowledge that the player will piece together to discover the truth. Maybe this alone is enough for a playable&nbsp;game?</p>
<blockquote>
<p><strong>Eira Trefor</strong>: knows that Marina confided in her about her suspicions of Hector and sought her advice at The Seafarer&#8217;s House at 6pm on the day of the murder. Eira advised her to speak to the authorities and not to confront Hector alone. <br />
<strong>Vladimir Kuznetsov</strong>: witnessed Marina receiving a gift from an anonymous sender (a bottle of wine) at her shop an hour before the murder, but did not see who the sender was. Vladimir may also know about Marauder Jones&#8217;s thieving&nbsp;tendencies.</p>
</blockquote>
<p>I&#8217;ve only used <span class="caps">GPT</span>-4 sparingly on this project, but there are steps in this plot generation where it might perform significantly better, especially when given a large&nbsp;task.</p>
<h1><span id="authoring">The authoring&nbsp;process</span></h1>
<p>While much of the authoring experience is the same as <a href="https://ianbicking.org/blog/2023/02/world-building-with-gpt.html">I wrote about before</a>, there are things I noticed because I generated <em>so much more</em>&nbsp;world.</p>
<h2><span id="rule-of-cool">The Rule Of&nbsp;Cool</span></h2>
<p>The <a href="https://tvtropes.org/pmwiki/pmwiki.php/Main/RuleOfCool">Rule Of Cool</a>:</p>
<blockquote>
<p>all but the most pedantic of viewers will forgive liberties with reality as long as the result is wicked sweet or&nbsp;awesome</p>
</blockquote>
<p>The authoring process is one where <span class="caps">GPT</span> throws out a bunch of ideas and you pick the ones you like, over and over. If you don&#8217;t like the ideas you can add suggestions, even simple suggestions like &#8220;make it weird.&#8221; I did this a&nbsp;lot!</p>
<p>As a result <span class="caps">GPT</span> is constantly tempting the author with awesome stuff. I happily went&nbsp;along&#8230;</p>
<p><img src="/media/world-building-with-gpt-2/soul-music-echo-soundwave.jpg" title="Full body fantasy portrait of a robot: Echo Soundwave has a silver metalic body and plays a variety of instruments | Cover of the book Soul Music: Death playing an electric guitar with a piece of his shattered scythe as the pick" class="content"></p>
<p>Some of the things <span class="caps">GPT</span> tempted me&nbsp;into:</p>
<ol>
<li>A desert neighborhood called Shifting Sands where shape-shifters practice their arts. I don&#8217;t know where these shape-shifters came from, but that sounds awesome! Later I would realize that you can&#8217;t fit a desert <em>inside</em> a&nbsp;city.</li>
<li>Bioluminescent Bay, that&#8217;s cool right? Again, physically unclear, but how can I say no to glowing marine&nbsp;life&#8230;</li>
<li>It all started with this prompt: <em>A city in the center of a maze ðŸŒ€, where travelers often lose their way and the locals always wear masks to hide their true identities</em>. That sounds awesome! But integrating a maze structure is very hard and got lost in the generation. (I went long on masks&nbsp;though.)</li>
<li>Silver Haven: <em>for those who seek refuge and peace, a sanctuary where automatons are created to aid those in need.</em> Robotic therapists seemed pretty on point for this moment so I couldn&#8217;t pass it up. But it ended up as a kind of bland&nbsp;retreat.</li>
</ol>
<h2><span id="gpt-dice"><span class="caps">GPT</span> does not roll fair&nbsp;dice</span></h2>
<p>This authoring process relies on <span class="caps">GPT</span> coming up with unique and creative ideas. It&#8217;s pretty good at this, but what it does well for one attribute can feel repetitive when it happens over and&nbsp;over.</p>
<p>For instance in Veilvale there are 29 people (out of 370) with the last name &#8220;Nightshade&#8221;. It&#8217;s a cool name I suppose, but not that cool. In another experiment <a href="https://twitter.com/colin_fraser/status/1641191388502163457">Colin Fraser asked <span class="caps">GPT</span> for a random noun</a> and it returned &#8220;Pineapple&#8221; 11% of the&nbsp;time.</p>
<p>The cool thing with something like name generation is that it can create punny combinations, like <em>Sage Pepper</em> for a cook, and other less obvious names that still rhyme with the spirit of the&nbsp;character.</p>
<p>But sometimes we don&#8217;t want randomness so much as <em>distribution</em>. It&#8217;s not to say that we only ever want one distribution, but just a conscious explicit&nbsp;distribution.</p>
<p>Also there should only be one, or at least no more than a couple &#8220;best cooks&#8221;. <span class="caps">GPT</span> isn&#8217;t the only one who is drawn to hyperbole, so it&#8217;s fine if some things are overstated, but you can&#8217;t make every character exceptional. You can still make every character unique! But you need to make them unique on a variety of&nbsp;spectrums.</p>
<p>I&#8217;m not quite sure how to resolve this. Maybe pre-roll some core things and then seed the prompts with the results. But I don&#8217;t have any clear answer for the&nbsp;hyperbole.</p>
<h2><span id="people-context">People existing in and out of a&nbsp;context</span></h2>
<p>Because of the hierarchical composition process all people &#8220;belong&#8221;&nbsp;somewhere:</p>
<ol>
<li>Factions have faction members. Faction members are created specifically in the context of their one&nbsp;faction.</li>
<li>Buildings have occupants. The person is built to occupy a&nbsp;building.</li>
<li>Plots can add new characters that serve a purpose in the&nbsp;plot.</li>
</ol>
<p>An alternative might be to create a pool of people and then assign them, adjusting descriptions to fit their new home. Maybe that would be better, but I think giving <span class="caps">GPT</span> the freedom to create characters for a specific purpose is the right&nbsp;choice.</p>
<p>But it&#8217;s not the right choice that it ends there. A few&nbsp;problems:</p>
<ol>
<li>People don&#8217;t relate to each other. When <span class="caps">GPT</span> creates a single list of characters it can and does relate them sometimes, for instance introducing a leader and an assistant. But that&#8217;s just an accidental feature. <em>Density of narrative</em> is a feature that&#8217;s missing from this process, there aren&#8217;t enough loops, enough serendipitous relationships. Even in a large city you should keep bumping into the same people for different reasons. That might not be realistic but it&#8217;s <em>enjoyable</em>.</li>
<li>There&#8217;s no one schema for people. People in buildings have a property that relates them to the building (like a job). People in factions have a role. &#8220;Protagonists&#8221; (narrative free agents) have a heroic archetype. I don&#8217;t think we want to overspecify people and demand that all attributes be filled in, but it makes the coding harder when each character is only&nbsp;half-filled-out.</li>
</ol>
<p><a href="https://twitter.com/dustinfreeman">Dustin Freeman</a> gave me the idea of doing this as a kind of fix-up: generate a cast of fully situated characters, but then start to add new properties and relationships. I&#8217;m imagining something&nbsp;like:</p>
<ol>
<li>Create a list of characters. If there&#8217;s too many for <span class="caps">GPT</span> to process then just sample a few&nbsp;randomly.</li>
<li>Ask <span class="caps">GPT</span> to suggest the basic outline of some relationships. E.g., &#8220;Tom and Eileen are brother and sister&#8221;. Let <span class="caps">GPT</span> pick and choose who to match. Maybe the author selects which relationships to keep, or maybe they just scan and mass&nbsp;accept.</li>
<li>Represent the relationship formally&nbsp;somewhere.</li>
<li>Go back to each person and rewrite their description to include the&nbsp;relationship.</li>
</ol>
<p>This could also be done with characters and factions (so building occupants can belong to factions, factions can own buildings, or people can belong to two&nbsp;factions).</p>
<p>I&#8217;ve done something like this experimenting with &#8220;faction relationships&#8221; (like, inter-faction squabbles) but it falls flat, usually explaining obvious tensions between factions. Maybe I&#8217;m doing it wrong, or maybe there&#8217;s not enough material in that particular combination. (Maybe I need to focus on inter-factional <em>histories</em> instead of <em>relationships</em>?)</p>
<h2><span id="gpt-3-4"><span class="caps">GPT</span> 3.5 vs <span class="caps">GPT</span>&nbsp;4</span></h2>
<p>The tool is built to default to use <span class="caps">GPT</span>-3.5 (the gpt-3.5-turbo <span class="caps">API</span>) for all requests. Lots of people are jumping on <span class="caps">GPT</span>-4, and I&#8217;ve now done some work with both, including places where 3.5 definitely wasn&#8217;t sufficient for the task. But here I&#8217;m quite happy with <span class="caps">GPT</span>-3.5.</p>
<p>My general intuition is that <span class="caps">GPT</span>-4 is able to connect information across greater distances and to simultaneously follow a larger number of directions. This does come up, instructions can get lost as they accumulate. I think there&#8217;s ways to solve that with 3.5, such as refining generic/universal instructions to just those applicable to certain domains. For instance some instructions only apply to buildings (like building material), others only to character generation (like demographics) and so&nbsp;on.</p>
<p>The overall development pattern for <span class="caps">GPT</span>-4 might also be different than 3.5. There&#8217;s a lot of architecture that is there implicitly to keep down the size of any one prompt and response. With <span class="caps">GPT</span>-4 it may be possible to accomplish much more in one prompt, both because of a greater confidence in the output and because it&#8217;s able to handle more complexity in the&nbsp;request.</p>
<p>That said, <span class="caps">GPT</span>-3.5 is pretty great and I&#8217;m reluctant to just switch to something that&#8217;s&nbsp;bigger/better/slower/more-expensive.</p>
<h1><span id="declarative">A declarative approach to&nbsp;building</span></h1>
<p>Inside the spaghetti code of City Maker was a much simpler idea waiting to come out, and this version is a complete rewrite of the previous code. I gave it the name <a href="https://llm.ianbicking.org/layercraft/">LayerCraft</a> with <a href="https://github.com/ianb/llm-garden/blob/main/src/layercraft/citymakerschema.js">City Maker as a schema</a>. I don&#8217;t know yet how widely applicable this approach is, but it feels like it&#8217;s touching on patterns will be relevant for&nbsp;LLMs.</p>
<p>I&#8217;ll try to explain it concretely using a&nbsp;city:</p>
<ol>
<li>There&#8217;s many properties: name, factions, people, neighborhoods,&nbsp;buildings</li>
<li>Some properties belong to others in a parent/child relationship, like buildings that belong to&nbsp;neighborhoods</li>
<li>For any property <span class="caps">GPT</span> can generate <em>options</em></li>
<li>Generating these options requires a prompt; these prompts usually require context which creates <em>dependencies</em>. The prompts themselves are templates, dependencies are the substitution&nbsp;variables</li>
<li>Once a prompt can be fulfilled <span class="caps">GPT</span> is immediately asked about it, the author can make choices, commit choices, and thus produce new properties ready to be filled&nbsp;out</li>
</ol>
<p>In practice for the City Maker this means you choose a theme for your city, then backstory, then you pick out some neighborhood types that are created based on that background, and so&nbsp;on.</p>
<p>The prompts themselves are constructed to elicit the best result from <span class="caps">GPT</span>. Good&nbsp;prompts:</p>
<ol>
<li>Give the necessary context without giving too much distracting&nbsp;context</li>
<li>Show concrete examples that neither over-specify nor under-specify the desired&nbsp;results</li>
<li>Give <span class="caps">GPT</span> broad guidance (&#8220;exciting&#8221;, &#8220;simple&#8221;,&nbsp;etc)</li>
<li>Identify the schema for the&nbsp;results</li>
</ol>
<p>For instance, the schema for building&nbsp;occupants:</p>
<div class="highlight"><pre><span></span>The city $cityName that is $cityType, $cityPeriod. $cityBackstory

A list of $building.jobTypes and other inhabitants for $building ($building.description). Give each person an interesting and culturally appropriate name and a colorful background and personality. Include negative attributes.

Respond with a JSON list like:

[
  {
    type: $building.jobTypes|first|repr|json, // Or $building.jobTypes|rest
    name: &quot;FirstName LastName&quot;,
    description: &quot;[a description of the person, their profession or role, their personality, their history]&quot;,
    age: 30, // age in years, 5-100
    arrives: &quot;8am&quot;,
    leaves: &quot;6pm&quot;,
  }
]
</pre></div>


<p>The building schema includes <code>jobTypes</code> which informs the example. The prompt <em>could</em> just offer some generic advice, but I&#8217;ve found there&#8217;s often an advantage in establishing options as part of the&nbsp;context.</p>
<p>The particular implementation of this in LayerCraft isn&#8217;t half as general as this needs to be, but I&#8217;m very optimistic about the&nbsp;approach.</p>
<h2><span id="updates-dependencies">Updates and&nbsp;dependencies</span></h2>
<p>Building up incrementally gives steering power to the author, but not correction. This is a common problem in the authoring process because it&#8217;s hard to know the results of some of those early choices until you&#8217;ve seen what they&#8217;ve produced. And if you are creating dozens of characters based on these prompts you might not see the problems until you are halfway&nbsp;in.</p>
<p>If we treated this process as a pure question of dependencies, and treated the schema-defined graph like a Makefile, then changing early choices would simply regenerate later choices. But the author probably liked many of those&nbsp;choices!</p>
<p>As an example: I created a candy city. Part way through I realized it would be more fun if the characters were each made of candy. I didn&#8217;t really want to change everyone&#8217;s role, but only to make sure each description said what kind of candy the person was. I added an instruction to the backstory: &#8220;the people of Gummytown are made out of candy, with some being gummies, others being chocolates, and a few being marshmallows or candy canes. For each person specify what kind of candy they are in their&nbsp;description.&#8221;</p>
<p>How do you tell which properties this applies to? How do you apply this change to those properties? <span class="caps">GPT</span> is capable of both of these things, but not in a deterministic or entirely reliable way. Fixing this is significant work and definitely needs to be present in the <span class="caps">UI</span>&nbsp;itself.</p>
<h2><span id="meta-prompting">Getting meta in the&nbsp;prompt</span></h2>
<p>The use of context (such as backstory) lets the author broadly control what&#8217;s being created, but it&#8217;s often underpowered. It also can&#8217;t change the <em>shape</em> of what&#8217;s returned, such as adding a new property to a <span class="caps">JSON</span>&nbsp;example.</p>
<p>You can do a lot with <span class="caps">GPT</span> prompts and concatenation. That is, you can &#8220;edit&#8221; a prompt by just adding more instructions. If those instructions conflict then <span class="caps">GPT</span> will try its best. This is usually enough, and why this entire approach&nbsp;works.</p>
<p>As an example where this worked: I added the request &#8220;describe each person&#8217;s mask&#8221; to Veilvale person creation. It listened and consistently did so. But when I tried to give the instruction: &#8220;make it a list of automatons&#8221; it balked, confused by a previous instruction which clearly asked for <em>people</em> and <em>automatons are not people</em>.</p>
<p>A next level is to put more of the core prompt material into properties. Yet the text of those prompt templates quickly turns into programming itself, a mode switch that&#8217;s hard even for a programmer if you aren&#8217;t in the driving&nbsp;seat.</p>
<p>If we turn back to <span class="caps">GPT</span> again to solve this we&#8217;ll need meta-prompts: descriptions of what the prompt needs to accomplish, and its constraints, so that <span class="caps">GPT</span> can apply natural-language edits to the prompts while maintaining the required&nbsp;structure.</p>
<h2><span id="planning">Planning <span class="amp">&amp;</span>&nbsp;action</span></h2>
<p>While this is author-focused, I think the choices that <span class="caps">GPT</span> produces should be thought of as <em>proposed plans</em>. In City Maker it&#8217;s offering plans for how to build out a world. The author chooses options (and edits and makes notes on options) to guide, correct, and expand on what <span class="caps">GPT</span> produces on its&nbsp;own.</p>
<p>If <span class="caps">GPT</span> was producing code instead of options that&#8217;s also a plan. Sometimes you can build plans on plans, i.e., build more code just by looking at existing code. But often you need the output of that code to keep going. Or you need feedback, refinement, etc. I think there could be a&nbsp;pattern:</p>
<ol>
<li>The author <em>specifies</em> the&nbsp;goal</li>
<li><span class="caps">GPT</span> <em>proposes</em> up to the limits of that&nbsp;specification</li>
<li>The author <em>previews the&nbsp;results</em></li>
<li>The author <em>adjusts, selects, refines</em> the results, perhaps through choice, through dialog (chat), refined specification,&nbsp;etc</li>
<li>The choices are <em>committed</em>, expanding the&nbsp;specification</li>
<li>Any unresolved actions can be taken, code run, output collected,&nbsp;etc</li>
<li>Repeat at&nbsp;2</li>
</ol>
<p>Unfortunately this doesn&#8217;t cover revision, as mentioned in the previous section, and I don&#8217;t know exactly what adding that to the loop would look&nbsp;like.</p>
<h2><span id="fine-tuning">I&#8217;m glad fine tuning is dead (for like a&nbsp;month)</span></h2>
<p>It&#8217;s tempting with these problems to think about &#8220;fine tuning&#8221; a model. That&#8217;s how <span class="caps">AI</span> has worked for a long time, and it feels like a good way to approach issues with reliability or ever-growing prompts that keep adding little instructions and&nbsp;caveats.</p>
<p>For now the fine-tuning option is off the table if you are using the gpt-3.5-turbo (what this uses) or gpt-4 APIs, which are chat-based and offer no finetuning. This probably won&#8217;t last for long, but <em>right now</em> you&#8217;ll almost always get better (cheaper, faster, more flexible) results by using these new models and forgoing fine&nbsp;tuning.</p>
<p>This is the future I want to see! Everything I&#8217;ve described here <em>is not compatible with fine tuning</em>. You can&#8217;t edit prompts and make sophisticated adjustments when the instructions are in the tuned model&nbsp;weights!</p>
<p><strong>Prompting is artisanal <span class="caps">AI</span></strong>. If you know something about a subject, and want to use that knowledge and your own sweat to iterate on a prompt, there is tremendous potential in prompt design. Prompt design isn&#8217;t enough right now because tooling is still limited, but prompt-focused tools can give people new agency on a very individual level. I&#8217;m developing both sides of LayerCraft (the tool and the prompts) and I still feel empowered by this&nbsp;abstraction.</p>
<p>When proposing prompt-focused functionality lots of people are all like <em>blah blah blah, what about a moat, how do you differentiate yourself?</em> It&#8217;s so self centered&#8230; there&#8217;s a kind of thought that is addicted to consuming people rather than empowering them. Empowered people don&#8217;t lay down and play the part of being your&nbsp;moat.</p>
<h1><span id="conclusion">Conclusion</span></h1>
<p>It&#8217;s hard to conclude this because this is just one step along the way. (To where?) Some things that stand out to&nbsp;me:</p>
<ul>
<li><span class="caps">GPT</span> prompts matter. It&#8217;s not just a matter of getting the prompt &#8220;right,&#8221; it&#8217;s iteration and exploration over a specific&nbsp;domain.</li>
<li>When a user can enter text to affect a prompt they are also prompt engineering, and that&#8217;s the magic of this&nbsp;technology.</li>
<li>These same things are true for image prompts, but without the complexity of recursively applying output to future&nbsp;inputs.</li>
<li>Natural language is now a data structure. We&#8217;re probably all going to struggle to internalize this for a&nbsp;while.</li>
<li>Steerability makes <span class="caps">GPT</span> a lot more fun than just gazing at its wise&nbsp;output.</li>
<li>Chat is not the only way to interact with <span class="caps">GPT</span>.</li>
</ul>
<p>If you want to try this yourself check out <a href="https://llm.ianbicking.org/layercraft/">llm.ianbicking.org</a>, or <a href="https://github.com/ianb/llm-garden">check out GitHub</a>. If you are curious about the exact prompts look in <a href="https://github.com/ianb/llm-garden/blob/main/src/layercraft/citymakerschema.js">citymakerschema.js</a>. Note that this is a personal project, it&#8217;s built for personal&nbsp;exploration.</p>
<p>Similarly: when using the site be warned I have not built it carefully for other people to use, stuff will be weird, errors will appear only in the <span class="caps">JS</span> Console, there are no promises. And you&#8217;ll have to bring your own <span class="caps">GPT</span> <span class="caps">API</span>&nbsp;key!</p>
<p>Comments welcome on <a href="https://hachyderm.io/@ianbicking/110141107480811400">Mastodon</a> or <a href="https://twitter.com/ianbicking/status/1643265359967924226">Twitter</a>.</p>
<script>

    let els = Array.from(document.querySelectorAll("img.content"));
    console.log("found images", els);
    let activeEl;
    let overlay;
    function closeOverlay() {
        activeEl = null;
        if (overlay) {
            overlay.remove();
        }
        overlay = null;
    }
    function activateEl(el) {
        if (overlay) {
            closeOverlay();
        }
        activeEl = el;
        event.preventDefault();
        overlay = document.createElement("div");
        overlay.style.position = "fixed";
        overlay.style.height = "100%";
        overlay.style.width = "100%";
        overlay.style.top = 0;
        overlay.style.left = 0;
        overlay.style.zIndex = 9999;
        overlay.style.backgroundColor = "rgba(0, 0, 0, 0.8)";
        overlay.addEventListener("click", closeOverlay);
        const inner = document.createElement("div");
        inner.style.display = "flex";
        inner.style.alignItems = "center";
        inner.style.justifyContent = "center";
        inner.style.height = "100%";
        overlay.appendChild(inner);
        const img = document.createElement("img");
        img.src = el.src;
        img.style.maxHeight = "95%";
        img.style.maxWidth = "95%";
        img.style.marginBottom = "1em";
        inner.appendChild(img);
        const x = document.createElement("div");
        x.textContent = "âœ–";
        x.style.position = "absolute";
        x.style.right = "20px";
        x.style.top = "10px";
        x.style.fontSize = "200%";
        x.style.color = "#fff";
        overlay.appendChild(x);
        const caption = document.createElement("caption");
        caption.textContent = el.getAttribute("title");
        const pos = els.indexOf(el);
        caption.textContent += " " + (pos+1) + "/" + els.length;
        caption.style.color = "#fff";
        caption.style.textAlign = "center";
        caption.style.position = "absolute";
        caption.style.width = "100%";
        caption.style.padding = "1px 10px";
        caption.style.bottom = "5px";
        caption.style.backgroundColor = "rgba(0, 0, 0, 0.6)";
        overlay.appendChild(caption);
        document.body.appendChild(overlay);
    }
    for (const el of els) {
        el.addEventListener("click", (event) => {
            activateEl(el);
        });
    }
    document.addEventListener("keydown", function(event) {
        if (!overlay) {
            return;
        }
        if (event.key === "Escape") {
            closeOverlay();
            event.preventDefault();
            return;
        }
        if (event.key === "ArrowLeft" || event.key === "ArrowRight") {
            const cur = els.indexOf(activeEl);
            const next = (els.length + cur + (event.key === "ArrowLeft" ? -1 : 1)) % els.length;
            console.log({cur, next, els, el: els[next]});
            activateEl(els[next]);
            event.preventDefault();
        }
    });

</script>

<style>
  img.content {
    border-radius: 5px;
  }
  #toc + ol, #toc + ol li ol {
    margin: 0 0 0 1.5em;
  }
  #toc + ol li, #toc + ol li ol li {
    margin: 0;
  }
</style>

<p><meta property="og:image" content="https://veilvale.ianbicking.org/assets/images/icon-128.png" />
<meta property="og:image:width" content="128" />
<meta property="og:image:height" content="128" /></p></div>
        <!-- /.entry-content -->
  
        <hr />

        <!-- <div>
            Hello! Did you know as of December 2024 I'm looking for a job? <a href="https://www.linkedin.com/feed/update/urn:li:activity:7265435901009231872/">I am!</a> I really like working with LLMs, especially in the domain of education, wellness, and <a href="https://en.wikipedia.org/wiki/Executive_functions">executive function</a>. Maybe <a href="mailto:ianbicking@gmail.com">drop me an email</a>?
        </div> -->
    </article>
</section>
        <section id="extras" class="body">
                <div class="links">
                  <h2><a href="https://ianbicking.org">here</a></h2>
                  <ul>
                    <li><a href="/blog/">blog</a></li>
                    <li><a href="/projects.html">projects</a></li>
                    <li><a href="https://ianbicking.org/archives.html">archives</a> &amp; <a href="https://ianbicking.org/categories.html">categories</a></li>
                    <li><a href="https://ianbicking.org/category/ai.html">category: ai</a></li>
                    <li><a href="https://ianbicking.org/category/javascript.html">category: javascript</a></li>
                    <li><a href="https://ianbicking.org/category/misc.html">category: misc</a></li>
                    <li><a href="https://ianbicking.org/category/mozilla.html">category: mozilla</a></li>
                    </ul>
                </div>
                <div class="social">
                        <h2>elsewhere</h2>
                        <ul>
                            <li><a href="https://ianbicking.org/feeds/atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="https://hachyderm.io/@ianbicking">@ianbicking@hachyderm.io</a></li>
                            <li><a href="https://bsky.app/profile/ianbicking.org">Blue Sky</a></li>
                            <li><a href="https://www.threads.net/@ibicking">Threads</a></li>
                            <li><a href="https://github.com/ianb">Github</a></li>
                            <li><a href="https://www.linkedin.com/in/ianbicking/">LinkedIn</a></li>
                        </ul>
                </div><!-- /.social -->
                <div class="archives">
                  <h2><a href="https://ianbicking.org/blog/">recent posts</a></h2>
                  <ul>
                    <li><a href="https://ianbicking.org/blog/2025/05/the-hungry-ghost.html">The Hungry&nbsp;Ghost</a></li>
                    <li><a href="https://ianbicking.org/blog/2024/05/ai-aita.html"><span class="caps">AI</span> <span class="caps">AITA</span></a></li>
                    <li><a href="https://ianbicking.org/blog/2024/04/roleplaying-by-llm.html">Roleplaying driven by an <span class="caps">LLM</span>: observations <span class="amp">&amp;</span> open&nbsp;questions</a></li>
                    <li><a href="https://ianbicking.org/blog/2023/04/world-building-gpt-2-declarative.html">World Building with <span class="caps">GPT</span> part 2: bigger, better, more&nbsp;declarative</a></li>
                    <li><a href="https://ianbicking.org/blog/2023/02/world-building-with-gpt.html">World Building With <span class="caps">GPT</span></a></li>
                    <li><a href="https://ianbicking.org/blog/2023/01/thoughts-on-voice-interfaces-2-llms.html">Thoughts On Voice Interfaces 2 years later:&nbsp;LLMs</a></li>
                    <li><a href="https://ianbicking.org/blog/2023/01/infinite-ai-array.html">Infinite <span class="caps">AI</span>&nbsp;Array</a></li>
                    <li><a href="https://ianbicking.org/blog/2020/11/firefox-was-always-enough.html">Firefox Was Always&nbsp;Enough</a></li>
                    <li><a href="https://ianbicking.org/blog/2020/09/project-ideas-2020.html">Project ideas for (what&#8217;s left of)&nbsp;2020</a></li>
                    <li><a href="https://ianbicking.org/blog/2020/09/a-history-of-projects.html">A History Of&nbsp;Projects</a></li>
                  </ul>
                </div><!-- /.archives -->

        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
          This is the personal site of <a href="/">Ian Bicking</a>.  The opinions expressed here are my own.
        </footer><!-- /#contentinfo -->

<script src="/theme/instantclick.min.js"></script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FKT4HDGBE4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-FKT4HDGBE4');
</script>
        </div><!-- /#main-container -->
        </div><!-- /#main-wrapper2 -->
        </div><!-- /#main-wrapper1 -->
</body>
</html>