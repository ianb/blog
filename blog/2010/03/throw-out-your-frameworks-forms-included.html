<!DOCTYPE html>
<html lang="en">
<head>
        <title>Throw out your frameworks! (forms included)</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
          <link rel="stylesheet" href="https://www.ianbicking.org/theme/css/style.min.css">
        <!--<link rel="stylesheet" href="https://www.ianbicking.org/theme/css/main.css" type="text/css" />-->
        <link href="https://www.ianbicking.org/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="Ian Bicking: a blog Atom Feed" />
        <link rel="icon" href="https://www.ianbicking.org/favicon.ico">

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://www.ianbicking.org/css/ie.css"/>
                <script src="https://www.ianbicking.org/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://www.ianbicking.org/css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">
  <div id="main-wrapper1">
  <div id="main-wrapper2">
  <div id="main-container">
        <header id="banner" class="body">
                <h1><a href="https://www.ianbicking.org">Ian Bicking: a blog </a></h1>
        </header><!-- /#banner -->
<section id="content" class="body">
    <article>
        <header>
            <abbr class="published" title="2010-03-01T00:29:00-06:00">
                Monday, March 1st, 2010
            </abbr>
            <h1 class="entry-title">
                <a
                    href="https://www.ianbicking.org/blog/2010/03/throw-out-your-frameworks-forms-included.html"
                    rel="bookmark"
                    title="Permalink to Throw out your frameworks! (forms included)"
                    >Throw out your frameworks! (forms&nbsp;included)</a
                >
            </h1>
        </header>

        <div class="entry-content"><p>No, I should say <em>forms particularly</em>.</p>
<p>I have lots of things to blog about, but nothing makes me want to blog like <em>code</em>.  Ideas are hard, code is easy.  So when I saw <a class="reference external" href="http://jacobian.org/writing/dynamic-form-generation/">Jacob&#8217;s writeup about dynamic Django form generation</a> I felt a desire to respond.  I didn&#8217;t see the form panel at PyCon (I intended to but I hardly saw <em>any</em> talks at PyCon, and yet still didn&#8217;t even see a good number of the people I wanted to see), but as the author of an <a class="reference external" href="http://formencode.org/htmlfill.html">ungenerator</a> and as a general <a class="reference external" href="https://ianbicking.org/on-form-libraries.html">form library skeptic</a> I have a somewhat different perspective on the&nbsp;topic.</p>
<p>The example created for the panel might display that perspective.  You should go read <a class="reference external" href="http://jacobian.org/writing/dynamic-form-generation/">Jacob&#8217;s description</a>; but basically it&#8217;s a simple registration form with a dynamic set of questions to&nbsp;ask.</p>
<p>I have created a <a class="reference external" href="http://svn.colorstudy.com/home/ianb/formencode_answer.py">complete example</a>, because I wanted to be sure I wasn&#8217;t skipping anything, but I&#8217;ll present a trimmed-down&nbsp;version.</p>
<p>First, the basic control&nbsp;logic:</p>
<pre class="literal-block">
from webob.dec import wsgify
from webob import exc
from formencode import htmlfill

&#64;wsgify
def questioner(req):
    questions = get_questions(req) # This is provided as part of the example
    if req.method == 'POST':
        errors = validate(req, questions)
        if not errors:
            ... save response ...
            return exc.HTTPFound(location='/thanks')
    else:
        errors = {}
    ## Here's the &quot;form generation&quot;:
    page = page_template.substitute(
        action=req.url,
        questions=questions)
    page = htmlfill.render(
        page,
        defaults=req.POST,
        errors=errors)
    return Response(page)

def validate(req, questions):
    # All manual, but do it however you want:
    errors = {}
    form = req.POST
    if (form.get('password')
        and form['password'] != form.get('password_confirm')):
        errors['password_confirm'] = 'Passwords do not match'
    fields = questions + ['username', 'password']
    for field in fields:
        if not form.get(field):
            errors[field] = 'Please enter a value'
    return errors
</pre>
<p>I&#8217;ve just manually handled validation here.  I don&#8217;t feel like doing it with FormEncode.  Manual validation isn&#8217;t that big a deal; FormEncode would just produce the same <tt class="docutils literal">errors</tt> dictionary anyway.  In this case (as in many form validation cases) you can&#8217;t do better than hand-written validation code: it&#8217;s shorter, more self-contained, and easier to&nbsp;tweak.</p>
<p>After validation the template is&nbsp;rendered:</p>
<pre class="literal-block">
page = page_template.substitute(
    action=req.url,
    questions=questions)
</pre>
<p>I&#8217;m using <a class="reference external" href="http://pythonpaste.org/tempita/">Tempita</a>, but it really doesn&#8217;t matter.  The template looks like&nbsp;this:</p>
<pre class="literal-block">
&lt;form action=&quot;{{action}}&quot; method=&quot;POST&quot;&gt;
New Username: &lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;&lt;br&gt;
Password: &lt;input type=&quot;password&quot; name=&quot;password&quot;&gt;&lt;br&gt;
Repeat Password:
  &lt;input type=&quot;password&quot; name=&quot;password_confirm&quot;&gt;&lt;br&gt;
{{for question in questions}}
  {{question}}: &lt;input type=&quot;text&quot; name=&quot;{{question}}&quot;&gt;&lt;br&gt;
{{endfor}}
&lt;input type=&quot;submit&quot;&gt;
&lt;/form&gt;
</pre>
<p>Note that the only &#8220;logic&#8221; here is to render the form to include fields for all the questions.  Obviously this produces an ugly form, but it&#8217;s <em>very obvious</em> how you make this form pretty, and how to tweak it in any way you might want.  Also if you have deeper dynamicism (e.g., <tt class="docutils literal">get_questions</tt> start returning the type of response required, or weird validation, or whatever) it&#8217;s <em>very obvious</em> where that change would go: display logic goes in the form, validation logic goes in that validate&nbsp;function.</p>
<p>This just gives you the raw form.  You wouldn&#8217;t need a template at all if it wasn&#8217;t for the dynamicism.  Everything else is added when the form is&nbsp;&#8220;filled&#8221;:</p>
<pre class="literal-block">
page = htmlfill.render(
    page,
    defaults=req.POST,
    errors=errors)
</pre>
<p>How exactly you want to calculate <tt class="docutils literal">defaults</tt> is up to the application; you might want query string variables to be able to pre-fill the form (use <tt class="docutils literal">req.params</tt>), you might want the form bare to start (like here with <tt class="docutils literal">req.<span class="caps">POST</span></tt>), you can easily implement wizards by stuffing <tt class="docutils literal">req.<span class="caps">POST</span></tt> into the session to repeat a form, you might read the defaults out of a user object to make this an edit form.  And errors are just handled automatically, inserted into the <span class="caps">HTML</span> with appropriate <span class="caps">CSS</span>&nbsp;classes.</p>
<p>A great aspect of this <em>pattern</em> if you use it (I&#8217;m not even sure it deserves the moniker <em>library</em>): when <a class="reference external" href="http://www.whatwg.org/specs/web-apps/current-work/multipage/forms.html#forms"><span class="caps">HTML</span> 5 Forms</a> finally come around and we can all stop doing this stupid server-side overthought nonsense, <strong>you</strong> won&#8217;t have overthought your forms.  Your mind will be free and ready to accept that the world has actually become simpler, not more complicated, and that there is knowledge worth forgetting (forms are so freakin&#8217; stupid!)  If at all possible, dodging complexity is far better than cleverly responding to&nbsp;complexity.</p>
</div>
        <!-- /.entry-content -->
    </article>
</section>
        <section id="extras" class="body">
                <div class="links">
                  <h2><a href="https://www.ianbicking.org">here</a></h2>
                  <ul>
                    <li><a href="/blog/">blog</a></li>
                    <li><a href="/projects.html">projects</a></li>
                    <li><a href="https://www.ianbicking.org/archives.html">archives</a> &amp; <a href="https://www.ianbicking.org/categories.html">categories</a></li>
                    <li><a href="https://www.ianbicking.org/category/javascript.html">category: javascript</a></li>
                    <li><a href="https://www.ianbicking.org/category/misc.html">category: misc</a></li>
                    <li><a href="https://www.ianbicking.org/category/mozilla.html">category: mozilla</a></li>
                    </ul>
                </div>
                <div class="social">
                        <h2>elsewhere</h2>
                        <ul>
                            <li><a href="https://www.ianbicking.org/feeds/atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="https://twitter.com/ianbicking">@ianbicking</a></li>
                            <li><a href="https://hachyderm.io/@ianbicking">@ianbicking@hachyderm.io</a></li>
                            <li><a href="https://github.com/ianb">Github</a></li>
                        </ul>
                </div><!-- /.social -->
                <div class="archives">
                  <h2><a href="https://www.ianbicking.org/blog/">recent posts</a></h2>
                  <ul>
                    <li><a href="https://www.ianbicking.org/blog/2020/11/firefox-was-always-enough.html">Firefox Was Always&nbsp;Enough</a></li>
                    <li><a href="https://www.ianbicking.org/blog/2020/09/project-ideas-2020.html">Project ideas for (what&#8217;s left of)&nbsp;2020</a></li>
                    <li><a href="https://www.ianbicking.org/blog/2020/09/a-history-of-projects.html">A History Of&nbsp;Projects</a></li>
                    <li><a href="https://www.ianbicking.org/blog/2020/08/thoughts-on-voice-interfaces.html">Thoughts on Voice&nbsp;Interfaces</a></li>
                    <li><a href="https://www.ianbicking.org/blog/2019/07/kling-axes-of-politics-technocrats.html">Kling&#8217;s Axes of Politics, and the&nbsp;Technocrats</a></li>
                    <li><a href="https://www.ianbicking.org/blog/2019/04/users-want-control-is-a-shrug.html"><span class="dquo">&#8220;</span>Users want control&#8221; is a shoulder&nbsp;shrug</a></li>
                    <li><a href="https://www.ianbicking.org/blog/2019/03/open-source-doesnt-make-money-by-design.html">Open Source Doesn&#8217;t Make Money Because It Isn&#8217;t Designed To Make&nbsp;Money</a></li>
                    <li><a href="https://www.ianbicking.org/blog/2019/03/firefox-experiments-i-would-have-liked.html">The Firefox Experiments I Would Have Liked To&nbsp;Try</a></li>
                    <li><a href="https://www.ianbicking.org/blog/2019/01/overengaged-knowledge-worker.html">The Over-engaged Knowledge&nbsp;Worker</a></li>
                    <li><a href="https://www.ianbicking.org/blog/2019/01/we-need-open-hosting-platforms.html">We Need Open Hosting&nbsp;Platforms</a></li>
                  </ul>
                </div><!-- /.archives -->

                <div class="widgets">
                  <h2><a href="https://twitter.com/ianbicking">tweets</a></h2>
                  <a class="twitter-timeline" width="230" height="500" href="https://twitter.com/ianbicking" data-widget-id="319849964417187842" data-link-color="#aaae94">Tweets by @ianbicking</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

                </div><!-- /.widgets -->

        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
          This is the personal site of <a href="/">Ian Bicking</a>.  The opinions expressed here are my own.
        </footer><!-- /#contentinfo -->

<script src="/theme/instantclick.min.js"></script>
    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-2442258-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>
        </div><!-- /#main-container -->
        </div><!-- /#main-wrapper2 -->
        </div><!-- /#main-wrapper1 -->
</body>
</html>