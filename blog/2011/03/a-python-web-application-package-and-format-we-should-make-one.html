<!DOCTYPE html>
<html lang="en">
<head>
        <title>A Python Web Application Package and Format (we should make one)</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
          <link rel="stylesheet" href="https://ianbicking.org/theme/css/style.min.css">
        <!--<link rel="stylesheet" href="https://ianbicking.org/theme/css/main.css" type="text/css" />-->
        <link href="https://ianbicking.org/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="Ian Bicking: a blog Atom Feed" />
        <link rel="icon" href="https://ianbicking.org/favicon.ico">

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://ianbicking.org/css/ie.css"/>
                <script src="https://ianbicking.org/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://ianbicking.org/css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">
  <div id="main-wrapper1">
  <div id="main-wrapper2">
  <div id="main-container">
        <header id="banner" class="body">
                <h1><a href="https://ianbicking.org">Ian Bicking: a blog </a></h1>
        </header><!-- /#banner -->
<section id="content" class="body">
    <article>
        <header>
            <abbr class="published" title="2011-03-31T10:01:00-05:00">
                Thursday, March 31st, 2011
            </abbr>
            <h1 class="entry-title">
                <a
                    href="https://ianbicking.org/blog/2011/03/a-python-web-application-package-and-format-we-should-make-one.html"
                    rel="bookmark"
                    title="Permalink to A Python Web Application Package and Format (we should make one)"
                    >A Python Web Application Package and Format (we should make&nbsp;one)</a
                >
            </h1>
        </header>

        <div class="entry-content"><p>At PyCon there was an open space about deployment, and the idea of drop-in applications (Java-<span class="caps">WAR</span>-style).</p>
<p>I generally get pessimistic about 80% solutions, and dropping in a <span class="caps">WAR</span> file feels like an 80% solution to me. I&#8217;ve used the Hudson/Jenkins installer (which I think is <em>specifically</em> a project that got WARs on people&#8217;s minds), and in a lot of ways that installer is nice, but it&#8217;s also kind of wonky, it makes configuration unclear, it&#8217;s not always clear when it installs or configures itself through the web, and when you have to do this at the system level, nor is it clear where it puts files and data, etc. So a great initial experience doesn&#8217;t feel like a great ongoing experience to me &#8212; and <em>it doesn&#8217;t have to be that way</em>. If those were <em>necessary</em> compromises, sure, but they aren&#8217;t. And because we <em>don&#8217;t have</em> <span class="caps">WAR</span> files, if we&#8217;re proposing to make something new, then we have every opportunity to make things&nbsp;better.</p>
<p>So the question then is what we&#8217;re trying to make. To me: we want applications that are easy to install, that are self-describing, self-configuring (or at least guide you through configuration), reliable with respect to their environment (not dependent on system tweaking), upgradable, and respectful of persistence (the data that outlives the application install). A lot of this can be done by the &#8220;container&#8221; (to use Java parlance; or &#8220;environment&#8221;) &#8212; if you just have the app packaged in a nice way, the container (server environment, hosting service, etc) can handle all the system-specific things to make the application actually&nbsp;work.</p>
<p>At which point I am of course reminded of my <a class="reference external" href="http://cloudsilverlining.org">Silver Lining</a> project, which defines something very much like this. Silver Lining isn&#8217;t <em>just</em> an application format, and things aren&#8217;t fully extracted along these lines, but it&#8217;s pretty close and it addresses a lot of important issues in the lifecycle of an application. To be clear: Silver Lining is an application packaging format, a server configuration library, a cloud server management tool, a persistence management tool, and a tool to manage the application with respect to all these services over time. It is a bunch of things, maybe too many things, so it is not unreasonable to pick out a smaller subset to focus on. Maybe an easy place to start (and good for Silver Lining itself) would be to separate at least the application format (and tools to manage applications in that state, e.g., installing new libraries) from the tools that make use of such applications (deploy,&nbsp;etc).</p>
<p>Some opinions I have on this format, exemplified in Silver&nbsp;Lining:</p>
<ul class="simple">
<li>It&#8217;s not zipped or a single file, unlike WARs. Uploading zip files is not a great <span class="caps">API</span>. Geez. I know there&#8217;s this desire to &#8220;just drop in a file&#8221;; but there&#8217;s no getting around the fact that &#8220;dropping a file&#8221; becomes a <em>deployment protocol</em> <strong>and</strong> <em>it&#8217;s an incredibly impoverished protocol</em>. The format is also not subtly git-based (ala Heroku) because <tt class="docutils literal">git push</tt> is not a good deployment&nbsp;protocol.</li>
<li>But of course there isn&#8217;t really any deployment protocol inferred by a format anyway, so maybe I&#8217;m getting ahead of myself ;) I&#8217;m saying a tool that deploys should take as an argument a directory, not a single file. (If the tool then zips it up and uploads it,&nbsp;fine!)</li>
<li>Configuration &#8220;comes from the outside&#8221;. That is, an application requests services, and the <em>container</em> tells the application where those services are. For Silver Lining I&#8217;ve used environmental variables. I think this one point is really important &#8212; the container <em>tells</em> the application. As a counter-example, an application that comes with a Puppet deployment recipe is essentially <em>telling</em> the server how to arrange itself to suit the application. This will never be reliable or&nbsp;simple!</li>
<li>The application indicates what &#8220;services&#8221; it wants; for instance, it may want to have access to a MySQL database. The container then provides this to the application. In practice this means installing the actual packages, but also creating a database and setting up permissions appropriately. The alternative is never having <em>any</em> dependencies, meaning you have to use SQLite databases or ad hoc structures, etc. But in fact installing databases really isn&#8217;t that hard these&nbsp;days.</li>
<li><em>All</em> persistence has to use a service of some kind. If you want to be able to write to files, you need to use a file service. This means the container is fully aware of everything the application is leaving behind. All the various paths an application should use are given in different environmental variables (many of which don&#8217;t need to be invented anew, e.g., <tt class="docutils literal">$<span class="caps">TMPDIR</span></tt>).</li>
<li>It uses vendor libraries exclusively for Python libraries. That means the application bundles all the libraries it requires. Nothing ever gets installed at deploy-time. This is in contrast to using a <tt class="docutils literal">requirements.txt</tt> list of packages at deployment time. If you want to use those tools for development that&#8217;s fine, just not for&nbsp;deployment.</li>
<li>There <em>is</em> also a way to indicate other libraries you might require; e.g., you might <tt class="docutils literal">lxml</tt>, or even something that isn&#8217;t quite a library, like <tt class="docutils literal">git</tt> (if you are making a github clone). You can&#8217;t do those as vendor libraries (they include non-portable binaries). Currently in Silver Lining the application description can contain a list of Ubuntu package names to install. Of course that would have to be abstracted&nbsp;some.</li>
<li>You can ask for scripts or a request to be invoked for an application after an installation or deployment. It&#8217;s lame to try to test if is-this-app-installed on <em>every</em> request, which is the frequent alternative. Also, it gives the application the chance to signal that the installation&nbsp;failed.</li>
<li>It has a very simple (possibly/probably too simple) sense of configuration. You don&#8217;t have to use this if you make your app self-configuring (i.e., build in a web-accessible settings screen), but in practice it felt like some simple sense of configuration would be&nbsp;helpful.</li>
</ul>
<p>Things that could be&nbsp;improved:</p>
<ul class="simple">
<li>There are some places where you might be encouraged to use routines from the <tt class="docutils literal">silversupport</tt> package. There are very few! But maybe an alternative could be provided for these&nbsp;cases.</li>
<li>A little convention-over-configuration is probably suitable for the bundled libraries; silver includes tools to manage things, but it gets a little twisty. When creating a new project I find myself creating several <tt class="docutils literal">.pth</tt> files, special customizing modules, etc. Managing vendor libraries is also not&nbsp;obvious.</li>
<li><a class="reference external" href="http://cloudsilverlining.org/services.html">Services</a> are <span class="caps">IMHO</span> quite important and useful, but also need to be carefully&nbsp;specified.</li>
<li>There&#8217;s a bunch of runtime expectations that aren&#8217;t part of the format, but in practice would be part of how the application is written. For instance, I make sure each app has its own temporary directory, and that it is cleared on update. If you keep session files in that location, and you expect the environment to clean up old sessions &#8212; well, either all environments should do that, or none&nbsp;should.</li>
<li>The process model is not entirely clear. I tried to simply define one process model (unthreaded, multiple processes), but I&#8217;m not sure that&#8217;s suitable &#8212; most notably, multiple processes have a significant memory impact compared to threads. An application should at least be able to indicate what process models it accepts and&nbsp;prefers.</li>
<li>Static files are <em>all</em> convention over configuration &#8212; you put static files under <tt class="docutils literal">static/</tt> and then they are available. So <tt class="docutils literal">static/style.css</tt> would be at <tt class="docutils literal">/style.css</tt>. I think this is generally <em>good</em>, but putting all static files under one <span class="caps">URL</span> path (e.g., <tt class="docutils literal">/media/</tt>) can be good for other reasons as well. Maybe there should be conventions for&nbsp;both.</li>
<li>Cron jobs are important. Though maybe they could just be yet another kind of service? Many extra features could be new&nbsp;services.</li>
<li>Logging is also important; Silver Lining attempts to handle that somewhat, but it could be specified much&nbsp;better.</li>
<li>Silver Lining also supports <span class="caps">PHP</span>, which seemed to cause a bit of stress. But just ignore that. It&#8217;s really easy to&nbsp;ignore.</li>
</ul>
<p>There is a <a class="reference external" href="http://cloudsilverlining.org/appconfig.html">description of the configuration file for apps</a>. The <a class="reference external" href="http://cloudsilverlining.org/envvariables.html">environmental variables</a> are also notably part of the application&#8217;s expectations. The file layout is explained (together with a bunch of Silver Lining-specific concepts) in <a class="reference external" href="http://cloudsilverlining.org/devpatterns.html">Development Patterns</a>. Besides all that there is admittedly some other stuff that is only really specified in code; but in Silver Lining&#8217;s defense, specified in code is better than unspecified ;) App Engine provides another example of an application format, and would be worth using as a point of discussion or contrast (I did that myself when writing Silver&nbsp;Lining).</p>
<p>Discussing <span class="caps">WSGI</span> stuff with Ben Bangert at PyCon he noted that he didn&#8217;t really feel like the <span class="caps">WSGI</span> pieces needed that much more work, or at least that&#8217;s not where the interesting work was &#8212; the interesting work is in the tooling. An application format could provide a great basis for building this tooling. And I honestly think that the tooling has been held back more by divergent patterns of development than by the difficulty of writing the tools themselves; and a good, general application format could fix&nbsp;that.</p>
</div>
        <!-- /.entry-content -->
      </article>
</section>
        <section id="extras" class="body">
                <div class="links">
                  <h2><a href="https://ianbicking.org">here</a></h2>
                  <ul>
                    <li><a href="/blog/">blog</a></li>
                    <li><a href="/projects.html">projects</a></li>
                    <li><a href="https://ianbicking.org/archives.html">archives</a> &amp; <a href="https://ianbicking.org/categories.html">categories</a></li>
                    <li><a href="https://ianbicking.org/category/javascript.html">category: javascript</a></li>
                    <li><a href="https://ianbicking.org/category/misc.html">category: misc</a></li>
                    <li><a href="https://ianbicking.org/category/mozilla.html">category: mozilla</a></li>
                    </ul>
                </div>
                <div class="social">
                        <h2>elsewhere</h2>
                        <ul>
                            <li><a href="https://ianbicking.org/feeds/atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="https://twitter.com/ianbicking">@ianbicking</a></li>
                            <li><a href="https://hachyderm.io/@ianbicking">@ianbicking@hachyderm.io</a></li>
                            <li><a href="https://github.com/ianb">Github</a></li>
                        </ul>
                </div><!-- /.social -->
                <div class="archives">
                  <h2><a href="https://ianbicking.org/blog/">recent posts</a></h2>
                  <ul>
                    <li><a href="https://ianbicking.org/blog/2020/11/firefox-was-always-enough.html">Firefox Was Always&nbsp;Enough</a></li>
                    <li><a href="https://ianbicking.org/blog/2020/09/project-ideas-2020.html">Project ideas for (what&#8217;s left of)&nbsp;2020</a></li>
                    <li><a href="https://ianbicking.org/blog/2020/09/a-history-of-projects.html">A History Of&nbsp;Projects</a></li>
                    <li><a href="https://ianbicking.org/blog/2020/08/thoughts-on-voice-interfaces.html">Thoughts on Voice&nbsp;Interfaces</a></li>
                    <li><a href="https://ianbicking.org/blog/2019/07/kling-axes-of-politics-technocrats.html">Kling&#8217;s Axes of Politics, and the&nbsp;Technocrats</a></li>
                    <li><a href="https://ianbicking.org/blog/2019/04/users-want-control-is-a-shrug.html"><span class="dquo">&#8220;</span>Users want control&#8221; is a shoulder&nbsp;shrug</a></li>
                    <li><a href="https://ianbicking.org/blog/2019/03/open-source-doesnt-make-money-by-design.html">Open Source Doesn&#8217;t Make Money Because It Isn&#8217;t Designed To Make&nbsp;Money</a></li>
                    <li><a href="https://ianbicking.org/blog/2019/03/firefox-experiments-i-would-have-liked.html">The Firefox Experiments I Would Have Liked To&nbsp;Try</a></li>
                    <li><a href="https://ianbicking.org/blog/2019/01/overengaged-knowledge-worker.html">The Over-engaged Knowledge&nbsp;Worker</a></li>
                    <li><a href="https://ianbicking.org/blog/2019/01/we-need-open-hosting-platforms.html">We Need Open Hosting&nbsp;Platforms</a></li>
                  </ul>
                </div><!-- /.archives -->

                <div class="widgets">
                  <h2><a href="https://twitter.com/ianbicking">tweets</a></h2>
                  <a class="twitter-timeline" width="230" height="500" href="https://twitter.com/ianbicking" data-widget-id="319849964417187842" data-link-color="#aaae94">Tweets by @ianbicking</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

                </div><!-- /.widgets -->

        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
          This is the personal site of <a href="/">Ian Bicking</a>.  The opinions expressed here are my own.
        </footer><!-- /#contentinfo -->

<script src="/theme/instantclick.min.js"></script>
    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-2442258-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>
        </div><!-- /#main-container -->
        </div><!-- /#main-wrapper2 -->
        </div><!-- /#main-wrapper1 -->
</body>
</html>