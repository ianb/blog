<!DOCTYPE html>
<html lang="en">
<head>
        <title>Javascript Status Message Display</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
          <link rel="stylesheet" href="https://ianbicking.org/theme/css/style.min.css">
        <!--<link rel="stylesheet" href="https://ianbicking.org/theme/css/main.css" type="text/css" />-->
        <link href="https://ianbicking.org/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="Ian Bicking: a blog Atom Feed" />
        <link rel="icon" href="https://ianbicking.org/favicon.ico">

</head>

<body id="index" class="home">
  <div id="main-wrapper1">
  <div id="main-wrapper2">
  <div id="main-container">
        <header id="banner" class="body">
                <h1><a href="https://ianbicking.org">Ian Bicking: a blog </a></h1>
        </header><!-- /#banner -->
<section id="content" class="body">
    <article>
        <header>
        <div>
            <div class="published" title="2008-12-17T12:03:00-06:00">
                Wednesday, December 17th, 2008
            </div>
            <h1 class="entry-title">
                <a
                    href="https://ianbicking.org/blog/2008/12/javascript-status-message-display.html"
                    rel="bookmark"
                    title="Permalink to Javascript Status Message Display"
                    >Javascript Status Message&nbsp;Display</a
                >
            </h1>
        </div>
        </header>

        <div class="entry-content"><p>In a <a class="reference external" href="http://www.bitbucket.org/ianb/pickywiki/">little wiki I&#8217;ve been playing with</a> I&#8217;ve been trying out little ideas that I&#8217;ve had but haven&#8217;t had a place to actually implement them.  One is how notification messages work.  I&#8217;m sure other people have done the same thing, but I thought I&#8217;d describe it&nbsp;anyway.</p>
<p>A <a class="reference external" href="https://ianbicking.org/web-application-patterns-status-notification.html">common pattern</a> is to accept a <span class="caps">POST</span> request and then redirect the user to some page, setting a status message.  Typically the status message is either set in a cookie or in the session, then the standard template for the application has some code to check for a message and display&nbsp;it.</p>
<p>The problem with this is that this breaks all caching &#8212; at any time any page can have some message injected into it, basically for no reason at all.  So I thought: why not do the whole thing in Javascript?  The server will set a cookie, but only Javascript will read&nbsp;it.</p>
<p>The code goes like this; on the server (easily translated into any&nbsp;framework):</p>
<pre class="literal-block">
resp.set_cookie('flash_message', urllib.quote(msg))
</pre>
<p>I quote the message because it can contain characters unsafe for cookies, and <span class="caps">URL</span> quoting is a particularly easy quoting to&nbsp;apply.</p>
<p>Then I have this Javascript (using&nbsp;jQuery):</p>
<pre class="literal-block">
$(function () {
    // Anything in $(function...) is run on page load
    var flashMsg = readCookie('flash_message');
    if (flashMsg) {
        flashMsg = unescape(flashMsg);
        var el = $('&lt;div id=&quot;flash-message&quot;&gt;'+
          '&lt;div id=&quot;flash-message-close&quot;&gt;'+
          '&lt;a title=&quot;dismiss this message&quot; '+
          'id=&quot;flash-message-button&quot; href=&quot;#&quot;&gt;X&lt;/a&gt;&lt;/div&gt;'+
          flashMsg + '&lt;/div&gt;');
        $('a#flash-message-button', el).bind(
          'click', function () {
            $(this.parentNode.parentNode).remove();
        });
        $('#body').prepend(el);
        eraseCookie('flash_message');
    }
});
</pre>
<p>Note that I&#8217;ve decided to treat the flash message as <span class="caps">HTML</span>.  I don&#8217;t see a strong risk of injection attack in this case, though I must admit I&#8217;m a little unclear about what the normal policies are for cross-domain cookie&nbsp;setting.</p>
<p>I use <a class="reference external" href="http://www.quirksmode.org/js/cookies.html">these cookie functions</a> because oddly I can&#8217;t find cookie handling functions in jQuery.  It&#8217;s always weird to me how primitive <tt class="docutils literal">document.cookie</tt> is.  Anyway, <span class="caps">CSS</span> looks like&nbsp;this:</p>
<pre class="literal-block">
#flash-message {
  margin: 0.5em;
  border: 2px solid #000;
  background-color: #9f9;
  -moz-border-radius: 4px;
  text-align: center;
}

#flash-message-close {
  float: right;
  font-size: 70%;
  margin: 2px;
}

a#flash-message-button {
  text-decoration: none;
  color: #000;
  border: 1px solid #9f9;
}

a#flash-message-button:hover {
  border: 1px solid #000;
  background-color: #009;
  color: #fff;
}
</pre>
<p>This doesn&#8217;t have non-Javascript fallback, but I think that&#8217;s okay.  This isn&#8217;t something that a spider would ever see (since spiders shouldn&#8217;t be submitting forms that result in update messages).  Accessible browsers generally implement Javascript so that&#8217;s also not particularly a problem, though there may be additional hints I could give in <span class="caps">CSS</span> or Javascript to help make this more readable (if there&#8217;s a message, it should probably be the first thing read on the&nbsp;page).</p>
<p>Another common component of pages that varies separate from the page itself is logged-in status, but that&#8217;s more heavily connected to your application.  Get both into Javascript and you might be able to turn caching way up on a lot of your&nbsp;pages.</p>
</div>
        <!-- /.entry-content -->
      </article>
</section>
        <section id="extras" class="body">
                <div class="links">
                  <h2><a href="https://ianbicking.org">here</a></h2>
                  <ul>
                    <li><a href="/blog/">blog</a></li>
                    <li><a href="/projects.html">projects</a></li>
                    <li><a href="https://ianbicking.org/archives.html">archives</a> &amp; <a href="https://ianbicking.org/categories.html">categories</a></li>
                    <li><a href="https://ianbicking.org/category/ai.html">category: ai</a></li>
                    <li><a href="https://ianbicking.org/category/javascript.html">category: javascript</a></li>
                    <li><a href="https://ianbicking.org/category/misc.html">category: misc</a></li>
                    <li><a href="https://ianbicking.org/category/mozilla.html">category: mozilla</a></li>
                    </ul>
                </div>
                <div class="social">
                        <h2>elsewhere</h2>
                        <ul>
                            <li><a href="https://ianbicking.org/feeds/atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="https://hachyderm.io/@ianbicking">@ianbicking@hachyderm.io</a></li>
                            <li><a href="https://github.com/ianb">Github</a></li>
                            <li><a href="https://www.linkedin.com/in/ianbicking/">LinkedIn</a></li>
                            <li><a href="https://twitter.com/ianbicking">@ianbicking</a></li>
                        </ul>
                </div><!-- /.social -->
                <div class="archives">
                  <h2><a href="https://ianbicking.org/blog/">recent posts</a></h2>
                  <ul>
                    <li><a href="https://ianbicking.org/blog/2024/05/ai-aita.html"><span class="caps">AI</span> <span class="caps">AITA</span></a></li>
                    <li><a href="https://ianbicking.org/blog/2024/04/roleplaying-by-llm.html">Roleplaying driven by an <span class="caps">LLM</span>: observations <span class="amp">&amp;</span> open&nbsp;questions</a></li>
                    <li><a href="https://ianbicking.org/blog/2023/04/world-building-gpt-2-declarative.html">World Building with <span class="caps">GPT</span> part 2: bigger, better, more&nbsp;declarative</a></li>
                    <li><a href="https://ianbicking.org/blog/2023/02/world-building-with-gpt.html">World Building With <span class="caps">GPT</span></a></li>
                    <li><a href="https://ianbicking.org/blog/2023/01/thoughts-on-voice-interfaces-2-llms.html">Thoughts On Voice Interfaces 2 years later:&nbsp;LLMs</a></li>
                    <li><a href="https://ianbicking.org/blog/2023/01/infinite-ai-array.html">Infinite <span class="caps">AI</span>&nbsp;Array</a></li>
                    <li><a href="https://ianbicking.org/blog/2020/11/firefox-was-always-enough.html">Firefox Was Always&nbsp;Enough</a></li>
                    <li><a href="https://ianbicking.org/blog/2020/09/project-ideas-2020.html">Project ideas for (what&#8217;s left of)&nbsp;2020</a></li>
                    <li><a href="https://ianbicking.org/blog/2020/09/a-history-of-projects.html">A History Of&nbsp;Projects</a></li>
                    <li><a href="https://ianbicking.org/blog/2020/08/thoughts-on-voice-interfaces.html">Thoughts on Voice&nbsp;Interfaces</a></li>
                  </ul>
                </div><!-- /.archives -->

        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
          This is the personal site of <a href="/">Ian Bicking</a>.  The opinions expressed here are my own.
        </footer><!-- /#contentinfo -->

<script src="/theme/instantclick.min.js"></script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FKT4HDGBE4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-FKT4HDGBE4');
</script>
        </div><!-- /#main-container -->
        </div><!-- /#main-wrapper2 -->
        </div><!-- /#main-wrapper1 -->
</body>
</html>