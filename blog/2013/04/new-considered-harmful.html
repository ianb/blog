<!DOCTYPE html>
<html lang="en">
<head>
        <title>“new” Only Makes Javascript OO Harder</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
          <link rel="stylesheet" href="https://ianbicking.org/theme/css/style.min.css">
        <!--<link rel="stylesheet" href="https://ianbicking.org/theme/css/main.css" type="text/css" />-->
        <link href="https://ianbicking.org/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="Ian Bicking: a blog Atom Feed" />
        <link rel="icon" href="https://ianbicking.org/favicon.ico">

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://ianbicking.org/css/ie.css"/>
                <script src="https://ianbicking.org/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://ianbicking.org/css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">
  <div id="main-wrapper1">
  <div id="main-wrapper2">
  <div id="main-container">
        <header id="banner" class="body">
                <h1><a href="https://ianbicking.org">Ian Bicking: a blog </a></h1>
        </header><!-- /#banner -->
<section id="content" class="body">
    <article>
        <header>
        <div>
            <div class="published" title="2013-04-29T00:00:00-05:00">
                Monday, April 29th, 2013
            </div>
            <h1 class="entry-title">
                <a
                    href="https://ianbicking.org/blog/2013/04/new-considered-harmful.html"
                    rel="bookmark"
                    title="Permalink to “new” Only Makes Javascript OO Harder"
                    ><span class="dquo">&#8220;</span>new&#8221; Only Makes Javascript <span class="caps">OO</span>&nbsp;Harder</a
                >
            </h1>
        </div>
        </header>

        <div class="entry-content"><p>Javascript objects and classes aren&#8217;t hard.  This whole &#8220;prototype&#8221; thing is blamed for too much: prototype-based programming isn&#8217;t hard. <code>this</code> is really weird, but prototypes&nbsp;aren&#8217;t.</p>
<p>What&#8217;s prototype-based programming?  It just means every object has a &#8220;prototype&#8221; and when you look up a property on the object it searches the object, then the object&#8217;s prototype, then the prototype&#8217;s prototype, and so on.  It&#8217;s exactly like classes except there&#8217;s no special distinction between &#8220;instance&#8221; and &#8220;class&#8221;.  You don&#8217;t have to change paradigms to understand prototypes, you don&#8217;t have to drink any Kool Aid to accept the idea.  Don&#8217;t overthink it, it&#8217;s&nbsp;fine.</p>
<p>The problem with Javascript isn&#8217;t prototypes, it&#8217;s the <code>new</code> operator. The <code>new</code> operator is terrible in all ways.  But to explain why it is bad, I want to start with the <em>right</em> way to think about prototypes: <a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Object/create">Object.create()</a>.</p>
<p><code>Object.create</code> is newer than <code>new</code> and <a href="http://kangax.github.io/es5-compat-table/#Object.create">support isn&#8217;t universal</a> (though there&#8217;s a <a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Object/create#Polyfill">polyfill</a>), but it&#8217;s much&nbsp;simpler.</p>
<p><code>Object.create(obj)</code> creates a new object, with <code>obj</code> as the new object&#8217;s prototype.  (There&#8217;s a <a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Object/create#Using_&lt;propertiesObject&gt;_argument_with_Object.create">second argument</a> that does fancy things, but let&#8217;s ignore that part.)  That&#8217;s really all you need to know, and you should probably be able to understand it.  As an example, <a href="http://yehudakatz.com/2011/08/12/understanding-prototypes-in-javascript/">this tutorial by Yehuda Katz</a> uses it as the basis for explaining Javascript objects in&nbsp;general.</p>
<p>We can describe <code>new</code> in terms of <code>Object.create()</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">new_</span><span class="p">(</span><span class="kr">constructor</span><span class="w"> </span><span class="cm">/* plus a variable number of arguments */</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">newObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="kr">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="c1">// This gets the varargs after `constructor`:</span><span class="w"></span>
<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">restArgs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">newObject</span><span class="p">,</span><span class="w"> </span><span class="nx">restArgs</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// If the function returns something, ignore newObject</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">newObject</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Using this, <code>new Constructor(1, 2)</code> is equivalent to <code>new_(Constructor, 1, 2)</code></p>
<p>This <em>might</em> seem reasonable, but it has a few&nbsp;problems:</p>
<p><a name="nonew"></a></p>
<h3>There&#8217;s nothing to distinguish constructor functions from normal&nbsp;functions</h3>
<p>So there&#8217;s nothing to keep you from calling <code>Constructor(1, 2)</code> &#8212; but the results will be bad.  If you&#8217;ve used Javascript much you&#8217;ve probably made this mistake, and added global variables as a&nbsp;result.</p>
<p>If you are not familiar with it, it works like&nbsp;this:</p>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">Constructor</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">this</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">this</span><span class="p">.</span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="kd">var</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Constructor</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">);</span><span class="w"></span>
<span class="c1">// Now there is a global object a==1, b==2</span><span class="w"></span>
<span class="c1">// because &quot;this&quot; was bound to the window</span><span class="w"></span>
<span class="c1">// obj is undefined because Constructor didn&#39;t return a value</span><span class="w"></span>
</code></pre></div>

<p><a name="detectnonew"></a></p>
<h3>It&#8217;s not actually that easy to detect when <code>new</code> was left&nbsp;off.</h3>
<p>You can check if <code>this === window</code>, but that doesn&#8217;t work in Node.js (you&#8217;d have to check <code>this === module</code>).  The best way is&nbsp;generally:</p>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">Foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="nx">Foo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Foo</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>But then it&#8217;s not clear if <code>new</code> should be used at all, you may very well need to understand <a href="http://kangax.github.io/nfe/">named function expressions</a>, and passing arbitrary arguments along <a href="http://ejohn.org/blog/simple-class-instantiation/">is hard</a>).</p>
<p><a name="defineprototype"></a></p>
<h3>There&#8217;s two ways to define the prototype: awkard or&nbsp;inflexible</h3>
<p>The more common way to define the prototype is like&nbsp;this:</p>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">Foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="nx">Foo</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>

<p>This gets kind of tedious, and you repeat the class name over and over.  A shorthand is&nbsp;helpful:</p>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">Foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="nx">Foo</span><span class="p">.</span><span class="nx">prototype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</code></pre></div>

<p>But that makes it hard to do subclassing, because you are <em>overwriting</em> the prototype.  This keeps you from overriding just the methods you care to in the subclass.  Which leads us&nbsp;to&#8230;</p>
<p><a name="subclassing"></a></p>
<h3>Clean subclassing is hard to impossible because of the&nbsp;constructor</h3>
<p>So here&#8217;s how you are supposed to create a class <code>Bar</code> that subclasses <code>Foo</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">Bar</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="nx">Bar</span><span class="p">.</span><span class="nx">prototype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Foo</span><span class="p">();</span><span class="w"></span>
</code></pre></div>

<p>Now you can add methods.  But can you create a new <code>Foo</code> object so easily?  Usually the constructor will have arguments, maybe even side effects, creating peculiar artifacts in your&nbsp;prototype.</p>
<p>(Of course you could do <code>Bar.prototype = Object.create(Foo.prototype)</code> &#8212; and you probably should &#8212; but once you use <code>Object.create()</code> there&#8217;s no reason to go back to <code>new</code>.)</p>
<p><a name="prototypes"></a></p>
<h2>Prototypes are still&nbsp;okay</h2>
<p>Given the problems with <code>new</code> some people resort to wildly different means of creating object.  For instance, the explicit&nbsp;method:</p>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">x</span><span class="o">:</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nx">y</span><span class="o">:</span><span class="w"> </span><span class="nx">y</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nx">add</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">other</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">Point</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">other</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">other</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">};</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Or you can avoid <code>this</code> entirely:</p>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">getX</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">x</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="nx">getY</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">y</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="nx">add</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">other</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">other</span><span class="p">.</span><span class="nx">getX</span><span class="p">(),</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">other</span><span class="p">.</span><span class="nx">getY</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">};</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>There&#8217;s a wealth of quirky ways to use objects, ad hoc methods, closures, factory functions, and other techniques to create something class-like.  But prototypes don&#8217;t need all that fixing!  These techniques add memory overhead, sometimes performance overhead, and make it harder for other people to read your code.  Prototypes don&#8217;t need&nbsp;fixing.</p>
<p>Douglas Crockford described some patterns like this (using closures) in <em>Javascript The Good Parts</em> but I think he ultimately has <a href="http://javascript.crockford.com/prototypal.html">come around to prototypes</a>.</p>
<h2>A modest proposal for&nbsp;classes</h2>
<p>Lots of libraries include shortcuts for classes.  But they often add other features that get in the way of just replacing <code>new</code>.  I will offer my own class constructor, which in my opinion does exactly what it needs to do and nothing&nbsp;more:</p>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">Class</span><span class="p">(</span><span class="nx">superclass</span><span class="p">,</span><span class="w"> </span><span class="nx">properties</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">prototype</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="w"> </span><span class="nx">properties</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// We&#39;re creating an object with no superclass</span><span class="w"></span>
<span class="w">    </span><span class="nx">prototype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">superclass</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">prototype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">superclass</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">properties</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">properties</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nx">prototype</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">properties</span><span class="p">[</span><span class="nx">a</span><span class="p">];</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">ClassObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">newObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">prototype</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">newObject</span><span class="p">.</span><span class="kr">constructor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nx">newObject</span><span class="p">.</span><span class="kr">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">newObject</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">newObject</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">};</span><span class="w"></span>
<span class="w">  </span><span class="nx">ClassObject</span><span class="p">.</span><span class="nx">prototype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">prototype</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">ClassObject</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// Use like:</span><span class="w"></span>
<span class="kd">var</span><span class="w"> </span><span class="nx">Point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Class</span><span class="p">({</span><span class="w"></span>
<span class="w">  </span><span class="kr">constructor</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">x</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">y</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="nx">add</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">other</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">Point</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">x</span><span class="o">+</span><span class="nx">other</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">y</span><span class="o">+</span><span class="nx">other</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>
</code></pre></div>

<p>This doesn&#8217;t have a special way to call the superclass.  Instead you just have to be explicit, for instance you might&nbsp;do:</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">Subclass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Class</span><span class="p">(</span><span class="nx">Superclass</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">Superclass</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>
</code></pre></div>

<p>It&#8217;s a little tedious to write out <code>Superclass.prototype.call(...)</code>, but in my experience these superclass calls don&#8217;t happen that often, and trying to be clever is worse than the little bit of extra typing&nbsp;required.</p>
<p>I&#8217;ve chosen the name <code>constructor</code> for the constructor method because it&#8217;s the one name <a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Object/constructor">already used by Javascript</a>. I prefer this over <code>init</code> or <code>__init__</code> or something else adopted from another&nbsp;language.</p>
<p><a name="future"></a></p>
<h2><span class="caps">ES6</span> will save us all, sometime far in the&nbsp;future</h2>
<p><span class="caps">ES6</span> (EcmaScript 6, the version of Javascript currently in development) has a <a href="http://people.mozilla.org/~jorendorff/es6-draft.html#sec-13.5">class statement</a> (<a href="http://wiki.ecmascript.org/doku.php?id=strawman:maximally_minimal_classes">this is probably more readable</a>). Unlike some previous proposed versions of Javascript, and some previous proposed class statements, this one seems like it will actually stick.  That will resolve most of the problems with our current vague patterns (though it&#8217;s unclear to me how it affects <code>new</code>).</p>
<p>But let&#8217;s be honest: most of us will not be able to use this for quite some time (though who knows, with <a href="http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/">source maps</a> we might be able to <a href="https://github.com/square/es6-module-transpiler">compile down to older versions of Javascript</a> without much loss in debuggability).  So until then we must manually apply sanity when we write&nbsp;Javascript.</p>
<p>Another improvement coming into availability is <code>"use strict"</code> &#8212; the ability to apply strict behaviors (both in syntax <em>and</em> at runtime) to your code.  This allows you to at least avoid the <a href="#nonew">problem of forgetting <code>new</code></a> <a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Functions_and_function_scope/Strict_mode#.22Securing.22_JavaScript">by setting <code>this</code> to undefined when you leave off <code>new</code></a></p></div>
        <!-- /.entry-content -->
          <div class="comments">
            <h2>Comments</h2>
            <table class='table table-striped'>
<tr><td style='padding-left: 0px' class='dU'>Roberto De Almeida</td><td class='dTS'>Tue, 30 Apr 2013</td></tr>
<tr><td style='padding-left: 0px' colspan='2' class='dMessage'><p>I always thought of the "new" operator as meaning a new scope. This way we can interpret the line "var obj = new Operator(1, 2);" as "create a new scope named obj from this function". BTW, I like your class constructor, will definitely use for my new Javascript explorations. :)</p></td></tr>
<tr><td style='padding-left: 50px' class='dU'>Radomír Žemlička</td><td class='dTS'>Tue, 30 Apr 2013</td></tr>
<tr><td style='padding-left: 50px' colspan='2' class='dMessage'><p>It doesn't create a scope, it creates an object which inherits from Operator.prototype and immediately calls the Operator function in the context of this object. ;-)</p></td></tr>
<tr><td style='padding-left: 0px' class='dU'>Radomír Žemlička</td><td class='dTS'>Tue, 30 Apr 2013</td></tr>
<tr><td style='padding-left: 0px' colspan='2' class='dMessage'><p>I'm not really sure about this. I don't think using the new operator is bad practice. Sure, it's harmful when you don't know the right way of using it, but when you do, you immediately can see what is a constructor function a what is a normal function. When I see this:</p><p>var p = Point();</p><p>I can't be sure if it's inherited from Point.prototype or if it's some other object. But when I see this:</p><p>var p = new Point();</p><p>I can be pretty sure it's the right object (in most cases, but I keep my code clean so I don't have to worry). So I wouldn't bury this operator, just start using it the right way and don't produce a bad code. :-)</p></td></tr>
<tr><td style='padding-left: 50px' class='dU'>Ian Bicking</td><td class='dTS'>Tue, 30 Apr 2013</td></tr>
<tr><td style='padding-left: 50px' colspan='2' class='dMessage'><p>I guess I encounter too many methods and functions that create objects to worry too much about having an operator to mark when an object is being created.</p><p>"use strict" is a good point, and I've added a note about it to the end of the article.</p></td></tr>
<tr><td style='padding-left: 0px' class='dU'>Piotr Dobrogost</td><td class='dTS'>Tue, 30 Apr 2013</td></tr>
<tr><td style='padding-left: 0px' colspan='2' class='dMessage'><p>I'm surprised you didn't mention Douglas Crockford who's objections to "new" operator as well as the technique to avoid it are well known.</p></td></tr>
<tr><td style='padding-left: 50px' class='dU'>Ian Bicking</td><td class='dTS'>Tue, 30 Apr 2013</td></tr>
<tr><td style='padding-left: 50px' colspan='2' class='dMessage'><p>I intended to allude to it in "Prototypes are still okay" – I agree with Crockford's diagnosis, but not his prescription (though I'm not clear, his opinions may have evolved since Javascript The Good Parts).  I still prefer sticking with prototypes instead of using a closure to encapsulate state, while Crockford seems to like the privacy that a closure can enforce.</p><p>(I updated the article to mention Douglas Crockford specifically.)</p></td></tr>
<tr><td style='padding-left: 0px' class='dU'>Mat Scales</td><td class='dTS'>Tue, 30 Apr 2013</td></tr>
<tr><td style='padding-left: 0px' colspan='2' class='dMessage'><p>Use strict mode. Use JSHint. Done.</p><p>If you use a linter in your editor (like SublimeLinter for Sublime Text) then you get instant feedback if you make a mistake. Then new is no more problematic than anything else.</p><p>Reinventing new seems like overkill, especially since its been done hundreds of times (seriously, I think every new JS developer creates their own "classes" library.)</p><p>If you really want to avoid using new then, as you mention, you can polyfill Object.create. The advantage there is that it is well understood by other people reading your code and is forward compatible.</p></td></tr>
</table>

        </div>
    </article>
</section>
        <section id="extras" class="body">
                <div class="links">
                  <h2><a href="https://ianbicking.org">here</a></h2>
                  <ul>
                    <li><a href="/blog/">blog</a></li>
                    <li><a href="/projects.html">projects</a></li>
                    <li><a href="https://ianbicking.org/archives.html">archives</a> &amp; <a href="https://ianbicking.org/categories.html">categories</a></li>
                    <li><a href="https://ianbicking.org/category/ai.html">category: ai</a></li>
                    <li><a href="https://ianbicking.org/category/javascript.html">category: javascript</a></li>
                    <li><a href="https://ianbicking.org/category/misc.html">category: misc</a></li>
                    <li><a href="https://ianbicking.org/category/mozilla.html">category: mozilla</a></li>
                    </ul>
                </div>
                <div class="social">
                        <h2>elsewhere</h2>
                        <ul>
                            <li><a href="https://ianbicking.org/feeds/atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="https://twitter.com/ianbicking">@ianbicking</a></li>
                            <li><a href="https://hachyderm.io/@ianbicking">@ianbicking@hachyderm.io</a></li>
                            <li><a href="https://github.com/ianb">Github</a></li>
                        </ul>
                </div><!-- /.social -->
                <div class="archives">
                  <h2><a href="https://ianbicking.org/blog/">recent posts</a></h2>
                  <ul>
                    <li><a href="https://ianbicking.org/blog/2023/01/thoughts-on-voice-interfaces-2-llms.html">Thoughts On Voice Interfaces 2 years later:&nbsp;LLMs</a></li>
                    <li><a href="https://ianbicking.org/blog/2023/01/infinite-ai-array.html">Infinite <span class="caps">AI</span>&nbsp;Array</a></li>
                    <li><a href="https://ianbicking.org/blog/2020/11/firefox-was-always-enough.html">Firefox Was Always&nbsp;Enough</a></li>
                    <li><a href="https://ianbicking.org/blog/2020/09/project-ideas-2020.html">Project ideas for (what&#8217;s left of)&nbsp;2020</a></li>
                    <li><a href="https://ianbicking.org/blog/2020/09/a-history-of-projects.html">A History Of&nbsp;Projects</a></li>
                    <li><a href="https://ianbicking.org/blog/2020/08/thoughts-on-voice-interfaces.html">Thoughts on Voice&nbsp;Interfaces</a></li>
                    <li><a href="https://ianbicking.org/blog/2019/07/kling-axes-of-politics-technocrats.html">Kling&#8217;s Axes of Politics, and the&nbsp;Technocrats</a></li>
                    <li><a href="https://ianbicking.org/blog/2019/04/users-want-control-is-a-shrug.html"><span class="dquo">&#8220;</span>Users want control&#8221; is a shoulder&nbsp;shrug</a></li>
                    <li><a href="https://ianbicking.org/blog/2019/03/open-source-doesnt-make-money-by-design.html">Open Source Doesn&#8217;t Make Money Because It Isn&#8217;t Designed To Make&nbsp;Money</a></li>
                    <li><a href="https://ianbicking.org/blog/2019/03/firefox-experiments-i-would-have-liked.html">The Firefox Experiments I Would Have Liked To&nbsp;Try</a></li>
                  </ul>
                </div><!-- /.archives -->

                <div class="widgets">
                  <h2><a href="https://twitter.com/ianbicking">tweets</a></h2>
                  <a class="twitter-timeline" width="230" height="500" href="https://twitter.com/ianbicking" data-widget-id="319849964417187842" data-link-color="#aaae94">Tweets by @ianbicking</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

                </div><!-- /.widgets -->

        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
          This is the personal site of <a href="/">Ian Bicking</a>.  The opinions expressed here are my own.
        </footer><!-- /#contentinfo -->

<script src="/theme/instantclick.min.js"></script>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-2442258-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-2442258-1');
</script>
        </div><!-- /#main-container -->
        </div><!-- /#main-wrapper2 -->
        </div><!-- /#main-wrapper1 -->
</body>
</html>