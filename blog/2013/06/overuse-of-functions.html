<!DOCTYPE html>
<html lang="en">
<head>
        <title>The overuse of functions</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
          <link rel="stylesheet" href="https://ianbicking.org/theme/css/style.min.css">
        <!--<link rel="stylesheet" href="https://ianbicking.org/theme/css/main.css" type="text/css" />-->
        <link href="https://ianbicking.org/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="Ian Bicking: a blog Atom Feed" />
        <link rel="icon" href="https://ianbicking.org/favicon.ico">

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://ianbicking.org/css/ie.css"/>
                <script src="https://ianbicking.org/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="https://ianbicking.org/css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">
  <div id="main-wrapper1">
  <div id="main-wrapper2">
  <div id="main-container">
        <header id="banner" class="body">
                <h1><a href="https://ianbicking.org">Ian Bicking: a blog </a></h1>
        </header><!-- /#banner -->
<section id="content" class="body">
    <article>
        <header>
        <div>
            <div class="published" title="2013-06-11T00:00:00-05:00">
                Tuesday, June 11st, 2013
            </div>
            <h1 class="entry-title">
                <a
                    href="https://ianbicking.org/blog/2013/06/overuse-of-functions.html"
                    rel="bookmark"
                    title="Permalink to The overuse of functions"
                    >The overuse of&nbsp;functions</a
                >
            </h1>
        </div>
        </header>

        <div class="entry-content"><p>A programming quandry (related to <a href="https://plus.google.com/u/0/+IanBicking/posts/ipAD1j3QNT1">some thoughts I&#8217;ve had on locality</a>):</p>
<p>The prevailing wisdom says that you should keep your functions small and concise, refactoring and extracting functions as necessary.  But this hurts the locality of expectations that I have been thinking about.&nbsp;Consider:</p>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">updateUserStatus</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;active&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;li /&gt;&quot;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#userlist&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;user-&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#user-&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>Code like this is generally considered to be terrible – there&#8217;s logic for users and their status, mixed in with a bunch of very specific <span class="caps">UI</span>-related code.  (Which is all tied to a <span class="caps">DOM</span> state that is defined somewhere else entirely &#8212; but I&nbsp;digress.)</p>
<p>So a typical refactoring would&nbsp;be:</p>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">updateUserStatus</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;active&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">displayUserInList</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nx">removeUserFromList</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>With the obvious definition of <code>displayUserInList()</code> and <code>removeUserFromList()</code>.  But the first approach had certain invariants that the second does not.  Assuming you don&#8217;t mess with the <span class="caps">UI</span>/<span class="caps">DOM</span> directly, and assuming that <code>updateUserStatus()</code> is called when it needs to be called, the user will be in the list or not based strictly on the value of <code>user.status</code>. After refactoring there are functions that could be called in other contexts (e.g., <code>displayUserInList()</code>). You can look at the code and see that particular things happen when <code>updateUserStatus()</code> is called, but it&#8217;s not as easy to determine what is going to happen when inspect the code from the bottom up.  For instance, you want to understand why things end up in <code>&lt;ul id="userlist"&gt;&lt;/ul&gt;</code> &#8212; you search for <code>#userlist</code> but you now get two functions instead of one, and to understand the logic you have to trace that back to the calling function, and you have to wonder if now or in the future anyone else will call those&nbsp;functions.</p>
<p>The advantage of the first function is that blocks of code are strict. You execute from the top to the bottom, with clear control structures. When <span class="caps">GOTO</span> existed you couldn&#8217;t reason so well, but we&#8217;ve gotten rid of that!  (Of course there are still other exceptions.)  It&#8217;s not entirely clear what intention drives the refactoring (besides adherence to conventional standards of code beauty), but it&#8217;s probably more about code organization than about making the control flow more flexible. Extracting those functions means that you now have the power to make the <span class="caps">UI</span> inconsistent with the model, and that hardly seems like a&nbsp;feature.</p>
<p>And I have to wonder: are some of these basic patterns of &#8220;good&#8221; code there because we have poor tools for code organization? We express too many things with functions and methods and classes (and perhaps modules) because that&#8217;s all we have.  But those are full of unintended semantic&nbsp;meaning.</p>
<p>Anyone have examples of languages that have found novel ways of keeping code&nbsp;organized?</p>
<p><a href="https://plus.google.com/u/0/+IanBicking/posts/ajbi8QFDWD1">(Also there are comments on&nbsp;G+)</a></p></div>
        <!-- /.entry-content -->
          <div class="comments">
            <h2>Comments</h2>
            <table class='table table-striped'>
<tr><td style='padding-left: 0px' class='dU'>Peter Bengtsson</td><td class='dTS'>Tue, 11 Jun 2013</td></tr>
<tr><td style='padding-left: 0px' colspan='2' class='dMessage'><p>I agree. I'd sum it up as, let it be a full-fat function until something within is needed too by another full-fat function.</p></td></tr>
<tr><td style='padding-left: 0px' class='dU'>Ionel Cristian Mărieș</td><td class='dTS'>Tue, 11 Jun 2013</td></tr>
<tr><td style='padding-left: 0px' colspan='2' class='dMessage'><p>For such small amount of code you wouldn't bother but suppose it's 10 times longer ? I think making better abstractions for the ui would do it. But be generic, not specific - eg: implement a widget for a list of labels instead of a UpdateUserStatusWidget</p></td></tr>
<tr><td style='padding-left: 0px' class='dU'>buggyfunbunny</td><td class='dTS'>Wed, 12 Jun 2013</td></tr>
<tr><td style='padding-left: 0px' colspan='2' class='dMessage'><p>The result of this (not ready for prime time) OO meme (for the real deal read Meyer or Holub) is that one ends up with lots and lots o state in instance variables (by various names in various languages).  Keeping track of all that in one's head is tough.  Those with photographic memories probably do OK.  The functional languages exist in contraindication, but have a performance burden.</p><p>When we asked our high school English teacher how long a paper was supposed to be, he said, "organic length".  Too bad for us, since we hadn't a clue.</p><p>The result is that most OO style code ends up being written in the debugger, since that's the only way to keep track of the spaghetti!!</p></td></tr>
<tr><td style='padding-left: 0px' class='dU'>asbjornenge</td><td class='dTS'>Thu, 13 Jun 2013</td></tr>
<tr><td style='padding-left: 0px' colspan='2' class='dMessage'><p>I've seen this on many an occasion. A few years back I inherited quite a large java (liferay) application where the previous engineer had really taken this to heart. Every class contained a large number of 1 line functions with increasingly complicated naming. Trying to stitch together what was actually going on when a request hit a particular endpoint was a nightmare.</p><p>In our current object oriented languages and frameworks I think it is about finding a middle ground with what structurally makes sense with the concepts of the application and what is practical to maintain.</p><p>I'd also be interested to hear and learn about other language approaches and their (hopefully better) ways of organising logic.</p></td></tr>
<tr><td style='padding-left: 0px' class='dU'>asbjornenge</td><td class='dTS'>Wed, 10 Jul 2013</td></tr>
<tr><td style='padding-left: 0px' colspan='2' class='dMessage'><p>Would I be wrong to argue that this makes for a particular mess regarding procedural functions? I've recently started digging into functional programming (avoiding state, thinking in values, designing pure and chainable functions) and find it helps reduce complexity and ease control flow so it actually makes sense keeping procedures in single functions. Did that make sense? Anyway, Rich Hickey has more - <a href="http://www.youtube.com/watch?v=rI8tNMsozo0" rel="nofollow noopener" title="http://www.youtube.com/watch?v=rI8tNMsozo0">http://www.youtube.com/watc...</a></p></td></tr>
<tr><td style='padding-left: 0px' class='dU'>collinmanderson</td><td class='dTS'>Thu, 11 Jul 2013</td></tr>
<tr><td style='padding-left: 0px' colspan='2' class='dMessage'><p>Wow. I agree. I don't enjoy needing to skip through different functions to figure out what's going on. I find huge functions really easy to debug and follow.</p></td></tr>
<tr><td style='padding-left: 0px' class='dU'>interstar</td><td class='dTS'>Sat, 03 Aug 2013</td></tr>
<tr><td style='padding-left: 0px' colspan='2' class='dMessage'><p>Very good question. My immediate thought :</p><p>If your refactored code was like this :</p><p>function updateUserStatus() {<br>    var id = "user-"+<a href="http://user.id" rel="nofollow noopener" title="user.id">user.id</a>;<br>    if (user.status == "active") {<br>         addToList("#userlist",<a href="http://user.name" rel="nofollow noopener" title="user.name">user.name</a>,id);<br>    } else {<br>            removeFromList("#userlist",id);<br>     }<br>}</p><p>it would solve most of the problems. You aren't fussily creating extra functions for tiny fragments of functionality which are only relevant to narrow situations (ie. users, userlists).  Now your new functions are more generic and widely applicable. They're doing enough that it's worth the overhead of creating them. They're still usefully hiding the bit of complexity you DON'T want to think about here - the actual jQuery / HTML details of how lists are constructed - while keeping the important details - WHICH list you're updating, what bits of a user you show - in this locality rather than allowing them to become diffuse across your program.</p><p>Of course, you CAN'T prevent another bit of code updating the list itself somewhere. (That's more a quirk of the HTML environment you're working in where the DOM is global. In many analogous cases you could prevent most of the code having unauthorized access to a list simply by making it private within a class.)</p><p>This is a great question though. It's still a classic modularity problem  : how to keep closely related stuff together in one place, and unconnected stuff at arms length / in a substitutable form. But we tend not to have much explicit thinking down at such small granularities (compared to all the patterns for classes etc.)</p></td></tr>
</table>

        </div>
    </article>
</section>
        <section id="extras" class="body">
                <div class="links">
                  <h2><a href="https://ianbicking.org">here</a></h2>
                  <ul>
                    <li><a href="/blog/">blog</a></li>
                    <li><a href="/projects.html">projects</a></li>
                    <li><a href="https://ianbicking.org/archives.html">archives</a> &amp; <a href="https://ianbicking.org/categories.html">categories</a></li>
                    <li><a href="https://ianbicking.org/category/javascript.html">category: javascript</a></li>
                    <li><a href="https://ianbicking.org/category/misc.html">category: misc</a></li>
                    <li><a href="https://ianbicking.org/category/mozilla.html">category: mozilla</a></li>
                    </ul>
                </div>
                <div class="social">
                        <h2>elsewhere</h2>
                        <ul>
                            <li><a href="https://ianbicking.org/feeds/atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="https://twitter.com/ianbicking">@ianbicking</a></li>
                            <li><a href="https://hachyderm.io/@ianbicking">@ianbicking@hachyderm.io</a></li>
                            <li><a href="https://github.com/ianb">Github</a></li>
                        </ul>
                </div><!-- /.social -->
                <div class="archives">
                  <h2><a href="https://ianbicking.org/blog/">recent posts</a></h2>
                  <ul>
                    <li><a href="https://ianbicking.org/blog/2020/11/firefox-was-always-enough.html">Firefox Was Always&nbsp;Enough</a></li>
                    <li><a href="https://ianbicking.org/blog/2020/09/project-ideas-2020.html">Project ideas for (what&#8217;s left of)&nbsp;2020</a></li>
                    <li><a href="https://ianbicking.org/blog/2020/09/a-history-of-projects.html">A History Of&nbsp;Projects</a></li>
                    <li><a href="https://ianbicking.org/blog/2020/08/thoughts-on-voice-interfaces.html">Thoughts on Voice&nbsp;Interfaces</a></li>
                    <li><a href="https://ianbicking.org/blog/2019/07/kling-axes-of-politics-technocrats.html">Kling&#8217;s Axes of Politics, and the&nbsp;Technocrats</a></li>
                    <li><a href="https://ianbicking.org/blog/2019/04/users-want-control-is-a-shrug.html"><span class="dquo">&#8220;</span>Users want control&#8221; is a shoulder&nbsp;shrug</a></li>
                    <li><a href="https://ianbicking.org/blog/2019/03/open-source-doesnt-make-money-by-design.html">Open Source Doesn&#8217;t Make Money Because It Isn&#8217;t Designed To Make&nbsp;Money</a></li>
                    <li><a href="https://ianbicking.org/blog/2019/03/firefox-experiments-i-would-have-liked.html">The Firefox Experiments I Would Have Liked To&nbsp;Try</a></li>
                    <li><a href="https://ianbicking.org/blog/2019/01/overengaged-knowledge-worker.html">The Over-engaged Knowledge&nbsp;Worker</a></li>
                    <li><a href="https://ianbicking.org/blog/2019/01/we-need-open-hosting-platforms.html">We Need Open Hosting&nbsp;Platforms</a></li>
                  </ul>
                </div><!-- /.archives -->

                <div class="widgets">
                  <h2><a href="https://twitter.com/ianbicking">tweets</a></h2>
                  <a class="twitter-timeline" width="230" height="500" href="https://twitter.com/ianbicking" data-widget-id="319849964417187842" data-link-color="#aaae94">Tweets by @ianbicking</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

                </div><!-- /.widgets -->

        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
          This is the personal site of <a href="/">Ian Bicking</a>.  The opinions expressed here are my own.
        </footer><!-- /#contentinfo -->

<script src="/theme/instantclick.min.js"></script>
    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-2442258-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>
        </div><!-- /#main-container -->
        </div><!-- /#main-wrapper2 -->
        </div><!-- /#main-wrapper1 -->
</body>
</html>